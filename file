GiGGGefter
2016/04/13 16:22:58 1011252 INFO  [apply_result_s] Updating PhrasePrice with inner join
2016/04/13 16:23:19 1011252 INFO  [update_phrase_] Done forming ABPrice100_75532_1Group
2016/04/13 16:23:48 1011252 INFO  [update_phrase_] Done forming ABPrice100_75532_1GroupBanners
2016/04/13 16:23:48 1011252 INFO  [update_phrase_] update PhrasePrice : join with ABPrice100_75532_1GroupBanners on BannerID,PhraseID,ContextT
ype
2016/04/13 16:24:53 1011252 INFO  [update_phrase_] Done applying to PhrasePrice
2016/04/13 16:24:53 1011252 INFO  [update_phrase_] Done forming ABPrice100_75532_1Group
2016/04/13 16:24:53 1011252 INFO  [update_phrase_] Done forming ABPrice100_75532_1GroupBanners
2016/04/13 16:24:53 1011252 INFO  [update_phrase_] update PhrasePrice : join with ABPrice100_75532_1GroupBanners on BannerID,PhraseID,ContextT
ype
2016/04/13 16:24:53 1011252 INFO  [update_phrase_] Done applying to PhrasePrice
2016/04/13 16:24:53 1011252 INFO  [update_phrase_] Done forming ABPrice100_75532_1Group
2016/04/13 16:24:53 1011252 INFO  [update_phrase_] Done forming ABPrice100_75532_1GroupBanners
2016/04/13 16:24:53 1011252 INFO  [update_phrase_] update PhrasePrice : join with ABPrice100_75532_1GroupBanners on BannerID,PhraseID,ContextT
ype
2016/04/13 16:24:53 1011252 INFO  [update_phrase_] Done applying to PhrasePrice

Before
2016/04/13 16:01:24 738239 INFO  [apply_result_s] Updating PhrasePrice with inner join
2016/04/13 16:01:45 738239 INFO  [update_phrase_] Done forming ABPrice100_75531_1Group
2016/04/13 16:02:14 738239 INFO  [update_phrase_] Done forming ABPrice100_75531_1GroupBanners
2016/04/13 16:02:14 738239 INFO  [update_phrase_] update PhrasePrice : join with ABPrice100_75531_1GroupBanners on BannerID,PhraseID,ContextTy
pe
2016/04/13 16:02:59 738239 INFO  [update_phrase_] Done applying to PhrasePrice
2016/04/13 16:02:59 738239 INFO  [update_phrase_] Done forming ABPrice100_75531_1Group
2016/04/13 16:02:59 738239 INFO  [update_phrase_] Done forming ABPrice100_75531_1GroupBanners
2016/04/13 16:02:59 738239 INFO  [update_phrase_] update PhrasePrice : join with ABPrice100_75531_1GroupBanners on BannerID,PhraseID,ContextTy
pe
2016/04/13 16:02:59 738239 INFO  [update_phrase_] Done applying to PhrasePrice
2016/04/13 16:02:59 738239 INFO  [update_phrase_] Done forming ABPrice100_75531_1Group
2016/04/13 16:02:59 738239 INFO  [update_phrase_] Done forming ABPrice100_75531_1GroupBanners
2016/04/13 16:02:59 738239 INFO  [update_phrase_] update PhrasePrice : join with ABPrice100_75531_1GroupBanners on BannerID,PhraseID,ContextTy
pe
2016/04/13 16:02:59 738239 INFO  [update_phrase_] Done applying to PhrasePrice


========

PlaceID = 542:
	HourCategory
	ConvHourCategoryPos
	HourCategoryPos
	CategoryClicksDistShard
	OrderTarget

=====

basic_packages/yabs-yt-api/Yabs/YT.pm:	'locke' => {
basic_packages/yabs-yt-api/Yabs/YT.pm:			"fol01.locke.yt.yandex.net:9010",
basic_packages/yabs-yt-api/Yabs/YT.pm:			"iva01.locke.yt.yandex.net:9010",
basic_packages/yabs-yt-api/Yabs/YT.pm:			"sas01.locke.yt.yandex.net:9010",
basic_packages/yabs-yt-api/Yabs/YT.pm:			"fol01.locke.yt.yandex.net:9012",
basic_packages/yabs-yt-api/Yabs/YT.pm:			"iva01.locke.yt.yandex.net:9012",
basic_packages/yabs-yt-api/Yabs/YT.pm:			"sas01.locke.yt.yandex.net:9012",
stat/yabs-log-chopper/Yabs/LogChopper.pm:	my $yt = yt_connect(anthill => 'locke', user => $config->{$base}->{yt_user});
stat/yabs-bsyt/load-apps-from-static-yt.pl:my $yt = yt_connect(anthill => 'locke', user => 'yabs_bsyt_applicationloader');




=====
r2254105
mysql> select * from ExportABPrice where BannerID = 148026204 and PhraseID = 249152;
+------------+-----------+----------+-------------+------+----------+--------+----------+----------+
| PriorityID | BannerID  | PhraseID | ContextType | Cost | FlatCost | Export | Currency | ActionID |
+------------+-----------+----------+-------------+------+----------+--------+----------+----------+
|          0 | 148026204 |   249152 |           2 | 3000 |   507000 |      1 |        1 |       14 |
+------------+-----------+----------+-------------+------+----------+--------+----------+----------+
1 row in set (0.00 sec)



r2258120 | olegts | 2016-03-25 18:56:12 +0300 (Пт., 25 марта 2016) | 4 lines
r2257049 | olegts | 2016-03-24 22:23:36 +0300 (Чт., 24 марта 2016) | 4 lines
r2257039 | olegts | 2016-03-24 22:07:09 +0300 (Чт., 24 марта 2016) | 4 lines
r2256951 NOT OK | olegts | 2016-03-24 21:02:34 +0300 (Чт., 24 марта 2016) | 4 lines
r2256864 | olegts | 2016-03-24 20:11:09 +0300 (Чт., 24 марта 2016) | 4 lines
r2256730 NOT OK | olegts | 2016-03-24 19:03:39 +0300 (Чт., 24 марта 2016) | 4 lines
r2255293 | olegts | 2016-03-23 19:39:13 +0300 (Ср., 23 марта 2016) | 5 lines
r2254105 NOT OK | olegts | 2016-03-23 03:28:46 +0300 (Ср., 23 марта 2016) | 4 lines
r2252507 OK | olegts | 2016-03-21 22:04:46 +0300 (Пн., 21 марта 2016) | 5 lines
r2252499 | olegts | 2016-03-21 21:54:37 +0300 (Пн., 21 марта 2016) | 5 lines
r2250701 | olegts | 2016-03-20 00:32:16 +0300 (Вс., 20 марта 2016) | 4 lines
r2250647 | olegts | 2016-03-19 21:10:00 +0300 (Сб., 19 марта 2016) | 4 lines
r2250646 | olegts | 2016-03-19 21:07:33 +0300 (Сб., 19 марта 2016) | 4 lines
r2187048 | olegts | 2016-03-15 02:05:34 +0300 (Вт., 15 марта 2016) | 6 lines
r2187002 | olegts | 2016-03-14 23:34:22 +0300 (Пн., 14 марта 2016) | 5 lines
r2186842 | olegts | 2016-03-14 21:00:12 +0300 (Пн., 14 марта 2016) | 4 lines
r2184144 | pgriffin | 2016-03-10 22:43:05 +0300 (Чт., 10 марта 2016) | 3 lines
r2181503 | olegts | 2016-03-08 21:30:27 +0300 (Вт., 08 марта 2016) | 6 lines

OK


hosts = []; $('#host_packages_table').find('tr').each(function(undefined, tr) { td = $(tr).find('td')[0]; hosts.push($($(td).find('a')).html())}); print hosts.join(",")

bssoap-pre01e

bstat     | collect-undoevent              | 0   | 0     | 2
bstat     | collect-visit                  | 0   | 0     | 2
bstat     | collect-auction                | 0   | 0     | 3
bstat     | collect-localorderinfo         | 0   | 0     | 3
bstat     | collect-phraseprice            | 0   | 0     | 3

bsut      | collect-chevent                | 0   | 0     | 3
bsut      | collect-undoevent              | 0   | 0     | 3
bsut      | collect-dsp                    | 0   | 0     | 6

bstat     | collect-qtailstat              | 10  | 9.97  | 11
bspstat   | collect-undodspmon             | 2   | 15.96 | 32

bsarchive | collect-serptaghits            | 0   | 0.02  | 7
bsarchive | collect-undofraudbits          | 0   | 0.01  | 7
bsarchive | collect-undodsp                | 0   | 0.02  | 9
bsarchive | collect-chevent                | 0   | 0.07  | 10
bsarchive | collect-dsp_object             | 0   | 0.02  | 10

bsarchive | collect-event_bad              | 0   | 4.17  | 109
bsarchive | collect-qtail                  | 0   | 4.04  | 109
bsarchive | collect-abuse                  | 0   | 5.5   | 110
bsarchive | collect-auction                | 0   | 6.45  | 110
bsarchive | collect-bscount                | 0   | 4.48  | 110
bsarchive | collect-dsp                    | 0   | 5.02  | 110
bsarchive | collect-hit                    | 0   | 0.92  | 110
bsarchive | collect-performance            | 0   | 5.21  | 110
bsarchive | collect-rtb                    | 0   | 3.76  | 110
bsarchive | collect-searchvisit            | 0   | 0.12  | 110
bsarchive | collect-setuid                 | 0   | 4.14  | 110
bsarchive | collect-setuiddetail           | 0   | 4.38  | 110
bsarchive | collect-visit                  | 0   | 0.09  | 110
bsarchive | collect-xuniqs                 | 0   | 4.12  | 110


legts@bstat01i:/mnt/raid/home/olegts$ monrun|grep logcount-ng
	logcount-ng = Count of PhrasePriceChangeLog=2745 > limit=600
 production environment
olegts@bstat01i:/mnt/raid/home/olegts$
=====


mysql> select count(*) from TimeOrderParams ;
+----------+
| count(*) |
+----------+
|  2047230 |
+----------+
1 row in set (0.00 sec)


	тут то, что нас интересует
	mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 = MaxClickCost;
	+----------+
	| count(*) |
	+----------+
	|  1145292 |
	+----------+
	1 row in set (0.55 sec)

	ql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 != MaxClickCost;
	+----------+
	| count(*) |
	+----------+
	|   755475 |
	+----------+
	1 row in set (0.45 sec)


		mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 > MaxClickCost;
		+----------+
		| count(*) |
		+----------+
		|   568273 |
		+----------+
		1 row in set (0.44 sec)


			mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 > MaxClickCost  and ceiling(OrderBalance/1e4) * 1e4 = MaxClickCost ;
			+----------+
			| count(*) |
			+----------+
			|   476879 |
			+----------+
			1 row in set (0.51 sec)


			mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 > MaxClickCost  and ceiling(OrderBalance/1e4) * 1e4 != MaxClickCost ;
			+----------+
			| count(*) |
			+----------+
			|    91394 |
			+----------+
			1 row in set (0.46 sec)

				mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 > MaxClickCost  and ceiling(OrderBalance/1e4) * 1e4 != MaxClickCost and (MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10 or MaxClickCost = truncate(LimitWeek/1e5, 0)*1e4) ;
				+----------+
				| count(*) |
				+----------+
				|    44887 |
				+----------+
				1 row in set (0.00 sec)

				mysql>  select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 > MaxClickCost  and ceiling(OrderBalance/1e4) * 1e4 != MaxClickCost and not(MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10 or MaxClickCost = truncate(LimitWeek/1e5, 0)*1e4) ;
				+----------+
				| count(*) |
				+----------+
				|    46507 |
				+----------+
				1 row in set (0.00 sec)

					mysql>  select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 > MaxClickCost  and ceiling(OrderBalance/1e4) * 1e4 != MaxClickCost and not(MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10 or MaxClickCost = truncate(LimitWeek/1e5, 0)*1e4) and (truncate(BidLimiterLowerMoneyCoef * LimitWeek/10 /1e4, 0)* 1e4 = MaxClickCost) ;
					+----------+
					| count(*) |
					+----------+
					|    14222 |
					+----------+
					1 row in set (0.00 sec)


					mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 > MaxClickCost  and ceiling(OrderBalance/1e4) * 1e4 != MaxClickCost and not(MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10 or MaxClickCost = truncate(LimitWeek/1e5, 0)*1e4) and not(truncate(BidLimiterLowerMoneyCoef * LimitWeek/10 /1e4, 0)* 1e4 = MaxClickCost) ;
					+----------+
					| count(*) |
					+----------+
					|    32285 |
					+----------+
					1 row in set (0.00 sec)


						mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 > MaxClickCost  and ceiling(OrderBalance/1e4) * 1e4 != MaxClickCost and not(MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10 or MaxClickCost = truncate(LimitWeek/1e5, 0)*1e4) and not(truncate(BidLimiterLowerMoneyCoef * LimitWeek/10 /1e4, 0)* 1e4 = MaxClickCost) and SelectedABType = 0;
						+----------+
						| count(*) |
						+----------+
						|     6583 |
						+----------+
						1 row in set (0.18 sec)

						mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 > MaxClickCost  and ceiling(OrderBalance/1e4) * 1e4 != MaxClickCost and not(MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10 or MaxClickCost = truncate(LimitWeek/1e5, 0)*1e4) and not(truncate(BidLimiterLowerMoneyCoef * LimitWeek/10 /1e4, 0)* 1e4 = MaxClickCost) and SelectedABType != 0;
						\+----------+
						| count(*) |
						+----------+
						|    25702 |
						+----------+
						1 row in set (0.53 sec)
v


							mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 > MaxClickCost  and ceiling(OrderBalance/1e4) * 1e4 != MaxClickCost and not(MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10 or MaxClickCost = truncate(LimitWeek/1e5, 0)*1e4) and not(truncate(BidLimiterLowerMoneyCoef * LimitWeek/10 /1e4, 0)* 1e4 = MaxClickCost) and SelectedABType != 0 and MaxClickCost = 15000000;;
							+----------+
							| count(*) |
							+----------+
							|     3002 |
							+----------+
							1 row in set (0.15 sec)

							ERROR:
							No query specified

							mysql>  select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 > MaxClickCost  and ceiling(OrderBalance/1e4) * 1e4 != MaxClickCost and not(MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10 or MaxClickCost = truncate(LimitWeek/1e5, 0)*1e4) and not(truncate(BidLimiterLowerMoneyCoef * LimitWeek/10 /1e4, 0)* 1e4 = MaxClickCost) and SelectedABType != 0 and MaxClickCost != 15000000;
							+----------+
							| count(*) |
							+----------+
							|    22599 |
							+----------+
							1 row in set (0.55 sec)

								mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 > MaxClickCost  and ceiling(OrderBalance/1e4) * 1e4 != MaxClickCost and not(MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10 or MaxClickCost = truncate(LimitWeek/1e5, 0)*1e4) and not(truncate(BidLimiterLowerMoneyCoef * LimitWeek/10 /1e4, 0)* 1e4 = MaxClickCost) and SelectedABType != 0 and MaxClickCost != 15000000 and (OrderBalance < 10000  and MaxClickCost=10000 )  ;
								+----------+
								| count(*) |
								+----------+
								|     3039 |
								+----------+
								1 row in set (0.00 sec)


								mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 > MaxClickCost  and ceiling(OrderBalance/1e4) * 1e4 != MaxClickCost and not(MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10 or MaxClickCost = truncate(LimitWeek/1e5, 0)*1e4) and not(truncate(BidLimiterLowerMoneyCoef * LimitWeek/10 /1e4, 0)* 1e4 = MaxClickCost) and SelectedABType != 0 and MaxClickCost != 15000000 and not(OrderBalance < 10000  and MaxClickCost=10000 )  ;
								+----------+
								| count(*) |
								+----------+
								|    19560 |
								+----------+
1 row in set (0.00 sec)

										mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 > MaxClickCost  and ceiling(OrderBalance/1e4) * 1e4 != MaxClickCost and not(MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10 or MaxClickCost = truncate(LimitWeek/1e5, 0)*1e4) and not(truncate(BidLimiterLowerMoneyCoef * LimitWeek/10 /1e4, 0)* 1e4 = MaxClickCost) and SelectedABType != 0 and MaxClickCost != 15000000 and not(OrderBalance < 10000  and MaxClickCost=10000 )  and (BidLimiterLowerMoneyCoef != -1 and ceil(LimitWeek /10 * 0.131849274802447 / 1e4) * 1e4 = MaxClickCost)  ;
										+----------+
										| count(*) |
										+----------+
										|       21 |
										+----------+
										1 row in set (0.67 sec)

										ql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 > MaxClickCost  and ceiling(OrderBalance/1e4) * 1e4 != MaxClickCost and not(MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10 or MaxClickCost = truncate(LimitWeek/1e5, 0)*1e4) and not(truncate(BidLimiterLowerMoneyCoef * LimitWeek/10 /1e4, 0)* 1e4 = MaxClickCost) and SelectedABType != 0 and MaxClickCost != 15000000 and not(OrderBalance < 10000  and MaxClickCost=10000 )  and !(BidLimiterLowerMoneyCoef != -1 and ceil(LimitWeek /10 * 0.131849274802447 / 1e4) * 1e4 = MaxClickCost)  ;
										+----------+
										| count(*) |
										+----------+
										|    19550 |
										+----------+
										1 row in set (0.51 sec)
---

										mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 > MaxClickCost  and ceiling(OrderBalance/1e4) * 1e4 != MaxClickCost and not(MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10 or MaxClickCost = truncate(LimitWeek/1e5, 0)*1e4) and not(truncate(BidLimiterLowerMoneyCoef * LimitWeek/10 /1e4, 0)* 1e4 = MaxClickCost) and SelectedABType != 0 and MaxClickCost != 15000000 and not(OrderBalance < 10000  and MaxClickCost=10000 )  and not(BidLimiterLowerMoneyCoef != -1)  and not(truncate(UserMaxCost / 1e4, 0) * 1e4 = truncate(MaxClickCost/1e4, 0) * 1e4) and !(BidLimiterUpperMoneyCoef = 0 and MaxClickCost = 10000) and not(BidLimiterUpperClicksCoef = 0 and MaxClickCost = 10000) ;
										+----------+
										| count(*) |
										+----------+
										|     8796 |
										+----------+
										1 row in set (0.00 sec)


		mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 < MaxClickCost;
		+----------+
		| count(*) |
		+----------+
		|   201239 |
		+----------+
		1 row in set (0.51 sec)

			Gumysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 < MaxClickCost and (MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10) ;
			+----------+
			| count(*) |
			+----------+
			|    60382 |
			+----------+
			1 row in set (0.55 sec)

				mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 < MaxClickCost and (MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10) and SelectedABType = 0;
				+----------+
				| count(*) |
				+----------+
				|    58328 |
				+----------+
				1 row in set (0.20 sec)

				mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 < MaxClickCost and (MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10) and SelectedABType != 0;
				+----------+
				| count(*) |
				+----------+
				|      106 |
				+----------+
				1 row in set (0.54 sec)

			mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 < MaxClickCost and MaxClickCost != ceil(LimitWeek/1e5)*1e4 and MaxClickCost != LimitWeek/10 ;
			+----------+
			| count(*) |
			+----------+
			|   140857 |
			+----------+
			1 row in set (0.57 sec)

				mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 < MaxClickCost and not(MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10) and MaxClickCost = 15000000;
				+----------+
				| count(*) |
				+----------+
				|   127271 |
				+----------+
				1 row in set (0.19 sec)

					mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 < MaxClickCost and not(MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10) and MaxClickCost = 15000000  and SelectedABType = 0 ;
					+----------+
					| count(*) |
					+----------+
					|   122326 |
					+----------+
					1 row in set (0.19 sec)

					mysql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 < MaxClickCost and not(MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10) and MaxClickCost = 15000000  and SelectedABType != 0 ;
					+----------+
					| count(*) |
					+----------+
					|     2343 |
					+----------+
					1 row in set (0.00 sec)
					or  MaxClickCost = LimitWeek/10) and MaxClickCost = 15000000  and SelectedABType = 0;


				ql> select count(*) from TimeOrderParams where ceil(Formula1 / 10000) *10000 < MaxClickCost and not(MaxClickCost = ceil(LimitWeek/1e5)*1e4 or  MaxClickCost = LimitWeek/10) and MaxClickCost != 15000000;
				+----------+
				| count(*) |
				+----------+
				|    13586 |
				+----------+
				1 row in set (0.00 sec)

				это меньше процента, дальше не объясняем




 sum((avg(ceil(MaxClickCost/1e4) - ceil(Formula1/1e4)) <= 1) and (avg(ceil(MaxClickCost/1e4) - ceil(OrderBalance/1e4)) <= 1) and (avg(ceil(MaxClickCost/1e4) - ceil(LimitWeek/10/1e4)) <= 1)  )

MaxClickCost ~=~ Formula1 : 1043124 (58%)
not MaxClickCost ~=~ Formula1 : 753100 (41%)
  MaxClickCost ~=~ OrderBalance : 479421 (63%)
  not MaxClickCost ~=~ OrderBalance : 273679 (36%)
    SelectedABType = 0 : 215156 (78%)
    not SelectedABType = 0 : 58523 (21%)
      MaxClickCost ~=~ LimitWeek/10 : 26512 (45%)
      not MaxClickCost ~=~ LimitWeek/10 : 32011 (54%)
        MaxClickCost ~=~ BidLimiterLowerMoneyCoef * LimitWeek / 10 : 14124 (44%)
        not MaxClickCost ~=~ BidLimiterLowerMoneyCoef * LimitWeek / 10 : 17887 (55%)
          BidLimiterUpperMoneyCoef = 0 and MaxClickCost = 10000 : 7318 (40%)
          not BidLimiterUpperMoneyCoef = 0 and MaxClickCost = 10000 : 10569 (59%)
            MaxClickCost = 15000000 : 5225 (49%)
            not MaxClickCost = 15000000 : 5344 (50%)
              BidLimiterUpperClicksCoef = 0 and MaxClickCost = 10000 : 0 (0%)
              not BidLimiterUpperClicksCoef = 0 and MaxClickCost = 10000 : 5344 (100%)




2016/04/08 13:56:28 165090 INFO  [         BEGIN] MYSQL_NOW = now(), mysql_generation_start_time = '20160408135500'
2016/04/08 14:07:11 165090 INFO  [update_phrase_] Done forming ABPrice133_52447_1GroupBanners

=======


["clicks:cost:no_rtb",
"clicks:cost:with_rtb"]

["clicks:count:no_rtb",
"clicks:count:with_rtb",
"shows:count:with_rtb",
"clicks:count:all_search",
"shows:count:no_rtb",
"clicks:cost:all_search",
"shows:count:all_search"]

["clicks:count:with_rtb",
"shows:count:with_rtb",
"clicks:cost:all_search",
"clicks:cost:no_rtb",
"shows:count:all_search",
"clicks:cost:with_rtb",
"clicks:count:no_rtb",
"clicks:count:all_search",
"shows:count:no_rtb"]



https://bsint2.yandex-team.ru/cgi-bin/redis_image.cgi?clusters_ports=["bsspark:8102"]&period=10&from=-600s&until=-0d&series=["clicks:count:an_with_rtb","shows:count:an_with_rtb","clicks:count:mobile_search","clicks:count:big_search","clicks:cost:big_search","clicks:count:partner_search","clicks:count:mobile_app_search","clicks:count:an_no_rtb","shows:count:mobile_app_search","shows:count:an_no_rtb","shows:count:partner_search","shows:count:big_search","shows:count:mobile_search"]


https://bsint2.yandex-team.ru/cgi-bin/redis_image.cgi?clusters_ports=["bsspark:8102"]&period=10&from=-600s&until=-0d&series=["clicks:cost:an_no_rtb","clicks:cost:an_with_rtb","clicks:cost:mobile_app_search","clicks:cost:mobile_search","clicks:cost:partner_search"]


https://bsint2.yandex-team.ru/cgi-bin/redis_image.cgi?clusters_ports=["bsspark:8102"]&period=10&from=-600s&until=-0d&series=["clicks:cost:an_no_rtb","clicks:count:an_with_rtb","shows:count:an_with_rtb","clicks:count:mobile_search","clicks:cost:mobile_app_search","clicks:cost:mobile_search","clicks:count:big_search","clicks:count:partner_search","clicks:cost:big_search","clicks:cost:an_with_rtb","clicks:count:mobile_app_search","clicks:cost:partner_search","shows:count:mobile_app_search","clicks:count:an_no_rtb","shows:count:an_no_rtb","shows:count:partner_search","shows:count:big_search","shows:count:mobile_search"]
https://bsint2.yandex-team.ru/cgi-bin/redis_image.cgi?clusters_ports=["bsspark:8102"]&period=10&from=-600s&until=-0d&series=["clicks:count:an_with_rtb","shows:count:an_with_rtb","clicks:count:mobile_search","clicks:count:mobile_app_search","shows:count:mobile_app_search","clicks:count:an_no_rtb","clicks:count:big_search","shows:count:partner_search","shows:count:an_no_rtb","clicks:count:partner_search","clicks:cost:big_search","shows:count:big_search","shows:count:mobile_search"]
https://bsint2.yandex-team.ru/cgi-bin/redis_image.cgi?clusters_ports=["bsspark:8102"]&period=10&from=-600s&until=-0d&series=["clicks:cost:an_no_rtb","clicks:cost:mobile_search","clicks:cost:partner_search","clicks:cost:mobile_app_search","clicks:cost:an_with_rtb"]



https://bsint2.yandex-team.ru/cgi-bin/redis_image.cgi?clusters_ports=["bsspark:8102"]&period=10&from=-600s&until=-0d&series=["clicks:count:an_with_rtb","shows:count:an_with_rtb","clicks:count:mobile_search","shows:count:mobile_app_search","clicks:count:an_no_rtb","clicks:count:big_search","shows:count:partner_search","shows:count:an_no_rtb","clicks:count:partner_search","clicks:cost:big_search","shows:count:big_search","shows:count:mobile_search"]



https://bsint2.yandex-team.ru/cgi-bin/redis_image.cgi?clusters_ports=["bsspark:8102"]&period=10&from=-600s&until=-0d&series=["clicks:cost:an_no_rtb","clicks:cost:mobile_search","clicks:cost:partner_search","clicks:cost:mobile_app_search","clicks:cost:an_with_rtb","clicks:count:mobile_app_search"]

2016/04/15 02:25:17 15838 INFO  [get_avg_strate] Calc max cost using sigma: value = 38649.0437007182 (x = 0.0294091435185185, real_reserve = 338793.3299454, avg_cost = 29999.9997, real_spent = 374)


==================================

select  truncate(log(truncate(Formula2/1e4, 0)) - log(truncate(Formula1/1e4,0)), 1), count(*) from TimeOrderParams where abs(ceil(MaxClickCost/1e4) - ceil(Formula1/1e4)) <= 1  and Formula1 >= 0 group by 1;


mysql> select  truncate(log(truncate(Formula2/1e4, 0)) - log(truncate(Formula1/1e4,0)), 1), count(*) from TimeOrderParams where abs(ceil(MaxClickCost/1e4) - ceil(Formula1/1e4)) <= 1  and Formula1 >= 0 and Formula1 <= AvgCost *2 and AvgCost > 0 group by 1;
+-----------------------------------------------------------------------------+----------+
| truncate(log(truncate(Formula2/1e4, 0)) - log(truncate(Formula1/1e4,0)), 1) | count(*) |
+-----------------------------------------------------------------------------+----------+
|                                                                        -0.6 |       13 |
|                                                                        -0.5 |      198 |
|                                                                        -0.4 |     1327 |
|                                                                        -0.3 |     3381 |
|                                                                        -0.2 |     8302 |
|                                                                        -0.1 |    28693 |
|                                                                         0.0 |    87026 |
|                                                                        -0.0 |    38221 |
|                                                                         0.1 |    60595 |
|                                                                         0.2 |    70517 |
|                                                                         0.3 |     7914 |
|                                                                         0.4 |     6695 |
|                                                                         0.5 |     4443 |
|                                                                         0.6 |      418 |
|                                                                         1.0 |       33 |
+-----------------------------------------------------------------------------+----------+
15 rows in set (0.00 sec)

mysql> select  truncate(log(truncate(Formula2/1e4, 0)) - log(truncate(Formula1/1e4,0)), 1), count(*) from TimeOrderParams where abs(ceil(MaxClickCost/1e4) - ceil(Formula1/1e4)) <= 1  and Formula1 >= 0 and Formula1 > AvgCost *2 and AvgCost > 0 group by 1;
+-----------------------------------------------------------------------------+----------+
| truncate(log(truncate(Formula2/1e4, 0)) - log(truncate(Formula1/1e4,0)), 1) | count(*) |
+-----------------------------------------------------------------------------+----------+
|                                                                        -3.5 |       10 |
|                                                                        -3.4 |       16 |
|                                                                        -3.3 |       14 |
|                                                                        -3.2 |       17 |
|                                                                        -3.1 |       12 |
|                                                                        -3.0 |       24 |
|                                                                        -2.9 |       23 |
|                                                                        -2.8 |       46 |
|                                                                        -2.7 |       79 |
|                                                                        -2.6 |       92 |
|                                                                        -2.5 |      103 |
|                                                                        -2.4 |      190 |
|                                                                        -2.3 |      170 |
|                                                                        -2.2 |      170 |
|                                                                        -2.1 |      201 |
|                                                                        -2.0 |      273 |
|                                                                        -1.9 |      298 |
|                                                                        -1.8 |      337 |
|                                                                        -1.7 |      281 |
|                                                                        -1.6 |      451 |
|                                                                        -1.5 |      439 |
|                                                                        -1.4 |      443 |
|                                                                        -1.3 |      541 |
|                                                                        -1.2 |      701 |
|                                                                        -1.1 |      936 |
|                                                                        -1.0 |     1106 |
|                                                                        -0.9 |     1358 |
|                                                                        -0.8 |     1817 |
|                                                                        -0.7 |     2223 |
|                                                                        -0.6 |     2973 |
|                                                                        -0.5 |     4240 |
|                                                                        -0.4 |   268813 |
|                                                                        -0.3 |   148893 |
|                                                                        -0.2 |   119074 |
|                                                                        -0.1 |    57894 |
|                                                                         0.0 |    13989 |
|                                                                        -0.0 |    18778 |
+-----------------------------------------------------------------------------+----------+
37 rows in set (0.00 sec)

mysql>



https://bsint2.yandex-team.ru/cgi-bin/redis_image.cgi?clusters_ports=["bsspark:8102"]&period=10&from=-600s&until=-0d&series=["clicks:count:an_with_rtb","shows:count:an_with_rtb","clicks:count:mobile_search","shows:count:mobile_app_search","clicks:count:an_no_rtb","clicks:count:big_search","shows:count:partner_search","shows:count:an_no_rtb","clicks:count:partner_search","shows:count:big_search","shows:count:mobile_search"]




https://bsint2.yandex-team.ru/cgi-bin/redis_image.cgi?clusters_ports=["bsspark:8102"]&period=10&from=-600s&until=-0d&series=["clicks:cost:an_no_rtb","clicks:cost:mobile_search","clicks:cost:partner_search","clicks:count:mobile_app_search","clicks:cost:mobile_app_search","clicks:cost:an_with_rtb","clicks:cost:big_search"]

https://bsint2.yandex-team.ru/cgi-bin/redis_image.cgi?clusters_ports=["bsspark:8102"]&period=10&from=-600s&until=-0d&series=["clicks:count:an_with_rtb","shows:count:an_with_rtb","shows:count:mobile_app_search","clicks:count:an_no_rtb","clicks:count:big_search","shows:count:partner_search","shows:count:an_no_rtb","clicks:count:partner_search","shows:count:big_search","shows:count:mobile_search"]



https://bsint2.yandex-team.ru/cgi-bin/redis_image.cgi?clusters_ports=["bsspark:8102"]&period=10&from=-600s&until=-0d&series=["clicks:cost:an_no_rtb","clicks:cost:mobile_search","clicks:cost:partner_search","clicks:count:mobile_app_search","clicks:cost:big_search","clicks:cost:mobile_app_search","clicks:cost:an_with_rtb","clicks:count:mobile_search"]

r2278299 | zasalamel | 2016-04-14 14:43:45 +0300 (Чт., 14 апр. 2016) | 1 line
r2273432 | pgriffin | 2016-04-08 23:08:49 +0300 (Пт., 08 апр. 2016) | 3 lines
r2262464 | say | 2016-03-30 15:24:04 +0300 (Ср., 30 марта 2016) | 1 line
r2256953 NOT OK | pgriffin | 2016-03-24 21:04:10 +0300 (Чт., 24 марта 2016) | 3 lines
r2256032 NOT OK | say | 2016-03-24 14:22:50 +0300 (Чт., 24 марта 2016) | 2 lines
r2255948 NOT OK | say | 2016-03-24 13:42:14 +0300 (Чт., 24 марта 2016) | 3 lines
r2192633 OK | olegts | 2016-03-18 21:27:39 +0300 (Пт., 18 марта 2016) | 5 lines

r2255948 -- поломка теста


(P1|P110953|P39)&P1090&P2
(P1|P110953|P67)&P1090&P2


Error    : bstat45e.yandex.ru,bstat139f.yandex.ru,bstat141f.yandex.ru,bstat132h.yandex.ru
/home/yabs/stat/log/autobudget.log.1


2016/04/18 14:31:48 937075 INFO  [apply_result_s] Updating PhrasePrice with inner join
2016/04/18 14:31:53 937075 INFO  [prepare_banner] Done appying Banner100 -> TmpABBanners100_75830_1
2016/04/18 14:31:53 937075 INFO  [prepare_banner] Done appying Banner148 -> TmpABBanners100_75830_1
2016/04/18 14:31:53 937075 INFO  [prepare_banner] Done appying Banner149 -> TmpABBanners100_75830_1
2016/04/18 14:32:10 937075 INFO  [update_phrase_] Done forming ABPrice100_75830_1Group
2016/04/18 14:32:38 937075 INFO  [update_phrase_] Done forming ABPrice100_75830_1GroupBanners

2016/04/18 13:54:19 402134 INFO  [apply_result_s] Updating PhrasePrice with inner join
2016/04/18 13:54:36 402134 INFO  [update_phrase_] Done forming ABPrice100_75829_1Group
2016/04/18 13:55:18 402134 INFO  [update_phrase_] Done forming ABPrice100_75829_1GroupBanners
2016/04/18 13:55:18 402134 INFO  [update_phrase_] update PhrasePrice : join with ABPrice100_75829_1GroupBanners on BannerID,PhraseID,ContextType
2016/04/18 13:56:13 402134 INFO  [update_phrase_] Done applying to PhrasePrice
2016/04/18 13:56:13 402134 INFO  [update_phrase_] Done forming ABPrice100_75829_1Group
2016/04/18 13:56:13 402134 INFO  [update_phrase_] Done forming ABPrice100_75829_1GroupBanners
2016/04/18 13:56:13 402134 INFO  [update_phrase_] update PhrasePrice : join with ABPrice100_75829_1GroupBanners on BannerID,PhraseID,ContextType
2016/04/18 13:56:13 402134 INFO  [update_phrase_] Done applying to PhrasePrice
2016/04/18 13:56:14 402134 INFO  [update_phrase_] Done forming ABPrice100_75829_1Group
2016/04/18 13:56:14 402134 INFO  [update_phrase_] Done forming ABPrice100_75829_1GroupBanners
2016/04/18 13:56:14 402134 INFO  [update_phrase_] update PhrasePrice : join with ABPrice100_75829_1GroupBanners on BannerID,PhraseID,ContextType
2016/04/18 13:56:14 402134 INFO  [update_phrase_] Done applying to PhrasePrice



qwertyuiop[asdfghjkl;''
zxcvbnm,./



mysql> select distinct Name from AnomaliesDetectorTasks inner join User using(UserID);
+-------------+
| Name        |
+-------------+
| mavlyutov   |
| mihajlova   |
o| palevas     |


https://bsgraphite.yandex-team.ru/render/?width=586&height=308&_salt=1458644905.904&target=one_hour.bsmr-server01k_yabs_yandex_ru.factors_stats.lolita3factors.9_1_1.N

basenos_array = [2,3,4,5,6,7,8,9,10,11,12,13,14,16,18,19,22,23,24,25,26,27,28,29,30,32,34,35,37,39,40,41,42,49,52,53,54,56,57,59,62,64,65,66,67,69,72,73,75,76,77,78,79,80,82,86,87,88,89,90,101,102,104,105,107,109,112,113,115,116,117,118,119,121,122,123,124,125,126,127,128,130,131,132,133,134,135,136,137,139,140,141,142,143,144,145,146,147];
basenos_hash = {};
for (var index = 0; index < basenos_array.length; ++index) {
	basenos_hash[basenos_array[index]] = 1;
}
$('[name=base_nos]').find('option').each(function(undefined, option) {
	if (basenos_hash[parseInt($(option).attr('value'))]) {
		$(option).attr('selected', 'selected');
	}
});


| TaskName             | text                                          | NO   |     | NULL                |                |
| Freq                 | int(11)                                       | NO   |     | 0                   |                |
| Lag                  | int(11)                                       | NO   |     | 0                   |                |
| Period               | int(11)                                       | NO   |     | 0                   |                |
| DayTimeStart         | int(11)                                       | NO   |     | 0                   |                |
| DayTimeEnd           | int(11)                                       | NO   |     | 0                   |                |
| Operations           | text                                          | NO   |     | NULL                |                |
| Status               | tinyint(3)                                    | NO   |     | 0                   |                |
| NotificationInterval | int(11)                                       | NO   |     | 0                   |                |
| AlertInterval        | int(11)                                       | NO   |     | 0                   |                |
| SeriesAliases        | text                                          | NO   |     | NULL                |                |
| Options              | set('use_graphite_multi_source','debug_mode') | NO   |     |                     |                |
| UpdateTime           | timestamp                                     | NO   |     | 0000-00-00 00:00:00 |                |
| PostGenerator        | text                                          | NO   |     | NULL                |                |

| TaskID               | int(11)                                       | NO   | PRI | NULL                | auto_increment |
| DataSource           | text                                          | NO   |     | NULL                |                |
| LastRunTime          | timestamp                                     | NO   |     | 0000-00-00 00:00:00 |                |
| UserID               | bigint(20)                                    | NO   |     | 0                   |                |
| LastRunStatus        | tinyint(3)                                    | NO   |     | 0                   |                |
| LastRunError         | blob                                          | NO   |     | NULL                |                |


| Notification         | set('email','sms')                            | NO   |     | email               |                |




mysql> select * from AutoBudgetStatCurWeek where orderid = 6351264;
+------+---------+---------------------+------+----------+-------+--------+-------------+------------+
| Week | OrderID | UpdateTime          | Days | StopDays | Shows | Clicks | Cost        | CostCur    |
+------+---------+---------------------+------+----------+-------+--------+-------------+------------+
|   13 | 6351264 | 2016-04-03 23:58:42 |  112 |        0 |     0 |   8964 |  2928830778 |  878649240 |
|   14 | 6351264 | 2016-04-10 23:57:20 |  127 |        0 |     0 |  33369 | 11580445242 | 3474133580 |
|   15 | 6351264 | 2016-04-18 00:00:00 |  127 |        0 |     0 |  23055 |  7835239290 | 2350571800 |
|   16 | 6351264 | 2016-04-21 13:35:01 |   15 |        0 |     0 |   7598 |  2606439068 |  781931720 |
+------+---------+---------------------+------+----------+-------+--------+-------------+------------+
4 rows in set (0.00 sec)

mysql>  select AvgCPA,AvgCPACur,GoalID from AutoBudgetOrder where orderid = 6351264;
+---------+-----------+----------+
| AvgCPA  | AvgCPACur | GoalID   |
+---------+-----------+----------+
| 1966667 |    500000 | 11840621 |
+---------+-----------+----------+
1 row in set (0.01 sec)

ql> select avg(APC1)/1e6, avg(APC2)/1e6 from ABVWForecasterAPC where orderid = 6351264;
+---------------------+---------------------+
| avg(APC1)/1e6       | avg(APC2)/1e6       |
+---------------------+---------------------+
| 0.17013339692199952 | 0.16818263654250173 |
+---------------------+---------------------+
1 row in set (0.08 sec)


mysql> select * from ABExperimentCurWeek where orderid = 6351264;
+---------+------+------------+----------+--------+------------+------------+------------+-------------+---------+-------+
| OrderID | Week | Experiment | Shows    | Clicks | Cost       | CostCur    | FullCost   | FullCostCur | Actions | Price |
+---------+------+------------+----------+--------+------------+------------+------------+-------------+---------+-------+
| 6351264 |   15 |          0 | 56394186 |  23074 | 7840738092 | 2352221440 | 7840738092 |  2352221440 |    4698 |     0 |
| 6351264 |   16 |          0 | 17628642 |   7613 | 2609562136 |  782868640 | 2609562136 |   782868640 |    1537 |     0 |
+---------+------+------------+----------+--------+------------+------------+------------+-------------+---------+-------+
2 rows in set (0.00 sec)




mysql> select * from ABOrderActions where orderid= 7084321;
+---------------------+---------+------------+---------+-------+
| UpdateTime          | OrderID | TargetType | Actions | Price |
+---------------------+---------+------------+---------+-------+
| 2016-03-25 00:00:00 | 7084321 |          3 |    1130 |     0 |
| 2016-03-26 00:00:00 | 7084321 |          3 |     842 |     0 |
| 2016-03-27 00:00:00 | 7084321 |          3 |    1058 |     0 |
| 2016-03-28 00:00:00 | 7084321 |          3 |     986 |     0 |
| 2016-03-29 00:00:00 | 7084321 |          3 |    1303 |     0 |
| 2016-03-30 00:00:00 | 7084321 |          3 |    1470 |     0 |
| 2016-03-31 00:00:00 | 7084321 |          3 |    1272 |     0 |
| 2016-04-01 00:00:00 | 7084321 |          3 |    1123 |     0 |
| 2016-04-02 00:00:00 | 7084321 |          3 |    1319 |     0 |
| 2016-04-03 00:00:00 | 7084321 |          3 |    1399 |     0 |
| 2016-04-04 00:00:00 | 7084321 |          3 |    1205 |     0 |
| 2016-04-05 00:00:00 | 7084321 |          3 |    1275 |     0 |
| 2016-04-06 00:00:00 | 7084321 |          3 |    1015 |     0 |
| 2016-04-07 00:00:00 | 7084321 |          3 |     978 |     0 |
| 2016-04-08 00:00:00 | 7084321 |          3 |     887 |     0 |
| 2016-04-09 00:00:00 | 7084321 |          3 |     795 |     0 |
| 2016-04-10 00:00:00 | 7084321 |          3 |     941 |     0 |
| 2016-04-11 00:00:00 | 7084321 |          3 |    1141 |     0 |
| 2016-04-12 00:00:00 | 7084321 |          3 |     841 |     0 |
| 2016-04-13 00:00:00 | 7084321 |          3 |     756 |     0 |
| 2016-04-14 00:00:00 | 7084321 |          3 |     985 |     0 |
| 2016-04-15 00:00:00 | 7084321 |          3 |     698 |     0 |
| 2016-04-16 00:00:00 | 7084321 |          3 |     710 |     0 |
| 2016-04-17 00:00:00 | 7084321 |          3 |     894 |     0 |
| 2016-04-18 00:00:00 | 7084321 |          3 |     920 |     0 |
| 2016-04-19 00:00:00 | 7084321 |          3 |     839 |     0 |
| 2016-04-20 00:00:00 | 7084321 |          3 |     603 |     0 |
| 2016-04-21 00:00:00 | 7084321 |          3 |     474 |     0 |
+---------------------+---------+------------+---------+-------+
28 rows in set (0.01 sec)


mysql>  select * from ABExperimentCurWeek where orderid = 7084321;
+---------+------+------------+----------+--------+-------------+------------+-------------+-------------+---------+-------+
| OrderID | Week | Experiment | Shows    | Clicks | Cost        | CostCur    | FullCost    | FullCostCur | Actions | Price |
+---------+------+------------+----------+--------+-------------+------------+-------------+-------------+---------+-------+
| 7084321 |   15 |          0 | 26645622 |  63749 | 10128998106 | 3038699420 | 10128998106 |  3038699420 |    6025 |     0 |
| 7084321 |   16 |          0 | 13870205 |  31035 |  4736087354 | 1420826200 |  4736087354 |  1420826200 |    2836 |     0 |
+---------+------+------------+----------+--------+-------------+------------+-------------+-------------+---------+-------+
2 rows in set (0.00 sec)



mysql> select * from ABOrderActions where orderid= 6351264;
+---------------------+---------+------------+---------+-------+
| UpdateTime          | OrderID | TargetType | Actions | Price |
+---------------------+---------+------------+---------+-------+
| 2016-03-25 00:00:00 | 6351264 |          3 |     859 |     0 |
| 2016-03-26 00:00:00 | 6351264 |          3 |     615 |     0 |
| 2016-03-27 00:00:00 | 6351264 |          3 |     672 |     0 |
| 2016-03-28 00:00:00 | 6351264 |          3 |     779 |     0 |
| 2016-03-29 00:00:00 | 6351264 |          3 |     973 |     0 |
| 2016-03-30 00:00:00 | 6351264 |          3 |     910 |     0 |
| 2016-03-31 00:00:00 | 6351264 |          3 |     949 |     0 |
| 2016-04-01 00:00:00 | 6351264 |          3 |     862 |     0 |
| 2016-04-02 00:00:00 | 6351264 |          3 |     729 |     0 |
| 2016-04-03 00:00:00 | 6351264 |          3 |     810 |     0 |
| 2016-04-04 00:00:00 | 6351264 |          3 |     984 |     0 |
| 2016-04-05 00:00:00 | 6351264 |          3 |     851 |     0 |
| 2016-04-06 00:00:00 | 6351264 |          3 |    1188 |     0 |
| 2016-04-07 00:00:00 | 6351264 |          3 |    1431 |     0 |
| 2016-04-08 00:00:00 | 6351264 |          3 |    1219 |     0 |
| 2016-04-09 00:00:00 | 6351264 |          3 |     538 |     0 |
| 2016-04-10 00:00:00 | 6351264 |          3 |     720 |     0 |
| 2016-04-11 00:00:00 | 6351264 |          3 |    1113 |     0 |
| 2016-04-12 00:00:00 | 6351264 |          3 |     895 |     0 |
| 2016-04-13 00:00:00 | 6351264 |          3 |     742 |     0 |
| 2016-04-14 00:00:00 | 6351264 |          3 |     811 |     0 |
| 2016-04-15 00:00:00 | 6351264 |          3 |     275 |     0 |
| 2016-04-16 00:00:00 | 6351264 |          3 |     466 |     0 |
| 2016-04-17 00:00:00 | 6351264 |          3 |     396 |     0 |
| 2016-04-18 00:00:00 | 6351264 |          3 |    1113 |     0 |
| 2016-04-19 00:00:00 | 6351264 |          3 |     160 |     0 |
| 2016-04-20 00:00:00 | 6351264 |          3 |     170 |     0 |
| 2016-04-21 00:00:00 | 6351264 |          3 |      96 |     0 |
+---------------------+---------+------------+---------+-------+
28 rows in set (0.01 sec)



=======


Old:

legts@olegts [ 26559.bstat-updaters.start ] :~/arc/trunk/arcadia/yabs/stat/bstat-updaters$ sudo -u yabs  ./collect-log.pl PhrasePrice -only=PhrasePrice
2016/04/21 20:13:17 23728 WARN  [get_all_collec] Multiline message (3 rows):    (Yabs::Stat::CollectManager @/usr/share/perl5/Yabs/Stat/CollectManager.pm:160)
2016/04/21 20:13:17 23728 WARN  [get_all_collec] > Collector 'Yabs::Stat::Collectors::PhrasePrice' is already loaded. Looks like multiple instances of collector is installed:
2016/04/21 20:13:17 23728 WARN  [get_all_collec] >  - /usr/share/perl5/Yabs/Stat/Collectors/PhrasePrice.pm
2016/04/21 20:13:17 23728 WARN  [get_all_collec] >  - /home/olegts/arc/trunk/arcadia/yabs/stat/bstat-updaters/Yabs/Stat/Collectors/PhrasePrice.pm
2016/04/21 20:13:17 23728 INFO  [yabs_file_lock] locked
ReadGlobalInfo: Unable to read 'scriptcontrol/olegts.haze/collect-phraseprice': No such file or directory
2016/04/21 20:13:17 23728 INFO  [        main::] Started collect-phraseprice (./collect-log.pl PhrasePrice -only=PhrasePrice)
2016/04/21 20:13:17 23728 INFO  [get_nextdatalo] Time stamp border for log sorting: 20260417225835
2016/04/21 20:13:17 23728 INFO  [     get_bases] Option checkDumpedTables2-use-yabsmem is active, but yabslogmem db not found
2016/04/21 20:13:17 23728 INFO  [checkDumpedTab] RotatePhrasePriceChangeLog2016042107390600201 ready for processing
Metrica: one_min.olegts_haze_yandex_net.cl.phraseprice.launches, Value = 1, time = 1461258720
2016/04/21 20:13:17 23728 INFO  [process_datalo] Process log: DataID=2016042107390600201, 10000 rows
2016/04/21 20:13:17 23746 INFO  [_load_phrase_p] Reading from PhrasePrice in bstat19 common way
2016/04/21 20:13:22 23746 INFO  [ _task_collect] PhrasePrice columns : OrderID,BannerID,GroupExportID,PhraseID,ContextType,Cost,FlatCost,ResultCost,ResultFlatCost,Hits,PCTR0,AvgCost,AvgCPA,EngineID,CostUpdateTime,FlatCostUpdateTime,HitsUpdateTime,Options,OptionAutobrokerCurrencyUpdateTime,AvgCostUpdateTime,AvgCPAUpdateTime,OptionOnlyOfferRetargetingUpdateTime,OptionOnlyNewAuditoryUpdateTime,OptionGoalContextUpdateTime
2016/04/21 20:13:23 23728 INFO  [     get_bases] Option checkDumpedTables2-use-yabsmem is active, but yabslogmem db not found
2016/04/21 20:13:23 23728 INFO  [get_sources_co] Can't get sources count for 'phraseprice': Table 'yabsinfo.LogType' doesn't exist
ReadGlobalInfo: Unable to read 'scriptcontrol/olegts.haze/collect-phraseprice': No such file or directory
2016/04/21 20:13:23 23728 INFO  [      put_info] Skipped put_info: olegts.haze/collect-phraseprice is not found in global-info.
2016/04/21 20:13:23 23728 INFO  [      main_log] 20160421201300 timing: Setup=0.026,LogWait=0.042,Collect=6.063,Minutely=0.002,Total=6.134 (Speed=1637 rps, DataID=2016042107390600201)
2016/04/21 20:13:23 23728 INFO  [     get_bases] Option checkDumpedTables2-use-yabsmem is active, but yabslogmem db not found
2016/04/21 20:13:23 23728 INFO  [yabs_file_unlo] unlocked


New:


Golegts@olegts [ 26559.bstat-updaters.start ] :~/arc/trunk/arcadia/yabs/stat/bstat-updaters$ sudo -u yabs PERL5LIB=.  ./collect-log.pl PhrasePrice -only=PhrasePrice
2016/04/21 20:14:12 25817 WARN  [get_all_collec] Multiline message (3 rows):    (Yabs::Stat::CollectManager @/usr/share/perl5/Yabs/Stat/CollectManager.pm:160)
2016/04/21 20:14:12 25817 WARN  [get_all_collec] > Collector 'Yabs::Stat::Collectors::PhrasePrice' is already loaded. Looks like multiple instances of collector is installed:
2016/04/21 20:14:12 25817 WARN  [get_all_collec] >  - /home/olegts/arc/trunk/arcadia/yabs/stat/bstat-updaters/Yabs/Stat/Collectors/PhrasePrice.pm
2016/04/21 20:14:12 25817 WARN  [get_all_collec] >  - /usr/share/perl5/Yabs/Stat/Collectors/PhrasePrice.pm
2016/04/21 20:14:12 25817 INFO  [yabs_file_lock] locked
ReadGlobalInfo: Unable to read 'scriptcontrol/olegts.haze/collect-phraseprice': No such file or directory
2016/04/21 20:14:12 25817 INFO  [        main::] Started collect-phraseprice (./collect-log.pl PhrasePrice -only=PhrasePrice)
2016/04/21 20:14:12 25817 INFO  [get_nextdatalo] Time stamp border for log sorting: 20260417225835
2016/04/21 20:14:12 25817 INFO  [     get_bases] Option checkDumpedTables2-use-yabsmem is active, but yabslogmem db not found
2016/04/21 20:14:12 25817 INFO  [checkDumpedTab] RotatePhrasePriceChangeLog2016042107390600201 ready for processing
Metrica: one_min.olegts_haze_yandex_net.cl.phraseprice.launches, Value = 1, time = 1461258780
2016/04/21 20:14:12 25817 INFO  [process_datalo] Process log: DataID=2016042107390600201, 10000 rows
2016/04/21 20:14:31 25890 INFO  [ _task_collect] PhrasePrice columns : OrderID,BannerID,GroupExportID,PhraseID,ContextType,Cost,FlatCost,ResultCost,ResultFlatCost,Hits,PCTR0,AvgCost,AvgCPA,EngineID,CostUpdateTime,FlatCostUpdateTime,HitsUpdateTime,Options,OptionAutobrokerCurrencyUpdateTime,AvgCostUpdateTime,AvgCPAUpdateTime,OptionOnlyOfferRetargetingUpdateTime,OptionOnlyNewAuditoryUpdateTime,OptionGoalContextUpdateTime
2016/04/21 20:14:32 25817 INFO  [     get_bases] Option checkDumpedTables2-use-yabsmem is active, but yabslogmem db not found
2016/04/21 20:14:32 25817 INFO  [get_sources_co] Can't get sources count for 'phraseprice': Table 'yabsinfo.LogType' doesn't exist
ReadGlobalInfo: Unable to read 'scriptcontrol/olegts.haze/collect-phraseprice': No such file or directory
2016/04/21 20:14:32 25817 INFO  [      put_info] Skipped put_info: olegts.haze/collect-phraseprice is not found in global-info.
2016/04/21 20:14:32 25817 INFO  [      main_log] 20160421201400 timing: Setup=0.028,LogWait=0.040,Collect=20.395,Minutely=0.003,Total=20.465 (Speed=489 rps, DataID=2016042107390600201)
2016/04/21 20:14:32 25817 INFO  [     get_bases] Option checkDumpedTables2-use-yabsmem is active, but yabslogmem db not found
2016/04/21 20:14:32 25817 INFO  [yabs_file_unlo] unlocked


Old:


olegts@olegts [ 26559.bstat-updaters.start ] :~/arc/trunk/arcadia/yabs/stat/bstat-updaters$ sudo -u yabs  ./collect-log.pl PhrasePrice -only=PhrasePrice
2016/04/21 20:15:06 27572 WARN  [get_all_collec] Multiline message (3 rows):    (Yabs::Stat::CollectManager @/usr/share/perl5/Yabs/Stat/CollectManager.pm:160)
2016/04/21 20:15:06 27572 WARN  [get_all_collec] > Collector 'Yabs::Stat::Collectors::PhrasePrice' is already loaded. Looks like multiple instances of collector is installed:
2016/04/21 20:15:06 27572 WARN  [get_all_collec] >  - /usr/share/perl5/Yabs/Stat/Collectors/PhrasePrice.pm
2016/04/21 20:15:06 27572 WARN  [get_all_collec] >  - /home/olegts/arc/trunk/arcadia/yabs/stat/bstat-updaters/Yabs/Stat/Collectors/PhrasePrice.pm
2016/04/21 20:15:06 27572 INFO  [yabs_file_lock] locked
ReadGlobalInfo: Unable to read 'scriptcontrol/olegts.haze/collect-phraseprice': No such file or directory
2016/04/21 20:15:06 27572 INFO  [        main::] Started collect-phraseprice (./collect-log.pl PhrasePrice -only=PhrasePrice)
2016/04/21 20:15:06 27572 INFO  [get_nextdatalo] Time stamp border for log sorting: 20260417225835
2016/04/21 20:15:06 27572 INFO  [     get_bases] Option checkDumpedTables2-use-yabsmem is active, but yabslogmem db not found
2016/04/21 20:15:06 27572 INFO  [checkDumpedTab] RotatePhrasePriceChangeLog2016042107390600201 ready for processing
Metrica: one_min.olegts_haze_yandex_net.cl.phraseprice.launches, Value = 1, time = 1461258840
2016/04/21 20:15:06 27572 INFO  [process_datalo] Process log: DataID=2016042107390600201, 20000 rows
2016/04/21 20:15:07 27590 INFO  [_load_phrase_p] Reading from PhrasePrice in bstat19 common way
2016/04/21 20:15:16 27590 INFO  [ _task_collect] PhrasePrice columns : OrderID,BannerID,GroupExportID,PhraseID,ContextType,Cost,FlatCost,ResultCost,ResultFlatCost,Hits,PCTR0,AvgCost,AvgCPA,EngineID,CostUpdateTime,FlatCostUpdateTime,HitsUpdateTime,Options,OptionAutobrokerCurrencyUpdateTime,AvgCostUpdateTime,AvgCPAUpdateTime,OptionOnlyOfferRetargetingUpdateTime,OptionOnlyNewAuditoryUpdateTime,OptionGoalContextUpdateTime
2016/04/21 20:15:18 27572 INFO  [     get_bases] Option checkDumpedTables2-use-yabsmem is active, but yabslogmem db not found
2016/04/21 20:15:18 27572 INFO  [get_sources_co] Can't get sources count for 'phraseprice': Table 'yabsinfo.LogType' doesn't exist
ReadGlobalInfo: Unable to read 'scriptcontrol/olegts.haze/collect-phraseprice': No such file or directory
2016/04/21 20:15:18 27572 INFO  [      put_info] Skipped put_info: olegts.haze/collect-phraseprice is not found in global-info.
2016/04/21 20:15:18 27572 INFO  [      main_log] 20160421201500 timing: Setup=0.028,LogWait=0.054,Collect=11.974,Minutely=0.002,Total=12.058 (Speed=1662 rps, DataID=2016042107390600201)
2016/04/21 20:15:18 27572 INFO  [     get_bases] Option checkDumpedTables2-use-yabsmem is active, but yabslogmem db not found
2016/04/21 20:15:18 27572 INFO  [yabs_file_unlo] unlocked


New:

olegts@olegts [ 26559.bstat-updaters.start ] :~/arc/trunk/arcadia/yabs/stat/bstat-updaters$ sudo -u yabs PERL5LIB=.  ./collect-log.pl PhrasePrice -only=PhrasePrice
2016/04/21 20:19:30 3989  WARN  [get_all_collec] Multiline message (3 rows):    (Yabs::Stat::CollectManager @/usr/share/perl5/Yabs/Stat/CollectManager.pm:160)
2016/04/21 20:19:30 3989  WARN  [get_all_collec] > Collector 'Yabs::Stat::Collectors::PhrasePrice' is already loaded. Looks like multiple instances of collector is installed:
2016/04/21 20:19:30 3989  WARN  [get_all_collec] >  - /home/olegts/arc/trunk/arcadia/yabs/stat/bstat-updaters/Yabs/Stat/Collectors/PhrasePrice.pm
2016/04/21 20:19:30 3989  WARN  [get_all_collec] >  - /usr/share/perl5/Yabs/Stat/Collectors/PhrasePrice.pm
2016/04/21 20:19:30 3989  INFO  [yabs_file_lock] locked
ReadGlobalInfo: Unable to read 'scriptcontrol/olegts.haze/collect-phraseprice': No such file or directory
2016/04/21 20:19:30 3989  INFO  [        main::] Started collect-phraseprice (./collect-log.pl PhrasePrice -only=PhrasePrice)
2016/04/21 20:19:30 3989  INFO  [get_nextdatalo] Time stamp border for log sorting: 20260417225835
2016/04/21 20:19:30 3989  INFO  [     get_bases] Option checkDumpedTables2-use-yabsmem is active, but yabslogmem db not found
2016/04/21 20:19:30 3989  INFO  [checkDumpedTab] RotatePhrasePriceChangeLog2016042107390600201 ready for processing
Metrica: one_min.olegts_haze_yandex_net.cl.phraseprice.launches, Value = 1, time = 1461258900
2016/04/21 20:19:30 3989  INFO  [process_datalo] Process log: DataID=2016042107390600201, 20000 rows
2016/04/21 20:20:29 4010  INFO  [ _task_collect] PhrasePrice columns : OrderID,BannerID,GroupExportID,PhraseID,ContextType,Cost,FlatCost,ResultCost,ResultFlatCost,Hits,PCTR0,AvgCost,AvgCPA,EngineID,CostUpdateTime,FlatCostUpdateTime,HitsUpdateTime,Options,OptionAutobrokerCurrencyUpdateTime,AvgCostUpdateTime,AvgCPAUpdateTime,OptionOnlyOfferRetargetingUpdateTime,OptionOnlyNewAuditoryUpdateTime,OptionGoalContextUpdateTime
2016/04/21 20:20:30 3989  INFO  [     get_bases] Option checkDumpedTables2-use-yabsmem is active, but yabslogmem db not found
2016/04/21 20:20:30 3989  INFO  [get_sources_co] Can't get sources count for 'phraseprice': Table 'yabsinfo.LogType' doesn't exist
ReadGlobalInfo: Unable to read 'scriptcontrol/olegts.haze/collect-phraseprice': No such file or directory
2016/04/21 20:20:30 3989  INFO  [      put_info] Skipped put_info: olegts.haze/collect-phraseprice is not found in global-info.
2016/04/21 20:20:30 3989  INFO  [      main_log] 20160421201900 timing: Setup=0.026,LogWait=0.046,Collect=60.740,Minutely=0.002,Total=60.814 (Speed=329 rps, DataID=2016042107390600201)
2016/04/21 20:20:30 3989  INFO  [     get_bases] Option checkDumpedTables2-use-yabsmem is active, but yabslogmem db not found
2016/04/21 20:20:30 3989  INFO  [yabs_file_unlo] unlocked



RotatePhrasePriceChangeLog201604211225080023

https://bsint2.yandex-team.ru/cgi-bin/redis_image.cgi?clusters_ports=["bsspark:8102"]&period=10&from=-600s&until=-0d&series=["clicks:count:an_with_rtb","shows:count:an_with_rtb","shows:count:mobile_app_search","clicks:count:an_no_rtb","clicks:count:big_search","shows:count:partner_search","shows:count:an_no_rtb","shows:count:big_search","shows:count:mobile_search"]




https://bsint2.yandex-team.ru/cgi-bin/redis_image.cgi?clusters_ports=["bsspark:8102"]&period=10&from=-600s&until=-0d&series=["clicks:cost:an_no_rtb","clicks:count:mobile_search","clicks:cost:mobile_app_search","clicks:cost:mobile_search","clicks:cost:partner_search","clicks:count:mobile_app_search","clicks:cost:big_search","clicks:cost:an_with_rtb","clicks:count:partner_search"]


  `BrowserName` enum('Unknown','Chrome','MSIE','Opera','Safari','Firefox','YandexBrowser','Novarra-Vision','Dolfin','Playstation','Vivaldi','Lunascape','Links','Netscape','LGBrowser','Mail.ru','SkyFire','Dolphin','Dillo','K-Meleon','WebOSBrowser','CM Browser','AdobeAIR','Minimo','PaleMoon','ELinks','OmniWeb','UCBrowser','AndroidBrowser','iTunes','YandexSearch','Rekonq','Dalvik','Puffin','NetSurf','BlackBerry','SeaMonkey','Midori','Tizen','MAUI WAP Browser','Baidu','OperaMini','NetFront','Mozilla','Coast','Galeon','Conkeror','Konqueror','Blazer','UbuntuBrowser','Jasmine','QtWeb','Arora','Epiphany','Edge','Amigo','GoogleSearch','NetFrontLifeBrowser','Uzbl','NokiaBrowser','Flock','Chromium','QupZilla','Ninesky','OpenWave','AvantBrowser','GoogleWirelessTranscoder','Nichrome','Sleipnir','MQQBrowser','SEMC','Camino','SongBird','Polaris','Obigo','NCSA Mosaic','Iron','Lynx','OviBrowser','Maxthon','YandexInternet','Docomo','MobileFirefox','Mercury','OperaMobile','ChromeMobile','IEMobile','MobileSafari','WeChat','Sputnik','facebookexternalhit','vkShare','OdklBot','GPlusSnippet','Twitterbot','MailRuConnect','Samsung Internet') NOT NULL DEFAULT 'Unknown',

enum(\'Unknown\',\'Chrome\',\'MSIE\',\'Opera\',\'Safari\',\'Firefox\',\'YandexBrowser\',\'Novarra-Vision\',\'Dolfin\',\'Playstation\',\'Vivaldi\',\'Lunascape\',\'Links\',\'Netscape\',\'LGBrowser\',\'Mail.ru\',\'SkyFire\',\'Dolphin\',\'Dillo\',\'K-Meleon\',\'WebOSBrowser\',\'CM Browser\',\'AdobeAIR\',\'Minimo\',\'PaleMoon\',\'ELinks\',\'OmniWeb\',\'UCBrowser\',\'AndroidBrowser\',\'iTunes\',\'YandexSearch\',\'Rekonq\',\'Dalvik\',\'Puffin\',\'NetSurf\',\'BlackBerry\',\'SeaMonkey\',\'Midori\',\'Tizen\',\'MAUI WAP Browser\',\'Baidu\',\'OperaMini\',\'NetFront\',\'Mozilla\',\'Coast\',\'Galeon\',\'Conkeror\',\'Konqueror\',\'Blazer\',\'UbuntuBrowser\',\'Jasmine\',\'QtWeb\',\'Arora\',\'Epiphany\',\'Edge\',\'Amigo\',\'GoogleSearch\',\'NetFrontLifeBrowser\',\'Uzbl\',\'NokiaBrowser\',\'Flock\',\'Chromium\',\'QupZilla\',\'Ninesky\',\'OpenWave\',\'AvantBrowser\',\'GoogleWirelessTranscoder\',\'Nichrome\',\'Sleipnir\',\'MQQBrowser\',\'SEMC\',\'Camino\',\'SongBird\',\'Polaris\',\'Obigo\',\'NCSA Mosaic\',\'Iron\',\'Lynx\',\'OviBrowser\',\'Maxthon\',\'YandexInternet\',\'Docomo\',\'MobileFirefox\',\'Mercury\',\'OperaMobile\',\'ChromeMobile\',\'IEMobile\',\'MobileSafari\',\'WeChat\',\'Sputnik\',\'facebookexternalhit\',\'vkShare\',\'OdklBot\',\'GPlusSnippet\',\'Twitterbot\',\'MailRuConnect\',\'Samsung Internet\')


enum(\'Unknown\',\'Chrome\',\'MSIE\',\'Opera\',\'Safari\',\'Firefox\',\'YandexBrowser\',\'Novarra-Vision\',\'Dolfin\',\'Playstation\',\'Vivaldi\',\'Lunascape\',\'Links\',\'Netscape\',\'LGBrowser\',\'Mail.ru\',\'SkyFire\',\'Dolphin\',\'Dillo\',\'K-Meleon\',\'WebOSBrowser\',\'CM Browser\',\'AdobeAIR\',\'Minimo\',\'PaleMoon\',\'ELinks\',\'OmniWeb\',\'UCBrowser\',\'AndroidBrowser\',\'iTunes\',\'YandexSearch\',\'Rekonq\',\'Dalvik\',\'Puffin\',\'NetSurf\',\'BlackBerry\',\'SeaMonkey\',\'Midori\',\'Tizen\',\'MAUI WAP Browser\',\'Baidu\',\'OperaMini\',\'NetFront\',\'Mozilla\',\'Coast\',\'Galeon\',\'Conkeror\',\'Konqueror\',\'Blazer\',\'UbuntuBrowser\',\'Jasmine\',\'QtWeb\',\'Arora\',\'Epiphany\',\'Edge\',\'Amigo\',\'GoogleSearch\',\'NetFrontLifeBrowser\',\'Uzbl\',\'NokiaBrowser\',\'Flock\',\'Chromium\',\'QupZilla\',\'Ninesky\',\'OpenWave\',\'AvantBrowser\',\'GoogleWirelessTranscoder\',\'Nichrome\',\'Sleipnir\',\'MQQBrowser\',\'SEMC\',\'Camino\',\'SongBird\',\'Polaris\',\'Obigo\',\'NCSA Mosaic\',\'Iron\',\'Lynx\',\'OviBrowser\',\'Maxthon\',\'YandexInternet\',\'Docomo\',\'MobileFirefox\',\'Mercury\',\'OperaMobile\',\'ChromeMobile\',\'IEMobile\',\'MobileSafari\',\'WeChat\',\'Sputnik\',\'facebookexternalhit\',\'vkShare\',\'OdklBot\',\'GPlusSnippet\',\'Twitterbot\',\'MailRuConnect\')




20:10 начало задачи про пробелы в конец
20:14 проблема с индексацией, нет рассмотрения крайних случаев
20:14 написан алгоритм за n^2
20:20 предложен алгоритм пузырька, но он тоже сложности n^2, это пришлось объяснять
20:28 с двумя массивами -- тоже придумал только n^2
20:38 предложено решение с двумя массивами за n, в нем все равно есть недочет с индексацией
20:43 подсказака про хранение последнего непробела со стороны интервьюера
20:57 тут ответ на заа
j = s.length - 1
for i in 0..s.length-1
  if s[i] == ' '
    temp = s[j]
    s[j] = s[i]
    s[i] = temp
    j--
  end
end
21:00 подсказали


Examples : 6378248,2001197,6513386

8483621,3793879,7754261

Examples : 6378248,2001197,6513386


RotatePhrasePriceChangeLog201604251135060024

RotatePhrasePriceChangeLog201604251135060023

18:16 решена первая задачка, нет ошибок, сразу пправильное решение
18:24 со второй задачей до нода с подсказками не поучается догадаться
18:42 все еще думаем над сдвигом на одну переменную (очень много подсказок, чистый вариант не написан правильно)
18:50 вариант со сдвигом на 1 запомнили

95:~ olegts$ ./detect-outstanding-graphite-series.pl 'https://bsgraphite.yandex-team.ru/render/?width=586&height=308&_salt=1461778676.268&target=one_min.bstat*_yandex_ru.logcount_RotateEventLog.count&from=-2h' 15
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  982k    0  982k    0     0   202k      0 --:--:--  0:00:04 --:--:--  269k
$VAR1 = [
          'one_min.bstat90e_yandex_ru.logcount_RotateEventLog.count',
          'one_min.bstat27f_yandex_ru.logcount_RotateEventLog.count',
          'one_min.bstat146i_yandex_ru.logcount_RotateEventLog.count',
          'one_min.bstat71h_yandex_ru.logcount_RotateEventLog.count',
          'one_min.bstat121i_yandex_ru.logcount_RotateEventLog.count',
          'one_min.bstat106i_yandex_ru.logcount_RotateEventLog.count',
          'one_min.bstat27i_yandex_ru.logcount_RotateEventLog.count',
          'one_min.bstat71i_yandex_ru.logcount_RotateEventLog.count',
          'one_min.bstat146h_yandex_ru.logcount_RotateEventLog.count',
          'one_min.bstat71e_yandex_ru.logcount_RotateEventLog.count',
          'one_min.bstat53e_yandex_ru.logcount_RotateEventLog.count',
          'one_min.bstat106f_yandex_ru.logcount_RotateEventLog.count',
          'one_min.bstat53i_yandex_ru.logcount_RotateEventLog.count',
          'one_min.bstat146f_yandex_ru.logcount_RotateEventLog.count'
        ];

=======

mysql> select bannerid,parentexportid,flatprobability from Banner24_20160314 where orderid = 1192668 and parentexportid= 24312681 ;
+-----------+----------------+-----------------+
| bannerid  | parentexportid | flatprobability |
+-----------+----------------+-----------------+
|  30645787 |       24312681 |         1000000 |
| 174277019 |       24312681 |         1000000 |
+-----------+----------------+-----------------+
2 rows in set (0.00 sec)

mysql> select bannerid,parentexportid,flatprobability from Banner24_20160318 where orderid = 1192668 and parentexportid= 24312681 ;
+-----------+----------------+-----------------+
| bannerid  | parentexportid | flatprobability |
+-----------+----------------+-----------------+
|  30645787 |       24312681 |            1000 |
| 174277019 |       24312681 |            1000 |
+-----------+----------------+-----------------+
2 rows in set (0.00 sec)

2016-03-16 13:57:58 status installed yabs-autobudget-forecast 042.1

1.00    1273
1.02    17055



olegts@olegts [ 5190.autobudget.code :: VIM ] :~/arc/trunk/arcadia/yabs/stat/yabs-autobudget2$ svn log -v |grep -E '^r' | head -50
r2288577 | olegts | 2016-04-26 00:19:29 +0300 (Вт., 26 апр. 2016) | 5 lines
r2288569 NOT OK | olegts | 2016-04-26 00:01:50 +0300 (Вт., 26 апр. 2016) | 5 lines
r2288541 OK | olegts | 2016-04-25 23:03:10 +0300 (Пн., 25 апр. 2016) | 4 lines
r2288537 | olegts | 2016-04-25 22:49:29 +0300 (Пн., 25 апр. 2016) | 5 lines
r2288527 OK | olegts | 2016-04-25 22:37:19 +0300 (Пн., 25 апр. 2016) | 5 lines
r2288323 | olegts | 2016-04-25 19:29:25 +0300 (Пн., 25 апр. 2016) | 4 lines
r2288321 | olegts | 2016-04-25 19:27:44 +0300 (Пн., 25 апр. 2016) | 5 lines
r2288177 | olegts | 2016-04-25 18:06:44 +0300 (Пн., 25 апр. 2016) | 5 lines
r2288130 | olegts | 2016-04-25 17:41:22 +0300 (Пн., 25 апр. 2016) | 6 lines
r2281757 OK | olegts | 2016-04-18 18:46:52 +0300 (Пн., 18 апр. 2016) | 4 lines
r2281272 | olegts | 2016-04-18 14:54:33 +0300 (Пн., 18 апр. 2016) | 5 lines
r2280995 | olegts | 2016-04-18 12:57:52 +0300 (Пн., 18 апр. 2016) | 4 lines
r2280987 | olegts | 2016-04-18 12:52:55 +0300 (Пн., 18 апр. 2016) | 4 lines
r2280982 | olegts | 2016-04-18 12:49:36 +0300 (Пн., 18 апр. 2016) | 4 lines
r2280828 | olegts | 2016-04-18 06:20:17 +0300 (Пн., 18 апр. 2016) | 4 lines
r2280774 | olegts | 2016-04-18 01:49:03 +0300 (Пн., 18 апр. 2016) | 4 lines
r2280772 | olegts | 2016-04-18 01:41:41 +0300 (Пн., 18 апр. 2016) | 4 lines
r2279197 | olegts | 2016-04-15 05:02:05 +0300 (Пт., 15 апр. 2016) | 4 lines
r2277828 | olegts | 2016-04-13 23:07:54 +0300 (Ср., 13 апр. 2016) | 5 lines
r2277221 | olegts | 2016-04-13 16:10:33 +0300 (Ср., 13 апр. 2016) | 4 lines
r2275286 | olegts | 2016-04-12 03:19:38 +0300 (Вт., 12 апр. 2016) | 7 lines
r2274845 | olegts | 2016-04-11 18:59:48 +0300 (Пн., 11 апр. 2016) | 5 lines



ClickHouseOrderCounter.pm

http://bsgraphite.yandex.ru/render/?width=586&height=308&_salt=1462364367.806&from=-24hours&target=sumSeries(one_min.bsyt01g_prestable_bstest_yandex_net.log-chopper2.queue_size.Rotate*Log,one_min.bsyt0*g_prestable_bstest_yandex_net.logcount_*Log.count,one_min.bsyt01g_prestable_bstest_yandex_net.skyman.down.wait_pre_hook)

PatterID
P4765
P29000
(P24387&P24431&P545)&P1013761&P1013763&P930209&P926834



./stat/yabs-bsyt/scripts/export-ordercounter-to-yt-from-yt.pl OK
,/stat/bstat-yt/bsdb-to-yt.pl OK
./stat/yabs-bsyt/Yabs/TableDefs/yt.Banner.yml OK
./stat/yabs-bsyt/Yabs/TableDefs/yt.OrderCounter.yml OK
./stat/yabs-bsyt/Yabs/TableDefs/yt.OrderCounterGoalStat.yml OK
./stat/yabs-bsyt/Yabs/Stat/Collectors/YTOrderCounter.pm OK
./stat/yabs-bsyt/Yabs/Stat/Collectors/YTOrderCounterGoalStat.pm OK


=====


  DB<5> x $module
0  '/usr/share/perl5/Yabs/Data/Accumulator.pm'
  DB<6> x $submodule
0  '/usr/share/perl5/Log/Log4perl/Appender/Screen.pm'

/usr/share/perl5/PoolController.pm     | libpoolcontroller-perl       | ("WithTimeout");                      |
/usr/share/perl5/Yabs/Timeout.pm       | yabs-timeouts                | ("WithTimeout");                      |


====
1) tarball
  - common depends from INC
  - WithTimeout.so
  - log4perl configs
  - global-info
  - dirs: log, lock, scriptcontorl
  - TableDefs
  - TimeZone modules
2) mysql grants
3) testing

=========

старая таблица
	передалется параметр аттрибуции
новая таблица
	не передается параметр аттрибуции
		нет опции
		есть опция
	передается параметр аттрибуции
		нет опции
		есть опция





bubuffer выясняем нужен ли релиз для убирания фильтрация

Релизы
yabs-bstat-collectors=? <- ждем коммита zurom
yabs-bsyt=028.4 еще не собран, ждем коммита zurom (еще ждем коммита Ромы) <- zalamael, 1/2 olegts
yabs-export-scripts-fast=021.1 (старый 020 уже собран и его надо докатить) <- yarulin, zurom
bsbuffer-rotate2=148.1 тестируется
autobudget-forecast 044.1 ожидает ревью <- olegts
bstat-collectors-clickhouse=028.1 завершено тестирование <- zasalamel и на половину olegts
yabs-bssoap-www=124.1 тестируется <- yarulin
yabs-autobudget2 097.1 катим везде в понедельник <- olegts

Порядок включения:
  - после выкладки collectors-clickhouse мастер отчетов и ручки директа переключаются на чтение GoalsMap.AttributionType, Goals.SessionLen,..
  - убрать фильтрафию visit-лога на bsbuffer
  - переключаем некоторые коллекторы на AttributionType = 1
  - ClickHouseOrderCounter начинает собирать обе аттрибуции

bstat145

bstat48e.yandex.ru,bstat54e.yandex.ru,bstat38f.yandex.ru,bstat104f.yandex.ru,bstat86e.yandex.ru,bstat145f.yandex.ru,bstat148f.yandex.ru,bstat149f.yandex.ru,bstat104i.yandex.ru,bstat104h.yandex.ru,bstat129h.yandex.ru,bstat145i.yandex.ru,bstat145h.yandex.ru,bstat148i.yandex.ru,bstat148h.yandex.ru,bstat149i.yandex.ru,bstat149h.yandex.ru

1) timeout 'Yabs::Pool::forkTasks.*timeout' на bstat145 and 104

Error    : bstat104f.yandex.ru,bstat145f.yandex.ru,bstat104i.yandex.ru,bstat104h.yandex.ru,bstat129h.yandex.ru,bstat145i.yandex.ru,bstat145h.yandex.ru
[Serial] >



1090151,1309912
bsint145i


2016/05/16 17:45
2016/05/16 17:57


==========

2016/05/17 17:33:06 87062 INFO  [ update_orders] OrderInfo, AttributionType = 2: updated 0

В это время мы перестали апдейтить


==========


Простой запуск Автобюджета
2016/05/17 20:42:52 26463 INFO  [optimize_with_] order 8853655: good after LimitMaxCost 1
2016/05/17 20:53:41 26463 INFO  [optimize_with_] AutoBudget order 8853655 (total pr_ph=368982, have costs=368994)

Вместе с SW_NOT_WATCH
2016/05/18 03:18:00 11984 INFO  [optimize_with_] order 8853655: good after LimitMaxCost 1
2016/05/18 03:28:51 11984 INFO  [optimize_with_] AutoBudget order 8853655 (total pr_ph=368982, have costs=368994)

С обрезанием баннеро-фраз
2016/05/20 19:34:44 9314  INFO  [optimize_with_] order 8853655: good after LimitMaxCost 1
2016/05/20 19:39:51 9314  INFO  [optimize_with_] AutoBudget order 8853655 (total pr_ph=169384, have costs=169392)


Другой заказ с таким же числом группо-фраз 6035775


OrderID = 5126696


mysql> select OrderID,ABRestartHistory.StartTime,GoalID from ABRestartHistory inner join AutoBudgetOrder using(OrderID) where GoalID >= 0 and date(ABRestartHistory.StartTime) = '2016-05-18' order by 2 asc ;
+---------+---------------------+----------+
| OrderID | StartTime           | GoalID   |
+---------+---------------------+----------+
| 7641071 | 2016-05-18 02:44:19 |  2946526 |
|  217782 | 2016-05-18 13:09:27 | 10845244 |
| 5126696 | 2016-05-18 23:39:34 |        0 |
+---------+---------------------+----------+
3 rows in set (0.04 sec)

RotateAutoBudgetRestart201605182040050023

mysql> select * from AutoBudgetConvStatNew where BannerID = 765591179 and PhraseID = 1101791846;
+-----------+------------+--------+------------+-------------+---------------------+--------+---------+-------+---------+----------+--------+
| BannerID  | PhraseID   | TypeID | TargetType | ContextType | UpdateTime          | Clicks | Actions | Price | Clicks0 | Actions0 | Price0 |
+-----------+------------+--------+------------+-------------+---------------------+--------+---------+-------+---------+----------+--------+
| 765591179 | 1101791846 |      2 |          3 |           1 | 2016-05-12 00:00:00 |      0 | 2672742 |     0 |       0 |        0 |      0 |
+-----------+------------+--------+------------+-------------+---------------------+--------+---------+-------+---------+----------+--------+
1 row in set (0.00 sec)

mysql> select * from AutoBudgetConvStatOld where BannerID = 765591179 and PhraseID = 1101791846;
+-----------+------------+--------+------------+-------------+---------------------+--------+---------+-------+---------+----------+--------+
| BannerID  | PhraseID   | TypeID | TargetType | ContextType | UpdateTime          | Clicks | Actions | Price | Clicks0 | Actions0 | Price0 |
+-----------+------------+--------+------------+-------------+---------------------+--------+---------+-------+---------+----------+--------+
| 765591179 | 1101791846 |      2 |          3 |           1 | 2016-05-12 00:00:00 |      0 | 7857927 |     0 |       0 |        0 |      0 |
+-----------+------------+--------+------------+-------------+---------------------+--------+---------+-------+---------+----------+--------+
1 row in set (0.00 sec)

[Serial] > exec bstat29.* mysql -uroot yabsdb -e 'select * from AutoBudgetConvStat where BannerID = 765591179 and PhraseID = 1101791846'

=== bstat29i.yandex.ru (@sas-2-3-3), 1/3 ===
BannerID	PhraseID	TypeID	TargetType	ContextType	UpdateTime	Clicks	Actions	Price	Clicks0	Actions0	Price0
765591179	1101791846	2	3	1	2016-05-12 00:00:00	0	2577287	0	0	0	0

=== bstat29f.yandex.ru (@myt6), 2/3 ===
BannerID	PhraseID	TypeID	TargetType	ContextType	UpdateTime	Clicks	Actions	Price	Clicks0	Actions0	Price0
765591179	1101791846	2	3	1	2016-05-12 00:00:00	0	7577287	0	0	0	0

=== bstat29h.yandex.ru (@ugr7), 3/3 ===
BannerID	PhraseID	TypeID	TargetType	ContextType	UpdateTime	Clicks	Actions	Price	Clicks0	Actions0	Price0
765591179	1101791846	2	3	1	2016-05-12 00:00:00	0	7577287	0	0	0	0



[root@local] yt> select GoalID, UpdateTime,sum(Count) from [//yabs/OrderCounterGoalStat] where OrderID = 5126696u and BannerID = 765591179u and PhraseID = 1101791846u and  TypeID > 0u and UpdateTime > 1461289212u group by GoalID,UpdateTime ;
.------------------------------------.
| GoalID   | UpdateTime | sum(Count) |
+----------+------------+------------+
|        0 | 1461618000 |          5 |
| 10751364 | 1461618000 |          1 |
| 14476150 | 1461618000 |          1 |
| 16474090 | 1461618000 |          1 |
| 16499715 | 1461618000 |          1 |
| 17972095 | 1461618000 |          1 |
|        0 | 1463000400 |          1 |
| 10751364 | 1463000400 |          1 |
| 12348518 | 1463000400 |          1 |
| 16474090 | 1463000400 |          1 |
| 16499715 | 1463000400 |          1 |
| 16604605 | 1463000400 |          1 |
| 17972095 | 1463000400 |          1 |
'----------+------------+------------'


mysql> select UpdateTime,GoalID, sum(Count) from OCGoalStat201605 where OrderID = 5126696 and BannerID = 765591179 and PhraseID = 1101791846 and  TypeID > 0 and UpdateTime > 1461289212 group by 1,2;
+---------------------+----------+------------+
| UpdateTime          | GoalID   | sum(Count) |
+---------------------+----------+------------+
| 2016-05-12 00:00:00 | 10751364 |          1 |
| 2016-05-12 00:00:00 | 12348518 |          1 |
| 2016-05-12 00:00:00 | 16474090 |          1 |
| 2016-05-12 00:00:00 | 16499715 |          1 |
| 2016-05-12 00:00:00 | 16604605 |          1 |
| 2016-05-12 00:00:00 | 17972095 |          1 |
+---------------------+----------+------------+
6 rows in set, 2 warnings (0.00 sec)

mysql> select EventTime,OrderID,VisitID,GoalID, sum(Type = 1) - sum(Type = 0) from order_5126696_visits where TraficSourceID = 3 and ClickNum = 1 and GoalReached = 1 and GoodEvent > 0 and AttributionType = 1 and bannerid = 765591179 group by 1,2,3,4;
+---------------------+---------+---------------------+----------+-------------------------------+
| EventTime           | OrderID | VisitID             | GoalID   | sum(Type = 1) - sum(Type = 0) |
+---------------------+---------+---------------------+----------+-------------------------------+
| 2016-05-12 11:46:52 | 5126696 | 2567651897537990352 |        0 |                             1 |
| 2016-05-12 11:46:52 | 5126696 | 2567651897537990352 | 10751364 |                             1 |
| 2016-05-12 11:46:52 | 5126696 | 2567651897537990352 | 12348518 |                             1 |
| 2016-05-12 11:46:52 | 5126696 | 2567651897537990352 | 16474090 |                             1 |
| 2016-05-12 11:46:52 | 5126696 | 2567651897537990352 | 16499715 |                             1 |
| 2016-05-12 11:46:52 | 5126696 | 2567651897537990352 | 16604605 |                             1 |
| 2016-05-12 11:46:52 | 5126696 | 2567651897537990352 | 17972095 |                             1 |
+---------------------+---------+---------------------+----------+-------------------------------+
7 rows in set (0.00 sec)[M`A9

Пример хорошей фразы

[Serial] > exec bstat29.* mysql -uroot yabsdb -e 'select * from AutoBudgetConvStat where BannerID = 765248702 and PhraseID = 1109580815'

=== bstat29i.yandex.ru (@sas-2-3-3), 1/3 ===
BannerID	PhraseID	TypeID	TargetType	ContextType	UpdateTime	Clicks	Actions	Price	Clicks0	Actions0	Price0
765248702	1109580815	2	0	1	2016-04-25 00:00:00	0	12373872	0	0	0	0

=== bstat29f.yandex.ru (@myt6), 2/3 ===
BannerID	PhraseID	TypeID	TargetType	ContextType	UpdateTime	Clicks	Actions	Price	Clicks0	Actions0	Price0
765248702	1109580815	2	0	1	2016-04-25 00:00:00	0	12373872	0	0	0	0

=== bstat29h.yandex.ru (@ugr7), 3/3 ===
BannerID	PhraseID	TypeID	TargetType	ContextType	UpdateTime	Clicks	Actions	Price	Clicks0	Actions0	Price0
765248702	1109580815	2	0	1	2016-04-25 00:00:00	0	12373872	0	0	0	0
[Serial] >

[root@local] yt> select GoalID, UpdateTime,sum(Count) from [//yabs/OrderCounterGoalStat] where OrderID = 5126696u and BannerID = 765248702u and PhraseID = 1109580815u and  TypeID > 0u and UpdateTime > 1461289212u group by GoalID,UpdateTime ;
.------------------------------------.
| GoalID   | UpdateTime | sum(Count) |
+----------+------------+------------+
|        0 | 1461445200 |          9 |
| 10751364 | 1461445200 |          2 |
| 12909949 | 1461445200 |          1 |
| 16474090 | 1461445200 |          2 |
| 16499715 | 1461445200 |          2 |
| 17972095 | 1461445200 |          2 |
|        0 | 1461531600 |          4 |
| 10751364 | 1461531600 |          1 |
| 16474090 | 1461531600 |          1 |
| 16499715 | 1461531600 |          1 |
| 17972095 | 1461531600 |          1 |
'----------+------------+------------'

[root@local] yt>

mysql> select EventTime,OrderID,VisitID,GoalID, sum(Type = 1) - sum(Type = 0) from order_5126696_visits where TraficSourceID = 3 and ClickNum = 1 and GoalReached = 1 and GoodEvent > 0 and AttributionType = 1 and bannerid = 765248702 and phraseid = 1109580815 group by 1,2,3,4;
+---------------------+---------+---------------------+----------+-------------------------------+
| EventTime           | OrderID | VisitID             | GoalID   | sum(Type = 1) - sum(Type = 0) |
+---------------------+---------+---------------------+----------+-------------------------------+
| 2016-04-25 20:22:09 | 5126696 | 2190719323698366326 |        0 |                             1 |
| 2016-04-25 20:22:09 | 5126696 | 2190719323698366326 | 10751364 |                             1 |
| 2016-04-25 20:22:09 | 5126696 | 2190719323698366326 | 16474090 |                             1 |
| 2016-04-25 20:22:09 | 5126696 | 2190719323698366326 | 16499715 |                             1 |
| 2016-04-25 20:22:09 | 5126696 | 2190719323698366326 | 17972095 |                             1 |
+---------------------+---------+---------------------+----------+-------------------------------+
5 rows in set (0.00 sec)

https://arc.yandex-team.ru/wsvn/arc//trunk/arcadia/yabs/stat/yabs-bsyt/Yabs/Stat/Collectors/YTOrderCounterGoalStat.pm?rev=2283109&op=diff&ignorews=1
https://st.yandex-team.ru/BSRELEASE-37166
https://st.yandex-team.ru/BSRELEASE-37162#1461753540000


Рестарт другого заказа

orderid = 9210681
goal_id = 12200903


======================



mysql> select FromTime, sum(PhHits) from AutoBudgetOrderHistoryClicks where FromTime between '2016-05-18 10:00:00' and '2016-05-18 14:00:00' group by 1;
+---------------------+-------------+
| FromTime            | sum(PhHits) |
+---------------------+-------------+
| 2016-05-18 10:00:00 |     1171117 |
| 2016-05-18 10:40:00 |     1169793 |
| 2016-05-18 11:20:00 |    31977646 |
| 2016-05-18 12:00:00 |   679910454 |
| 2016-05-18 13:00:00 |   674205276 |
| 2016-05-18 14:00:00 |   687529924 |
+---------------------+-------------+
6 rows in set (0.01 sec)



mysql> select  OrderID, sum(PhHits * (FromTime='2016-05-18 10:40:00')) as PrevHits, sum(PhHits * (FromTime='2016-05-18 12:00:00')) as PostHits from AutoBudgetOrderHistoryClicks where FromTime between '2016-05-18 10:00:00' and '2016-05-18 14:00:00'  group by OrderID order by sum(PhHits * (FromTime='2016-05-18 12:00:00'))-sum(PhHits * (FromTime='2016-05-18 10:40:00')) desc limit 10;
+---------+----------+-----------+
| OrderID | PrevHits | PostHits  |
+---------+----------+-----------+
| 9288969 |        0 | 678608641 |
| 5974093 |   722503 |    904034 |
| 5894543 |       75 |        75 |
| 9225025 |        0 |         0 |
| 6101802 |        0 |         0 |
| 7762262 |        0 |         0 |
| 7948233 |        0 |         0 |
| 8293931 |       71 |        71 |
| 4997377 |        0 |         0 |
| 8817278 |        0 |         0 |
+---------+----------+-----------+
10 rows in set (0.00 sec)

mysql> select  OrderID, sum(PhHits * (FromTime='2016-05-18 10:25:00')) as PrevHits, sum(PhHits * (FromTime='2016-05-18 12:25:00')) as PostHits from AutoBudgetOrderHistoryClicks where FromTime between '2016-05-18 10:00:00' and '2016-05-18 14:00:00'  group by OrderID order by sum(PhHits * (FromTime='2016-05-18 12:25:00'))-sum(PhHits * (FromTime='2016-05-18 10:25:00')) desc limit 10;
+---------+----------+-----------+
| OrderID | PrevHits | PostHits  |
+---------+----------+-----------+
| 9289028 |        0 | 389929400 |
|  255356 |     5414 |      5718 |
| 2879736 |    16080 |     16096 |
| 8871467 |      821 |       822 |
| 3845918 |     2683 |      2684 |
| 8700210 |    22807 |     22808 |
| 8855117 |        0 |         0 |
| 5279551 |        0 |         0 |
| 2183818 |      969 |       969 |
| 5757374 |     1944 |      1944 |
+---------+----------+-----------+
10 rows in set (0.01 sec
=====


bannerid = 1064384315
orderid = 7207820
mysql> select bannerid,phraseid,contexttype,options from PhrasePrice where bannerid=  1064384315;
+------------+----------+-------------+-----------------------------+
| bannerid   | phraseid | contexttype | options                     |
+------------+----------+-------------+-----------------------------+
| 1064384315 |       65 |           8 | deleted,autobroker,currency |
| 1064384315 |       66 |           8 | deleted,autobroker,currency |
| 1064384315 |      122 |           8 | autobroker,currency         |
| 1064384315 |      123 |           8 | autobroker,currency         |
| 1064384315 |      124 |           8 | autobroker,currency         |
| 1064384315 |      125 |           8 | autobroker,currency         |
| 1064384315 |      126 |           8 | autobroker,currency         |
| 1064384315 |      127 |           8 | autobroker,currency         |
| 1064384315 |      128 |           8 | autobroker,currency         |
| 1064384315 |      129 |           8 | autobroker,currency         |
| 1064384315 |      130 |           8 | autobroker,currency         |
| 1064384315 |      131 |           8 | autobroker,currency         |
| 1064384315 |      132 |           8 | autobroker,currency         |
| 1064384315 |      133 |           8 | autobroker,currency         |
+------------+----------+-------------+-----------------------------+
14 rows in set (0.00 sec)


=========

orderid=  8904073
annerid in (1599139389,1599139390)
phraseid = 63029877;



mysql> select bannerid,phraseid,contexttype,resultcost/1e4,resultflatcost/1e4,options from PhrasePrice where orderid= 8904073 and phraseid = 63029877;
+------------+----------+-------------+----------------+--------------------+---------------------+
| bannerid   | phraseid | contexttype | resultcost/1e4 | resultflatcost/1e4 | options             |
+------------+----------+-------------+----------------+--------------------+---------------------+
| 1599139389 | 63029877 |           1 |            0.3 |                4.4 | autobroker,currency |
| 1599139390 | 63029877 |           1 |            0.3 |                4.4 | autobroker,currency |
+------------+----------+-------------+----------------+--------------------+---------------------+
2 rows in set (0.00 sec)

mysql> select bannerid,phraseid,contexttype,resultcost/1e4,resultflatcost/1e4,options from PhrasePrice where orderid= 8904073 and phraseid = 63029877;
+------------+----------+-------------+----------------+--------------------+---------------------+
| bannerid   | phraseid | contexttype | resultcost/1e4 | resultflatcost/1e4 | options             |
+------------+----------+-------------+----------------+--------------------+---------------------+
| 1599139389 | 63029877 |           1 |            0.3 |                0.3 | autobroker,currency |
| 1599139390 | 63029877 |           1 |            0.3 |                0.3 | autobroker,currency |
+------------+----------+-------------+----------------+--------------------+---------------------+
2 rows in set (0.04 sec)



mysql> select APC1/1e6 from ABVWForecasterAPC where BannerID in(1599139389,1599139390) and phraseid= 63029877;
+----------+
| APC1/1e6 |
+----------+
| 0.072017 |
| 0.071428 |
+----------+
2 rows in set (0.00 sec)


mysql> select bannerid,phraseid,sum(Clicks /1e6) ,sum(Cost/1e6) from AutoBudgetAdjustedStat where BannerID in(1599139389,1599139390) and phraseid= 63029877;
+------------+----------+-------------------+---------------+
| bannerid   | phraseid | sum(Clicks /1e6)  | sum(Cost/1e6) |
+------------+----------+-------------------+---------------+
| 1599139389 | 63029877 | 758864.5501770001 | 111038.343541 |
+------------+----------+-------------------+---------------+
1 row in set (0.00 sec)


mysql> select AvgCPACur/1e4, AvgCPA/1e6 from AutoBudgetOrder where orderid=8904073;
+---------------+------------+
| AvgCPACur/1e4 | AvgCPA/1e6 |
+---------------+------------+
|         49.56 |      1.652 |
+---------------+------------+
1 row in set (0.00 sec)

>>> 110918.276222 / (757648.210309 * 0.072017)
2.0328272969814827


 !!! PRODUCTION !!! root@bstat33i [yabsdb]> select ContextPriority > 0, BannerPriority > 0, find_in_set('lm-phrase', Options) , count(*) from BroadMatch inner join  (select BannerID,ContextPriority,BannerPriority from Banner33 where orderid = 8747354) T using(BannerID) group by 1,2,3;
+---------------------+--------------------+-----------------------------------+----------+
| ContextPriority > 0 | BannerPriority > 0 | find_in_set('lm-phrase', Options) | count(*) |
+---------------------+--------------------+-----------------------------------+----------+
|                   1 |                  1 |                                 0 |     4779 |
|                   1 |                  1 |                                 3 |     3039 |
+---------------------+--------------------+-----------------------------------+----------+
2 rows in set (0.00 sec)


sudo apt-get install yabs-yt-standalone-conf-17.5=000.18 yabs-yt-standalone-conf=000.18 yandex-yt-http-proxy=0.17.5-stable~7975~ba88a85 yandex-yt-local=0.0.21-0 yandex-yt-python=0.6.98-1 yandex-yt=0.17.5-stable~7975~ba88a85 -q0



======


orderid = 6677302
bannerid = 931186747 parentexportid = 1318614143
phraseid = 732743089 meizu m2 mini

mysql> select date(EventTime), BannerID,  sum(CounterType = 2) from phrase_732743089_clicks where  SlotID = 1 group by 1,2 order by 1,3;
+-----------------+------------+----------------------+
| date(EventTime) | BannerID   | sum(CounterType = 2) |
+-----------------+------------+----------------------+
| 2016-04-30      | 1578250605 |                    1 |
| 2016-04-30      |  952534683 |                    1 |
| 2016-04-30      | 1631050576 |                    1 |
| 2016-04-30      | 1001259329 |                    1 |
| 2016-04-30      | 1624570775 |                    1 |
| 2016-04-30      |  931305357 |                    1 |
| 2016-04-30      | 1233818806 |                    1 |
| 2016-04-30      | 1631146736 |                    1 |
| 2016-04-30      |  924595713 |                    1 |
| 2016-04-30      | 1215713814 |                    2 |
| 2016-04-30      | 1001259328 |                    3 |
| 2016-04-30      | 1631146753 |                    3 |
| 2016-04-30      | 1001259330 |                    4 |
| 2016-04-30      | 1219630595 |                    5 |
| 2016-05-01      | 1442812635 |                    1 |
| 2016-05-01      | 1631146736 |                    1 |
| 2016-05-01      |  952534683 |                    1 |
| 2016-05-01      | 1089876871 |                    1 |
| 2016-05-01      | 1578250603 |                    1 |
| 2016-05-01      |  931305357 |                    1 |
| 2016-05-01      | 1441793824 |                    1 |
| 2016-05-01      | 1271365354 |                    1 |
| 2016-05-01      | 1001259328 |                    2 |
| 2016-05-01      | 1578250602 |                    2 |
| 2016-05-01      | 1578250605 |                    2 |
| 2016-05-01      | 1633587248 |                    2 |
| 2016-05-01      | 1001259330 |                    4 |
| 2016-05-01      | 1219630595 |                    5 |
| 2016-05-02      |  952534683 |                    1 |
| 2016-05-02      | 1633568509 |                    1 |
| 2016-05-02      | 1578250602 |                    1 |
| 2016-05-02      | 1001259328 |                    1 |
| 2016-05-02      | 1442812635 |                    1 |
| 2016-05-02      | 1394849285 |                    1 |
| 2016-05-02      | 1626528399 |                    1 |
| 2016-05-02      | 1578250605 |                    1 |
| 2016-05-02      |  931305357 |                    1 |
| 2016-05-02      | 1233818806 |                    2 |
| 2016-05-02      | 1635604055 |                    2 |
| 2016-05-02      | 1608687055 |                    2 |
| 2016-05-02      | 1578250606 |                    3 |
| 2016-05-02      |  931186746 |                    5 |
| 2016-05-02      | 1001259330 |                    5 |
| 2016-05-02      |  931186747 |                    7 |
| 2016-05-02      | 1219630595 |                    8 |
| 2016-05-03      |  931305357 |                    1 |
| 2016-05-03      | 1445004912 |                    1 |
| 2016-05-03      | 1230731477 |                    1 |
| 2016-05-03      |  952534683 |                    1 |
| 2016-05-03      | 1631050499 |                    2 |
| 2016-05-03      | 1089876871 |                    3 |
| 2016-05-03      | 1001259328 |                    3 |
| 2016-05-03      | 1633568509 |                    4 |
| 2016-05-03      | 1219630595 |                    5 |
| 2016-05-03      | 1001259330 |                    7 |
| 2016-05-03      | 1578250606 |                    7 |
| 2016-05-03      |  931186746 |                    9 |
| 2016-05-03      |  931186747 |                   17 |
+-----------------+------------+----------------------+
58 rows in set (0.00 sec)

mysql>

mysql> select date(EventTime), PhraseID, sum(OrigOrderID = 6677302 and SlotID = 1) as CurSlot1, sum(OrigOrderID = 6677302  and SlotID = 2) as CurSlot2, sum(SlotID = 1) as AllSlot1, sum(SlotID = 2) as AllSlot2  from phrase_732743089_clicks where FraudBits = 0 group by 1,2;
+-----------------+-----------+----------+----------+----------+----------+
| date(EventTime) | PhraseID  | CurSlot1 | CurSlot2 | AllSlot1 | AllSlot2 |
+-----------------+-----------+----------+----------+----------+----------+
| 2016-04-30      | 732743089 |        0 |        5 |       24 |       52 |
| 2016-05-01      | 732743089 |        0 |        2 |       22 |       44 |
| 2016-05-02      | 732743089 |       11 |        7 |       37 |       59 |
| 2016-05-03      | 732743089 |       24 |        5 |       56 |       70 |
+-----------------+-----------+----------+----------+----------+----------+
4 rows in set (0.00 sec)



mysql> select EventDate, PhraseID, sum(SlotID = 1), sum(SlotID = 2) from  (select distinct date(EventTime) as EventDate, PhraseID, SlotID, BannerID from phrase_732743089_clicks where OrigOrderID != 6677302) T group by 1,2;
+------------+-----------+-----------------+-----------------+
| EventDate  | PhraseID  | sum(SlotID = 1) | sum(SlotID = 2) |
+------------+-----------+-----------------+-----------------+
| 2016-04-30 | 732743089 |              14 |              18 |
| 2016-05-01 | 732743089 |              14 |               8 |
| 2016-05-02 | 732743089 |              15 |              13 |
| 2016-05-03 | 732743089 |              11 |              17 |
+------------+-----------+-----------------+-----------------+
4 rows in set (0.00 sec)


============================

bannerid in (417654251, 417718248) and phraseid = 646227492
bannerid = 417718248 and phraseid = 646227492
417718248,646227492

orderid = 3769202
mysql> select BannerID,PhraseID,ContextType,sum(Clicks), sum(RealCost) from AutoBudgetAdjustedStat  inner join Banner56 using(BannerID) where OrderID = 3769202 group by 1,2,3 order by 4 desc limit 10;
+-----------+------------+-------------+--------------+---------------+
| BannerID  | PhraseID   | ContextType | sum(Clicks)  | sum(RealCost) |
+-----------+------------+-------------+--------------+---------------+
| 417718248 |  646227492 |           1 | 166998994940 |   30574274596 |
| 363365752 |  639348551 |           1 | 106100415717 |   20765899010 |
| 441536874 |  646081295 |           1 |  56640701116 |   11201795179 |
| 441536874 |    6054690 |           1 |  49443036674 |    8670664287 |
| 390202886 | 1122865861 |           1 |  47696328511 |    9189178720 |
| 570470289 |  639409454 |           1 |  34883038162 |    7567382218 |
| 363365752 |  495321762 |           1 |  32294632352 |    6320918839 |
| 416979176 |  639401957 |           1 |  23291942926 |    4621229388 |
| 569010271 |     531094 |           1 |  23073884586 |    4102780305 |
| 387804088 |  648468210 |           1 |  22323921476 |    4870973747 |
+-----------+------------+-------------+--------------+---------------+
10 rows in set (0.00 sec)


+----------+---------------+-------------+----------------------------------+
| DomainID | DomainGroupID | Domain      | DomainHash                       |
+----------+---------------+-------------+----------------------------------+
| 22675926 |      22675926 | new-ford.ru | 5bf710b204c9137feb6e1436ff3a686d |
+----------+---------------+-------------+----------------------------------+
1 row in set (5.45 sec)


Welcome to YQL Console Client! Type help; for help.
> use sakura
sakura> select cast(BannerID as String) as key,  '' as subkey, '' as value from sakura.[dbrestore/bstat/yabsdb/Banner] where TargetDomainID = 22675926;
╒══════════════╤═════════════════╤════════════════╕
│ key String   │ subkey String   │ value String   │
╞══════════════╪═════════════════╪════════════════╡
╘══════════════╧═════════════════╧════════════════╛
(returned 0 rows in 3 minutes and 15 seconds)

mysql> select PhraseID,sum(Cost/1e6),sum(Clicks/1e6) from AutoBudgetAdjustedStat group by 1 order by 2 desc  limit 10;
+------------+--------------------+--------------------+
| PhraseID   | sum(Cost/1e6)      | sum(Clicks/1e6)    |
+------------+--------------------+--------------------+
|   63029877 |      154861.107933 | 1031315.2691990002 |
|    1811493 | 141875.38699300002 |     1157832.662186 |
| 1130919120 | 136112.74941199998 |  881710.4330050001 |
|    1371727 |  92119.05542700001 |      652310.487853 |
|   67396630 |       70833.472627 | 420550.22292000015 |
| 1130919128 |  63355.35485399999 |      419345.003202 |
| 1130919136 | 60611.788299000014 |      395265.844928 |
| 1119362219 |       60030.577924 |      376491.070732 |
| 1116994865 |  52670.01040700001 |       311014.43063 |
| 1130919135 |  52233.70043799999 | 342656.53695800004 |и
+------------+--------------------+--------------------+
10 rows in set (0.01 sec)

2016/05/26 21:17:50 24207 INFO  [calc_flat_bids] Order 8904073 final limit idx=1591/X-derivative-limit (actions)

ConvHourCategoryPos
HourCategorySlotForecast
HourCategoryPosForecast
RotateAutoBudgetCategoryCoeffs201605212224570012

1) БК:5847703
Остановка объявлений

https://direct.yandex.ru/registered/main.YFMTtPSuEqE3GBD6.pl?cmd=showLogs&type=cmd&login=&uid=&client_login=&client_uid=&cid=13537034&bid=&pid=&yandexuid=&ip=&date_from=2016.04.30&time_from=&date_to=2016.05.03&time_to=&reqid=&id=&sch_cmds=&cmds=&limit=1000&params_filter=

2) БК:7789517

Изменения ставок

3) БК:9037968

Изменения ставок

4) БК:9057887

Изменения ставок



RotatePhrasePriceChangeLog201605301156080020
RotatePhrasePriceChangeLog201605301156080013

mysql> select orderid,baseno from OrderInfo where orderid in (8800238,8853773) ;
+---------+--------+
| orderid | baseno |
+---------+--------+
| 8800238 |     10 |
| 8853773 |    124 |
+---------+--------+
2 rows in set (0.00 sec)

[parasprite] [precise] Отчёт Parasprite: yabs-bstat-updaters=049.15 - НЕ ПРОЙДЕНЫ [4/37]
 о тестировании YaBS Subsystems - Yabs BSTAT FT
[precise] Отчёт Transport – B2B Smoke (UpdateData2) (051.
[precise] Отчёт Transport – FT Direct


NewRotateDoubleVisitLog2016053023483607

bssoap01e
2016/05/30 15:13:55 705462 INFO  [          lock] Get quorum(5/3) while locking
2016/05/30 15:18:54 797357 INFO  [          lock] Some other host got quorum(0/3)

bssoap01f
2016/05/30 15:13:41 929250 INFO  [          lock] Get quorum(5/3) while locking
2016/05/30 15:18:42 1006762 INFO  [          lock] Get quorum(5/3) while locking


ABVWForecasterAPC
AutoBudgetForecasterAPC
AutoBudgetForecasterAPC
AutoBudgetForecasterCTR
ABVWForecasterPPC
AutoBudgetForecasterCTRMedia


8833146


   1) A /trunk/arcadia/yabs/stat/bsint2/Yabs/DatabaseCheck/Check/FiltersWithoutShows.pm OK
   2) A /trunk/arcadia/yabs/stat/bsint2/Yabs/DatabaseCheck/Check/CreativeCheck/CreativesExpireTime.pm OK
   3) A /trunk/arcadia/yabs/stat/bsint2/Yabs/DatabaseCheck/Check/OrdersWithoutRelevanceFilters.pm OK
   4) A /trunk/arcadia/yabs/stat/bsint2/Yabs/DatabaseCheck/Check/WrongHrefParams.pm OK
   5) A /trunk/arcadia/yabs/stat/bsint2/Yabs/DatabaseCheck/Check/OrdersWrongGeneration.pm OK
   6) A /trunk/arcadia/yabs/stat/bsint2/Yabs/DatabaseCheck/Check/CreativeCheck/OrdersWithoutNecessaryCreatives.pm OK
   7) не сделано
   8) A /trunk/arcadia/yabs/stat/bsint2/Yabs/DatabaseCheck/Check/CreativeCheck/CreativesWithoutAllSizes.pm OK
   9) A /trunk/arcadia/yabs/stat/bsint2/Yabs/DatabaseCheck/Check/CreativeCheck/RotateDspLogWin.pm OK
   10) A /trunk/arcadia/yabs/stat/bsint2/Yabs/DatabaseCheck/Check/PerformanceOrderWinsDistribution.pm OK


scale(divideSeries(diffSeries(diffSeries(one_min.bscoll-mf_yandex_ru.antifraud_clicks.all,one_min.bscoll-mf_yandex_ru.antifraud_clicks.good),timeShift(diffSeries(one_min.bscoll-mf_yandex_ru.antifraud_clicks.all,one_min.bscoll-mf_yandex_ru.antifraud_clicks.good), "-1w")),one_min.bscoll-mf_yandex_ru.antifraud_clicks.good),100)
scale(divideSeries(diffSeries(one_min.bscoll-mf_yandex_ru.antifraud_clicks.good,timeShift(one_min.bscoll-mf_yandex_ru.antifraud_clicks.good, "-1w")),one_min.bscoll-mf_yandex_ru.antifraud_clicks.good),100)



95:~ olegts$ grep -E "ERROR" YABSSYS-YBSTATFT-JOB1-2657.log | sed 's/.*ERROR//g' | sort | uniq | grep -v 'exist'
  bstat (5.255.244.137) is failed.
 [           new] DProcess::DProcess new failed	(Yabs::DProcess @/usr/share/perl5/Yabs/DProcess.pm:111)
 [           new] Initialization failed for task Transport3	(DProcess::DProcess @/usr/share/perl5/DProcess/DProcess.pm:204)
 [          init] DProcess::DLock::get_config failed for task Transport3	(DProcess::DProcess @/usr/share/perl5/DProcess/DProcess.pm:682)
 [        main::] main() error	(main @/home/yabs/stat/collect-log.pl:186)
 [      main_log] get_nextdatalog() error	(main @/home/yabs/stat/collect-log.pl:272)
 [      main_log] process_datalog() error	(main @/home/yabs/stat/collect-log.pl:313)
 [   export_data] CreateTable('MvPhrasePrice1') failed	(Yabs::Stat::Collectors::PhrasePrice @/usr/share/perl5/Yabs/Stat/Collectors/PhrasePrice.pm:514)
 [   export_data] CreateTable('MvPhrasePrice1000000000') failed	(Yabs::Stat::Collectors::PhrasePrice @/usr/share/perl5/Yabs/Stat/Collectors/PhrasePrice.pm:514)
 [  _export_data] SliceID=1000000000: BannerInfo->export() failed	(Yabs::Stat::Copier @/usr/share/perl5/Yabs/Stat/Copier.pm:1196)
 [  _export_data] SliceID=1000000000: LocalOrderInfo->export() failed	(Yabs::Stat::Copier @/usr/share/perl5/Yabs/Stat/Copier.pm:1196)
 [  _export_data] SliceID=1000000000: OrderUniData->export() failed	(Yabs::Stat::Copier @/usr/share/perl5/Yabs/Stat/Copier.pm:1196)
 [  _export_data] SliceID=1000000000: PhraseDict->export() failed	(Yabs::Stat::Copier @/usr/share/perl5/Yabs/Stat/Copier.pm:1196)
 [  _export_data] SliceID=1000000000: PhrasePrice->export() failed	(Yabs::Stat::Copier @/usr/share/perl5/Yabs/Stat/Copier.pm:1196)
 [  _export_data] SliceID=1000000000: Transport->export() failed	(Yabs::Stat::Copier @/usr/share/perl5/Yabs/Stat/Copier.pm:1196)
 [  _export_data] SliceID=1: BannerInfo->export() failed	(Yabs::Stat::Copier @/usr/share/perl5/Yabs/Stat/Copier.pm:1196)
 [  _export_data] SliceID=1: LocalOrderInfo->export() failed	(Yabs::Stat::Copier @/usr/share/perl5/Yabs/Stat/Copier.pm:1196)
 [  _export_data] SliceID=1: OrderUniData->export() failed	(Yabs::Stat::Copier @/usr/share/perl5/Yabs/Stat/Copier.pm:1196)
 [  _export_data] SliceID=1: PhraseDict->export() failed	(Yabs::Stat::Copier @/usr/share/perl5/Yabs/Stat/Copier.pm:1196)
 [  _export_data] SliceID=1: PhrasePrice->export() failed	(Yabs::Stat::Copier @/usr/share/perl5/Yabs/Stat/Copier.pm:1196)
 [  _export_data] SliceID=1: Transport->export() failed	(Yabs::Stat::Copier @/usr/share/perl5/Yabs/Stat/Copier.pm:1196)
 [  _fork_export] export_data(BannerInfo) error	(Yabs::Stat::Copier @/usr/share/perl5/Yabs/Stat/Copier.pm:1115)
 [  _fork_export] export_data(LocalOrderInfo) error	(Yabs::Stat::Copier @/usr/share/perl5/Yabs/Stat/Copier.pm:1115)
 [  _fork_export] export_data(PhraseDict) error	(Yabs::Stat::Copier @/usr/share/perl5/Yabs/Stat/Copier.pm:1115)
 [  _fork_export] export_data(PhrasePrice) error	(Yabs::Stat::Copier @/usr/share/perl5/Yabs/Stat/Copier.pm:1115)
 [_collect_order] _update_oc_metric_stat failed	(Yabs::Stat::Collectors::OrderCounter @/usr/share/perl5/Yabs/Stat/Collectors/OrderCounter.pm:595)
 [_update_oc_met] InsertIntoOCMetrictStat0: Incorrect datetime value: '1000000' for column 'EventTime' at row 1	(Yabs::Stat::Collectors::OrderCounter @/usr/share/perl5/Yabs/Stat/Collectors/OrderCounter.pm:736)
 [create_table_l] _get_table_fields error	(Yabs::MySQL::Utils @/usr/share/perl5/Yabs/MySQL/Utils.pm:482)
 [get_nextdatalo] _get_replica_time failed	(Yabs::Stat::CollectManager @/usr/share/perl5/Yabs/Stat/CollectManager.pm:510)
 [process_datalo] AntiDown::finish() error	(Yabs::Stat::CollectManager @/usr/share/perl5/Yabs/Stat/CollectManager.pm:637)
 [process_export] SliceID=1000000000: _export_data() failed	(Yabs::Stat::Copier @/usr/share/perl5/Yabs/Stat/Copier.pm:729)
 [process_export] SliceID=1: _export_data() failed	(Yabs::Stat::Copier @/usr/share/perl5/Yabs/Stat/Copier.pm:729)
: qabs-level3 failed =====
95:~ olegts$



7789094


trunk:
r2325232
r2325224
r2324830
r2321232
r2320373
r2320148

r093:
r2325245
r2321232
r2320373
r2320148


починка выпуклой оболочки https://st.yandex-team.ru/BSDEV-51605
autobudget-calc-flat-using-hulls
autobudget-flat-hull-extrapolation-enabled


ddсереги анплеева, славы дунаева, ильи акользина, виталика сувоворова, арсения красикова, леши мичурина, саши яруллина, илья никитина и тебя

2016/06/07 12:46:24 926420 INFO  [  check_orders] Start PerfomanceChildBannerWithoutRequiredResources
2016/06/07 13:59:12 926420 INFO  [  check_orders] Finish PerfomanceChildBannerWithoutRequiredResources

PhrasesWithoutBanners

dbmon-export-metrika-lost-banners-part
dbmon-perfomance-child-banner-without-required-resources-part 0.1

Load PhrasePrice
2016/06/08 16:58:28 869453 INFO  [load_all_forec] Got models to use : simple, default: simple



2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] Multiline message (23 rows):       (Yabs::YT::MultiClient @/usr/share/perl5/Yabs/YT/
MultiClient.pm:100)
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] > YT Exception: Chunk data is not preloaded yet
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >     origin          n0034i.seneca-fin.yt.yandex.net on 2016-06-08T16:51:25.443413Z
 (pid 156441, tid f1a7b2ee, fid d6b2650)
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >     request_id      624-f84f03a9-f02889a9-14b0d33e
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >     connection_id   1ab-82b266d1-203317f9-bf30605c
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >     tablet_id       e09-a1ac1-3f802be-e5b0e9b8
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >     timeout         60000
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >     method          Read
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >     address         n0034i.seneca-fin.yt.yandex.net:9012
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >     store_id        2957-d6a0f-3f80064-2998ebdf
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >     service         TabletService
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >     interface_type  remote
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >  at /usr/share/perl5/YT.pm line 167.
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >  YT::_XSFacade::AUTOLOAD('Yabs::YT::Client=HASH(0x7f4bd5a95038)', '//yabs/PhraseDi
ct', 'ARRAY(0x7f4bda4a14e8)', 'ARRAY(0x7f4bd9c57c08)', 'HASH(0x7f4bd9c51060)') called at /usr/share/perl5/Yabs/YT/MultiClient.pm line 95
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >  eval {...} called at /usr/share/perl5/Yabs/YT/MultiClient.pm line 95
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >  Yabs::YT::MultiClient::AUTOLOAD('Yabs::YT::MultiClient=HASH(0x7f4bd950fe08)', '//
yabs/PhraseDict', 'ARRAY(0x7f4bda4a14e8)', 'ARRAY(0x7f4bd9c57c08)', 'HASH(0x7f4bd9c51060)') called at /var/www/yabs-interface/export/yt_data.cgi line 73
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >  ModPerl::ROOT::ModPerl::Registry::var_www_yabs_2dinterface_export_yt_data_2ecgi::
phrase_dict('Yabs::YT::MultiClient=HASH(0x7f4bd950fe08)', 'ARRAY(0x7f4bd9c4dc98)') called at /var/www/yabs-interface/export/yt_data.cgi line 58
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >  ModPerl::ROOT::ModPerl::Registry::var_www_yabs_2dinterface_export_yt_data_2ecgi::
_run() called at /var/www/yabs-interface/export/yt_data.cgi line 32
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >  ModPerl::ROOT::ModPerl::Registry::var_www_yabs_2dinterface_export_yt_data_2ecgi::
handler('Apache2::RequestRec=SCALAR(0x7f4bd9c88e00)') called at /usr/lib/perl5/ModPerl/RegistryCooker.pm line 206
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >  eval {...} called at /usr/lib/perl5/ModPerl/RegistryCooker.pm line 206
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >  ModPerl::RegistryCooker::run('ModPerl::Registry=HASH(0x7f4bd9cb1a00)') called at
/usr/lib/perl5/ModPerl/RegistryCooker.pm line 172
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >  ModPerl::RegistryCooker::default_handler('ModPerl::Registry=HASH(0x7f4bd9cb1a00)'
) called at /usr/lib/perl5/ModPerl/Registry.pm line 31
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >  ModPerl::Registry::handler('ModPerl::Registry', 'Apache2::RequestRec=SCALAR(0x7f4
bd9c88e00)') called at -e line 0
2016/06/08 19:51:25 419951 ERROR [/usr/share/perl5/Yabs/YT/MultiClient.pm] [YT::MultiClient] >  eval {...} called at -e line 0



{"with_vat":1,"countable_fields_by_targettype":["Shows","Clicks","Cost"],"group_by":["PhraseID","mContextType","RegionID","mTypeID","bid","PageGroupID","mTargetType","mDeviceType"],"date_to":"20151224","order_ids":["2799310"],"limits":{"limit":"35000","offset":"0"},"with_discount":0,"group_by_date":"day","currency":"YND_FIXED","date_from":"20151211","filters_pre":{},"filters_post":{},"mapping":{"mTargetType":{"map":{"3":"3"},"by":"TargetType","data_type":"number","default":"0"},"mContextType":{"by":"ContextType","map":{"3":3,"5":3,"4":3,"6":3},"data_type":"number"},"mDeviceType":{"data_type":"string","default":"desktop","by":"DeviceType","map":{"3":"tablet","2":"mobile"}},"mTypeID":{"data_type":"number","default":"2","by":"TypeID","map":{"1":"1"}}},"without_totals":1,"lang":"ru","order_by":[{"dir":"asc","field":"PhraseID"},{"dir":"asc","field":"bid"},{"field":"UpdateTime","dir":"asc"},{"dir":"asc","field":"mTypeID"},{"field":"RegionID","dir":"asc"},{"dir":"asc","field":"PageSortName"},{"dir":"asc","field":"mDeviceType"},{"dir":"asc","field":"mContextType"},{"field":"Phrase","dir":"asc"},{"field":"PhraseID","dir":"asc"},{"dir":"asc","field":"RegionName"}]}

{"without_totals":1,"limits":{"offset":"0","limit":"35000"},"group_by_date":"day","date_from":"20160117","countable_fields_by_targettype":["Shows","Clicks","Cost"],"group_by":["PhraseID","mContextType","RegionID","PageGroupID","mTargetType","mDeviceType","mTypeID","bid"],"mapping":{"mDeviceType":{"default":"desktop","data_type":"string","map":{"3":"tablet","2":"mobile"},"by":"DeviceType"},"mContextType":{"map":{"4":3,"5":3,"3":3,"6":3},"by":"ContextType","data_type":"number"},"mTargetType":{"data_type":"number","default":"0","by":"TargetType","map":{"3":3}},"mTypeID":{"default":"2","data_type":"number","map":{"1":"1"},"by":"TypeID"}},"with_discount":0,"filters_post":{},"order_ids":["4269180"],"date_to":"20160130","order_by":[{"dir":"asc","field":"PhraseID"},{"field":"bid","dir":"asc"},{"field":"UpdateTime","dir":"asc"},{"field":"mTypeID","dir":"asc"},{"dir":"asc","field":"RegionID"},{"dir":"asc","field":"PageSortName"},{"dir":"asc","field":"mDeviceType"},{"dir":"asc","field":"mContextType"},{"dir":"asc","field":"Phrase"},{"dir":"asc","field":"PhraseID"},{"field":"RegionName","dir":"asc"}],"with_vat":1,"currency":"YND_FIXED","lang":"ru","filters_pre":{}}


  "header": [
    "PhraseID",
    "Phrase",
    "mContextType",
    "bid",
    "Shows",
    "Shows_search",
    "Shows_context",
    "Clicks",
    "Clicks_search",
    "Clicks_context",
    "ChildShows",
    "ParentShows",
    "Cost",
    "Cost_search",
    "Cost_context",
    "BonusNoVAT",
    "GoalsNum",
    "GoalsIncome",
    "SessionNum",
    "SessionNumLimited",
    "SessionDepth",
    "Bounces",
    "FirstPageShows",
    "FirstPageClicks",
    "FirstPageSumPosShows",
    "FirstPageSumPosClicks",
    "Ctr",
    "AvgClicksCost",
    "AvgShowsPosition",
    "AvgClicksPosition",
    "AvgSessionDepth",
    "BounceRatio",
    "ConversionPct",
    "AvgGoalsCost",
    "GoalsROI"
  ],

     [
       "518554155",
       "дарсонваль +для волос -видео -выбирать -инструкция -использовать -какой -отзыв -пользоваться -применение -противопоказание -фото -хорошо",
       1,
       205064904,
       "344",
       "344",
       "0",
       "34",
       "34",
       "0",
       "0",
       "344",
       385560500,
       385560500,
       0,
-      8518220.33898304,
+      8518220.33898305,
       "5",
       0,
       "74",
       "74",
       "109",
       "6",
       "286",
       "30",
       "638",
       "52",
       9.88372093023256,
       11340014.7058824,
       2.23076923076923,
       1.73333333333333,
       1.47297297297297,
       8.10810810810811,
       6.75675675675676,
       77112100,
       null
     ],


MR_USER=afraud mr_find -s sakura.search.yandex.net:8013 user_sessions/20160531/spy_log -S -f tml/input_uniqs


[pid=2983->5283]  DB<4> x $banid
0  1193403551
[pid=2983->5283]  DB<5> x $phid
0  863
[pid=2983->5283]  DB<6> x $ct
0  8

1193403551,863,8

/usr/share/yabs-autobudget2/manual-scripts/autobudget-change-process-count.pl --reshard --old-processes=6 --new-processes=24

select EventDate, sum(Shows), sum(Clicks), sum(Cost), sum(CostCur), sum(ShowsSumPosition), sum(ClicksSumPosition), sum(SessionNum), sum(SessionLen), sum(SessionCost), sum(GoalsNum), sum(SessionDepth), sum(Bounces),sum(arraySum(goal_id, attribution_type, value -> if(goal_id = 0 and attribution_type = 1, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id != 0 and attribution_type = 1, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id = 0 and attribution_type = 2, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id != 0 and attribution_type = 2, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id = 0 and attribution_type = 1, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.PriceCur)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id != 0 and attribution_type = 1, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.PriceCur)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id = 0 and attribution_type = 2, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.PriceCur)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id != 0 and attribution_type = 2, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.PriceCur)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id = 0 and attribution_type = 1, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.SessionNum)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id != 0 and attribution_type = 1, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.SessionNum)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id = 0 and attribution_type = 2, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.SessionNum)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id != 0 and attribution_type = 2, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.SessionNum)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id = 0 and attribution_type = 1, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.SessionLen)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id != 0 and attribution_type = 1, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.SessionLen)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id = 0 and attribution_type = 2, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.SessionLen)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id != 0 and attribution_type = 2, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.SessionLen)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id = 0 and attribution_type = 1, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.SessionCost)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id != 0 and attribution_type = 1, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.SessionCost)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id = 0 and attribution_type = 2, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.SessionCost)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id != 0 and attribution_type = 2, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.SessionCost)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id = 0 and attribution_type = 1, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.SessionDepth)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id != 0 and attribution_type = 1, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.SessionDepth)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id = 0 and attribution_type = 2, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.SessionDepth)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id != 0 and attribution_type = 2, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.SessionDepth)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id = 0 and attribution_type = 1, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Bounces)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id != 0 and attribution_type = 1, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Bounces)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id = 0 and attribution_type = 2, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Bounces)),sum(arraySum(goal_id, attribution_type, value -> if(goal_id != 0 and attribution_type = 2, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Bounces)) from OrderCounter where EventDate >= '2016-06-09' and EventDate <= '2016-06-09' group by Even



select EventDate, sum(Bounces),sum(arraySum(goal_id, attribution_type, value -> if(goal_id = 0 and attribution_type = 1, value, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Bounces)) from OrderCounter where EventDate >= '2016-06-09' and EventDate <= '2016-06-09' group by EventDate


7709994

bannerid = 813995209
phraseid = 844908570

http://bsgraphite.yandex.ru/render/?_salt=1452854699.152&width=588&height=311&target=one_hour.bsbackup02g_yandex_ru.mysql.db.yabsdb.tables.MetrikaDataXX.size

Евгений Гатов Юрий Галицкий ы


mysql> select ResultFlatCost/1e4, count(*) from PhrasePrice where orderid = 7709994 group by 1;
+--------------------+----------+
| ResultFlatCost/1e4 | count(*) |
+--------------------+----------+
|                8.2 |       17 |
|                8.6 |       85 |
|               11.4 |       17 |
|               12.3 |       17 |
|               13.8 |       17 |
|               16.2 |       17 |
|               18.2 |       17 |
|               21.5 |       17 |
|               27.3 |       17 |
|               29.7 |       17 |
|               36.4 |       17 |
|                 39 |       17 |
|               46.7 |       17 |
|               92.3 |       17 |
|               94.8 |       17 |
+--------------------+----------+
15 rows in set (0.00 sec)

2314435

P408212&P408222&P415630&P726941&P726942&P906021&P1046604:8395149;(P1096050|P1096048|P1096049|P1096047):8853773,8731341,8466427,8877561,8850183,8800238

select PhraseID,OrderID,GroupExportID from sakura.[dbrestore/bstat/yabsdb/PhrasePrice] as PhrasePrice left join sakura.[dbrestore/bstat/yabsdb/Banner] as Banner on Banner.OrderID = PhrasePrice.OrderID and Banner.GroupExportID = PhrasePrice.GroupExportID where Banner.OrderID is null;


clientid = 5337167

https://st.yandex-team.ru/BSINTERVIEW-30 решен
https://st.yandex-team.ru/BSINTERVIEW-28
https://st.yandex-team.ru/BSINTERVIEW-34
https://st.yandex-team.ru/BSINTERVIEW-67
https://st.yandex-team.ru/BSINTERVIEW-76
https://st.yandex-team.ru/BSINTERVIEW-78
https://st.yandex-team.ru/BSINTERVIEW-101
https://st.yandex-team.ru/BSINTERVIEW-105
https://st.yandex-team.ru/BSINTERVIEW-5
https://st.yandex-team.ru/BSINTERVIEW-7
https://st.yandex-team.ru/BSINTERVIEW-11


=====
2016/06/16 19:58:26 500896 INFO  [ load_forecast] Load PhrasePrice
2016/06/16 20:06:45 500896 INFO  [load_current_p] Restricting lazy phrases enabled

2016/06/16 20:07:11 500896 INFO  [ load_forecast] Loading CostsForecast
2016/06/16 20:18:42 500896 INFO  [load_costs_for] Phrase 57885550,9016374,1, cost_coef is negative: -4423.07692307692

2016/06/16 20:21:00 500896 INFO  [load_all_forec] Got models to use : simple, default: simple
2016/06/16 20:25:55 500896 INFO  [ load_forecast] Load AutoBudgetPriority
=====

====
2016/06/12 01:03:16 289480 INFO  [autobudget_mai] Started autobudget3 thread(previous start 20160611233500)

2016/06/12 01:03:24 289480 INFO  [ load_forecast] Load PhrasePrice
2016/06/12 01:06:07 289480 INFO  [load_current_p] Restricting lazy phrases enabled

2016/06/12 01:06:24 289480 INFO  [ load_forecast] Loading CostsForecast
2016/06/12 01:10:27 289480 INFO  [load_costs_for] Phrase 57885550,9016374,1, cost_coef is negative: -3739.51923076923

2016/06/12 01:12:29 289480 INFO  [load_all_forec] Got models to use : simple, default: simple
2016/06/12 01:15:01 289480 INFO  [ load_forecast] Load AutoBudgetPriority
====

====
olegts@bstat134f:/mnt/raid/home/olegts$ grep -E '280477'  autobudget.log.5|grep -E 'Load PhrasePrice' -A 1
2016/06/12 01:37:38 280477 INFO  [ load_forecast] Load PhrasePrice
2016/06/12 01:42:50 280477 INFO  [load_current_p] Restricting lazy phrases enabled
====

====
olegts@bstat134f:/mnt/raid/home/olegts$ grep -E '791651'  autobudget.log.5|grep -E 'Load PhrasePrice' -A 1
2016/06/12 02:18:12 791651 INFO  [ load_forecast] Load PhrasePrice
2016/06/12 02:24:25 791651 INFO  [load_current_p] Restricting lazy phrases enabled
====

====
2016/06/12 03:38:26 151403 INFO  [autobudget_mai] Started autobudget3 thread(previous start 20160612005500)
2016/06/12 04:07:25 151403 INFO  [calc_flat_prob] Order 9904275 nothing to spent in net

2016/06/12 03:38:33 151403 INFO  [ load_forecast] Load PhrasePrice
2016/06/12 03:45:31 151403 INFO  [load_current_p] Restricting lazy phrases enabled

2016/06/12 03:45:53 151403 INFO  [ load_forecast] Loading CostsForecast
2016/06/12 03:57:39 151403 INFO  [load_costs_for] Phrase 57885550,9016374,1, cost_coef is negative: -3739.51923076923

2016/06/12 03:59:58 151403 INFO  [load_all_forec] Got models to use : simple, default: simple
2016/06/12 04:05:07 151403 INFO  [ load_forecast] Load AutoBudgetPriority



orderid = 9838941

/var/lib/yabs-parasprite/yabs-bstat-collectors-clickhouse/ft/export-to-yt-from-clickhouse.yml
2016/06/21 13:10:11 25194 INFO  [process_overdr]        6133842 16.5
2016/06/21 13:10:11 25194 INFO  [process_overdr]        8469131 0.07
2016/06/21 13:10:11 25194 INFO  [process_overdr]        8041079 3.39
2016/06/21 13:10:11 25194 INFO  [process_overdr]        5456832 28.85


data_ttl:
	ExperimentStat

data_versions:
	StoreApplication

mysql> select bannerid from Banner31 where parentexportid = 1690319451;
+------------+
| bannerid   |
+------------+
| 1230307838 |
+------------+
1 row in set (0.01 sec)
mysql> select * from PhraseDict where Data = 'Садовая техника';
+----------------------+----------+------+-----------+-------------------------------+
| DataMD5              | PhraseID | Type | WordCount | Data                          |
+----------------------+----------+------+-----------+-------------------------------+
| 13978290763420671450 |    73678 |    0 |         2 | садовая техника               |
| 12157092020869173740 |   191466 |    0 |         2 | Садовая техника               |
+----------------------+----------+------+-----------+-------------------------------+
2 rows in set (14.21 sec)


bannerid = 1230307838
phraseid = 191466

phraseid = 10358
P24387&P24431&P545

mysql> select ContextID from OrderInfo where orderid = 7845145;
+-----------+
| ContextID |
+-----------+
| 538822392 |
+-----------+
1 row in set (0.01 sec)


mysql> select Expression from Context31 where ContextID = 538822392;
+--------------------+
| Expression         |
+--------------------+
| P24387&P24431&P545 |
+--------------------+
1 row in set (0.01 sec)

mysql> select * from Pattern where PatternID in (24387, 24431, 545);
+-----------+-----------+-------------+------+--------+
| PatternID | KeywordID | OperationID | Data | Weight |
+-----------+-----------+-------------+------+--------+
|       545 |        77 |           5 | 2    |      0 |
|     24387 |        77 |           5 | 0    |      0 |
|     24431 |        77 |           5 | 1    |      0 |
+-----------+-----------+-------------+------+--------+
3 rows in set (0.00 sec)

imysql> select * from Operation where OperationID = 5;
+-------------+-----------------+------+-------------+------+----------+
| OperationID | OperationPrefix | Data | Description | Name | MatchAll |
+-------------+-----------------+------+-------------+------+----------+
|           5 | 0+              | !=   | not equal   | ne   |        1 |
+-------------+-----------------+------+-------------+------+----------+
1 row in set (0.00 sec)

mysql> select * from KeywordType where KeywordId = 77;
+-----------+--------+---------+------------------+
| KeywordID | Type   | Options | Data             |
+-----------+--------+---------+------------------+
|        77 | query  |         | page-target-type |
|        77 | system |         | page-target-type |
+-----------+--------+---------+------------------+
2 rows in set (0.00 sec)



mysql> select * from ABOidGidPhrState where orderid = 9268131 order by AvgCPA;
+---------+---------------+----------+-------------+---------------------+--------+
| OrderID | GroupExportID | PhraseID | ContextType | UpdateTime          | AvgCPA |
+---------+---------------+----------+-------------+---------------------+--------+
| 9268131 |    1420396695 |    34820 |           8 | 2016-06-20 20:20:00 |      0 |
| 9268131 |    1420396695 |    34818 |           8 | 2016-06-20 20:20:00 |      0 |
| 9268131 |    1420396695 |    34814 |           8 | 2016-06-20 20:20:00 |      0 |
| 9268131 |    1420396695 |    34815 |           8 | 2016-06-20 20:20:00 |      0 |
| 9268131 |    1420396695 |    34817 |           8 | 2016-06-20 20:20:00 |      0 |
| 9268131 |    1420396695 |    34819 |           8 | 2016-06-20 20:20:00 |      1 |
| 9268131 |    1420396695 |    34816 |           8 | 2016-06-20 20:20:00 |      1 |
| 9268131 |    1420396695 |    34311 |           8 | 2016-06-20 20:20:00 |      1 |
| 9268131 |    1420396695 |    34310 |           8 | 2016-06-20 20:20:00 |      1 |
| 9268131 |    1420396695 |    33732 |           8 | 2016-06-20 20:20:00 |      1 |
+---------+---------------+----------+-------------+---------------------+--------+
10 rows in set (0.00 sec)


Бекап за 19 число

mysql> select BannerID,PhraseID,FlatCost/1e4 from PhrasePrice where OrderID = 9268131 and BannerID in (1704320861,1704320862,1704320863,1704320864,1704320865,1704320866,1704320867,1704320868,1704320869,1704320870,1704320871,1704320872,1704320873,1704320874,1704320875,1704320876,1704320877) and phraseid = 34311 ;
+------------+----------+--------------+
| BannerID   | PhraseID | FlatCost/1e4 |
+------------+----------+--------------+
| 1704320861 |    34311 |         20.5 |
| 1704320862 |    34311 |         20.5 |
| 1704320863 |    34311 |         20.5 |
| 1704320864 |    34311 |         20.5 |
| 1704320865 |    34311 |         20.5 |
| 1704320866 |    34311 |         20.5 |
| 1704320867 |    34311 |         20.5 |
| 1704320868 |    34311 |         20.5 |
| 1704320869 |    34311 |         20.5 |
| 1704320870 |    34311 |         20.5 |
| 1704320871 |    34311 |         20.5 |
| 1704320872 |    34311 |         20.5 |
| 1704320873 |    34311 |         20.5 |
| 1704320874 |    34311 |         20.5 |
| 1704320875 |    34311 |         20.5 |
| 1704320876 |    34311 |         20.5 |
| 1704320877 |    34311 |         20.5 |
+------------+----------+--------------+
17 rows in set (0.00 sec)


20160620
ql> select BannerID,PhraseID,FlatCost/1e4 from PhrasePrice where OrderID = 9268131 and BannerID in (1704320861,1704320862,1704320863,1704320864,1704320865,1704320866,1704320867,1704320868,1704320869,1704320870,1704320871,1704320872,1704320873,1704320874,1704320875,1704320876,1704320877) and phraseid = 34311 ;
+------------+----------+--------------+
| BannerID   | PhraseID | FlatCost/1e4 |
+------------+----------+--------------+
| 1704320861 |    34311 |         20.5 |
| 1704320862 |    34311 |         20.5 |
| 1704320863 |    34311 |         20.5 |
| 1704320864 |    34311 |         20.5 |
| 1704320865 |    34311 |         20.5 |
| 1704320866 |    34311 |         20.5 |
| 1704320867 |    34311 |         20.5 |
| 1704320868 |    34311 |         20.5 |
| 1704320869 |    34311 |         20.5 |
| 1704320870 |    34311 |         20.5 |
| 1704320871 |    34311 |         20.5 |
| 1704320872 |    34311 |         20.5 |
| 1704320873 |    34311 |         20.5 |
| 1704320874 |    34311 |         20.5 |
| 1704320875 |    34311 |         20.5 |
| 1704320876 |    34311 |         20.5 |
| 1704320877 |    34311 |         20.5 |
+------------+----------+---


бекап 21

1704320866,1704320867,1704320868,1704320869,1704320870,1704320871,1704320872,1704320873,1704320874,1704320875,1704320876,1704320877) and phraseid = 34311;
+------------+----------+--------------+
| BannerID   | PhraseID | FlatCost/1e4 |
+------------+----------+--------------+
| 1704320861 |    34311 |        284.2 |
| 1704320862 |    34311 |        284.2 |
| 1704320863 |    34311 |        284.2 |
| 1704320864 |    34311 |        284.2 |
| 1704320865 |    34311 |        284.2 |
| 1704320866 |    34311 |        284.2 |
| 1704320867 |    34311 |        284.2 |
| 1704320868 |    34311 |        284.2 |
| 1704320869 |    34311 |        284.2 |
| 1704320870 |    34311 |        284.2 |
| 1704320871 |    34311 |        284.2 |
| 1704320872 |    34311 |        284.2 |
| 1704320873 |    34311 |        284.2 |
| 1704320874 |    34311 |        284.2 |
| 1704320875 |    34311 |        284.2 |
| 1704320876 |    34311 |        284.2 |
| 1704320877 |    34311 |        284.2 |
+------------+----------+--------------+
17 rows in set (0.00 sec)


Текущие данные

mysql> select BannerID,PhraseID,FlatCost/1e4 from PhrasePrice where OrderID = 9268131 and BannerID in (1704320861,1704320862,1704320863,1704320864,1704320865,1704320866,1704320867,1704320868,1704320869,1704320870,1704320871,1704320872,1704320873,1704320874,1704320875,1704320876,1704320877) and phraseid = 34311 ;   +------------+----------+--------------+
| BannerID   | PhraseID | FlatCost/1e4 |
+------------+----------+--------------+
| 1704320861 |    34311 |        271.5 |
| 1704320862 |    34311 |        271.5 |
| 1704320863 |    34311 |        271.5 |
| 1704320864 |    34311 |        271.5 |
| 1704320865 |    34311 |        271.5 |
| 1704320866 |    34311 |        271.5 |
| 1704320867 |    34311 |        271.5 |
| 1704320868 |    34311 |        271.5 |
| 1704320869 |    34311 |        271.5 |
| 1704320870 |    34311 |        271.5 |
| 1704320871 |    34311 |        271.5 |
| 1704320872 |    34311 |        271.5 |
| 1704320873 |    34311 |        271.5 |
| 1704320874 |    34311 |        271.5 |
| 1704320875 |    34311 |        271.5 |
| 1704320876 |    34311 |        271.5 |
| 1704320877 |    34311 |        271.5 |
+------------+----------+--------------+
17 rows in set (0.00 sec)


mysql> select * from ABGroupExportPhraseStatDay where groupexportid = 1420396695 and phraseid = 34311 and updatetime = '2016-06-21 00:00:00';
+---------+---------------+----------+-------------+------------+---------------------+--------+--------+-----------+-----------+---------+
| OrderID | GroupExportID | PhraseID | ContextType | Experiment | UpdateTime          | Shows  | Clicks | Cost      | CostCur   | Actions |
+---------+---------------+----------+-------------+------------+---------------------+--------+--------+-----------+-----------+---------+
| 9268131 |    1420396695 |    34311 |           8 |          0 | 2016-06-21 00:00:00 | 512073 |    374 | 712550866 | 213765260 |       9 |
+---------+---------------+----------+-------------+------------+---------------------+--------+--------+-----------+-----------+---------+
1 row in set (0.50 sec)


mysql> select * from ABGroupExportPhraseStatDay where groupexportid = 1420396695 and phraseid = 34311;
+---------+---------------+----------+-------------+------------+---------------------+--------+--------+-----------+-----------+---------+
| OrderID | GroupExportID | PhraseID | ContextType | Experiment | UpdateTime          | Shows  | Clicks | Cost      | CostCur   | Actions |
+---------+---------------+----------+-------------+------------+---------------------+--------+--------+-----------+-----------+---------+
| 9268131 |    1420396695 |    34311 |           8 |          0 | 2016-06-14 00:00:00 |  96257 |     51 |  26687668 |   8006300 |       2 |
| 9268131 |    1420396695 |    34311 |           8 |          0 | 2016-06-15 00:00:00 |  95475 |    109 |  62142731 |  18642820 |       1 |
| 9268131 |    1420396695 |    34311 |           8 |          0 | 2016-06-16 00:00:00 | 229440 |    170 | 138142593 |  41442780 |       3 |
| 9268131 |    1420396695 |    34311 |           8 |          0 | 2016-06-17 00:00:00 | 382564 |    220 | 205823469 |  61747040 |       5 |
| 9268131 |    1420396695 |    34311 |           8 |          0 | 2016-06-18 00:00:00 | 195172 |    118 |  86804732 |  26041420 |       3 |
| 9268131 |    1420396695 |    34311 |           8 |          0 | 2016-06-19 00:00:00 | 172023 |     78 |  54118732 |  16235620 |       0 |
| 9268131 |    1420396695 |    34311 |           8 |          0 | 2016-06-20 00:00:00 | 497036 |    277 | 337275468 | 101182640 |       1 |
| 9268131 |    1420396695 |    34311 |           8 |          0 | 2016-06-21 00:00:00 | 512073 |    374 | 712550866 | 213765260 |       9 |
+---------+---------------+----------+-------------+------------+---------------------+--------+--------+-----------+-----------+---------+
8 rows in set (0.31 sec)


mysql> select * from ABOidGidPhrState  where groupexportid = 1420396695 and phraseid = 34311 ;
+---------+---------------+----------+-------------+---------------------+--------+
| OrderID | GroupExportID | PhraseID | ContextType | UpdateTime          | AvgCPA |
+---------+---------------+----------+-------------+---------------------+--------+
| 9268131 |    1420396695 |    34311 |           8 | 2016-06-20 20:20:00 |      1 |
+---------+---------------+----------+-------------+---------------------+--------+
1 row in set (0.00 sec)

mysql> select BannerID,PhraseID,FlatCost/1e4 from PhrasePrice where OrderID = 9268131 and BannerID in (1704320861,1704320862,1704320863,1704320864,1704320865,1704320866,1704320867,1704320868,1704320869,1704320870,1704320871,1704320872,1704320873,1704320874,1704320875,1704320876,1704320877) and phraseid = 34311;
+------------+----------+--------------+
| BannerID   | PhraseID | FlatCost/1e4 |
+------------+----------+--------------+
| 1704320861 |    34311 |        284.2 |
| 1704320862 |    34311 |        284.2 |
| 1704320863 |    34311 |        284.2 |
| 1704320864 |    34311 |        284.2 |
| 1704320865 |    34311 |        284.2 |
| 1704320866 |    34311 |        284.2 |
| 1704320867 |    34311 |        284.2 |
| 1704320868 |    34311 |        284.2 |
| 1704320869 |    34311 |        284.2 |
| 1704320870 |    34311 |        284.2 |
| 1704320871 |    34311 |        284.2 |
| 1704320872 |    34311 |        284.2 |
| 1704320873 |    34311 |        284.2 |
| 1704320874 |    34311 |        284.2 |
| 1704320875 |    34311 |        284.2 |
| 1704320876 |    34311 |        284.2 |
| 1704320877 |    34311 |        284.2 |
+------------+----------+--------------+
17 rows in set (0.00 sec)

clicks = x
cost = 10 * x
actions = x / 500

CPA = 5000
CPA = 500


cpa = 500 -> cpc = cpa * actions_per_clicks = 500 * 0.003949158823529409 = 1


mysql> select *,Actions/Clicks from ABGroupExportPhraseStatDay where orderid=  9268131 and PhraseID = 34311;
+---------+---------------+----------+-------------+------------+---------------------+--------+--------+-----------+-----------+---------+----------------+
| OrderID | GroupExportID | PhraseID | ContextType | Experiment | UpdateTime          | Shows  | Clicks | Cost      | CostCur   | Actions | Actions/Clicks |
+---------+---------------+----------+-------------+------------+---------------------+--------+--------+-----------+-----------+---------+----------------+
| 9268131 |    1420396695 |    34311 |           8 |          0 | 2016-06-14 00:00:00 |  96257 |     51 |  26687668 |   8006300 |       2 |         0.0392 |
| 9268131 |    1420396695 |    34311 |           8 |          0 | 2016-06-15 00:00:00 |  95475 |    109 |  62142731 |  18642820 |       1 |         0.0092 |
| 9268131 |    1420396695 |    34311 |           8 |          0 | 2016-06-16 00:00:00 | 229440 |    170 | 138142593 |  41442780 |       3 |         0.0176 |
| 9268131 |    1420396695 |    34311 |           8 |          0 | 2016-06-17 00:00:00 | 382564 |    220 | 205823469 |  61747040 |       5 |         0.0227 |
| 9268131 |    1420396695 |    34311 |           8 |          0 | 2016-06-18 00:00:00 | 195172 |    118 |  86804732 |  26041420 |       3 |         0.0254 |
| 9268131 |    1420396695 |    34311 |           8 |          0 | 2016-06-19 00:00:00 | 172023 |     78 |  54118732 |  16235620 |       0 |         0.0000 |
| 9268131 |    1420396695 |    34311 |           8 |          0 | 2016-06-20 00:00:00 | 497036 |    277 | 337275468 | 101182640 |       1 |         0.0036 |
| 9268131 |    1420396695 |    34311 |           8 |          0 | 2016-06-21 00:00:00 | 512073 |    374 | 712550866 | 213765260 |      10 |         0.0267 |
+---------+---------------+----------+-------------+------------+---------------------+--------+--------+-----------+-----------+---------+----------------+
8 rows in set (0.00 sec)


mysql> select UpdateTime,Actions/Clicks from ABGroupExportPhraseStatDay where orderid=  9268131 and PhraseID = 34311;
+---------------------+----------------+
| UpdateTime          | Actions/Clicks |
+---------------------+----------------+
| 2016-06-14 00:00:00 |         0.0392 |
| 2016-06-15 00:00:00 |         0.0092 |
| 2016-06-16 00:00:00 |         0.0176 |
| 2016-06-17 00:00:00 |         0.0227 |
| 2016-06-18 00:00:00 |         0.0254 |
| 2016-06-19 00:00:00 |         0.0000 |
| 2016-06-20 00:00:00 |         0.0036 |
| 2016-06-21 00:00:00 |         0.0267 |
+---------------------+----------------+
8 rows in set (0.01 sec)



mysql> select OrderID,BannerID,PhraseID,avg(APC1/1e6), avg(APC2/1e6) from ABVWForecasterAPC where OrderID = 9268131 and BannerID in (1704320861,1704320862,1704320863,1704320864,1704320865,1704320866,1704320867,1704320868,1704320869,1704320870,1704320871,1704320872,1704320873,1704320874,1704320875,1704320876,1704320877) and phraseid = 34311;
+---------+------------+----------+----------------------+----------------------+
| OrderID | BannerID   | PhraseID | avg(APC1/1e6)        | avg(APC2/1e6)        |
+---------+------------+----------+----------------------+----------------------+
| 9268131 | 1704320861 |    34311 | 0.004293529411764706 | 0.004388117647058824 |
+---------+------------+----------+----------------------+----------------------+
1 row in set (0.01 sec)


mysql> select FlatCost/1e4, GroupExportID, PhraseID, count(*) from PhrasePrice_20160620 where OrderID = 9268131 and !find_in_set("deleted",Options) group by 1,2,3;
+--------------+---------------+----------+----------+
| FlatCost/1e4 | GroupExportID | PhraseID | count(*) |
+--------------+---------------+----------+----------+
|         20.5 |    1420396695 |    34310 |       17 |
|         20.5 |    1420396695 |    34311 |       17 |
|         20.5 |    1420396695 |    34817 |       17 |
|         20.5 |    1420396695 |    34818 |       17 |
|         20.8 |    1420396695 |    34819 |       17 |
|         21.1 |    1420396695 |    33732 |       17 |
|         25.6 |    1420396695 |    34814 |       17 |
|         25.6 |    1420396695 |    34815 |       17 |
|         25.6 |    1420396695 |    34816 |       17 |
|         25.6 |    1420396695 |    34820 |       17 |
+--------------+---------------+----------+----------+
10 rows in set (0.00 sec)

mysql> select FlatCost/1e4, GroupExportID, PhraseID, count(*) from PhrasePrice_20160621 where OrderID = 9268131 and !find_in_set("deleted",Options) group by 1,2,3;
+--------------+---------------+----------+----------+
| FlatCost/1e4 | GroupExportID | PhraseID | count(*) |
+--------------+---------------+----------+----------+
|         12.9 |    1420396695 |    34814 |       17 |
|         12.9 |    1420396695 |    34818 |       17 |
|         12.9 |    1420396695 |    34820 |       17 |
|         13.2 |    1420396695 |    34817 |       17 |
|         13.9 |    1420396695 |    34815 |       17 |
|        255.2 |    1420396695 |    33732 |       17 |
|        263.8 |    1420396695 |    34819 |       17 |
|        277.6 |    1420396695 |    34310 |       17 |
|        277.8 |    1420396695 |    34816 |       17 |
|        284.2 |    1420396695 |    34311 |       17 |
+--------------+---------------+----------+----------+
10 rows in set (0.00 sec)

mysql>  select GroupExportID,PhraseID,AvgCPA from ABOidGidPhrState where OrderID = 9268131 order by AvgCPA;
+---------------+----------+--------+
| GroupExportID | PhraseID | AvgCPA |
+---------------+----------+--------+
|    1420396695 |    34820 |      0 |
|    1420396695 |    34818 |      0 |
|    1420396695 |    34814 |      0 |
|    1420396695 |    34815 |      0 |
|    1420396695 |    34817 |      0 |
|    1420396695 |    34819 |      1 |
|    1420396695 |    34816 |      1 |
|    1420396695 |    34311 |      1 |
|    1420396695 |    34310 |      1 |
|    1420396695 |    33732 |      1 |
+---------------+----------+--------+
10 rows in set (0.01 sec)


mysql> select GroupExportID, PhraseID, sum(Actions)/sum(Clicks) from ABGroupExportPhraseStatDay where OrderID = 9268131 group by 1,2;
+---------------+----------+--------------------------+
| GroupExportID | PhraseID | sum(Actions)/sum(Clicks) |
+---------------+----------+--------------------------+
|    1420396695 |    33732 |                   0.0112 |
|    1420396695 |    34310 |                   0.0077 |
|    1420396695 |    34311 |                   0.0179 |
|    1420396695 |    34814 |                   0.0112 |
|    1420396695 |    34815 |                   0.0171 |
|    1420396695 |    34816 |                   0.0160 |
|    1420396695 |    34817 |                   0.0141 |
|    1420396695 |    34818 |                   0.0000 |
|    1420396695 |    34819 |                   0.0046 |
|    1420396695 |    34820 |                   0.0088 |
+---------------+----------+--------------------------+
10 rows in set (0.01 sec)

mysql> select GroupExportID,PhraseID,avg(APC1/1e6), avg(APC2/1e6) from ABVWForecasterAPC inner join Banner40 using(BannerID) where ABVWForecasterAPC.OrderID = 9268131  group by 1,2;
+---------------+----------+-----------------------+-----------------------+
| GroupExportID | PhraseID | avg(APC1/1e6)         | avg(APC2/1e6)         |
+---------------+----------+-----------------------+-----------------------+
|    1420396695 |    33732 | 0.0031527647058823536 | 0.0032222352941176473 |
|    1420396695 |    34310 |  0.004074588235294118 |  0.004164352941176471 |
|    1420396695 |    34311 |  0.004293529411764706 |  0.004388117647058824 |
|    1420396695 |    34814 |  0.004555294117647058 |  0.004655470588235294 |
|    1420396695 |    34815 |  0.004442588235294118 |  0.004540411764705883 |
|    1420396695 |    34816 |  0.003485294117647059 | 0.0035619411764705885 |
|    1420396695 |    34817 | 0.0038214705882352947 |  0.003905764705882353 |
|    1420396695 |    34818 |  0.004127117647058824 |  0.004217941176470588 |
|    1420396695 |    34819 | 0.0031440588235294117 | 0.0032134117647058817 |
|    1420396695 |    34820 |  0.004394882352941176 | 0.0044914117647058835 |
+---------------+----------+-----------------------+-----------------------+
10 rows in set (0.01 sec)



rtPhraseStatDay where orderid=  9268131 group by 1;
+---------------------+--------------+-------------+---------------+---------------------------+----------------------------+--------------------------+
| UpdateTime          | sum(Actions) | sum(Clicks) | sum(Cost)/1e6 | sum(Cost)/1e6/sum(Clicks) | sum(Cost)/1e6/sum(Actions) | sum(Actions)/sum(Clicks) |
+---------------------+--------------+-------------+---------------+---------------------------+----------------------------+--------------------------+
| 2016-06-14 00:00:00 |           22 |        2360 |   1573.691253 |        0.6668183275423729 |           71.5314205909091 |                   0.0093 |
| 2016-06-15 00:00:00 |           36 |        4064 |   3842.197996 |        0.9454227352362204 |          106.7277221111111 |                   0.0089 |
| 2016-06-16 00:00:00 |           24 |        1259 |    872.665052 |        0.6931414233518666 |          36.36104383333333 |                   0.0191 |
| 2016-06-17 00:00:00 |           44 |        5008 |   4703.629465 |        0.9392231359824281 |         106.90066965909091 |                   0.0088 |
| 2016-06-18 00:00:00 |           27 |        2307 |   1615.282307 |        0.7001657160814911 |          59.82527062962963 |                   0.0117 |
| 2016-06-19 00:00:00 |           22 |        3317 |   2705.657384 |         0.815694116370214 |         122.98442654545455 |                   0.0066 |
| 2016-06-20 00:00:00 |           38 |        7975 |   9173.548164 |        1.1502881710344828 |         241.40916221052632 |                   0.0048 |
| 2016-06-21 00:00:00 |          133 |        7385 |    14203.2391 |        1.9232551252538932 |         106.79127142857143 |                   0.0180 |
+---------------------+--------------+-------------+---------------+---------------------------+----------------------------+--------------------------+
8 rows in set (0.01 sec)


mysql> select UpdateTime,sum(Actions),sum(Clicks),sum(Cost*30)/1e6 as SumCost,sum(Cost*30)/1e6/sum(Clicks) as CPC,sum(Cost*30)/1e6/sum(Actions)as CPA,sum(Actions)/sum(Clicks) as APC from ABGroupExportPhraseStatDay where orderid=  9268131 group by 1;
+---------------------+--------------+-------------+--------------+--------------------+--------------------+--------+
| UpdateTime          | sum(Actions) | sum(Clicks) | SumCost      | CPC                | CPA                | APC    |
+---------------------+--------------+-------------+--------------+--------------------+--------------------+--------+
| 2016-06-14 00:00:00 |           22 |        2360 |  47210.73759 | 20.004549826271184 | 2145.9426177272726 | 0.0093 |
| 2016-06-15 00:00:00 |           36 |        4064 | 115265.93988 | 28.362682057086616 | 3201.8316633333334 | 0.0089 |
| 2016-06-16 00:00:00 |           24 |        1259 |  26179.95156 | 20.794242700555998 | 1090.8313150000001 | 0.0191 |
| 2016-06-17 00:00:00 |           44 |        5008 | 141108.88395 | 28.176694079472842 |  3207.020089772727 | 0.0088 |
| 2016-06-18 00:00:00 |           27 |        2307 |  48458.46921 | 21.004971482444734 |  1794.758118888889 | 0.0117 |
| 2016-06-19 00:00:00 |           22 |        3317 |  81169.72152 | 24.470823491106422 |  3689.532796363637 | 0.0066 |
| 2016-06-20 00:00:00 |           38 |        7975 | 275206.44492 |  34.50864513103448 |  7242.274866315789 | 0.0048 |
| 2016-06-21 00:00:00 |          133 |        7385 |   426097.173 |  57.69765375761679 |  3203.738142857143 | 0.0180 |
+---------------------+--------------+-------------+--------------+--------------------+--------------------+--------+
8 rows in set (0.00 sec)

apc = 0.006759470588235294


0  '1704320862,34820,8'
[pid=19681->21241]  DB<22> x $max_click_cost*30/1e6
0  338.1

[pid=567->1126]  DB<6> x ((sqrt(max($banner_phrase_avg_click_cost ** 2 + 4 * $cost_by_cl2 * $p_ph_eir, 0)) + $banner_phrase_avg_click_cost ) / 2)
0  44314971.9683747
[pid=567->1126]  DB<7> x $banner_phrase_avg_click_cost
0  253349.9974665

[pid=567->1126]  DB<15> x $cost_by_cl2
0  10658014778.9388
[pid=567->1126]  DB<16> x $p_ph_eir
0  183203.868921295
[pid=567->1126]  DB<17>

[pid=567->1126]  DB<18> x $pr_stat->{cost}
0  567.394476393042
[pid=567->1126]  DB<19> x $pr_stat->{cost}  * 30 /1e6
0  0.0170218342917913
[pid=567->1126]  DB<20> x $pr_stat->{clicks}
0  0.000230730173551253
[pid=567->1126]  DB<22> x $p_ph_eir
0  183203.868921295
[pid=567->1126]  DB<23> x $ph_eir
0  183203.868921295
[pid=567->1126]  DB<26> x $ph_hash->{'eir'}
0  183203.868921295

rare_phrase = 1, $orderstat->[$O_PREV_WEEK_OVERDRAFT] = 0

Причины: max_cost большой и срабатывает rare phrase

===================================================

mysql> select FlatCost/1e4, count(*) from PhrasePrice where orderid =7709994  group by 1;
+--------------+----------+
| FlatCost/1e4 | count(*) |
+--------------+----------+
|          6.6 |       17 |
|          8.2 |       17 |
|          8.3 |       17 |
|          9.3 |       17 |
|          9.5 |       17 |
|          9.7 |       17 |
|         10.2 |       34 |
|         10.3 |       17 |
|         10.5 |       17 |
|         11.1 |       34 |
|         11.2 |       17 |
|         11.4 |       17 |
|         11.7 |       17 |
|         11.9 |       17 |
|         12.4 |       34 |
|         12.9 |       17 |
+--------------+----------+
16 rows in set (0.00 sec)

2016/06/21 03:12:20 3542  INFO  [calc_flat_bids] eis = 644439.361126633
2016/06/21 03:10:25 31573 INFO  [calc_flat_bids] eis = 644439.361126633


mysql> select bannerid,phraseid from PhrasePrice where orderid = 9268131 and ResultFlatCost/1e4=263.6;
+------------+----------+
| bannerid   | phraseid |
+------------+----------+
| 1704320861 |    34816 |
| 1704320862 |    34816 |
| 1704320863 |    34816 |
| 1704320864 |    34816 |
| 1704320865 |    34816 |
| 1704320866 |    34816 |
| 1704320867 |    34816 |
| 1704320868 |    34816 |
| 1704320869 |    34816 |
| 1704320870 |    34816 |
| 1704320871 |    34816 |
| 1704320872 |    34816 |
| 1704320873 |    34816 |
| 1704320874 |    34816 |
| 1704320875 |    34816 |
| 1704320876 |    34816 |
| 1704320877 |    34816 |
+------------+----------+
17 rows in set (0.01 sec)

1 BASENO=40
  2 DATE=20160621

  1 #base-local 0
  2 @base-map bstat* local
  3 @base-map bsdb* local
  4 host bstat40h
  5 collect-stat-skip-logs-deletion 1
  6 #host bstatloadx2i
  7 @script-control autobudget
  8 @script-control check-day-money-limit-overdraft
  9 autobudget-dont-skip-launching 1
 10 d-lock-config 1
 11 baseno 40
 12 autobudget-process-count-limit 1
 13 autobudget-process-count 1
 14 hostoption-autobudget-process-count 1
 15 autobudget-no-fake 1
 16 hostoption-autobudget-use-full-eir-in-avgcost-strategy 1
 17 hostoption-autobudget-original-cost-instead-of-real-cost 1
 18 hostoption-check-tabledef 1
 19 hostoption-autobudget-control-flat-probability-of-non-reg-spent-orders 1
 20 redefine-generation-start-time 1
 21 hostoption-autobudget-showscorr-buffer-before-unifying-banners-in-group 1
 22 autobudget-cache-pattern-time-tar 1
 23 #hostoption-autobudget-calc-flat-using-hulls 1
 24 #hostoption-autobudget-flat-hull-extrapolation-enabled 1
 25 autobudget-cache-functions 1
 26 #hostoption-autobudget-use-max-cost-sigma 1
 27 #hostoption-autobudget-flat-hulls-number-interpolate-points 1
 28 #shuffle-banners-from-group 1
 29 #autobudget-test-dump 1
 30 hostoption-autobudget-restrict-lazy-hits-group-phrases 1
 31 hostoption-autobudget-lazy-phrases-load-portion 0.1
 32 hostoption-autobudget-auction-banner-phrase-overdrafts 1

2016/06/21 01:11:24


===============================


ql> select baseno,exportid from OrderInfo where orderid = 9260512;
+--------+----------+
| baseno | exportid |
+--------+----------+
|    102 | 18695309 |
+--------+----------+


mysql> select AvgCost/1e6*30/1.18, count(*) from PhrasePrice_20160621  where orderid = 9260512 and !find_in_set("deleted", Options) group by 1;
+---------------------+----------+
| AvgCost/1e6*30/1.18 | count(*) |
+---------------------+----------+
|  3.0508474576271185 |      136 |
|  3.8135593220338984 |      136 |
|   5.084745762711865 |      136 |
+---------------------+----------+
3 rows in set (0.01 sec)

mysql> select AvgCost/1e6*30/1.18, count(*) from PhrasePrice_20160622  where orderid = 9260512 and !find_in_set("deleted", Options) group by 1;
+---------------------+----------+
| AvgCost/1e6*30/1.18 | count(*) |
+---------------------+----------+
|  3.0508474576271185 |      136 |
|  3.8135593220338984 |      136 |
|   5.084745762711865 |      136 |
+---------------------+----------+
3 rows in set (0.00 sec)

mysql> select AvgCost/1e4, count(*) from PhrasePrice_20160623  where orderid = 9260512 and !find_in_set("deleted", Options) group by 1;
+-------------+----------+
| AvgCost/1e4 | count(*) |
+-------------+----------+
|        3.05 |      136 |
|        3.81 |      136 |
|        5.08 |      136 |
+-------------+----------+
3 rows in set (0.01 sec)

mysql> select ResultFlatCost/1e6*30, count(*) from PhrasePrice_20160621  where orderid = 9260512 and !find_in_set("deleted", Options) group by 1;
+-----------------------+----------+
| ResultFlatCost/1e6*30 | count(*) |
+-----------------------+----------+
|                   4.2 |      136 |
|    5.1000000000000005 |      136 |
|                   6.6 |       17 |
|                   6.9 |      119 |
+-----------------------+----------+
4 rows in set (0.00 sec)


mysql> select ResultFlatCost/1e6*30, count(*) from PhrasePrice_20160622  where orderid = 9260512 and !find_in_set("deleted", Options) group by 1;
+-----------------------+----------+
| ResultFlatCost/1e6*30 | count(*) |
+-----------------------+----------+
|    3.5999999999999996 |       17 |
|                   4.2 |       17 |
|    5.1000000000000005 |      102 |
|                   6.3 |      153 |
|                   6.6 |       17 |
|     7.199999999999999 |       85 |
|                   8.4 |       17 |
+-----------------------+----------+
7 rows in set (0.00 sec)

mysql> select bannerid,groupexportid,orderid from Banner102 where parentexportid= 2360289879;
+------------+---------------+---------+
| bannerid   | groupexportid | orderid |
+------------+---------------+---------+
| 1874173356 |    1634906919 | 9260512 |
+------------+---------------+---------+
1 row in set (0.01 sec)




mysql> select ResultFlatCost/1e4, count(*) from PhrasePrice_20160623  where orderid = 9260512 and !find_in_set("deleted", Options) group by 1;
+--------------------+----------+
| ResultFlatCost/1e4 | count(*) |
+--------------------+----------+
|                0.7 |       17 |
|                1.1 |       17 |
|                1.2 |       17 |
|                1.5 |       34 |
|                1.6 |       17 |
|                1.8 |       17 |
|                2.5 |       17 |
|                2.7 |       34 |
|                3.1 |       17 |
|                3.2 |       17 |
|                3.3 |      187 |
|                3.6 |       17 |
+--------------------+----------+
12 rows in set (0.00 sec)


mysql> select Options, count(*) from PhrasePrice_20160622  where orderid = 9260512 and !find_in_set("deleted", Options) and bannerid = 1874173356 group by 1;
+-----------------------------------+----------+
| Options                           | count(*) |
+-----------------------------------+----------+
| autobroker,only-offer-retargeting |        1 |
+-----------------------------------+----------+
1 row in set (0.00 sec)

mysql> select Options, count(*) from PhrasePrice_20160621  where orderid = 9260512 and !find_in_set("deleted", Options) and bannerid = 1874173356 group by 1;
+-----------------------------------+----------+
| Options                           | count(*) |
+-----------------------------------+----------+
| autobroker,only-offer-retargeting |        1 |
+-----------------------------------+----------+
1 row in set (0.00 sec)

mysql> select Options, count(*) from PhrasePrice_20160623  where orderid = 9260512 and !find_in_set("deleted", Options) and bannerid = 1874173356 group by 1;
+--------------------------------------------+----------+
| Options                                    | count(*) |
+--------------------------------------------+----------+
| autobroker,currency,only-offer-retargeting |        1 |
+--------------------------------------------+----------+
1 row in set (0.00 sec)


| 2016-06-22 12:00:00                         |          5.982521186440677 |                  0 |           5.561440677966102 |                      0 |
| 2016-06-22 13:00:00                         |          6.610169491525423 |                  0 |           5.419876733436056 |                      0 |
| 2016-06-22 14:00:00                         |          6.444915254237289 |                  0 |           5.440677966101694 |                      0 |
| 2016-06-22 15:00:00                         |          5.084745762711865 |                  0 |          5.3107344632768365 |                      0 |
| 2016-06-22 16:00:00                         |          4.992295839753468 |                  0 |           6.841294298921418 |                      0 |
| 2016-06-22 17:00:00                         |           4.78813559322034 |                  0 |           6.355932203389831 |                      0 |
| 2016-06-22 18:00:00                         |                          5 |                  0 |          6.4406779661016955 |                      0 |
| 2016-06-22 19:00:00                         |          17.70127118644068 |                  0 |          24.798728813559332 |     24.612499999999994 |
| 2016-06-22 20:00:00                         |         19.607172956269313 |                  0 |          25.111901863470365 |     25.113812154696124 |
| 2016-06-22 21:00:00                         |         19.567689337052137 |                  0 |           24.73503540012875 |      24.85864978902953 |
| 2016-06-22 22:00:00                         |           18.1650700073692 |                  0 |          24.075165806927064 |     24.226570048309185 |
| 2016-06-22 23:00:00                         |         17.668549905838034 |                  0 |          20.636534839924682 |      20.73851851851852 |
| 2016-06-23 00:00:00                         |         16.233333333333334 |  19.15533333333333 |          20.051115254237285 |      20.05111111111111 |
| 2016-06-23 01:00:00                         |         12.879996610169494 | 15.198399999999998 |          23.260006779661015 |                  23.26 |
| 2016-06-23 06:00:00                         |          6.766669491525423 |  7.984666666666667 |           5.200008474576271 |                    5.2 |
| 2016-06-23 07:00:00                         |          5.766669491525423 |  6.804666666666667 |           5.583330508474577 |      5.583333333333333 |
| 2016-06-23 08:00:00                         |          6.217646560319044 |  7.336823529411764 |           5.817643070787638 |      5.817647058823528 |
| 2016-06-23 09:00:00                         |          6.672221751412429 |   7.87322222222222 |           5.761117231638418 |      5.761111111111109 |
| 2016-06-23 10:00:00                         |          6.816665254237288 |  8.043666666666667 |           5.799998587570623 |                    5.8 |
| 2016-06-23 11:00:00                         |          5.533332627118644 |  6.529333333333333 |                       5.425 |                  5.425 |
+---------------------------------------------+----------------------------+--------------------+-----------------------------+------------------------+
55 rows in set (0.00 sec)


Раньше срока появилась опция Currency во PhrasePrice&


ql> select OrderID,baseno from OrderInfo where orderid in (9723046,6632078,5204747,5978510,7312805) ;
+---------+--------+
| OrderID | baseno |
+-------Gu--+--------+
| 5204747 |     19 |
| 5978510 |     76 |
| 6632078 |     14 |
| 7312805 |    116 |
| 9723046 |      7 |
+---------+--------+
5 rows in set (0.00 sec)

mysql> select * from ABRestartHistory where OrderID = 5204747;
+---------+---------------------+---------+
| OrderID | StartTime           | Reasons |
+---------+---------------------+---------+
| 5204747 | 2016-04-29 12:14:54 |       1 |
| 5204747 | 2016-04-29 13:09:25 |       1 |
| 5204747 | 2016-04-29 13:32:58 |       1 |
| 5204747 | 2016-05-07 10:42:44 |       1 |
| 5204747 | 2016-05-08 23:49:50 |       1 |
| 5204747 | 2016-05-16 09:33:14 |       1 |
| 5204747 | 2016-05-16 17:06:33 |     128 |
| 5204747 | 2016-05-17 17:03:57 |     128 |
| 5204747 | 2016-05-21 00:58:43 |     128 |
| 5204747 | 2016-06-01 18:55:31 |       1 |
+---------+---------------------+---------+
10 rows in set (0.01 sec)

mysql> select * from ABRestartHistory where OrderID = 5978510;
+---------+---------------------+---------+
| OrderID | StartTime           | Reasons |
+---------+---------------------+---------+
| 5978510 | 2016-05-01 21:35:44 |     128 |
| 5978510 | 2016-05-12 18:52:10 |     128 |
| 5978510 | 2016-06-21 18:53:15 |     192 |
+---------+---------------------+---------+
3 rows in set (0.01 sec)

mysql> select * from ABRestartHistory where OrderID = 6632078;
+---------+---------------------+---------+
| OrderID | StartTime           | Reasons |
+---------+---------------------+---------+
| 6632078 | 2016-04-29 15:27:13 |       1 |
| 6632078 | 2016-05-05 18:45:40 |       1 |
| 6632078 | 2016-05-09 14:01:28 |       1 |
| 6632078 | 2016-05-10 17:12:27 |       1 |
| 6632078 | 2016-05-16 09:29:40 |       1 |
| 6632078 | 2016-05-19 11:02:34 |     128 |
| 6632078 | 2016-06-01 18:43:32 |       1 |
| 6632078 | 2016-06-01 19:02:04 |       1 |
| 6632078 | 2016-06-02 11:23:36 |       1 |
| 6632078 | 2016-06-23 15:32:57 |     128 |
+---------+---------------------+---------+
10 rows in set (0.01 sec)


| 7312805 | 2016-06-01 09:43:41 |     128 |
| 7312805 | 2016-06-01 18:09:29 |     128 |
| 7312805 | 2016-06-02 09:58:52 |     128 |
| 7312805 | 2016-06-02 15:00:30 |       1 |
| 7312805 | 2016-06-09 17:03:16 |       1 |
| 7312805 | 2016-06-16 14:50:43 |       2 |
| 7312805 | 2016-06-17 09:49:39 |       1 |
| 7312805 | 2016-06-17 12:04:27 |       1 |
| 7312805 | 2016-06-20 09:48:05 |       2 |
| 7312805 | 2016-06-20 14:37:36 |     128 |
| 7312805 | 2016-06-22 10:26:14 |      16 |
| 7312805 | 2016-06-24 10:12:08 |       1 |
+---------+---------------------+---------+
36 rows in set (0.02 sec)

+---------+---------------------+---------+
| OrderID | StartTime           | Reasons |
+---------+---------------------+---------+
| 9723046 | 2016-05-31 11:07:26 |       4 |
| 9723046 | 2016-05-31 14:47:45 |     128 |
| 9723046 | 2016-06-04 09:49:17 |      16 |
| 9723046 | 2016-06-07 17:52:01 |       1 |
| 9723046 | 2016-06-10 07:54:00 |      16 |
| 9723046 | 2016-06-11 20:26:29 |     128 |
| 9723046 | 2016-06-14 04:40:48 |      16 |
| 9723046 | 2016-06-17 07:52:21 |      16 |
+---------+---------------------+---------+
8 rows in set (0.00 sec)
|    219236 | perror     |        0 | 0000-00-00 00:00:00 | 9260512  |  165000000 |       0 |
|    219237 | perror     |        0 | 0000-00-00 00:00:00 | 8832684  |   80000000 |       0 |
|    219238 | perror     |        0 | 0000-00-00 00:00:00 | 9177584  |   30000000 |       0 |
|    219239 | perror     |        0 | 0000-00-00 00:00:00 | 9053211  |   20000000 |       0 |
|    219240 | perror     |        0 | 0000-00-00 00:00:00 | 9053112  |   15000000 |       0 |
|    219241 | perror     |        0 | 0000-00-00 00:00:00 | 9052591  |   15000000 |       0 |
|    219242 | perror     |        0 | 0000-00-00 00:00:00 | 7468582  |   14000000 |       0 |
|    219243 | perror     |        0 | 0000-00-00 00:00:00 | 9053113  |   14000000 |       0 |
|    219244 | perror     |        0 | 0000-00-00 00:00:00 | 9053110  |    5000000 |       0 |
+-----------+------------+----------+---------------------+----------+------------+---------+


mysql> select OrderIDs,MaxCost/1e6 * 30 from DropStatPreRequest where RequestID in (219236,219237,219238,219239,219240,219241,219242,219243,219244);
+----------+--------------------+
| OrderIDs | MaxCost/1e6 * 30   |
+----------+--------------------+
| 9260512  |              16500 |
| 8832684  |  8000.000010000001 |
| 9177584  |               3000 |
| 9053211  | 2000.0000100000002 |
| 9053112  |               1500 |
| 9052591  |               1500 |
| 7468582  |         1400.00001 |
| 9053113  |         1400.00001 |
| 9053110  | 500.00001000000003 |
+----------+--------------------+
9 rows in set (0.00 sec)

mysql> select orderid,exportid from OrderInfo  where OrderID in (9260512 ,8832684 ,9177584 ,9053211 ,9053112 ,9052591 ,7468582 ,9053113 ,9053110);
+---------+----------+
| orderid | exportid |
+---------+----------+
| 7468582 | 15824375 |
| 8832684 | 17935593 |
| 9052591 | 18377101 |
| 9053110 | 18377168 |
| 9053112 | 18377162 |
| 9053113 | 18377156 |
| 9053211 | 18377119 |
| 9177584 | 18358220 |
| 9260512 | 18695309 |
+---------+----------+
9 rows in set (0.01 sec)




mysql> select OrderIds from DropStatPreRequest where JiraTask = 'BSDEV-57147';
+----------+
| OrderIds |
+----------+
| 9053211  |
| 9053112  |
| 9052591  |
| 7468582  |
| 9053113  |
| 9053110  |
+----------+
6 rows in set (0.01 sec)

mysql> select orderid,exportid,baseno from OrderInfo  where OrderID in (9260512 ,8832684 ,9177584 ,9053211 ,9053112 ,9052591 ,7468582 ,9053113 ,9053110);
+---------+----------+--------+
| orderid | exportid | baseno |
+---------+----------+--------+
| 7468582 | 15824375 |    144 |
| 8832684 | 17935593 |     13 |
| 9052591 | 18377101 |      7 |
| 9053110 | 18377168 |     87 |
| 9053112 | 18377162 |     69 |
| 9053113 | 18377156 |     14 |
| 9053211 | 18377119 |     15 |
| 9177584 | 18358220 |     10 |
| 9260512 | 18695309 |    102 |
+---------+----------+--------+
9 rows in set (0.01 sec)



sudo  ./ft/cgi/master-report.pl  --SILENT_SKIP filters_pre/101_filter_by_BannerType filters_pre/102_filter_by_ImageSize filters_pre/103_filter_by_IsImage_extended filters_pre/104_filter_by_BannerImageType group_by/043_group_by_BannerType group_by/044_group_by_ImageSize group_by/045_group_by_IsImage_extended group_by/046_group_by_BannerImageType mapping/033_mapping_by_BannerType mapping/034_mapping_by_ImageSize mapping/035_mapping_by_IsImage_extended mapping/036_mapping_by_BannerImageType


https://st.yandex-team.ru/DIRECT-54061


orderid = 10119438

Index: Yabs/DatabaseCheck/Check.pm
Index: Yabs/DatabaseCheck/Check/PerfomanceBannersWithoutPhrases.pm
Index: Yabs/DatabaseCheck.pm
Index: debian/yabs-bsint2.cron.d
Index: database-monitor.pl

add_tasks
check_should_be_done
do_one_check
_extract_bad_objects
get_check
get_checks_connected_with_orders
get_config
get_hash_from_hostoption
increment_dlock_value_and_send_to_graphite
new
result_handler
run
run_checks_one_by_one
run_checks_smart



https://staff.yandex-team.ru/alximik?from=suggest
https://nanny.yandex-team.ru/v2/services/fibonacci/current_state/instances/
https://wiki.yandex-team.ru/jandekspoisk/sepe/nanny/service-repo-api/


_C_YABS_BSSOAP_
_BSDEVNETS_

AQAD-qJSJipxAAABTx6a8dmAdkuarZb4GEhLZ2w

mysql> select count(*) from AllClicksToCompare20160610;
+----------+
| count(*) |
+----------+
|   101659 |
+----------+
1 row in set (0.00 sec)

mysql> select count(*) from AllClicksToCompare20160610 where str_get_bit(WideFraudBits, 4);
+----------+
| count(*) |
+----------+
|    75277 |
+----------+
1 row in set (0.01 sec)

20160629
20160511
2016/07/04 03:11:28 29329 INFO  [  rename_table] Done OrderInfo -> OrderInfo_20160511
2016/07/04 03:11:28 29329 INFO  [  rename_table] Done AutoBudgetOrder -> AutoBudgetOrder_20160511
2016/07/04 03:12:23 29329 INFO  [  rename_table] Done OrderInfo -> OrderInfo_20160629
2016/07/04 03:12:23 29329 INFO  [  rename_table] Done AutoBudgetOrder -> AutoBudgetOrder_20160629
2016/07/04 03:15:59 2058  INFO  [  rename_table] Done OrderInfo -> OrderInfo_20160427
2016/07/04 03:15:59 2058  INFO  [  rename_table] Done AutoBudgetOrder -> AutoBudgetOrder_20160427

2016/07/04 03:25:34 13476 INFO  [  rename_table] Done OrderInfo -> OrderInfo_20160518
2016/07/04 03:25:34 13476 INFO  [  rename_table] Done AutoBudgetOrder -> AutoBudgetOrder_20160518

2016/07/04 03:29:41 18650 INFO  [  rename_table] Done OrderInfo -> OrderInfo_20160528
2016/07/04 03:29:41 18650 INFO  [  rename_table] Done AutoBudgetOrder -> AutoBudgetOrder_20160528

2016/07/04 03:31:18 20426 INFO  [  rename_table] Done OrderInfo -> OrderInfo_20160601
2016/07/04 03:31:18 20426 INFO  [  rename_table] Done AutoBudgetOrder -> AutoBudgetOrder_20160601


8092017, 8091940, 9196143

10045691,10046115,10068517,10068548,9757005,9757026,9757074,9757085,9757102,9860951,9861657




orderid = 9720048

mysql> select BannerID,PhraseID,ContextType, sum(Clicks) from AutoBudgetAdjustedStat inner join Banner66 using(BannerID) where orderid = 9720048 group by 1,2,3 order by 4 desc limit 10;
+------------+----------+-------------+--------------+
| BannerID   | PhraseID | ContextType | sum(Clicks)  |
+------------+----------+-------------+--------------+
| 1783741579 |    18661 |           8 | 151917232863 |
| 1783741579 |    18656 |           8 |  86517183314 |
| 1783741579 |    36643 |           8 |  71793384939 |
| 1783741593 |    36643 |           8 |  61494410429 |
| 1783741580 |    36643 |           8 |  54655569970 |
| 1783741593 |    18656 |           8 |  53295155067 |
| 1783741579 |    18655 |           8 |  50264453941 |
| 1783741562 |    36728 |           8 |  47341866180 |
| 1783741593 |    18661 |           8 |  44238820594 |
| 1783741594 |    18661 |           8 |  41547908739 |
+------------+----------+-------------+--------------+
10 rows in set (0.01 sec)
 orderid = 9720048 and bannerid = 1783741579 and phraseid = 18661;


mysql> select BannerID,PhraseID,ContextType from PhrasePrice where  orderid = 9720048 and resultflatcost = 9.7*1e4;
+------------+----------+-------------+
| BannerID   | PhraseID | ContextType |
+------------+----------+-------------+
| 1783741562 |    36726 |           8 |
| 1783741563 |    36726 |           8 |
| 1783741564 |    36726 |           8 |
| 1783741565 |    36726 |           8 |
| 1783741566 |    36726 |           8 |
| 1783741567 |    36726 |           8 |
| 1783741568 |    36726 |           8 |
| 1783741569 |    36726 |           8 |
| 1783741570 |    36726 |           8 |
| 1783741571 |    36726 |           8 |
| 1783741572 |    36726 |           8 |
| 1783741573 |    36726 |           8 |
| 1783741574 |    36726 |           8 |
| 1783741575 |    36726 |           8 |
| 1783741576 |    36726 |           8 |
| 1783741577 |    36726 |           8 |
| 1783741578 |    36726 |           8 |
+------------+----------+-------------+
17 rows in set (0.01 sec)

mysql> select bannerid,phraseid,contexttype,sum(Clicks),sum(CostCur/1e4) from ABBannerPhraseCurWeek where orderid = 9720048 and week = 26 group by 1,2,3 order by 4 desc limit 10;
+------------+----------+-------------+-------------+------------------+
| bannerid   | phraseid | contexttype | sum(Clicks) | sum(CostCur/1e4) |
+------------+----------+-------------+-------------+------------------+
| 1783741579 |    18661 |           8 |         384 |         5400.034 |
| 1783741579 |    36643 |           8 |         315 |         3816.356 |
| 1783741580 |    36643 |           8 |         304 |         3212.314 |
| 1783741593 |    36643 |           8 |         300 |          2808.99 |
| 1783741580 |    18661 |           8 |         179 |         2043.878 |
| 1783741557 |    18996 |           8 |         170 |         1951.602 |
| 1783741562 |    36728 |           8 |         155 |         2017.328 |
| 1783741582 |    36643 |           8 |         151 |         1663.564 |
| 1783741584 |    36643 |           8 |         146 |         1434.998 |
| 1783741579 |    18655 |           8 |         137 |         1946.174 |
+------------+----------+-------------+-------------+------------------+
10 rows in set (0.00 sec)

Без overdraft

mysql> select bannerid,phraseid,contexttype,SumClicks,SumCost,resultflatcost/1e4 from (select bannerid,phraseid,contexttype,sum(Clicks) as SumClicks ,sum(CostCur/1e4) as SumCost from ABBannerPhraseCurWeek where orderid = 9720048 and week = 26 group by 1,2,3 order by 4 desc limit 10) T inner join PhrasePrice using(BannerID,PhraseID,ContextType);
+------------+----------+-------------+-----------+----------+--------------------+
| bannerid   | phraseid | contexttype | SumClicks | SumCost  | resultflatcost/1e4 |
+------------+----------+-------------+-----------+----------+--------------------+
| 1783741579 |    18661 |           8 |       384 | 5400.034 |               10.3 |
| 1783741579 |    36643 |           8 |       315 | 3816.356 |                8.7 |
| 1783741580 |    36643 |           8 |       304 | 3212.314 |                8.7 |
| 1783741593 |    36643 |           8 |       300 |  2808.99 |                8.7 |
| 1783741580 |    18661 |           8 |       179 | 2043.878 |               10.3 |
| 1783741557 |    18996 |           8 |       170 | 1951.602 |                8.7 |
| 1783741562 |    36728 |           8 |       155 | 2017.328 |               10.3 |
| 1783741582 |    36643 |           8 |       151 | 1663.564 |                8.7 |
| 1783741584 |    36643 |           8 |       146 | 1434.998 |                8.7 |
| 1783741579 |    18655 |           8 |       137 | 1946.174 |               10.3 |
+------------+----------+-------------+-----------+----------+--------------------+
10 rows in set (0.00 sec)

C overdraft

mysql> select bannerid,phraseid,contexttype,SumClicks,SumCost,resultflatcost/1e4 from (select bannerid,phraseid,contexttype,sum(Clicks) as SumClicks ,sum(CostCur/1e4) as SumCost from ABBannerPhraseCurWeek where orderid = 9720048 and week = 26 group by 1,2,3 order by 4 desc limit 10) T inner join PhrasePrice using(BannerID,PhraseID,ContextType);
+------------+----------+-------------+-----------+----------+--------------------+
| bannerid   | phraseid | contexttype | SumClicks | SumCost  | resultflatcost/1e4 |
+------------+----------+-------------+-----------+----------+--------------------+
| 1783741579 |    18661 |           8 |       384 | 5400.034 |                5.5 |
| 1783741579 |    36643 |           8 |       315 | 3816.356 |                4.3 |
| 1783741580 |    36643 |           8 |       304 | 3212.314 |                4.3 |
| 1783741593 |    36643 |           8 |       300 |  2808.99 |                4.3 |
| 1783741580 |    18661 |           8 |       179 | 2043.878 |                5.5 |
| 1783741557 |    18996 |           8 |       170 | 1951.602 |                5.3 |
| 1783741562 |    36728 |           8 |       155 | 2017.328 |                5.9 |
| 1783741582 |    36643 |           8 |       151 | 1663.564 |                4.3 |
| 1783741584 |    36643 |           8 |       146 | 1434.998 |                4.3 |
| 1783741579 |    18655 |           8 |       137 | 1946.174 |                5.4 |
+------------+----------+-------------+-----------+----------+--------------------+
10 rows in set (0.00 sec)


2016/07/05 04:55:26 31054 INFO  [  rename_table] Done OrderInfo -> OrderInfo_20160531
2016/07/05 04:55:26 31054 INFO  [  rename_table] Done AutoBudgetOrder -> AutoBudgetOrder_20160531

2016/07/05 04:56:11 31054 INFO  [  rename_table] Done OrderInfo -> OrderInfo_20160623
2016/07/05 04:56:12 31054 INFO  [  rename_table] Done AutoBudgetOrder -> AutoBudgetOrder_20160623



Вплоть по 01.06 работала 8092017 и с 18.05 по 06.06 работала 9196143. Это были условно "хорошие" кампании.

9731785,9757005,9757026,9757074,9757085,9757102,9860951,9861657

которые стали получать резко меньше трафика.  Например, на неделе с 13.06 по 19.06 работали все они, кроме 9757074. Получали совсем немного кликов.

mysql> select baseno from OrderInfo_20160623 where orderid =9731785;
+--------+
| baseno |
+--------+
|     49 |
+--------+
1 row in set (0.03 sec)


mysql> select *from  AutoBudgetOrder_20160531 where OrderID in (9731785, 9757005, 9757026, 9757074, 9757085, 9757102, 9860951, 9861657);
Empty set (0.02 sec)



mysql> select *from  AutoBudgetOrder_20160623 where OrderID in (9731785 9757005 9757026 9757074 9757085 9757102 9860951 9861657);
ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '9757005 9757026 9757074 9757085 9757102 9860951 9861657)' at line 1
mysql> select *from  AutoBudgetOrder_20160623 where OrderID in (9731785, 9757005, 9757026, 9757074, 9757085, 9757102, 9860951, 9861657);
+---------+---------------------+---------------------+------------+--------------+---------------+------------------+---------+------------+---------+------------+--------+-----------+----------+--------+-----------------+------+--------------+---------+----------+-----------+--------------+------------------+--------------+--------------+---------------+---------------+------+---------+----------------+
| OrderID | FirstStartTime      | StartTime           | LimitWeek  | LimitWeekCur | LimitDayMoney | LimitDayMoneyCur | MaxCost | MaxCostCur | AvgCost | AvgCostCur | AvgCPA | AvgCPACur | ROILevel | GoalID | LimitWeekClicks | Type | ContextLimit | Testing | Problems | DayWeight | RegularSpent | TransportDelayed | GenerateBids | OptimizeType | ReserveReturn | Profitability | Easy | Options | ChosenStrategy |
+---------+---------------------+---------------------+------------+--------------+---------------+------------------+---------+------------+---------+------------+--------+-----------+----------+--------+-----------------+------+--------------+---------+----------+-----------+--------------+------------------+--------------+--------------+---------------+---------------+------+---------+----------------+
| 9731785 | 2016-05-31 12:45:00 | 2016-06-20 10:40:00 |          0 |            0 |             0 |                0 |       0 |          0 |  196667 |      59000 |      0 |         0 |        0 |     -1 |               0 |    3 |          100 |       0 |        2 |    333333 |            0 |                0 |            0 |            0 |             0 |             0 |    0 |         | cpc            |
| 9757005 | 2016-06-01 17:10:00 | 2016-06-01 17:10:00 | 2000000000 |            0 |             0 |                0 |       0 |          0 |       0 |          0 |      0 |         0 |        0 |     -1 |               0 |    3 |            0 |       0 |        2 |    333333 |            0 |                0 |            0 |            0 |             0 |             0 |    0 |         | cpc            |
| 9757026 | 2016-06-01 17:10:00 | 2016-06-01 17:10:00 | 2000000000 |            0 |             0 |                0 |       0 |          0 |       0 |          0 |      0 |         0 |        0 |     -1 |               0 |    3 |            0 |       0 |        2 |    333333 |            0 |                0 |            0 |            0 |             0 |             0 |    0 |         | cpc            |
| 9757074 | 2016-06-01 17:10:00 | 2016-06-01 17:10:00 | 2000000000 |            0 |             0 |                0 |       0 |          0 |       0 |          0 |      0 |         0 |        0 |     -1 |               0 |    3 |            0 |       0 |        2 |    333333 |            0 |                0 |            0 |            0 |             0 |             0 |    0 |         | cpc            |
| 9757085 | 2016-06-01 17:10:00 | 2016-06-01 17:10:00 | 2000000000 |            0 |             0 |                0 |       0 |          0 |       0 |          0 |      0 |         0 |        0 |     -1 |               0 |    3 |            0 |       0 |        2 |    333333 |            0 |                0 |            0 |            0 |             0 |             0 |    0 |         | cpc            |
| 9757102 | 2016-06-01 17:10:00 | 2016-06-01 17:10:00 | 2000000000 |            0 |             0 |                0 |       0 |          0 |       0 |          0 |      0 |         0 |        0 |     -1 |               0 |    3 |            0 |       0 |        0 |    333333 |            0 |                0 |            0 |            0 |             0 |             0 |    0 |         | cpc            |
| 9860951 | 2016-06-08 19:00:00 | 2016-06-21 14:10:00 | 2000000000 |            0 |             0 |                0 |       0 |          0 |       0 |          0 |      0 |         0 |        0 |     -1 |               0 |    3 |            0 |       0 |        2 |    333333 |            0 |                0 |            0 |            0 |             0 |             0 |    0 |         | cpc            |
| 9861657 | 2016-06-08 20:10:00 | 2016-06-21 14:10:00 | 2000000000 |            0 |             0 |                0 |       0 |          0 |       0 |          0 |      0 |         0 |        0 |     -1 |               0 |    3 |            0 |       0 |        2 |    333333 |            0 |                0 |            0 |            0 |             0 |             0 |    0 |         | cpc            |
+---------+---------------------+---------------------+------------+--------------+---------------+------------------+---------+------------+---------+------------+--------+-----------+----------+--------+-----------------+------+--------------+---------+----------+-----------+--------------+------------------+--------------+--------------+---------------+---------------+------+---------+----------------+
8 rows in set (0.09 sec)


1222711627
1193403547

2373381
r2384608
r2384769
r2387346
2390829


2016-07-05 18:31:48

alias(multiplySeries(removeAboveValue(scale(divideSeries(diffSeries(one_min.bscoll-mf_yandex_ru.antifraud_clicks.good,timeShift(one_min.bscoll-mf_yandex_ru.antifraud_clicks.good, "-1w")),one_min.bscoll-mf_yandex_ru.antifraud_clicks.good),100), -20),removeBelowValue(scale(divideSeries(diffSeries(diffSeries(one_min.bscoll-mf_yandex_ru.antifraud_clicks.all,one_min.bscoll-mf_yandex_ru.antifraud_clicks.good),timeShift(diffSeries(one_min.bscoll-mf_yandex_ru.antifraud_clicks.all,one_min.bscoll-mf_yandex_ru.antifraud_clicks.good), "-1w")),one_min.bscoll-mf_yandex_ru.antifraud_clicks.good),100), 15)), "combined_antifraud_data")



10 days
2016/07/07 18:31:11 433391 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/DataSources/LWP.pm] Got url https://artmon.bsadm.yandex-team.ru/cgi-bin/artmon_basic.cgi?module=FilterFraudStat2&period_start=20...
2016/07/07 18:31:11 433391 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/DataSources/LWP.pm] Chozen source artmon
2016/07/07 18:31:11 433391 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/Launcher/ShiftingAlertsGenerator.pm] Laucning on period 20160612000000 - 20160622000000
2016/07/07 18:31:11 433391 INFO  [/usr/share/perl5/Alerts/DProcess/CustomSubs/AnomaliesDetector.pm] [1466542800,0] Task 0 : start get_data
2016/07/07 18:31:11 433391 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/DataSources/LWP.pm] [1466542800,0] Got url https://artmon.bsadm.yandex-team.ru/cgi-bin/artmon_basic.cgi?module=FilterFraudStat2&period_start=20...
2016/07/07 18:31:11 433391 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/DataSources/LWP.pm] [1466542800,0] Chozen source artmon
2016/07/07 18:31:11 433391 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/DataSources/LWP.pm] [1466542800,0] Got url https://artmon.bsadm.yandex-team.ru/cgi-bin/artmon_basic.cgi?module=FilterFraudStat2&period_start=20...
2016/07/07 18:31:11 433391 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/DataSources/LWP.pm] [1466542800,0] Chozen source artmon
2016/07/07 18:31:23 433391 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/DataSources/LWP.pm] [1466542800,0] Got from 'https://artmon.bsadm.yandex-team.ru/public_api/fetch_artmon_data.cgi':
2016/07/07 18:31:23 433391 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/DataSources/LWP.pm] [1466542800,0]   Cost.1-7: from=1465592400, until=1466542800, timegroup=86400, last_points = 1.31,1.4,1.45,1.46,1.55,1.61,1.44,59.32,79.67,78.13
2016/07/07 18:31:23 433391 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/AnomaliesDetector/AbsoluteValueExpand.pm] [1466542800,0] Data tail is : 1.23, 1.16, 1.31, 1.4, 1.45, 1.46, 1.55, 1.61, 1.44, 59.32
2016/07/07 18:31:23 433391 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/AnomaliesDetector/AbsoluteValueExpand.pm] [1466542800,0] less_quantile = 4.068, more_quantile = 1.16
2016/07/07 18:31:23 433391 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/AnomaliesDetector/AbsoluteValueExpand.pm] [1466542800,0] heavy_max = 4.52, heavy_min = 1.044
2016/07/07 18:31:28 164009 INFO  [/usr/share/perl5/Alerts/CGI/RedisImage.pm] Succeeded connecting to ident h: host bsspark06h, port 8102
2016/07/07 18:31:28 164009 INFO  [/usr/share/perl5/Alerts/CGI/RedisImage.pm] Succeeded connecting to ident i: host bsspark03i, port 8102

9 days
2016/07/07 18:29:10 117224 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/DataSources/LWP.pm] Got url https://artmon.bsadm.yandex-team.ru/cgi-bin/artmon_basic.cgi?module=FilterFraudStat2&period_start=20...
2016/07/07 18:29:10 117224 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/DataSources/LWP.pm] Chozen source artmon
2016/07/07 18:29:10 117224 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/Launcher/ShiftingAlertsGenerator.pm] Laucning on period 20160613000000 - 20160622000000
2016/07/07 18:29:10 117224 INFO  [/usr/share/perl5/Alerts/DProcess/CustomSubs/AnomaliesDetector.pm] [1466542800,0] Task 0 : start get_data
2016/07/07 18:29:10 117224 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/DataSources/LWP.pm] [1466542800,0] Got url https://artmon.bsadm.yandex-team.ru/cgi-bin/artmon_basic.cgi?module=FilterFraudStat2&period_start=20...
2016/07/07 18:29:10 117224 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/DataSources/LWP.pm] [1466542800,0] Chozen source artmon
2016/07/07 18:29:10 117224 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/DataSources/LWP.pm] [1466542800,0] Got url https://artmon.bsadm.yandex-team.ru/cgi-bin/artmon_basic.cgi?module=FilterFraudStat2&period_start=20...
2016/07/07 18:29:10 117224 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/DataSources/LWP.pm] [1466542800,0] Chozen source artmon
2016/07/07 18:29:21 117224 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/DataSources/LWP.pm] [1466542800,0] Got from 'https://artmon.bsadm.yandex-team.ru/public_api/fetch_artmon_data.cgi':
2016/07/07 18:29:21 117224 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/DataSources/LWP.pm] [1466542800,0]   Cost.1-7: from=1465678800, until=1466542800, timegroup=86400, last_points = 1.31,1.4,1.45,1.46,1.55,1.61,1.44,59.32,79.67,78.13
2016/07/07 18:29:21 117224 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/AnomaliesDetector/AbsoluteValueExpand.pm] [1466542800,0] Data tail is : 1.16, 1.31, 1.4, 1.45, 1.46, 1.55, 1.61, 1.44, 59.32
2016/07/07 18:29:21 117224 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/AnomaliesDetector/AbsoluteValueExpand.pm] [1466542800,0] less_quantile = 59.32, more_quantile = 1.16
2016/07/07 18:29:21 117224 INFO  [/usr/share/perl5/Alerts/SeriesMonitoring/AnomaliesDetector/AbsoluteValueExpand.pm] [1466542800,0] heavy_max = 65.9111111111111, heavy_min = 1.044
(END)


21:51:20
21:55:54

Жй21:57:54
22:19:25


2016/07/08 00:50:12 1042438 INFO  [get_graphite_h] [1467928202,292] Done getting balancer hosts
2016/07/08 00:50:12 1042174 INFO  [output_downloa] [1467928202,281] Got from 'https://bsadm.yandex-team.ru/public_api/fetch_artmon_data.cgi':
2016/07/08 00:50:12 1042174 INFO  [output_downloa] [1467928202,281]     clicks.bspstat: from=1467914700, until=1467924900, timegroup=60, last_points = undef,undef,undef,undef,16219,undef,undef,undef,undef,16297
2016/07/08 00:50:12 1042174 INFO  [  analyze_data] [1467928202,281] Data tail is : 0, 0, 0, 0, -10987, 0, 0, 0, 0, -10724
2016/07/08 00:50:12 1042174 INFO  [  analyze_data] [1467928202,281] less_quantile = 0, more_quantile = -7690.9
2016/07/08 00:50:12 1042174 INFO  [  analyze_data] [1467928202,281] heavy_max = 0, heavy_min = -6921.81

2016/07/08 00:40:42 669234 INFO  [output_downloa] [1467927602,497] Got from 'https://bsadm.yandex-team.ru/public_api/fetch_artmon_data.cgi':
2016/07/08 00:40:42 669234 INFO  [output_downloa] [1467927602,497]      clicks.clickhouse: from=1467914100, until=1467924600, timegroup=60, last_points = unde
f,undef,undef,undef,16771,undef,undef,undef,undef,16219
2016/07/08 00:40:42 669234 INFO  [  analyze_data] [1467927602,497] Data tail is : 0, 0, 0, 0, -8687, 0, 0, 0, 0, -11010
2016/07/08 00:40:42 669234 INFO  [  analyze_data] [1467927602,497] less_quantile = 0, more_quantile = -7707
2016/07/08 00:40:42 669234 INFO  [  analyze_data] [1467927602,497] heavy_max = 0, heavy_min = -6936.3
i


=====
2016/07/08 00:50:21 1043031 INFO  [output_downloa] [1467928202,497] Got from 'https://bsadm.yandex-team.ru/public_api/fetch_artmon_data.cgi':
2016/07/08 00:50:21 1043031 INFO  [output_downloa] [1467928202,497]     clicks.clickhouse: from=1467914700, until=1467925200, timegroup=60, last_points = unde
f,undef,undef,undef,16297,undef,undef,undef,undef,15908
2016/07/08 00:50:21 1043031 INFO  [  analyze_data] [1467928202,497] Data tail is : 0, 0, 0, 0, -10724, 0, 0, 0, 0, -10277
2016/07/08 00:50:21 1043031 INFO  [  analyze_data] [1467928202,497] less_quantile = 0, more_quantile = -8240.25
2016/07/08 00:50:21 1043031 INFO  [  analyze_data] [1467928202,497] heavy_max = 0, heavy_min = -7416.225

2016/07/08 00:50:12 1042438 INFO  [get_graphite_h] [1467928202,292] Done getting balancer hosts
==============

2016/07/08 00:50:12 1042174 INFO  [output_downloa] [1467928202,281] Got from 'https://bsadm.yandex-team.ru/public_api/fetch_artmon_data.cgi':
2016/07/08 00:50:12 1042174 INFO  [output_downloa] [1467928202,281]     clicks.bspstat: from=1467914700, until=1467924900, timegroup=60, last_points = undef,u
ndef,undef,undef,16219,undef,undef,undef,undef,16297
2016/07/08 00:50:12 1042174 INFO  [  analyze_data] [1467928202,281] Data tail is : 0, 0, 0, 0, -10987, 0, 0, 0, 0, -10724
2016/07/08 00:50:12 1042174 INFO  [  analyze_data] [1467928202,281] less_quantile = 0, more_quantile = -7690.9
2016/07/08 00:50:12 1042174 INFO  [  analyze_data] [1467928202,281] heavy_max = 0, heavy_min = -6921.81



orderid = 2271290;
124349960,1240622806,1
bannerid = 124349960
phraseid = 1240622806
context_type = 1
parentexportid = 177412549
exportid = 6919482
phrase = лодочные моторы -2 -5 -honda -купить -магазин -подвесной -продажа -хонда -цена -четырехтактныйd



:) select sum(Clicks) from OrderCounter where OrderID = 2271290 and EventDate >= '2016-06-24' and EventDate <= '2016-07-08' and BannerID = 124349960 and PhraseID = 1240622806 and ContextType = 1;

SELECT sum(Clicks)
FROM OrderCounter
WHERE (OrderID = 2271290) AND (EventDate >= '2016-06-24') AND (EventDate <= '2016-07-08') AND (BannerID = 124349960) AND (PhraseID = 1240622806) AND (ContextType = 1)

┌─sum(Clicks)─┐
│          35 │
└─────────────┘
↘ Progress: 131.07 thousand rows, 3.54 MB (18.39 million rows/s., 496.40 MB/s.)
1 rows in set. Elapsed: 0.008 sec. Processed 131.07 thousand rows, 3.54 MB (17.29 million rows/s., 466.85 MB/s.)


:) select EventDate, sum(Clicks), sum(Cost/1e6) from OrderCounter where OrderID = 2271290 and EventDate >= '2016-05-01' and EventDate <= '2016-07-08' and BannerID = 124349960 and PhraseID = 1240622806 and ContextType = 1 group by EventDate;

SELECT
    EventDate,
    sum(Clicks),
    sum(Cost / 1000000.)
FROM OrderCounter
WHERE (OrderID = 2271290) AND (EventDate >= '2016-05-01') AND (EventDate <= '2016-07-08') AND (BannerID = 124349960) AND (PhraseID = 1240622806) AND (ContextType = 1)
GROUP BY EventDate

┌──EventDate─┬─sum(Clicks)─┬─sum(divide(Cost, 1000000.))─┐
│ 2016-06-29 │           0 │                           0 │
│ 2016-06-30 │           0 │                           0 │
│ 2016-07-01 │           9 │                    2.190866 │
│ 2016-07-02 │           0 │                           0 │
│ 2016-07-03 │           1 │                    0.267467 │
│ 2016-07-04 │           0 │                           0 │
│ 2016-07-05 │           2 │                    0.487734 │
│ 2016-07-06 │           9 │          1.8368659999999999 │
│ 2016-07-07 │           0 │                           0 │
│ 2016-07-08 │          14 │          3.0365329999999995 │
└────────────┴─────────────┴─────────────────────────────┘
↑ Progress: 188.42 thousand rows, 6.59 MB (5.90 million rows/s., 206.61 MB/s.)
10 rows in set. Elapsed: 0.032 sec. Processed 188.42 thousand rows, 6.59 MB (5.89 million rows/s., 206.27 MB/s.)

:)


:) select sum(Cost/1e6) from OrderCounter where OrderID = 2271290 and EventDate >= '2016-06-24' and EventDate <= '2016-07-08' and BannerID = 124349960 and PhraseID = 1240622806 and ContextType = 1;

SELECT sum(Cost / 1000000.)
FROM OrderCounter
WHERE (OrderID = 2271290) AND (EventDate >= '2016-06-24') AND (EventDate <= '2016-07-08') AND (BannerID = 124349960) AND (PhraseID = 1240622806) AND (ContextType = 1)

┌─sum(divide(Cost, 1000000.))─┐
│          7.8194659999999985 │
└─────────────────────────────┘
↓ Progress: 131.07 thousand rows, 4.06 MB (8.13 million rows/s., 252.11 MB/s.)
1 rows in set. Elapsed: 0.016 sec. Processed 131.07 thousand rows, 4.06 MB (8.04 million rows/s., 249.23 MB/s.)


:) select sum(Clicks) from OrderCounter where OrderID = 2271290 and EventDate >= '2016-06-24' and EventDate <= '2016-07-08' and BannerID = 124349961 and PhraseID = 1240622806 and ContextType = 1;

SELECT sum(Clicks)
FROM OrderCounter
WHERE (OrderID = 2271290) AND (EventDate >= '2016-06-24') AND (EventDate <= '2016-07-08') AND (BannerID = 124349961) AND (PhraseID = 1240622806) AND (ContextType = 1)

┌─sum(Clicks)─┐
│          45 │
└─────────────┘
→ Progress: 131.07 thousand rows, 3.54 MB (18.73 million rows/s., 505.61 MB/s.)
1 rows in set. Elapsed: 0.007 sec. Processed 131.07 thousand rows, 3.54 MB (18.12 million rows/s., 489.15 MB/s.)

:)


 !!! PRODUCTION !!! root@bstat112i.yandex.ru [yabsdb]> select OrderID, count(*) from PhrasePrice group by 1 order by 2 desc limit 10;
+----------+----------+
| OrderID  | count(*) |
+----------+----------+
|  8726540 |  2869500 |
| 10221034 |  2069063 |
| 10218373 |  1582996 |
| 10114928 |  1345700 |
|  9367994 |   804972 |
|  2949290 |   467952 |
|  6772964 |   374779 |
|  3288981 |   360496 |
|  5685328 |   278909 |
|  9088632 |   278302 |
+----------+----------+
10 rows in set (1 min 8.85 sec)

 !!! PRODUCTION !!! root@bstat136i.yandex.ru [yabsdb]> select OrderID, count(*) from PhrasePrice group by 1 order by 2 desc limit 10;
10218373+----------+----------+
| OrderID  | count(*) |
+----------+----------+
| 10045307 |  5302088 |
| 10127795 |  3179024 |
|  9368094 |   804972 |
|  8204034 |   708840 |

8726540 -- hits =1000
10218373 -- hits = 1000
10221034 -- hits=1000


10045307



mysql> select OrderID,Options from OrderInfo where ClientID = 10163940;
+----------+--------------------------------------------------------------------------------+
| OrderID  | Options                                                                        |
+----------+--------------------------------------------------------------------------------+
| 10099571 | broad,bscount,hide-market-rating,external-ssp                                  |
| 10100816 | autofocus,autobudget,bscount,hide-market-rating,disable-text-move,external-ssp |
+----------+--------------------------------------------------------------------------------+
2 rows in set (0.00 sec)

group_concat(Display): 1120402,1120396,1120397,1120405,1120394,1120400,1120401,1120406,1120393,1120409,1120398,1120395,1120407,1120408,1120404,1120399,1120403,1279513,1279509,1279514
 BannerID in (1193403547,1193403548,1193403549,1193403550,1193403551,1193403552,1193403553,1193403554,1193403555,1193403556,1193403557,1193403558,1193403559,1193403560,1193403561,1193403562,1193403563,1989423713,1989423714,1989423715)

orderid  7709994

mysql> select group_concat(Display)from Resource where BannerID in (1193403547,1193403548,1193403549,1193403550,1193403551,1193403552,1193403553,1193403554,1193403555,1193403556,1193403557,1193403558,1193403559,1193403560,1193403561,1193403562,1193403563,1989423713,1989423714,1989423715) and ResourceNo = 4\G
*************************** 1. row ***************************
group_concat(Display): 1120402,1120396,1120397,1120405,1120394,1120400,1120401,1120406,1120393,1120409,1120398,1120395,1120407,1120408,1120404,1120399,1120403,1279513,1279509,1279514
1 row in set (0.01 sec)

mysql> select * from yabsdb.DSPCreative where CreativeID = 1193403547;
Empty set (0.00 sec)


321605 -- плохой
321610 -- хороший


mysql> select OrderID from OrderInfo where State = 6 and Complete =1 and BaseNo = 100;
+---------+
| OrderID |
+---------+
|  283236 |
| 2729562 |
| 2783222 |
| 2831548 |
+---------+
4 rows in set (0.16 sec)


2016/07/15 01:33:29 27355 INFO  [ load_forecast] Load PhrasePrice
2016/07/15 01:33:29 27355 INFO  [load_current_p] lazy_phrases_part_condition = 1
2016/07/15 01:35:05 27355 INFO  [load_current_p] Restricting lazy phrases enabled

2016/07/15 01:35:12 27355 INFO  [ load_forecast] Loading CostsForecast
2016/07/15 01:42:38 27355 INFO  [load_costs_for] Phrase 1966223369,1248729779,1, cost_coef is negative: -45280.7692307692

2016/07/15 02:07:02 20329 INFO  [load_current_p] lazy_phrases_part_condition = 1
2016/07/15 02:07:39 21627 INFO  [         BEGIN] MYSQL_NOW = now(), mysql_generation_start_time = '20160715020500'

2016/07/15 02:08:03 21683 INFO  [ load_forecast] Loading CostsForecast
2016/07/15 02:08:10 21683 INFO  [load_costs_for] Phrase 1966223314,1251726431,1, cost_coef is negative: -24305.6923076923

                                        BannerID in (" . join( ",", splice( @bannerids, 0, 20000 ) ) . ")

2016/07/15 02:49:58 29234 INFO  [ load_forecast] Load PhrasePrice
2016/07/15 02:49:58 29234 INFO  [load_current_p] lazy_phrases_part_condition = 1
2016/07/15 02:50:08 29234 INFO  [load_current_p] Restricting lazy phrases enabled


-25
-27

mysql> insert into ABBannerPhraseCurWeek values (8780789,1422098745,1537457111,10301,8,0,week(now(), 7), 10000, 500, 500 * 30 / 30 * 1e6,500 * 30 * 1e4,500 * 30 / 30 * 1e6,500 * 30 * 1e4,0);

:q



AvgCost -- средняя цена -- параметр Автобюджета
ResultFlatCost -- ставка в РСЯ
orderid = 8780789 -- компания
mysql>  select AvgCost/1e4 ,count(*) from PhrasePrice where orderid = 8780789 group by 1;
+-------------+----------+
| AvgCost/1e4 | count(*) |
+-------------+----------+
|          10 |       68 |
+-------------+----------+
1 row in set (0.00 sec)

ABBannerPhraseCurWeek -- статистика

mysql> select CostCur/1e4/Clicks from ABBannerPhraseCurWeek where orderid = 8780789 group by 1;
+--------------------+
| CostCur/1e4/Clicks |
+--------------------+
|                 20 |
+--------------------+
1 row in set (0.00 sec)

mysql> select ResultFlatCost/1e4, count(*)  from PhrasePrice where orderid = 8780789 group by 1;
+--------------------+----------+
| ResultFlatCost/1e4 | count(*) |
+--------------------+----------+
|               12.2 |       68 |
+--------------------+----------+
1 row in set (0.00 sec)





| 408309513 | rplcat               | localhost                                    | yabsdb   | Query   |     1505 | updating                                                                    | delete from
						BroadMatch
					where
						(BannerID = 2001585883 AND SimDistance = 2 OR BannerID |

| 14222614 | rplcat      | localhost                                    | yabsdb   | Query   |   2214 | updating                         | delete from
						BroadMatch
					where
						(BannerID = 2001585883 AND SimDistance = 2 OR BannerID |


2016/07/18 15:25:39 73427 INFO  [process_datalo] Process log: DataID=201607181224060011, 506098 rows


CR UP:30 ET:60

==========================
wildberries
orderid = 7709994
день: 2016-07-15
groupexportid = 1190216211

2016/07/20 04:17:05 16860 INFO  [  rename_table] Done Banner140 -> Banner140_20160714
2016/07/20 04:16:34 16860 INFO  [  rename_table] Done Banner140 -> Banner140_20160716

mysql> select date_format(EventTime, "%Y-%m-%d 00:00:00"), avg(CostCur/1e4), count(distinct BannerID), count(*) from order_7709994_events  where FraudBits = 0 and TargetPhraseID = 651 group by 1;
+---------------------------------------------+-------------------+--------------------------+----------+
| date_format(EventTime, "%Y-%m-%d 00:00:00") | avg(CostCur/1e4)  | count(distinct BannerID) | count(*) |
+---------------------------------------------+-------------------+--------------------------+----------+
| 2016-07-14 00:00:00                         | 6.888842934106916 |                     1753 |     2413 |
| 2016-07-15 00:00:00                         | 7.228412087271006 |                     5807 |     8571 |
| 2016-07-16 00:00:00                         | 2.774568285976171 |                      880 |     1091 |
+---------------------------------------------+-------------------+--------------------------+----------+
3 rows in set (0.02 sec)

mysql> select date_format(UpdateTime, "%Y-%m-%d 00:00:00"), avg(yabs_json_path(Info, '[28][eis]')/1e6*30) * 12 * 24  from AutoBudgetParamHistory201607 where UpdateTime between 20160711000000 and 20160716235959 group by 1;
+----------------------------------------------+---------------------------------------------------------+
| date_format(UpdateTime, "%Y-%m-%d 00:00:00") | avg(yabs_json_path(Info, '[28][eis]')/1e6*30) * 12 * 24 |
+----------------------------------------------+---------------------------------------------------------+
| 2016-07-11 00:00:00                          |                                      23602.938615606858 |
| 2016-07-12 00:00:00                          |                                       40007.69380967791 |
| 2016-07-13 00:00:00                          |                                       48983.58040327678 |
| 2016-07-14 00:00:00                          |                                       84041.85509748153 |
| 2016-07-15 00:00:00                          |                                      63928.670908500004 |
| 2016-07-16 00:00:00                          |                                        5734.40847997542 |
+----------------------------------------------+---------------------------------------------------------+
6 rows in set (0.05 sec)


==================


connect_host
connect_local
connect_cluster
MasterConnectIfLag

LoadData.pm
DProcess/CustomSubs/AutoBudget.pm
autobudget.pl


[Serial] > exec bstat19.* cat check-mkdb-diff ;cat hoststate-diff

yabs-compare-event-log-stats-email-recipients
daily-eventlog-analyze-followers


------------------------------------------------------------------------
r2373093 | olegts | 2016-06-18 22:53:18 +0300 (Сб., 18 июня 2016) | 4 lines
Changed paths:
   M /trunk/arcadia/yabs/stat/bstat-updaters/Yabs/Stat/Collectors/PhrasePrice.pm

BSDEV-54400:

Using CopyFromGroupExportID in PhrasePrice collector in case if PhrasePrice does not contain BannerID column.

------------------------------------------------------------------------
r2372911 | olegts | 2016-06-18 01:31:58 +0300 (Сб., 18 июня 2016) | 5 lines
Changed paths:
   M /trunk/arcadia/yabs/stat/bstat-updaters/Yabs/Stat/Collectors/PhrasePrice.pm

BSDEV-54400:

Fixing import_data: use foreign BannerXX>


------------------------------------------------------------------------
r2363947 | olegts | 2016-06-09 23:28:01 +0300 (Чт., 09 июня 2016) | 5 lines
Changed paths:
   M /trunk/arcadia/yabs/stat/bstat-updaters/Yabs/Transport/Updaters/ABBannerPhraseCurWeekDrop.pm

BSDEV-56571:

Will not delete BannerID from ABBannerPhraseCurWeek, adapting to adding GroupExportID column to ABBannerPhraseCurWeek.


------------------------------------------------------------------------
r2325482 | olegts | 2016-06-03 21:22:36 +0300 (Пт., 03 июня 2016) | 4 lines
Changed paths:
   A /trunk/arcadia/yabs/stat/bstat-updaters/Yabs/TableDefs/ABBannerPhraseRestartHistoryByGroupExportID
   M /trunk/arcadia/yabs/stat/bstat-updaters/Yabs/Transport/Updaters/ABBannerPhraseCurWeekDrop.pm

BSDEV-56704:

Preparing to get rid of BannerID in ABBannerPhraseRestartHistory.



------------------------------------------------------------------------
r2320589 | olegts | 2016-05-31 05:16:55 +0300 (Вт., 31 мая 2016) | 4 lines
Changed paths:
   M /trunk/arcadia/yabs/stat/bstat-updaters/Yabs/Stat/Collectors/PhrasePrice.pm
   M /trunk/arcadia/yabs/stat/bstat-updaters/Yabs/Transport/Updaters/ABBannerPhraseCurWeekDrop.pm

BSDEV-56571:

Preparing to work with ABBannerPhraseCurWeek without BannerID field.


25402063        rplcat  localhost       yabsdb  Query   13      Waiting for table level lock    insert into TmpOrderEngineForPhrasePrice (\n\t\t\t\tOrderID,
(END)

1	update	insert into\n\t\t\t\tdpresults.UpdatePhrasePriceYSST146_PhrasePriceYSSTUpdates_3001156_1\n\t\t\tvalues\n\t\t('16
6	Waiting for table level lock	select\n\t\t\t\t\t\tB.BannerID,\n\t\t\t\t\t\tPP.PhraseID,\n\t\t\t\t\t\tPP.ResultCost as Cost\n\t\t\t\t\tfrom\n\t\t\t\t\t\tPhrasePrice
8	Waiting for table level lock	select\n\t\t\t\t\t\tB.BannerID,\n\t\t\t\t\t\tPP.PhraseID,\n\t\t\t\t\t\tPP.ResultCost as Cost\n\t\t\t\t\tfrom\n\t\t\t\t\t\tPhrasePrice
23	Waiting for table level lock	select\n\t\t\t\t\t\tB.BannerID,\n\t\t\t\t\t\tPP.PhraseID,\n\t\t\t\t\t\tPP.ResultCost as Cost\n\t\t\t\t\tfrom\n\t\t\t\t\t\tPhrasePrice
65	Waiting for table level lock	select\n\t\t\t\t\t\tB.BannerID,\n\t\t\t\t\t\tPP.PhraseID,\n\t\t\t\t\t\tPP.ResultCost as Cost\n\t\t\t\t\tfrom\n\t\t\t\t\t\tPhrasePrice
66	Waiting for table level lock	replace into ExpStat2PhrasePriceBufLocalData (\n\t\t\tID,\n\t\t\tOrderID,\n\t\t\tGroupExportID,\n\t\t\tBannerID,\n\t\t\t
68	Waiting for table level lock	select\n\t\t\t\t\t\tB.BannerID,\n\t\t\t\t\t\tPP.PhraseID,\n\t\t\t\t\t\tPP.ResultCost as Cost\n\t\t\t\t\tfrom\n\t\t\t\t\t\tPhrasePrice
75	Waiting for table level lock	select\n\t\t\t\t\t\tB.BannerID,\n\t\t\t\t\t\tPP.PhraseID,\n\t\t\t\t\t\tPP.ResultCost as Cost\n\t\t\t\t\tfrom\n\t\t\t\t\t\tPhrasePrice
86	Waiting for table level lock	select\n\t\t\t\t\t\tB.BannerID,\n\t\t\t\t\t\tPP.PhraseID,\n\t\t\t\t\t\tPP.ResultCost as Cost\n\t\t\t\t\tfrom\n\t\t\t\t\t\tPhrasePrice




75.828    save_updates@Yabs::Stat::Collectors::PhrasePrice::_task_collect      Count=28.8  Min=0.372     Max=208.747   Avg=2.629     Speed=0.000
    1.641    (  2.2%)  -WOC-
    24.714   ( 32.6%)  DBI-do@Yabs::Stat::Collectors::PhrasePrice:196                       Count=1.0   Min=0.001     Max=103.770   Avg=0.841     Speed=2508.103
    16.838   ( 22.2%)  DBI-do@Yabs::Transport::Updaters::PhrasePriceCostChanges:57          Count=1.0   Min=0.249     Max=9.326     Avg=0.590     Speed=756.478
    12.131   ( 16.0%)  DBI-do@Yabs::Transport::Updaters::GroupPhraseContextCostChanges:59   Count=1.0   Min=0.025     Max=206.972   Avg=0.425     Speed=625.261
    9.697    ( 12.8%)  DBI-do@Yabs::Transport::Updaters::PhrasePriceCostChanges:39          Count=1.0   Min=0.000     Max=84.780    Avg=0.353     Speed=3202.097
    6.746    (  8.9%)  DBI-selectcol_arrayref@Yabs::MySQL::Utils:606                        Count=3.0   Min=0.022     Max=1.397     Avg=0.079     Speed=0.000
    2.003    (  2.6%)  DBI-do@Yabs::Transport::Updaters::GroupPhraseContextCostChanges:40   Count=1.0   Min=0.000     Max=4.557     Avg=0.073     Speed=18793.893
    1.897    (  2.5%)  Yabs::Stat::Collectors::PhrasePrice::_phrase_price_sql_values        Count=1139.1  Min=0.000     Max=0.041     Avg=0.000     Speed=0.000


42.458    save_updates@Yabs::Stat::Collectors::PhrasePrice::_task_collect      Count=55.0  Min=0.201     Max=105.868   Avg=0.772     Speed=0.000
    2.183    (  5.1%)  -WOC-
    18.776   ( 44.2%)  DBI-do@Yabs::Transport::Updaters::PhrasePriceCostChanges:57          Count=1.0   Min=0.108     Max=6.777     Avg=0.341     Speed=5061.043
    7.041    ( 16.6%)  DBI-do@Yabs::Stat::Collectors::PhrasePrice:196                       Count=1.0   Min=0.000     Max=94.765    Avg=0.126     Speed=17103.659
    4.170    (  9.8%)  DBI-selectcol_arrayref@Yabs::MySQL::Utils:606                        Count=3.0   Min=0.011     Max=1.076     Avg=0.025     Speed=0.000
    3.074    (  7.2%)  DBI-do@Yabs::Transport::Updaters::PhrasePriceCostChanges:39          Count=1.0   Min=0.000     Max=9.399     Avg=0.058     Speed=22317.476
    2.692    (  6.3%)  DBI-do@Yabs::Transport::Updaters::GroupPhraseContextCostChanges:59   Count=1.0   Min=0.033     Max=0.499     Avg=0.049     Speed=4235.303
p       | Msg_type | Msg_text |
+-------------------------------+----------+----------+----------+
| yabsdb.PhrasePriceCostChanges | optimize | status   | OK       |
+-------------------------------+----------+----------+----------+
1 row in set (4.68 sec)

    2.493    (  5.9%)  Yabs::Stat::Collectors::PhrasePrice::_phrase_price_sql_values        Count=1106.7  Min=0.000     Max=0.016     Avg=0.000     Speed=0.000
    1.889    (  4.4%)  DBI-do@Yabs::Transport::Updaters::GroupPhraseContextCostChanges:40   Count=1.0   Min=0.000     Max=1.930     Avg=0.036     Speed=41126.665


PhrasePrice:196 +0.7
GroupPhraseContextCostChanges:59 +0.4
PhrasePriceCostChanges:39 +0.3
PhrasePriceCostChanges:57 +0.2




 !!! PRODUCTION !!! root@bstat146h.yandex.ru [yabsdb]> select OrderID, count(*) from ABPrice146_55111_1GroupBanners group by 1 order by 2 desc limit 10;
+----------+----------+
| OrderID  | count(*) |
+----------+----------+
| 10209728 |   775076 |
|  9057918 |   482784 |
|  4494090 |   380160 |
|  9464847 |   118202 |
| 10461470 |    93328 |
|  8179207 |    85394 |
|  8113685 |    76440 |
|  9166902 |    66964 |
|  3049954 |    66646 |
|  6967698 |    57862 |
+----------+----------+
10 rows in set (2.55 sec)
2016/07/22 15:04:18 820357 INFO  [update_phrase_] update PhrasePrice : join with ABChangeExperimentOptionBanners146_55111_1GroupBanners on BannerID
2016/07/22 15:04:19 820357 INFO  [update_phrase_] Done updating ab-exp in PhrasePrice

 !!! PRODUCTION !!! root@bstat146h.yandex.ru [yabsdb]> select count(*) from ABPrice146_55111_1GroupBanners;
+----------+
| count(*) |
+----------+
|  5951468 |
+----------+
1 row in set (0.00 sec)


2016/07/22 15:06:43 820357 INFO  [update_phrase_] update PhrasePrice : join with ABPrice146_55111_1GroupBanners on BannerID,PhraseID,ContextType
2016/07/22 15:09:35 820357 INFO  [update_phrase_] Done applying to PhrasePrice

while [ 1 ];do date;mysql -uroot yabsdb -e 'show processlist' | cut -f 6- | grep -v -E '^0\s' |grep -v NULL |sort -nk 1; echo ; echo; echo ;sleep 1;done



 !!! PRODUCTION !!! root@bstat146h.yandex.ru [yabsdb]> optimize table GroupPhraseContextCostChanges;
+--------------------------------------+----------+----------+----------+
| Table                                | Op       | Msg_type | Msg_text |
+--------------------------------------+----------+----------+----------+
| yabsdb.GroupPhraseContextCostChanges | optimize | status   | OK       |
+--------------------------------------+----------+----------+----------+
1 row in set (0.73 sec)



 !!! PRODUCTION !!! root@bstat146h.yandex.ru [yabsdb]> optimize table PhrasePriceCostChanges;
+-------------------------------+----------+----------+----------+
| Table                         | Op       | Msg_type | Msg_text |
+-------------------------------+----------+----------+----------+
| yabsdb.PhrasePriceCostChanges | optimize | status   | OK       |
+-------------------------------+----------+----------+----------+
1 row in set (4.68 sec)


2016/07/22 15:59:21 100249 INFO  [          save] Filling ABBannerPhraseRestartHistory using GroupExportID
2016/07/22 15:59:39 44978 INFO  [cleanupProcess] /var/lib/mysql.yabs/yabsdb/RotatePhrasePriceChangeLog201607220757070022.frm.lz4 was succesfully removed

Тормоза до чтения

2016/07/22 16:26:07 578369 INFO  [process_datalo] Process log: DataID=201607220825090013, 121002 rows
Пт. июля 22 16:26:07 MSK 2016
13      Writing to net  select\n\t\t\t\tBannerID,\n\t\t\t\tOrderID,\n\t\t\t\tGroupExportID,\n\t\t\t\tContextID\n\t\t\tfrom\n\t\t\t\tBanner146\n\t\t\twhere\n
Пт. июля 22 16:26:49 MSK 2016
55      Writing to net  select\n\t\t\t\tBannerID,\n\t\t\t\tOrderID,\n\t\t\t\tGroupExportID,\n\t\t\t\tContextID\n\t\t\tfrom\n\t\t\t\tBanner146\n\t\t\twhere\n
2016/07/22 16:27:30 713151 INFO  [_load_phrase_p] Reading PhrasePrice with BannerID


2016/07/22 16:26:06 684101 INFO  [ _task_collect] OrderID = 10469076    ContextPriceCoef = 100 (1)      MobilePriceCoef = 100 (1)       State = 6 (1)   Comp
lete = 0 (1)        RotationGoalID = -1 (1) RotationMaxCPA = 0 (1)  RotationMaxCPACur = 0 (1)       CostPcs = 0 (1) BroadmatchGoalID = 0 (0)
2016/07/22 16:27:29 578554 INFO  [cleanupProcess] /var/lib/mysql.yabs/yabsdb/RotateLocalOrderInfoChangeLog201607221318040021.frm.lz4 was succesfully removed
2016/07/22 16:27:29 578554 INFO  [cleanupProcess] /var/lib/mysql.yabs/yabsdb/RotateLocalOrderInfoChangeLog201607221318040021.MYD.lz4 was succesfully removed
2016/07/22 16:27:29 578554 INFO  [cleanupProcess] /var/lib/mysql.yabs/yabsdb/RotateLocalOrderInfoChangeLog201607221318040021.MYI.lz4 was succesfully removed
2016/07/22 16:27:29 578554 INFO  [      main_log] 20160722162600 timing: LogWait=0.460,Collect=84.524,Minutely=0.030,Total=85.013 (Speed=0 rps, DataID=20160
7221318040021)


2016/07/22 18:26:55 46203 INFO  [update_phrase_] Done updating ab-exp in PhrasePrice
2016/07/22 18:27:53 46203 INFO  [update_phrase_] Done forming ABPrice146_55109_1Group
2016/07/22 18:29:03 46203 INFO  [update_phrase_] Done forming ABPrice146_55109_1GroupBanners
2016/07/22 18:29:03 46203 INFO  [update_phrase_] update PhrasePrice : join with ABPrice146_55109_1GroupBanners on BannerID,PhraseID,ContextType
2016/07/22 18:30:57 46203 INFO  [update_phrase_] Done applying to PhrasePrice
2016/07/22 18:32:55 46203 INFO  [apply_result_s] Reexport: nothing to reexport
2016/07/22 18:32:55 46203 INFO  [apply_result_s] Reexport oids for baseno 146 count: 8
2016/07/22 18:32:55 46203 INFO  [apply_result_s] Bids reexported count: 2814
2016/07/22 18:32:55 46203 INFO  [apply_result_s] CleanupAutoBudgetReexportBids 0E0 rows
2016/07/22 18:33:36 46203 INFO  [  apply_result] Deleted 0E0 records older than 1 week
2016/07/22 18:33:37 46203 INFO  [  apply_result] 91963 rows copied from ABOrderGroup146_55109_1 to ABOrderGroup
2016/07/22 18:33:37 46203 INFO  [apply_result_s] Result AutoBudget146 55109-1 applied on slave


2016/07/22 18:04:44 665919 INFO  [         BEGIN] MYSQL_NOW = now(), mysql_generation_start_time = '20160722180000'
2016/07/22 18:21:00 665919 INFO  [update_phrase_] Done applying to PhrasePrice
2016/07/22 18:23:31 665919 INFO  [apply_result_s] Reexport: nothing to reexport
2016/07/22 18:23:31 665919 INFO  [apply_result_s] Reexport oids for baseno 146 count: 8
2016/07/22 18:23:34 665919 INFO  [apply_result_s] Bids reexported count: 2174
2016/07/22 18:23:34 665919 INFO  [apply_result_s] CleanupAutoBudgetReexportBids 5 rows
2016/07/22 18:24:43 46203 INFO  [         BEGIN] MYSQL_NOW = now(), mysql_generation_start_time = '20160722182000'
2016/07/22 18:24:44 46203 INFO  [         BEGIN] Search rel powers: 1.0000, 1.0000
2016/07/22 18:24:44 46203 INFO  [         BEGIN] AutoBudget adjusted algoritm is active



починил
yabs@bsarchive52e:~$ ls -al /mnt/mem-data-dir/
total 231472
drwxrwsr-x 2 yabs yabs       160 Jul 22 19:41 .
drwxr-xr-x 5 root root      4096 Mar 10 14:28 ..
-rw-rw-r-- 1 yabs yabs  22189284 Jul 22 15:49 RotateSearchVisitLog2016072110241210.MYD
-rw-rw-r-- 1 yabs yabs   5372928 Jul 22 15:49 RotateSearchVisitLog2016072110241210.MYI
-rw-rw-r-- 1 yabs yabs  48990112 Jul 21 17:35 RotateVisitLog2016072110241210.MYD
-rw-rw-r-- 1 yabs yabs  12264448 Jul 21 17:35 RotateVisitLog2016072110241210.MYI
-rw-rw-r-- 1 yabs yabs 119270784 Jul 22 19:41 RotateVisitLog2016072216403106.MYD
-rw-rw-r-- 1 yabs yabs  28922880 Jul 22 19:41 RotateVisitLog2016072216403106.MYI
 production environment
yabs@bsarchive52e:~$ cd /tmp/
 production environment
yabs@bsarchive52e:/tmp$ sky get rbtorrent:5694f8d2d58ffc0277d1a6b32d977523d2ba5af3
 production environment
yabs@bsarchive52e:/tmp$ cp Ro
RotateVisitLog2016072110241210.MYD.lz4  RotateVisitLog2016072110241210.MYI.lz4  RotateVisitLog2016072110241210.frm.lz4
yabs@bsarchive52e:/tmp$ cp RotateVisitLog2016072110241210.* /mnt/yabslogmem/
 production environment
yabs@bsarchive52e:/tmp$ cd /mnt/yabslogmem/
 production environment
yabs@bsarchive52e:/mnt/yabslogmem$ rm RotateVisitLog2016072110241210.{frm,MYD,MYI}
 production environment
yabs@bsarchive52e:/mnt/yabslogmem$ cd /mnt/mem-data-dir/
 production environment
yabs@bsarchive52e:/mnt/mem-data-dir$ rm RotateVisitLog2016072110241210.{frm,MYD,MYI}
rm: cannot remove `RotateVisitLog2016072110241210.frm': No such file or directory
 production environment


collect-pharseprice.log
2016/07/22 21:26:30 85498 INFO  [process_datalo] Process log: DataID=201607221823060023, 90177 rows
2016/07/22 21:30:38 179630 INFO  [_load_phrase_p] Reading PhrasePrice with BannerID

collect-localorderinfo.log
2016/07/22 21:26:30 44706 INFO  [checkDumpedTab] RotateLocalOrderInfoChangeLog201607221818100021 ready for processing
2016/07/22 21:26:30 44706 INFO  [process_datalo] Process log: DataID=201607221818100021, 11 rows
2016/07/22 21:30:40 44706 INFO  [cleanupProcess] /var/lib/mysql.yabs/yabsdb/RotateLocalOrderInfoChangeLog201607221818100021.frm.lz4 was succesfully removed


while [ 1 ];do date;mysql -uroot yabsdb -e 'show full processlist' | cut -f 6- | grep -v NULL |sort -nk 1; echo ; echo; echo ;sleep 1;done 1>> mysql-queries.log
v
RotateSearchVisitLog2016072110241210


[Serial] > distribute bsarchive96h.yandex.ru,bsarchive52e.yabs.yandex.ru RotateSearchVisitLog2016072110241210*

=== bsarchive52e.yabs.yandex.ru ===
RotateSearchVisitLog2016072110241210.MYD.lz4                                                                                100% 9486KB   9.3MB/s   00:00
RotateSearchVisitLog2016072110241210.MYI.lz4                                                                                100% 2733KB   2.7MB/s   00:00
RotateSearchVisitLog2016072110241210.frm.lz4                                                                                100% 2221     2.2KB/s   00:00

=== bsarchive96h.yandex.ru ===
RotateSearchVisitLog2016072110241210.MYD.lz4                                                                                100% 9486KB   9.3MB/s   00:00
RotateSearchVisitLog2016072110241210.MYI.lz4                                                                                100% 2733KB   2.7MB/s   00:00
RotateSearchVisitLog2016072110241210.frm.lz4                                                                                100% 2221     2.2KB/s   00:00
[Serial] > p_exec bsarchive96h.yandex.ru,bsarchive52e.yabs.yandex.ru sudo /etc/init.d

http://bsgraphite.yandex.ru/render/?width=588&height=312&_salt=1448542034.889&target=maxSeries(one_hour.bsint*_yandex_ru.daily_and_hourly_budget.bad_orders)

=====

28-Jul-2016 15:43:45	tank-test   5.255.247.154  2a02:6b8:0:1a39:1000::537a  ca3ed113-3501-4bc5-93fc-6c8d393518bc
28-Jul-2016 15:43:45	bsgmpre01   5.255.247.155  2a02:6b8:0:1a39:1000::537b  e8e1bda0-ce21-4a0a-8bfa-626d4052ef9d
28-Jul-2016 15:43:45	bsgmtest01  5.255.247.156  2a02:6b8:0:1a39:1000::537c  19a4b98b-34e9-4562-9d93-a4439fd74a34

2407376.st061.yabs
2407376.st112.yabs
2407376.st140.yabs
2407376.st148.yabs

mysql -uroot --socket=/var/run/mysqld.yabsst61/mysqld.sock yabsdb
mysql -uroot yabsdb

tailf /home/yabs/multitest/metasearch/phantom.log

/mnt/opt/qabs/bsserver-b2b/engine/run/shoot.py
/opt/qabs/bsserver-b2b/engine/run/compare_log_tables.py

bannerid = bannerid - 2147483648


=====

export_family_id, region_id, export_channel_id
all_regions
bulk of export_channels -> строим мап из export_channel в export_famity, region_id, возвращаем export_family_id, region_id, start_time, stop_time


error   29-Jul-2016 19:38:25    [autobudget-test-138 5.255.247.238 run]  Fri Jul 29 19:38:25 MSK 2016  ===== Running qabs-level3 =====
error   29-Jul-2016 19:38:25    [autobudget-test-138 5.255.247.238 run]  INFO  waitflag has connected to autobudget-pre-11
error   29-Jul-2016 19:38:26    [autobudget-pre-138 5.255.247.237 run]  [2016-07-29 19:38:25] [info]: >> Тестируемые пакеты
error   29-Jul-2016 19:38:26    [autobudget-pre-138 5.255.247.237 run]  +------------------+---------+---------------------+
error   29-Jul-2016 19:38:26    [autobudget-pre-138 5.255.247.237 run]  |   Package name   | Version |      Host list      |
error   29-Jul-2016 19:38:26    [autobudget-pre-138 5.255.247.237 run]  |==================-=========-=====================|
error   29-Jul-2016 19:38:26    [autobudget-pre-138 5.255.247.237 run]  | yabs-autobudget2 |   099.2 |  autobudget-pre-138 |
error   29-Jul-2016 19:38:26    [autobudget-pre-138 5.255.247.237 run]  +------------------+---------+---------------------+
error   29-Jul-2016 19:38:26    [autobudget-pre-138 5.255.247.237 run]  |                  |   100.3 | autobudget-test-138 |
error   29-Jul-2016 19:38:26    [autobudget-pre-138 5.255.247.237 run]  +------------------+---------+---------------------+
error   29-Jul-2016 19:38:26    [autobudget-pre-138 5.255.247.237 run]  [2016-07-29 19:38:25] [info]: >> Другие пакеты


(export_family_id=123,region_id=213,start_time=20160731000000,finish_time=20160731010000,ParentID=3)


mysql> select ResultCost from PhrasePrice where BannerID = 779512624 and PhraseID = 4652148 and ContextType = 1;
+------------+
| ResultCost |
+------------+
|     397000 |
+------------+
1 row in set (0.00 sec)

mysql>  select ResultCost from PhrasePrice where BannerID = 779512624 and PhraseID = 4652148 and ContextType = 1;
+------------+
| ResultCost |
+------------+
|     266000 |
+------------+
1 row in set (0.00 sec)


mysql> select orderid from Banner130 where bannerid = 779512624;
+---------+
| orderid |
+---------+
| 6076416 |
+---------+
1 row in set (0.06 sec)


'779512624,303598390,1'

'2926996272,303598390,1'

mysql>  select CurrencyID, CurrencyDate from OrderInfo where orderid = 6076416;
+------------+---------------------+
| CurrencyID | CurrencyDate        |
+------------+---------------------+
|        643 | 2000-01-01 00:00:00 |
+------------+---------------------+
1 row in set (0.00 sec)


OrderID: 8812875
BannerID: 1547040548

BannerID: 1122758515
OrderID: 7400114

mysql> select bannerid,phraseid,contexttype,resultflatcost from PhrasePrice where BannerID in (1108893936,1108893937,1134822551,1134822552) and PhraseID = 170881347;
+------------+-----------+-------------+----------------+
| bannerid   | phraseid  | contexttype | resultflatcost |
+------------+-----------+-------------+----------------+
| 1108893936 | 170881347 |           1 |          45000 |
| 1108893937 | 170881347 |           1 |          45000 |
+------------+-----------+-------------+----------------+
2 rows in set (0.00 sec)



mysql> select bannerid,phraseid,contexttype,resultflatcost from PhrasePrice where BannerID in (1108893936+2147483648,1108893937+2147483648,1134822551+2147483648,1134822552+2147483648) and PhraseID = 170881347
    -> ;
+------------+-----------+-------------+----------------+
| bannerid   | phraseid  | contexttype | resultflatcost |
+------------+-----------+-------------+----------------+
| 3256377584 | 170881347 |           1 |          44000 |
| 3256377585 | 170881347 |           1 |          44000 |
+------------+-----------+-------------+----------------+
2 rows in set (0.06 sec)

mysql> select OrderID from Banner11 where BannerID = 1108893937;
+---------+
| OrderID |
+---------+
| 7393988 |
+---------+
1 row in set (0.00 sec)


clicks_20160729100000
clicks_20160805100000

mysql> select from_unixtime(unix_timestamp(EventTime) -  unix_timestamp(EventTime) % 300), sum(CounterType = 2)  from clicks_20160729100000 inner join Page using(PageID) where TargetType =3 and EventTime between '2016-07-29 10:50:00' and '2016-07-29 10:55:00';
+-----------------------------------------------------------------------------+----------------------+
| from_unixtime(unix_timestamp(EventTime) -  unix_timestamp(EventTime) % 300) | sum(CounterType = 2) |
+-----------------------------------------------------------------------------+----------------------+
| 2016-07-29 10:55:00                                                         |                37033 |
+-----------------------------------------------------------------------------+----------------------+
1 row in set (0.85 sec)
mysql> select from_unixtime(unix_timestamp(EventTime) -  unix_timestamp(EventTime) % 300), sum(CounterType = 2)  from clicks_20160805100000 inner join Page using(PageID) where TargetType =3 and EventTime between '2016-08-05 10:50:00' and '2016-08-05 10:55:00';
+-----------------------------------------------------------------------------+----------------------+
| from_unixtime(unix_timestamp(EventTime) -  unix_timestamp(EventTime) % 300) | sum(CounterType = 2) |
+-----------------------------------------------------------------------------+----------------------+
| 2016-08-05 10:55:00                                                         |                27131 |
+-----------------------------------------------------------------------------+----------------------+
1 row in set (0.80 sec)


mysql> select OrigOrderID, count(*) from clicks_20160729100000 inner join Page using(PageID) where TargetType =3 and EventTime between '2016-07-29 10:50:00' and '2016-07-29 10:55:00' group by 1 order by 2 desc limit 20;
+-------------+----------+
| OrigOrderID | count(*) |
+-------------+----------+
|     5166143 |      176 |
|    10511173 |      146 |
|     4504075 |       81 |
|    10557717 |       77 |
|    10539113 |       74 |
|    10554604 |       69 |
|     5881924 |       64 |
|     8407034 |       58 |
|     6201492 |       58 |
|    10556275 |       57 |
|    10188598 |       53 |
|     8339414 |       52 |
|     6959869 |       50 |
|    10395991 |       49 |
|    10537468 |       47 |
|     6535664 |       45 |
|     6675167 |       43 |
|     7709994 |       42 |
|     6485442 |       42 |
|     3516477 |       42 |
+-------------+----------+
20 rows in set (1.21 sec)


mysql> select from_unixtime(unix_timestamp(EventTime) -  unix_timestamp(EventTime) % 300), sum(CounterType = 2)  from clicks_20160805100000 inner join Page using(PageID) where TargetType =3 group by 1;
+-----------------------------------------------------------------------------+----------------------+
| from_unixtime(unix_timestamp(EventTime) -  unix_timestamp(EventTime) % 300) | sum(CounterType = 2) |
+-----------------------------------------------------------------------------+----------------------+
| 2016-08-05 10:00:00                                                         |                35570 |
| 2016-08-05 10:05:00                                                         |                36750 |
| 2016-08-05 10:10:00                                                         |                37215 |
| 2016-08-05 10:15:00                                                         |                37638 |
| 2016-08-05 10:20:00                                                         |                37511 |
| 2016-08-05 10:25:00                                                         |                37615 |
| 2016-08-05 10:30:00                                                         |                37180 |
| 2016-08-05 10:35:00                                                         |                31356 |
| 2016-08-05 10:40:00                                                         |                35892 |
| 2016-08-05 10:45:00                                                         |                33930 |
| 2016-08-05 10:50:00                                                         |                27034 |
| 2016-08-05 10:55:00                                                         |                26017 |
| 2016-08-05 11:00:00                                                         |                25382 |
+-----------------------------------------------------------------------------+----------------------+
13 rows in set (4.37 sec)

mysql> select from_unixtime(unix_timestamp(EventTime) -  unix_timestamp(EventTime) % 300), sum(CounterType = 2)  from clicks_20160729100000 inner join Page using(PageID) where TargetType =3 group by 1;
+-----------------------------------------------------------------------------+----------------------+
| from_unixtime(unix_timestamp(EventTime) -  unix_timestamp(EventTime) % 300) | sum(CounterType = 2) |
+-----------------------------------------------------------------------------+----------------------+
| 2016-07-29 10:00:00                                                         |                34787 |
| 2016-07-29 10:05:00                                                         |                34682 |
| 2016-07-29 10:10:00                                                         |                35109 |
| 2016-07-29 10:15:00                                                         |                35397 |
| 2016-07-29 10:20:00                                                         |                35694 |
| 2016-07-29 10:25:00                                                         |                36285 |
| 2016-07-29 10:30:00                                                         |                36669 |
| 2016-07-29 10:35:00                                                         |                36588 |
| 2016-07-29 10:40:00                                                         |                37096 |
| 2016-07-29 10:45:00                                                         |                37316 |
| 2016-07-29 10:50:00                                                         |                36883 |
| 2016-07-29 10:55:00                                                         |                36831 |
| 2016-07-29 11:00:00                                                         |                36433 |
+-----------------------------------------------------------------------------+----------------------+
13 rows in set (4.61 sec)



mysql> select from_unixtime(unix_timestamp(EventTime) -  unix_timestamp(EventTime) % 300), sum(CounterType = 2)  from clicks_20160805100000 inner join Page using(PageID) where TargetType =3 and EventTime between '2016-08-05 10:50:00' and '2016-08-05 10:55:00';
+-----------------------------------------------------------------------------+----------------------+
| from_unixtime(unix_timestamp(EventTime) -  unix_timestamp(EventTime) % 300) | sum(CounterType = 2) |
+-----------------------------------------------------------------------------+----------------------+
| 2016-08-05 10:55:00                                                         |                27131 |
+-----------------------------------------------------------------------------+----------------------+
1 row in set (0.00 sec)

mysql> select from_unixtime(unix_timestamp(EventTime) -  unix_timestamp(EventTime) % 300), sum(CounterType = 2)  from clicks_20160805100000 inner join Page using(PageID) where TargetType =3 and EventTime between '2016-08-05 10:30:00' and '2016-08-05 10:35:00';
+-----------------------------------------------------------------------------+----------------------+
| from_unixtime(unix_timestamp(EventTime) -  unix_timestamp(EventTime) % 300) | sum(CounterType = 2) |
+-----------------------------------------------------------------------------+----------------------+
| 2016-08-05 10:30:00                                                         |                37277 |
+-----------------------------------------------------------------------------+----------------------+
1 row in set (0.77 sec)


mysql> select OrigOrderID, count(*) from clicks_20160805100000 inner join Page using(PageID) where TargetType =3 and EventTime between '2016-08-05 10:30:00' and '2016-08-05 10:35:00' group by 1 order by 2 desc limit 20;
+-------------+----------+
| OrigOrderID | count(*) |
+-------------+----------+
|    10363686 |      315 |
|    10654478 |      203 |
|     7709994 |      128 |
|    10188598 |      119 |
|    10654196 |      102 |
|     9797757 |       87 |
|    10457041 |       85 |
|    10381393 |       74 |
|     6959869 |       62 |
|     8339414 |       58 |
|    10656011 |       54 |
|     9331015 |       52 |
|    10169039 |       51 |
|     6112630 |       47 |
|    10654234 |       47 |
|    10513841 |       45 |
|     4432501 |       45 |
|     6675167 |       44 |
|    10498345 |       44 |
|    10652943 |       42 |
+-------------+----------+
20 rows in set (0.89 sec)

mysql> select OrigOrderID, count(*) from clicks_20160805100000 inner join Page using(PageID) where TargetType =3 and EventTime between '2016-08-05 10:50:00' and '2016-08-05 10:55:00' group by 1 order by 2 desc limit 20;
+-------------+----------+
| OrigOrderID | count(*) |
+-------------+----------+
|     7709994 |       88 |
|    10608455 |       82 |
|    10188598 |       76 |
|     9797757 |       73 |
|     5603782 |       67 |
|    10656460 |       66 |
|    10652301 |       52 |
|    10656413 |       46 |
|     8339414 |       41 |
|    10641842 |       39 |
|    10652888 |       36 |
|     4432501 |       35 |
|     6959869 |       35 |
|     9331015 |       34 |
|     6112630 |       33 |
|     6485442 |       33 |
|     6675167 |       30 |
|     6243920 |       30 |
|     5022074 |       30 |
|     8721621 |       29 |
+-------------+----------+
20 rows in set (0.80 sec)

mysql> select from_unixtime(unix_timestamp(EventTime) -  unix_timestamp(EventTime) % 300), sum(CounterType = 2)  from clicks_20160805100000 inner join Page using(PageID) where TargetType =3 and  OrigOrderID = 10363686 group by 1;
+-----------------------------------------------------------------------------+----------------------+
| from_unixtime(unix_timestamp(EventTime) -  unix_timestamp(EventTime) % 300) | sum(CounterType = 2) |
+-----------------------------------------------------------------------------+----------------------+
| 2016-08-05 10:15:00                                                         |                  503 |
| 2016-08-05 10:20:00                                                         |                  152 |
| 2016-08-05 10:25:00                                                         |                   16 |
| 2016-08-05 10:30:00                                                         |                  315 |
| 2016-08-05 10:35:00                                                         |                   22 |
| 2016-08-05 10:40:00                                                         |                   13 |
| 2016-08-05 10:45:00                                                         |                    2 |
| 2016-08-05 10:50:00                                                         |                    1 |
| 2016-08-05 10:55:00                                                         |                    4 |
| 2016-08-05 11:00:00                                                         |                    2 |
+-----------------------------------------------------------------------------+----------------------+
10 rows in set (0.00 sec)

mysql> select from_unixtime(unix_timestamp(EventTime) -  unix_timestamp(EventTime) % 300), sum(CounterType = 2)  from clicks_20160805100000 inner join Page using(PageID) where TargetType =3 and  OrigOrderID = 10654478 group by 1;
+-----------------------------------------------------------------------------+----------------------+
| from_unixtime(unix_timestamp(EventTime) -  unix_timestamp(EventTime) % 300) | sum(CounterType = 2) |
+-----------------------------------------------------------------------------+----------------------+
| 2016-08-05 10:00:00                                                         |                  101 |
| 2016-08-05 10:05:00                                                         |                  209 |
| 2016-08-05 10:10:00                                                         |                  217 |
| 2016-08-05 10:15:00                                                         |                  210 |
| 2016-08-05 10:20:00                                                         |                  175 |
| 2016-08-05 10:25:00                                                         |                  122 |
| 2016-08-05 10:30:00                                                         |                  203 |
| 2016-08-05 10:35:00                                                         |                  128 |
| 2016-08-05 10:40:00                                                         |                   38 |
| 2016-08-05 10:45:00                                                         |                   19 |
| 2016-08-05 10:50:00                                                         |                    9 |
| 2016-08-05 10:55:00                                                         |                    5 |
| 2016-08-05 11:00:00                                                         |                    4 |
+-----------------------------------------------------------------------------+----------------------+
13 rows in set (0.00 sec)

mysql> select PhraseID, ContextType, sum((CounterType = 2) * (EventTime between '2016-08-05 10:30:00' and '2016-08-05 10:35:00'))-  sum((CounterType = 2) * (EventTime between '2016-08-05 10:50:00' and '2016-08-05 10:55:00'))  as clicks_diff  from clicks_20160805100000 inner join Page using(PageID) where TargetType =3 group by 1,2 order by 3 desc limit 20;
+------------+-------------+-------------+
| PhraseID   | ContextType | clicks_diff |
+------------+-------------+-------------+
|     248163 |           1 |         195 |
| 2147483647 |           8 |         109 |
|  284114802 |           1 |          51 |
|       3237 |           1 |          42 |
|       7216 |           1 |          38 |
|     672270 |           1 |          37 |
|  850443758 |           1 |          34 |
|       1416 |           1 |          23 |
| 1286193040 |           1 |          19 |
|     179552 |           1 |          19 |
|  212183265 |           1 |          19 |
|      86053 |           1 |          17 |
|          0 |           1 |          17 |
|   77398851 |           1 |          16 |
|  723843886 |           1 |          16 |
|  166152642 |           1 |          16 |
| 1286193041 |           1 |          16 |
|     134675 |           1 |          16 |
|     975078 |           1 |          15 |
| 1013697254 |           1 |          15 |
+------------+-------------+-------------+
20 rows in set (5.59 sec)
2147483647

905701228544

905701228544

  "data": [
    [
      "performance",
      7221155,
      1091488733,
      "1498632873",
      "text_only",
      "no_image",
      "140",
      "0",
      0,
      0,
      "0",
      0,
      "0",
      "0",
      "0",
      "0",
      "0",
      "0",
      "0",
      null
    ],
  "header": [
    "CampType",
    "OrderID",
    "GroupExportID",
    "bid",
    "BannerImageType",
    "ImageSize",
    "Shows",
    "Clicks",
    "Cost",
    "BonusNoVAT",
    "GoalsNum",
    "GoalsIncome",
    "SessionNum",
    "SessionNumLimited",
    "SessionDepth",
    "FirstPageShows",
    "FirstPageClicks",
    "FirstPageSumPosShows",
    "FirstPageSumPosClicks",
    "BounceRatio"
  ],


REQUEST_METHOD=POST CONTENT_TYPE= CONTENT_LENGTH=401 LOG_CONFIG_NAME=cgi ./cgi/master-report.cgi
{"with_performance_coverage":1,"order_ids":["62919136"],"group_by_date":"none","countable_fields":["PerformanceCoverage"],"order_by":[],"with_discount":1,"filters_pre":{},"mapping":{},"date_to":"20160401","group_by":["OrderID","BannerID"],"with_vat":0,"filters_post":{},"lang":"ru","currency":"RUB","dont_group_and_filter_zeros_for_totals":1,"countable_fields_by_targettype":[],"date_from":"20151101"}


+----------+----------+
| OrderID  | count(*) |
+----------+----------+
|  5490700 |  3257197 |
| 10130731 |  2711600 |
|  7508832 |  1014497 |
| 10317609 |   529680 |
| 10236820 |   443652 |
|  8156485 |   342024 |
|  6410100 |   308277 |
| 10014708 |   230550 |
|  8810772 |   208574 |
|  8932782 |   195924 |
|  9269765 |   171432 |
|  9187987 |   163236 |
|  9080374 |   152634 |
|  7537059 |   150730 |
| 10574276 |   140323 |
|  4022004 |   138435 |
|  5441409 |   138101 |
|  4922700 |   131787 |
|  3919008 |   126879 |
|  2700343 |   125846 |
|  8614706 |   123960 |



orderid = 1769932
bannerid= 75956348
phraseid = 144878038

orderid = 1769932
bannerid = 75956348
parentexportid = 101693704

orderid = 7845145

select * from ABVWForecasterPPC where orderid = 7845145;



mysql> select ResultFlatCost/1e4, count(*) from PhrasePrice_31_20160808 where orderid =7845145 group by 1;
+--------------------+----------+
| ResultFlatCost/1e4 | count(*) |
+--------------------+----------+
|                5.5 |      170 |
|                6.3 |       17 |
|                9.3 |      187 |
|                9.4 |      391 |
|                9.5 |       17 |
|                9.6 |       17 |
|                9.7 |       17 |
|                9.9 |       17 |
+--------------------+----------+
8 rows in set (0.00 sec)

mysql> select ResultFlatCost/1e4, count(*) from PhrasePrice_31_20160807 where orderid =7845145 group by 1;
+--------------------+----------+
| ResultFlatCost/1e4 | count(*) |
+--------------------+----------+
|                6.3 |       17 |
|                9.3 |      187 |
|                9.4 |      391 |
|                9.5 |       17 |
|                9.6 |       17 |
|                9.7 |       17 |
|                9.9 |       17 |
|                 10 |       17 |
|               10.4 |       17 |
|                 11 |       17 |
|               11.1 |       34 |
|               11.2 |       17 |
|               11.3 |       68 |
+--------------------+----------+
13 rows in set (0.00 sec)

mysql> select ResultFlatCost/1e4, count(*) from PhrasePrice where orderid =7845145 group by 1;
+--------------------+----------+
| ResultFlatCost/1e4 | count(*) |
+--------------------+----------+
|                2.6 |       17 |
|                2.8 |       17 |
|                2.9 |       51 |
|                3.4 |       17 |
|                3.7 |       17 |
|                3.9 |       17 |
|                  4 |       17 |
|                4.4 |       17 |
|                6.3 |       17 |
|                9.3 |      187 |
|                9.4 |      391 |
|                9.5 |       17 |
|                9.6 |       17 |
|                9.7 |       17 |
|                9.9 |       17 |
+--------------------+----------+
15 rows in set (0.01 sec)


mysql> select * from AutoBudgetForecasterAvgAPC where orderid =7845145
    -> ;
+---------+---------------------+-------+---------+----------------+
| OrderID | UpdateTime          | APC   | PPC     | ExperimentBits |
+---------+---------------------+-------+---------+----------------+
| 7845145 | 2016-08-08 22:29:00 | 73975 | 2058266 |              0 |
+---------+---------------------+-------+---------+----------------+
1 row in set (0.00 sec)

mysql> select BannerID,TargetPhraseID,ContextType, count(*)  from order_7845145_events group by 1,2,3 order by 4 desc limit 10 ;
+------------+----------------+-------------+----------+
| BannerID   | TargetPhraseID | ContextType | count(*) |
+------------+----------------+-------------+----------+
| 1644476201 |          10358 |           8 |       12 |
| 1241157450 |          10356 |           8 |        9 |
| 1525986681 |          10363 |           8 |        8 |
| 1233437048 |          10363 |           8 |        7 |
| 1233488594 |          10363 |           8 |        6 |
| 1233484949 |          10358 |           8 |        5 |
| 1233467706 |          10354 |           8 |        5 |
| 1233444640 |          10363 |           8 |        5 |
| 1237962836 |          10363 |           8 |        5 |
| 1237964560 |          10358 |           8 |        4 |
+------------+----------------+-------------+----------+
10 rows in set (0.00 sec)

parentorderid = 5132594

 mysqldump -uroot yabsdb -w "OrderID = 7845145" AutoBudgetForecasterAvgAPC ABVWForecasterAPC AutoBudgetForecasterAPC AutoBudgetForecasterCTR ABVWForecasterPPC > new_models

1) Почему max_cost такой же маленький?

[pid=30708->9255]  DB<19> x $avg_cost * 30/1e6
0  4.41844364722481

2) Почему есть баннера за 3 рубля?

[pid=30708->9255]  DB<33> x $ostat->[$O_AVG_ACTION_COST] * $ostat->[$O_AVG_APC] * 30/1e6
0  4.41844364722481

Price/Clicks = 61.85784

mysqldump -uroot yabsdb -w "OrderID = 7845145" AutoBudgetForecasterAvgAPC ABVWForecasterAPC AutoBudgetForecasterAPC AutoBudgetForecasterCTR ABVWForecasterPPC > old_models

mysqldump -uroot yabsdb -w "OrderID = 7845145" AutoBudgetForecasterAvgAPC ABVWForecasterAPC AutoBudgetForecasterAPC AutoBudgetForecasterCTR ABVWForecasterPPC > new_models

sudo yabs-dbrestore -b bstat31 -t AutoBudgetForecasterAvgAPC,ABVWForecasterAPC,AutoBudgetForecasterAPC,AutoBudgetForecasterCTR,ABVWForecasterPPC

[pid=21879->22384]  DB<3> x $ostat->[$O_AVG_ACTION_COST] * $ostat->[$O_AVG_APC] * 30/1e6
0  10.7143499851227
[pid=21879->22384]  DB<4> x $ostat->[$O_AVG_APC] * 30/1e6
0  150


G
было 150 рублей дохода на клик
[pid=21879->22384]  DB<6> x $ostat->[$O_AVG_APC] * 30/1e6
0  150

в реальности 44 рубля дохода на клик
 >>> 28000./626
44.7284345047923

сейчас в таблице 61 рублей за клик.

(income - cost) / cost //
cost / income \\

ABVWForecasterPPC
AutoBudgetForecasterAvgAPC


mysql> select  * from AutoBudgetForecasterAvgAPC;
+---------+---------------------+-------+---------+----------------+
| OrderID | UpdateTime          | APC   | PPC     | ExperimentBits |
+---------+---------------------+-------+---------+----------------+
| 7845145 | 2016-08-09 00:29:00 | 74195 | 2061928 |              0 |
+---------+---------------------+-------+---------+----------------+
1 row in set (0.00 sec)

mysql> select 2061928 * 30/1e6;
+------------------+
| 2061928 * 30/1e6 |
+------------------+
|         61.85784 |
+------------------+

ql> select avg(APC1), avg(APC2) from ABVWForecasterAPC where  orderid =7845145;
+------------+------------+
| avg(APC1)  | avg(APC2)  |
+------------+------------+
| 25929.8333 | 25064.1417 |
+------------+------------+
1 row in set (0.00 sec)
ql> select max(APC1), max(APC2) from ABVWForecasterAPC where  orderid =7845145;
+-----------+-----------+
| max(APC1) | max(APC2) |
+-----------+-----------+
|     48273 |     46694 |
+-----------+-----------+
1 row in set (0.00 sec)

mysql> select max(PPC1), max(PPC2) from ABVWForecasterPPC where  orderid =7845145;
+-----------+-----------+
| max(PPC1) | max(PPC2) |
+-----------+-----------+
|         7 |         9 |
+-----------+-----------+
1 row in set (0.00 sec)


mysql> select avg(PPC1), avg(PPC2) from ABVWForecasterPPC where  orderid =7845145;
+-----------+-----------+
| avg(PPC1) | avg(PPC2) |
+-----------+-----------+
|    2.5000 |    3.3000 |
+-----------+-----------+
1 row in set (0.00 sec)

AutoBudgetForecasterAPC




mysql> select GoalID from AutoBudgetOrder where orderid = 7845145;
+----------+
| GoalID   |
+----------+
| 17151165 |
+----------+
1 row in set (0.01 sec)
https://paste.yandex-team.ru/140849
https://paste.yandex-team.ru/140848



5329738 БК: 1769932
101693704
Авиабилеты [Москва Киев]
BannerID = 75956348
PhraseID = 144878038

конкуренты: BannerID = 75783934, 163300448, 1894236453, 1894242496

1)
	BannerID = 75783934
	orderid = 1767685
	exportid = 5326272
	baseno = 71
2)
	BannerID = 163300448
	orderid= 2509772
	exportid = 7476150
	baseno = 27
3)
	BannerID = 1894236453
	orderid = 10037852
	exportid = 19749664
	baseno = 59
4)
	BannerID = 1894242496
	orderid = 10037852
	exportid = 19749664
	baseno = 59

curl 'https://sandbox.yandex-team.ru/api/v1.0/resource?type=YABS_APP_OPTIONS&limit=1&order=-id' | jq .
curl 'https://proxy.sandbox.yandex-team.ru/152748821' > host-options.tar.gz


mysql> select distinct ContextType from AutoBudgetForecasterQuality where UpdateTime >= '2016-08-09';
+-------------+
| ContextType |
+-------------+
|           1 |
|           7 |
+-------------+
2 rows in set (0.03 sec)

mysql> select distinct ContextType from AutoBudgetForecasterAPCQuality where UpdateTime >= '2016-08-09';
+-------------+
| ContextType |
+-------------+
|           1 |
|           2 |
|           7 |
|           8 |
+-------------+
4 rows in set (0.01 sec)


mysql> select distinct ContextType from AutoBudgetForecasterMonitoring where UpdateTime > now() - interval 1 day;
+-------------+
| ContextType |
+-------------+
|           1 |
|           7 |
+-------------+
2 rows in set (0.35 sec)

orderid = 9268131


select * from AutoBudgetForecasterCTR where orderid = 9268131;
Одинаковые данные для баннеро-фраз

8-07 08:00:00 | 8705828 |          3 |  1993 |      3 |  263533 |   393333 |
| 2016-08-07 08:30:00 | 8705828 |          3 |  2048 |      5 |  413000 |   617533 |
| 2016-08-07 09:00:00 | 8705828 |          3 |  1715 |      6 |  633268 |   829932 |
| 2016-08-07 09:30:00 | 8705828 |          3 |  2129 |      9 |  833866 |  1258665 |
| 2016-08-07 10:00:00 | 8705828 |          3 |  2074 |      4 |  436600 |   562467 |
| 2016-08-07 10:30:00 | 8705828 |          3 |  1952 |      5 |  534933 |   711933 |
| 2016-08-07 11:00:00 | 8705828 |          3 |  2191 |     12 | 1089535 |  1667733 |
| 2016-08-07 11:30:00 | 8705828 |          3 |  2049 |     12 | 1254731 |  1714932 |
| 2016-08-07 12:00:00 | 8705828 |          3 |  2015 |      6 |  452334 |   861399 |
| 2016-08-07 12:30:00 | 8705828 |          3 |  1957 |      6 |  578200 |   747333 |
| 2016-08-07 13:00:00 | 8705828 |          3 |  1968 |      2 |  173067 |   259600 |
| 2016-08-07 13:30:00 | 8705828 |          3 |  2321 |      6 |  613600 |   877132 |
| 2016-08-07 14:00:00 | 8705828 |          3 |  2263 |      6 |  456267 |   688334 |
| 2016-08-07 14:30:00 | 8705828 |          3 |  2211 |      7 |  558534 |   877133 |
| 2016-08-07 15:00:00 | 8705828 |          3 |  2667 |      6 |  499534 |   908600 |
| 2016-08-07 15:30:00 | 8705828 |          3 |  2632 |      7 |  645066 |  1058065 |
| 2016-08-07 16:00:00 | 8705828 |          3 |  3204 |      7 |  652933 |   936133 |
| 2016-08-07 16:30:00 | 8705828 |          3 |  2667 |      7 |  782733 |  1034466 |
| 2016-08-07 17:00:00 | 8705828 |          3 |  3204 |      6 |  566400 |   896799 |
| 2016-08-07 17:30:00 | 8705828 |          3 |  2593 |      5 |  554600 |   786665 |
| 2016-08-07 18:00:00 | 8705828 |          3 |  2993 |     10 |  900732 |  1341266 |
| 2016-08-07 18:30:00 | 8705828 |          3 |  2525 |      6 |  625399 |   877132 |
| 2016-08-07 19:00:00 | 8705828 |          3 |  2718 |      9 | 1006933 |  1270465 |
| 2016-08-07 19:30:00 | 8705828 |          3 |  3392 |     10 | 1058066 |  1494665 |
| 2016-08-07 20:00:00 | 8705828 |          3 |  3800 |     11 | 1207532 |  1695263 |
| 2016-08-07 20:30:00 | 8705828 |          3 |  3663 |     20 | 2202664 |  2930330 |
| 2016-08-07 21:00:00 | 8705828 |          3 |  4052 |     20 | 1923400 |  2914597 |
| 2016-08-07 21:30:00 | 8705828 |          3 |  3484 |      7 |  723733 |   975467 |
| 2016-08-07 22:00:00 | 8705828 |          3 |  3313 |     16 | 1408135 |  2222332 |
| 2016-08-07 22:30:00 | 8705828 |          3 |  2940 |      8 |  873201 |  1168198 |
| 2016-08-07 23:00:00 | 8705828 |          3 |  2586 |      7 |  684401 |  1054132 |
| 2016-08-07 23:30:00 | 8705828 |          3 |  1821 |      3 |  283200 |   440533 |
| 2016-08-08 00:00:00 | 8705828 |          3 |   661 |      8 |  849600 |  1179998 |
| 2016-08-08 00:30:00 | 8705828 |          3 |   491 |      4 |  456266 |   562466 |
| 2016-08-08 01:00:00 | 8705828 |          3 |   636 |      1 |   86533 |   133733 |
| 2016-08-08 01:30:00 | 8705828 |          3 |   511 |      0 |       0 |        0 |
| 2016-08-08 02:00:00 | 8705828 |          3 |   484 |      1 |   70800 |   106200 |
| 2016-08-08 02:30:00 | 8705828 |          3 |   362 |      1 |   94400 |   118000 |
| 2016-08-08 03:00:00 | 8705828 |          3 |   365 |      1 |  121933 |   157333 |
| 2016-08-08 03:30:00 | 8705828 |          3 |   460 |      2 |  169133 |   302866 |
| 2016-08-08 04:00:00 | 8705828 |          3 |   538 |      0 |       0 |        0 |
| 2016-08-08 04:30:00 | 8705828 |          3 |   716 |      4 |  361867 |   550667 |
| 2016-08-08 05:00:00 | 8705828 |          3 |  1112 |      0 |       0 |        0 |
| 2016-08-08 05:30:00 | 8705828 |          3 |  1308 |      2 |  169133 |   298933 |
| 2016-08-08 06:00:00 | 8705828 |          3 |  1175 |      3 |  287133 |   424799 |
| 2016-08-08 06:30:00 | 8705828 |          3 |  1699 |      5 |  468066 |   660800 |
| 2016-08-08 07:00:00 | 8705828 |          3 |  2329 |      2 |  212400 |   291067 |
| 2016-08-08 07:30:00 | 8705828 |          3 |  2723 |      6 |  652933 |   892865 |
| 2016-08-08 08:00:00 | 8705828 |          3 |  3167 |      6 |  609666 |   822067 |
| 2016-08-08 08:30:00 | 8705828 |          3 |  3396 |      9 |  645067 |  1274398 |
| 2016-08-08 09:00:00 | 8705828 |          3 |  2293 |      2 |  251733 |   314666 |
| 2016-08-08 09:30:00 | 8705828 |          3 |  2481 |      6 |  700133 |   829932 |
| 2016-08-08 10:00:00 | 8705828 |          3 |  2588 |      5 |  487734 |   672601 |
| 2016-08-08 10:30:00 | 8705828 |          3 |  2541 |      6 |  566399 |   790600 |
| 2016-08-08 11:00:00 | 8705828 |          3 |  2678 |      4 |  409067 |   601799 |
| 2016-08-08 11:30:00 | 8705828 |          3 |  2973 |      6 |  735533 |   924333 |
| 2016-08-08 12:00:00 | 8705828 |          3 |  3344 |     17 | 1903732 |  2517330 |
| 2016-08-08 12:30:00 | 8705828 |          3 |  3228 |      3 |  318600 |   436600 |
| 2016-08-08 13:00:00 | 8705828 |          3 |  2883 |      8 |  759133 |  1105266 |
| 2016-08-08 13:30:00 | 8705828 |          3 |  2708 |      6 |  637201 |   873200 |
| 2016-08-08 14:00:00 | 8705828 |          3 |  1906 |      7 |  700133 |  1018733 |
| 2016-08-08 14:30:00 | 8705828 |          3 |   786 |      1 |  129800 |   157333 |
| 2016-08-08 15:00:00 | 8705828 |          3 |  1250 |      4 |  491666 |   617532 |
| 2016-08-08 15:30:00 | 8705828 |          3 |   879 |      2 |  255667 |   314666 |
| 2016-08-08 16:00:00 | 8705828 |          3 |  1088 |      0 |       0 |        0 |
| 2016-08-08 16:30:00 | 8705828 |          3 |   890 |      3 |  287134 |   471999 |
| 2016-08-08 17:00:00 | 8705828 |          3 |   859 |      1 |  121933 |   157333 |
| 2016-08-08 17:30:00 | 8705828 |          3 |   751 |      5 |  609665 |   786665 |
| 2016-08-08 18:00:00 | 8705828 |          3 |   696 |      2 |  161266 |   255666 |
| 2016-08-08 18:30:00 | 8705828 |          3 |  1009 |      2 |  141600 |   302866 |
| 2016-08-08 19:00:00 | 8705828 |          3 |   779 |      4 |  326466 |   542799 |
| 2016-08-08 19:30:00 | 8705828 |          3 |  1099 |      0 |       0 |        0 |
| 2016-08-08 20:00:00 | 8705828 |          3 |  2279 |      4 |  389401 |   601799 |
| 2016-08-08 20:30:00 | 8705828 |          3 |  2317 |      9 |  711933 |  1081667 |
| 2016-08-08 21:00:00 | 8705828 |          3 |  2502 |     14 | 1207534 |  2061064 |
| 2016-08-08 21:30:00 | 8705828 |          3 |  2908 |     16 | 1475001 |  2273464 |
| 2016-08-08 22:00:00 | 8705828 |          3 |  2345 |      6 |  479867 |   759132 |
| 2016-08-08 22:30:00 | 8705828 |          3 |  1876 |      4 |  318600 |   507399 |
| 2016-08-08 23:00:00 | 8705828 |          3 |  1405 |      4 |  405134 |   542799 |
| 2016-08-08 23:30:00 | 8705828 |          3 |  1146 |      6 |  586067 |   790601 |
| 2016-08-09 00:00:00 | 8705828 |          3 |   708 |      3 |  200601 |   357933 |
| 2016-08-09 00:30:00 | 8705828 |          3 |   493 |      0 |       0 |        0 |
| 2016-08-09 01:00:00 | 8705828 |          3 |   587 |      1 |   74733 |    90467 |
| 2016-08-09 01:30:00 | 8705828 |          3 |   345 |      1 |  110133 |   141600 |
| 2016-08-09 02:00:00 | 8705828 |          3 |   419 |      2 |  267467 |   314666 |
| 2016-08-09 02:30:00 | 8705828 |          3 |   337 |      3 |  279266 |   409066 |
| 2016-08-09 03:00:00 | 8705828 |          3 |   270 |      2 |  232067 |   295000 |
| 2016-08-09 03:30:00 | 8705828 |          3 |   243 |      0 |       0 |        0 |
| 2016-08-09 04:00:00 | 8705828 |          3 |   412 |      0 |       0 |        0 |
| 2016-08-09 04:30:00 | 8705828 |          3 |   716 |      1 |   98333 |   157333 |
| 2016-08-09 05:00:00 | 8705828 |          3 |  1344 |      4 |  436601 |   586067 |
| 2016-08-09 05:30:00 | 8705828 |          3 |   962 |      4 |  322533 |   570334 |
| 2016-08-09 06:00:00 | 8705828 |          3 |  1048 |      2 |  145533 |   279266 |
| 2016-08-09 06:30:00 | 8705828 |          3 |  1216 |      4 |  338266 |   483800 |
| 2016-08-09 07:00:00 | 8705828 |          3 |  1346 |      5 |  401200 |   652933 |
| 2016-08-09 07:30:00 | 8705828 |          3 |  2024 |      5 |  432667 |   751266 |
| 2016-08-09 08:00:00 | 8705828 |          3 |  2249 |      8 |  829933 |  1065932 |
| 2016-08-09 08:30:00 | 8705828 |          3 |  2315 |     10 |  826000 |  1199668 |
| 2016-08-09 09:00:00 | 8705828 |          3 |  2785 |      4 |  302866 |   491668 |
| 2016-08-09 09:30:00 | 8705828 |          3 |  3264 |      9 | 1010867 |  1329466 |
| 2016-08-09 10:00:00 | 8705828 |          3 |  3040 |      6 |  629332 |   865333 |
| 2016-08-09 10:30:00 | 8705828 |          3 |  3162 |      6 |  645068 |   853532 |
| 2016-08-09 11:00:00 | 8705828 |          3 |  2081 |     11 |  944000 |  1530066 |
| 2016-08-09 11:30:00 | 8705828 |          3 |  2762 |     12 | 1179999 |  1659865 |
| 2016-08-09 12:00:00 | 8705828 |          3 | 10813 |     10 |  810267 |  1290133 |
| 2016-08-09 12:30:00 | 8705828 |          3 | 20139 |     13 | 1085600 |  1699198 |
| 2016-08-09 13:00:00 | 8705828 |          3 | 16277 |     15 | 1329465 |  2104331 |
| 2016-08-09 13:30:00 | 8705828 |          3 | 18826 |     18 | 1502535 |  2328533 |
| 2016-08-09 14:00:00 | 8705828 |          3 | 16313 |     19 | 1797535 |  2635329 |
| 2016-08-09 14:30:00 | 8705828 |          3 | 23275 |     14 | 1325534 |  1919464 |
| 2016-08-09 15:00:00 | 8705828 |          3 | 30542 |      8 |  829934 |  1101332 |
| 2016-08-09 15:30:00 | 8705828 |          3 | 36747 |     18 | 1471065 |  2175136 |
| 2016-08-09 16:00:00 | 8705828 |          3 | 39344 |     25 | 2053200 |  3111263 |
| 2016-08-09 16:30:00 | 8705828 |          3 | 48913 |      9 |  888934 |  1262599 |
| 2016-08-09 17:00:00 | 8705828 |          3 | 37162 |     13 | 1006934 |  1651999 |
| 2016-08-09 17:30:00 | 8705828 |          3 | 38927 |     19 | 1675602 |  2485864 |
| 2016-08-09 18:00:00 | 8705828 |          3 | 29149 |     14 | 1423868 |  1962733 |
| 2016-08-09 18:30:00 | 8705828 |          3 | 24980 |     15 | 1400268 |  1903733 |
| 2016-08-09 19:00:00 | 8705828 |          3 | 27051 |     23 | 2245932 |  3280396 |
| 2016-08-09 19:30:00 | 8705828 |          3 | 28118 |     16 | 1349133 |  1950932 |
| 2016-08-09 20:00:00 | 8705828 |          3 | 40494 |     27 | 2584201 |  3787795 |
| 2016-08-09 20:30:00 | 8705828 |          3 | 41540 |     20 | 1777867 |  2647131 |
| 2016-08-09 21:00:00 | 8705828 |          3 | 38030 |     24 | 2273468 |  3237131 |
| 2016-08-09 21:30:00 | 8705828 |          3 | 35539 |     23 | 2037466 |  2981466 |
| 2016-08-09 22:00:00 | 8705828 |          3 | 36751 |     27 | 2458335 |  3713063 |
| 2016-08-09 22:30:00 | 8705828 |          3 | 36280 |     24 | 2265599 |  3366931 |
| 2016-08-09 23:00:00 | 8705828 |          3 | 32385 |     23 | 2131869 |  3099464 |
| 2016-08-09 23:30:00 | 8705828 |          3 | 29073 |     14 | 1227198 |  1675599 |
| 2016-08-10 00:00:00 | 8705828 |          3 | 20668 |      7 |  751267 |  1018732 |
| 2016-08-10 00:30:00 | 8705828 |          3 | 15052 |      6 |  613599 |   904665 |
| 2016-08-10 01:00:00 | 8705828 |          3 | 10012 |      9 |  818133 |  1172131 |
| 2016-08-10 01:30:00 | 8705828 |          3 |  9716 |      4 |  330400 |   468066 |
| 2016-08-10 02:00:00 | 8705828 |          3 |  8548 |      5 |  428733 |   586066 |
| 2016-08-10 02:30:00 | 8705828 |          3 |  8468 |      4 |  342200 |   531000 |
+---------------------+---------+------------+-------+--------+---------+----------+
381 rows in set (0.25 sec)


mysql> select * from AutoBudgetOrder where orderid = 8705828\G
*************************** 1. row ***************************
         OrderID: 8705828
  FirstStartTime: 2016-04-06 11:50:00
       StartTime: 2016-06-30 03:55:00
       LimitWeek: 3933333333
    LimitWeekCur: 1180000000
   LimitDayMoney: 0
LimitDayMoneyCur: 0
         MaxCost: 157333
      MaxCostCur: 40000
         AvgCost: 0
      AvgCostCur: 0
          AvgCPA: 0
       AvgCPACur: 0
        ROILevel: 0
          GoalID: 1745776
 LimitWeekClicks: 0
            Type: 3
    ContextLimit: 0
         Testing: 0
        Problems: 2
       DayWeight: 333333
    RegularSpent: 0
TransportDelayed: 0
    GenerateBids: 0
    OptimizeType: 1
   ReserveReturn: 0
   Profitability: 0
            Easy: 0
         Options:
  ChosenStrategy: cpc
1 row in set (0.00 sec)

exportid = 17845997


+----------+
| count(*) |
+----------+
|   179995 |
+----------+
1 row in set (0.19 sec)

mysql> select count(*) from Banner44 where OrderID = 8705828 ;
+----------+
| count(*) |
+----------+
|   335714 |
+----------+
1 row in set (0.06 sec)


mysql> select CutName,CutValue,Evaluation,TargetName,FirstPeriodValue,SecondPeriodValue from AnomaliesAnalyzerResults where TaskID = 8220 and CutName = 'Age' and Reasoner=5 and TargetName = 'Clicks';
+---------+----------+----------------------+------------+------------------+-------------------+
| CutName | CutValue | Evaluation           | TargetName | FirstPeriodValue | SecondPeriodValue |
+---------+----------+----------------------+------------+------------------+-------------------+
| Age     | -1       |    0.131112485669966 | Clicks     |          6031454 |           4640224 |
| Age     | 0        | 0.000015546820546497 | Clicks     |           385915 |            385927 |
| Age     | 1        |   0.0366079358661393 | Clicks     |           505764 |            544184 |
| Age     | 2        |  0.00922511390663416 | Clicks     |          3711973 |           3644114 |
| Age     | 3        |   0.0832960005712442 | Clicks     |          1277610 |           1509207 |
| Age     | 4        |   0.0405889171263718 | Clicks     |          3993143 |           4330819 |
+---------+----------+----------------------+------------+------------------+-------------------+
6 rows in set (0.00 sec)

  DB<7> x _first_cut_entropy($params, $evaluation_by);
0  1.45669559561928

  DB<8> x abs(log_diff($params, $cut_id, $evaluation_by))/ max(2, -0.441184 + 0.518664 * $entropy - 0.0122656 * $entropy ** 2);
0  0.131112485669966

  DB<9> x log_diff($params, $cut_id, $evaluation_by)
0  '-0.262224971339933'

  DB<13> x $relation
0  0.251048560156355


  DB<14> x $target_sum
0  15905859


>>> 6031454 + 385915 + 505764 + 3711973 + 1277610 + 3993143
15905859
>>> entropy = sum((-math.log(x / 15905859) * x / 15905859 for x in (6031454.,385915.,505764.,3711973.,1277610.,3993143.)))
>>> entropy
1.4566955956192773
>>> log_diff = math.log(6031454./4640224)
>>> log_diff
0.262225468432352
>>> ratio = -0.441184 + 0.518664 * entropy - 0.0122656 * entropy ** 2
>>> ratio
0.28832442658403407
>>> log_diff / max(2, ratio)
0.131112734216176


values (':ffff:193.41.62.158','::ffff:193.41.62.158',6, 'moblie'), (..), (..);


this.sliceFields
sudo apt-get install yandex-yt-perl=18.4.20514-prestable~dfd8a22 yandex-yt-perl-18.4=18.4.20514-prestable~dfd8a22 yandex-yt=18.4.20514-prestable~dfd8a22 yandex-yt-http-proxy=18.4.20514-prestable~dfd8a22 nodejs=0.8.26-yandex1 yandex-yt-local=0.0.21-0

yandex-yt 18.4.20514-prestable~dfd8a22

sudo apt-get install yabs-yt-api=000.116 yabs-yt-standalone-conf=000.19 yabs-yt-standalone-conf-18.4=000.19 yandex-yt=18.4.20514-prestable~dfd8a22 yandex-yt-http-proxy=18.4.20514-prestable~dfd8a22 yandex-yt-local=0.0.42-0 yandex-yt-perl=18.4.20514-prestable~dfd8a22 yandex-yt-perl-17.2=0.17.2-stable~6339+212e585 yandex-yt-perl-17.3=0.17.3-stable~6440~8420aea yandex-yt-perl-17.4=0.17.4-stable~7869~955494f yandex-yt-perl-17.5=0.17.5-stable~8581~e377122 yandex-yt-perl-18.4=18.4.20514-prestable~dfd8a22 yandex-yt-python=0.7.12-0 yandex-yt-python-tools=0.2.93-0 yandex-yt-python-yson=0.2.24-0 yandex-yt-transfer-manager-client=0.0.18-0



r032-alter-offer-url-dict.pl OK
YTOfferUrlDict.pm OK
YTOrderCounter.pm
/Yabs/LoadAppsFromStaticYT.pm
load-apps-from-static-yt.pl
//yabs/Dicts/StoreApplication { name: Goal, type: string } OK
//yabs/Dicts/Hosts NOT OK
//yabs/Dicts/EngineHosts NOT OK
YTDSPModerationDayMonitoring.pm OK
Yabs/Stat/Collectors/YTDSPObjectStat.pm OK
//yabs/DSP/DSPModerationBannerXXQueue


orderid = 7845145
ABVWForecasterPPC
AutoBudgetForecasterAvgAPC

mysql> select avg(PPC1), avg(PPC2) from ABVWForecasterPPC where orderid = 7845145;
+-----------+-----------+
| avg(PPC1) | avg(PPC2) |
+-----------+-----------+
|    2.7000 |    3.7000 |
+-----------+-----------+
1 row in set (0.01 sec)

mysql> select * from AutoBudgetForecasterAvgAPC where orderid = 7845145;
+---------+---------------------+-------+---------+----------------+
| OrderID | UpdateTime          | APC   | PPC     | ExperimentBits |
+---------+---------------------+-------+---------+----------------+
| 7845145 | 2016-08-16 14:11:00 | 14735 | 1706313 |              0 |
+---------+---------------------+-------+---------+----------------+
1 row in set (0.00 sec)

mysql> select avg(PPC1), avg(PPC2) from ABVWForecasterPPC where orderid = 5735714;
+-----------+-----------+
| avg(PPC1) | avg(PPC2) |
+-----------+-----------+
| 3081.2273 | 3507.7000 |
+-----------+-----------+
1 row in set (0.00 sec)

mysql> select * from AutoBudgetForecasterAvgAPC where orderid = 5735714;
+---------+---------------------+--------+-------+----------------+
| OrderID | UpdateTime          | APC    | PPC   | ExperimentBits |
+---------+---------------------+--------+-------+----------------+
| 5735714 | 2015-10-08 16:18:00 | 118040 | 13227 |              0 |
+---------+---------------------+--------+-------+----------------+
1 row in set (0.00 sec)


mysql> select orderid,contenttype from OrderInfo  where orderid in (5735714,7845145);
+---------+-------------+
| orderid | contenttype |
+---------+-------------+
| 5735714 |             |
| 7845145 | performance |
+---------+-------------+
2 rows in set (0.01 sec)

=====

bstat18
mysql> select * from ABVWForecasterPPC where BannerID = 763251304 and PhraseID = 354652364;
+---------+-----------+-----------+-------------+-------+-------+
| OrderID | BannerID  | PhraseID  | ContextType | PPC1  | PPC2  |
+---------+-----------+-----------+-------------+-------+-------+
| 5735714 | 763251304 | 354652364 |           1 | 57369 | 65306 |
+---------+-----------+-----------+-------------+-------+-------+
1 row in set (0.01 sec)

bstat31
mysql> select * from ABVWForecasterPPC where bannerid = 1230307839 and PhraseID = 10363;
+---------+------------+----------+-------------+------+------+
| OrderID | BannerID   | PhraseID | ContextType | PPC1 | PPC2 |
+---------+------------+----------+-------------+------+------+
| 7845145 | 1230307839 |    10363 |           8 |    4 |    6 |
+---------+------------+----------+-------------+------+------+
1 row in set (0.00 sec)

1230307832
10356



orderid = 10775124
bannerid = 2304620786
basenos = 100

[Serial] > exec bstat100.* mysql -uroot yabsdb -e 'select ContextPriority,UpdateTime from Banner100 where BannerID = 2304620786'

=== bstat100i.yandex.ru (@sas-1-1-1), 1/3 ===
ContextPriority	UpdateTime
10	2016-08-16 13:33:18

=== bstat100f.yandex.ru (@myt6), 2/3 ===
ContextPriority	UpdateTime
10	2016-08-16 13:33:18

=== bstat100h.yandex.ru (@ugr6), 3/3 ===
ContextPriority	UpdateTime
10	2016-08-16 13:33:18

[yabs_common_read@seneca-fin] yt> select * from [//yabs/Dicts/Banner] where BannerID = 2304620786u ;
.-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------.
| BannerHash           | BannerID   | GroupExportID | OrderID  | ParentExportID | ExportID   | EngineID | ContextPriority | OptionMobileApp | OptionDynamicTemplate | OptionPerformance | UpdateTime | Lang |
+----------------------+------------+---------------+----------+----------------+------------+----------+-----------------+-----------------+-----------------------+-------------------+------------+------+
| 10031578458846726794 | 2304620786 |    1815269062 | 10775124 |     2655044550 | 2655044550 |        7 |              10 |                 |                       |                   | 1471343598 |      |
'----------------------+------------+---------------+----------+----------------+------------+----------+-----------------+-----------------+-----------------------+-------------------+------------+------'

[yabs_common_read@seneca-fin] yt>
 production environment
olegts@bsyt01k:/mnt/raid/home/olegts$ yabs-yt -h seneca-sas
YT perl client
type: connect <anthill>; to establish connect to cluster
known commands: connect, get, list, select
2016/08/16 16:03:55 902909 INFO  [_yt_connection] Redefining abi_version to 18_4
[yabs_common_read@seneca-sas] yt> select * from [//yabs/Dicts/Banner] where BannerID = 2304620786u ;
.-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------.
| BannerHash           | BannerID   | GroupExportID | OrderID  | ParentExportID | ExportID   | EngineID | ContextPriority | OptionMobileApp | OptionDynamicTemplate | OptionPerformance | UpdateTime | Lang |
+----------------------+------------+---------------+----------+----------------+------------+----------+-----------------+-----------------+-----------------------+-------------------+------------+------+
| 10031578458846726794 | 2304620786 |    1815269062 | 10775124 |     2655044550 | 2655044550 |        7 |               0 |                 |                       |                   | 1471343598 |      |
'----------------------+------------+---------------+----------+----------------+------------+----------+-----------------+-----------------+-----------------------+-------------------+------------+------'



autobudget.pl:my $host = GetHost();
Yabs/AutoBudget/Constants.pm:   my $host = shift || GetHost();
Yabs/DProcess/CustomSubs/AutoBudget.pm: my $host = GetHost()
Yabs/DProcess/CustomSubs/AutoBudget.pm: or return N_ERROR "GetHost() failed";


var diversities = [];
$($('table').find('tr')).each(function(undefined, element) {
	console.log(element);

	if ($(element).find('td')[0]) {
		diversities.push($($(element).find('td')[0]).html());
	}
});

diversities.join(',')

OrderID_BannerID_PhraseID_ContextType_RegionID_PageID_TypeID_ResourceNo_PageNo_DeviceType_Gender_Age_CoefGoalContextID_TargetPhraseID_DetailedDeviceType_ConnectionType
yt/bstat
10022411_1888624721_14979954302753895172_3_213_172351_2_0_1_6_0_1_0_0_33_0

diff <(cat file1.txt |grep fin| sed 's/fin//g' | sort) <(cat file1.txt |grep sas| sed 's/sas//g' | sort)


1) TargetPhraseID = 0

[yabs_common_read@alyx] yt> select Shows from [//yabs/OrderCounter] where OrderID=10022411 and BannerID=1888624721 and PhraseID=14979954302753895172u and ContextType=3 and RegionID=213 and PageID=172351 and TypeID=2 and ResourceNo=0 and PageNo=1 and DeviceType=6 and Gender=0 and Age=1 and CoefGoalContextID=0 and TargetPhraseID=0u and DetailedDeviceType=33u and ConnectionType=0u and UpdateTime = 1470862800 ;
.-------.
| Shows |
+-------+
|     1 |
'-------'

:) select TargetPhraseID,Shows from OrderCounter where OrderID = 10022411 and EventDate = '2016-08-11' and BannerID=1888624721 and PhraseID=14979954302753895172 and ContextType=3 and RegionID=213 and PageID=172351 and TypeID=2 and ResourceNo=0 and PageNo=1 and DeviceType=6 and Gender=0 and Age=1 and CoefGoalContextID=0  and DetailedDeviceType=33 and ConnectionType=0\G

SELECT
    TargetPhraseID,
    Shows
FROM OrderCounter
WHERE (OrderID = 10022411) AND (EventDate = '2016-08-11') AND (BannerID = 1888624721) AND (PhraseID = 14979954302753895172) AND (ContextType = 3) AND (RegionID = 213) AND (PageID = 172351) AND (TypeID = 2) AND (ResourceNo = 0) AND (PageNo = 1) AND (DeviceType = 6) AND (Gender = 0) AND (Age = 1) AND (CoefGoalContextID = 0) AND (DetailedDeviceType = 33) AND (ConnectionType = 0)

Row 1:
──────
TargetPhraseID: 1227111541
Shows:          1

1 rows in set. Elapsed: 0.015 sec. Processed 32.77 thousand rows, 2.29 MB (2.23 million rows/s., 156.19 MB/s.)

2)



mysql> desc ContentResource
    -> ;
+----------------+------------+------+-----+---------+----------------+
| Field          | Type       | Null | Key | Default | Extra          |
+----------------+------------+------+-----+---------+----------------+
| ContentGroupID | bigint(20) | NO   | PRI | NULL    | auto_increment |
| ResourceNo     | int(11)    | NO   | PRI | NULL    |                |
| Value          | blob       | YES  |     | NULL    |                |
+----------------+------------+------+-----+---------+----------------+
3 rows in set (0.02 sec)

mysql> desc ContentTemplate;
+---------------+------------+------+-----+---------+----------------+
| Field         | Type       | Null | Key | Default | Extra          |
+---------------+------------+------+-----+---------+----------------+
| ContentTypeID | bigint(20) | NO   | PRI | NULL    | auto_increment |
| ResourceNo    | bigint(20) | NO   | PRI | NULL    |                |
| Description   | blob       | YES  |     | NULL    |                |
| Type          | blob       | YES  |     | NULL    |                |
+---------------+------------+------+-----+---------+----------------+
4 rows in set (0.01 sec)


https://st.yandex-team.ru/BSDEV-58321


ABVWForecasterAPC
AutoBudgetForecasterAPC
AutoBudgetForecasterCTR
ABVWForecasterPPC
AutoBudgetForecasterCTRMedia

1) AutoBudgetForecasterAPC OK
  - AutoBudgetForecasterStat
  - AutoBudgetSearchConvStat
2) AutoBudgetForecasterCTR OK
  - AutoBudgetForecasterStat
3) ABVWForecasterAPC, ABVWForecasterPPC
  - model
4) AutoBudgetForecasterCTRMedia OK
  - AutoBudgetForecasterStat

AutoBudgetForecasterStat (BannerID, PhraseID) -- есть рестарт и еще таблица AutoBudgetIntentForecasterStat
AutoBudgetSearchConvStat -- (BannerID, PhraseID) в Автобюджете


http://bsgraphite.yandex-team.ru/render/?width=586&height=308&_salt=1422526600.642&target=maxSeries(one_hour.bsint*.bsdb.currency.980.mon)&target=maxSeries(one_hour.bsint*.bsdb.currency.840.mon)&target=maxSeries(one_hour.bsint*.bsdb.currency.398.mon)&target=maxSeries(one_hour.bsint*.bsdb.currency.756.mon)&target=maxSeries(one_hour.bsint*.bsdb.currency.978.mon)&target=maxSeries(one_hour.bsint*.bsdb.currency.643.mon)&target=maxSeries(one_hour.bsint*.bsdb.currency.949.mon)

==

mysql> desc ContentVersion;
+------------------+---------------------+------+-----+---------+----------------+
| Field            | Type                | Null | Key | Default | Extra          |
+------------------+---------------------+------+-----+---------+----------------+
| ContentVersionID | bigint(20) unsigned | NO   | PRI | NULL    | auto_increment |
| Comment          | blob                | YES  |     | NULL    |                |
| AgreementID      | bigint(20) unsigned | NO   |     | 0       |                |
+------------------+---------------------+------+-----+---------+----------------+
3 rows in set (0.03 sec)

AggreemntID = 0
Comment

mysql> desc InputStream;
+------------------+---------------------+------+-----+---------+----------------+
| Field            | Type                | Null | Key | Default | Extra          |
+------------------+---------------------+------+-----+---------+----------------+
| InputStreamID    | bigint(20) unsigned | NO   | PRI | NULL    | auto_increment |
| ContentVersionID | bigint(20) unsigned | NO   |     | 0       |                |
| Data             | blob                | NO   |     | NULL    |                |
| Master           | bigint(20) unsigned | YES  |     | NULL    |                |
| EncoderStartTS   | blob                | YES  |     | NULL    |                |
+------------------+---------------------+------+-----+---------+----------------+
5 rows in set (0.01 sec)

1) смотрим есть ли такая data в InputSteam.Data
2) Если есть, берем ContentVersionID
3) Если нет, заводим новый ContentVersionID в ContentVersion( AgreementID = 0 , Comment = "")
4) заполняем InputStream Master = 0, EncoderStartTS = ""

Сб. авг. 20 16:19:45 MSK 2016
[Sat Aug 20 16:19:46.032893 2016] [core:notice] [pid 109151] AH00051: child pid 319611 exit signal Segmentation fault (11), possible coredump in /coredumps/
2016/08/20 16:19:46 322599 INFO  [/var/www/yabs-interface/export/direct-aggregated-stat-uni.cgi] Started


 bstat16h.yandex.ru: 				O.OrderID not in (4636437,6562859,8438124,8726540,9935115,10018508,10215920,10218373,10221034,10235576)
 bstat06h.yandex.ru: 				O.OrderID not in (5490700,7508832,8156485,10130731,10236820,10317609)
bstat112h.yandex.ru: 				O.OrderID not in (4636437,6562859,8438124,8726540,9935115,10018508,10215920,10218373,10221034,10235576)
bstat112f.yandex.ru: 				O.OrderID not in (4636437,6562859,8438124,8726540,9935115,10018508,10215920,10218373,10221034,10235576)
 bstat14f.yandex.ru: 				O.OrderID not in (4636437,6562859,8438124,8726540,9935115,10018508,10215920,10218373,10221034,10235576)
bstat112i.yandex.ru: 				O.OrderID not in (4636437,6562859,8438124,8726540,9935115,10018508,10215920,10218373,10221034,10235576)
 bstat16f.yandex.ru: 				O.OrderID not in (4636437,6562859,8438124,8726540,9935115,10018508,10215920,10218373,10221034,10235576)
 bstat06f.yandex.ru: 				O.OrderID not in (5490700,7508832,8156485,10130731,10236820,10317609)
 bstat14h.yandex.ru: 				O.OrderID not in (4636437,6562859,8438124,8726540,9935115,10018508,10215920,10218373,10221034,10235576)
 bstat16i.yandex.ru: 				O.OrderID not in (4636437,6562859,8438124,8726540,9935115,10018508,10215920,10218373,10221034,10235576)
 bstat06i.yandex.ru: 				O.OrderID not in (5490700,7508832,8156485,10130731,10236820,10317609)
 bstat14i.yandex.ru: 				O.OrderID not in (4636437,6562859,8438124,8726540,9935115,10018508,10215920,10218373,10221034,10235576)


=====

mysql> select * from RotatePhrasePriceChangeLog201608241020110024 where UpdateCopyFromOrderID > 0 limit 1\G
*************************** 1. row ***************************
                 UpdateTime: 2016-08-24 13:19:53
                    OrderID: 5172554
                   BannerID: 585368527
              GroupExportID: 658692902
                   PhraseID: 1337955790
                ContextType: 1
                 UpdateCost: 1
                       Cost: 756000
             UpdateFlatCost: 1
                   FlatCost: 3000
              UpdateAvgCost: 0
                    AvgCost: 0
               UpdateAvgCPA: 0
                     AvgCPA: 0
                 UpdateHits: 1
                       Hits: 23858
                UpdatePCTR0: 0
                      PCTR0: 0
      UpdateCopyFromOrderID: 1
            CopyFromOrderID: 5172554
UpdateCopyFromGroupExportID: 1
      CopyFromGroupExportID: 658692902
     UpdateCopyFromBannerID: 1
           CopyFromBannerID: 585368527
     UpdateCopyFromPhraseID: 1
           CopyFromPhraseID: 1337943801
              EnableOptions: autobroker,currency
             DisableOptions:
1 row in set (0.00 sec)


mysql> select * from RotatePhrasePriceChangeLog201608241111080012 where CopyFromOrderID > 0 limit 1\G
*************************** 1. row ***************************
                 UpdateTime: 2016-08-24 14:11:04
                    OrderID: 10251367
                   BannerID: 1979255690
              GroupExportID: 1648333548
                   PhraseID: 1338098920
                ContextType: 1
                 UpdateCost: 1
                       Cost: 550000
             UpdateFlatCost: 1
                   FlatCost: -1
              UpdateAvgCost: 0
                    AvgCost: 0
               UpdateAvgCPA: 0
                     AvgCPA: 0
                 UpdateHits: 1
                       Hits: 9
                UpdatePCTR0: 0
                      PCTR0: 0
      UpdateCopyFromOrderID: 1
            CopyFromOrderID: 10251367
UpdateCopyFromGroupExportID: 1
      CopyFromGroupExportID: 1648333548
     UpdateCopyFromBannerID: 1
           CopyFromBannerID: 1979255690
     UpdateCopyFromPhraseID: 1
           CopyFromPhraseID: 1255180524
              EnableOptions: autobroker,currency
             DisableOptions:
1 row in set (0.01 sec)


по mtlog у нас ничего не заметно (количество визитов по часам за сегодня у которых есть достижения целей):
:) select toHour(StartTime) as hour, sum(Sign) from visits_all where StartDate = today() and ((TraficSourceID = 3 and AdvEngineID = 1 and ClickLogID != 0) OR (LastSignificantTraficSourceID = 3 AND LastSignificantTraficSourceAdvEngineID = 1 and LastSignificantTraficSourceClickLogID != 0) OR (length(TraficSource.ID) != 0 and TraficSource.ID[1] = 3 and TraficSource.AdvEngineID[1] = 1 and TraficSource.PlaceID[1] != 0)) and length(Goals.ID) != 0 group by hour order by hour asc;

SELECT
    toHour(StartTime) AS hour,
    sum(Sign)
FROM visits_all
WHERE (StartDate = today()) AND (((TraficSourceID = 3) AND (AdvEngineID = 1) AND (ClickLogID != 0)) OR ((LastSignificantTraficSourceID = 3) AND (LastSignificantTraficSourceAdvEngineID = 1) AND (LastSignificantTraficSourceClickLogID != 0)) OR ((length(TraficSource.ID) != 0) AND (TraficSource.ID[1] = 3) AND (TraficSource.AdvEngineID[1] = 1) AND (TraficSource.PlaceID[1] != 0))) AND (length(Goals.ID) != 0)
GROUP BY hour
ORDER BY hour ASC

┌─hour─┬─sum(Sign)─┐
│    0 │    146331 │
│    1 │     81181 │
│    2 │     51427 │
│    3 │     43634 │
│    4 │     53337 │
│    5 │     76419 │
│    6 │    128878 │
│    7 │    200193 │
│    8 │    307160 │
│    9 │    411229 │
│   10 │    460576 │
│   11 │    486184 │
│   12 │    483109 │
│   13 │    480220 │
│   14 │    482847 │
│   15 │    473645 │
│   16 │    461449 │
│   17 │    413633 │
│   18 │    370034 │
│   19 │    369036 │
│   20 │    390510 │
│   21 │    294271 │
│   22 │     20086 │
│   23 │     14062 │
└──────┴───────────┘

24 rows in set. Elapsed: 1.889 sec. Processed 2.43 billion rows, 116.12 GB (1.29 billion rows/s., 61.48 GB/s.)


3)
task_id 232 -- тяжелая задача bsyeti, надо спросить как справится с ней megagraphite
https://bs.mega-graphite.search.yandex.net/render/?width=588&height=312&_salt=1423067035.565&target=alias(%20divideSeries(%20averageSeries(groupByNode(five_min.bsyeti*_yandex_ru.profiler.accumulated_importance.processed.*.avg,%201,%20"sumSeries")),%20averageSeries(groupByNode(five_min.bsyeti*_yandex_ru.profiler.accumulated_importance.max.*.avg,%201,%20"sumSeries"))%20),%20"processed"%20)



 #|

|| TargetType | BaseNo | RShows | RClicks | RCost | RActions ||
|| 0 | 50 | 0.98573685 | 1.01712140 | 0.97756668 | 0.97744361 ||
|| 0 | 51 | 1.05706877 | 1.01584990 | 1.01375632 | 1.18243243 ||
|| 0 | 52 | 0.96482908 | 0.95945903 | 0.98460750 | 0.97767857 ||
|| 0 | 53 | 0.93853328 | 1.01057329 | 1.01179748 | 1.07894737 ||
|| 0 | 54 | 0.93668941 | 0.97426999 | 0.98962847 | 1.01492537 ||
|| 0 | 55 | 0.98902176 | 1.01861171 | 1.00903574 | 0.90249433 ||
|| 0 | 56 | 0.99455284 | 1.00858671 | 1.03328634 | 0.95275591 ||
|| 0 | 57 | 0.98943587 | 0.99474564 | 1.02588585 | 0.85046729 ||
|| 0 | 58 | 1.07944720 | 1.10125243 | 1.16000432 | 1.46280992 ||
|| 0 | 59 | 0.98484459 | 0.96926292 | 1.01187389 | 0.90298507 ||
|| 1 | 50 | 0.98657293 | 1.03353911 | 0.95168151 | 0.52592593 ||
|| 1 | 51 | 0.85893515 | 0.92409975 | 0.85664709 | 0.83520599 ||
|| 1 | 52 | 0.83018372 | 0.95416549 | 0.72375180 | 0.48500000 ||
|| 1 | 53 | 0.92163166 | 1.13072007 | 0.97790662 | 1.50902527 ||
|| 1 | 54 | 0.87982043 | 0.97112007 | 0.90140751 | 0.14629948 ||
|| 1 | 55 | 0.99744652 | 1.10574673 | 1.02187668 | 1.52083333 ||
|| 1 | 56 | 0.91062485 | 0.93703217 | 0.847 45560 | 0.39398496 ||
|| 1 | 57 | 0.95495060 | 1.13603833 | 1.08821373 | 0.74899598 ||
|| 1 | 58 | 1.02255281 | 1.19480156 | 1.07461636 | 1.56461538 ||
|| 1 | 59 | 1.02834152 | 1.11702955 | 1.00254432 | 1.08080808 ||
d|#


=======

1)
:) select EventDate, sum(Shows), sum(Clicks), sum(Cost) from OrderCounter where OrderID =10814120 group by EventDate;

SELECT
    EventDate,
    sum(Shows),
    sum(Clicks),
    sum(Cost)
FROM OrderCounter
WHERE OrderID = 10814120
GROUP BY EventDate

┌──EventDate─┬─sum(Shows)─┬─sum(Clicks)─┬─sum(Cost)─┐
│ 2016-08-25 │         11 │           0 │         0 │
│ 2016-08-26 │      23039 │          37 │    370000 │
│ 2016-08-27 │      26298 │          49 │    490000 │
│ 2016-08-28 │      27733 │          44 │    450000 │
│ 2016-08-29 │       1317 │           3 │     30000 │
└────────────┴────────────┴─────────────┴───────────┘
→ Progress: 230.44 thousand rows, 5.07 MB (11.96 million rows/s., 263.04 MB/s.)
5 rows in set. Elapsed: 0.019 sec. Processed 230.44 thousand rows, 5.07 MB (11.93 million rows/s., 262.46 MB/s.)

mysql> select date(UpdateTime), sum(Shows),sum(Clicks),sum(Cost) from OrderTargetStat where orderid = 10814120 group by date(UpdateTime);
+------------------+------------+-------------+-----------+
| date(UpdateTime) | sum(Shows) | sum(Clicks) | sum(Cost) |
+------------------+------------+-------------+-----------+
| 2016-08-25       |         11 |           0 |         0 |
| 2016-08-26       |      23039 |          37 |    370000 |
| 2016-08-27       |      26298 |          49 |    490000 |
| 2016-08-28       |      27733 |          44 |    450000 |
| 2016-08-29       |       1338 |           3 |     30000 |
+------------------+------------+-------------+-----------+
5 rows in set (0.01 sec)


mysql> select * from AutoBudgetOrder where orderid = 10814120\G
*************************** 1. row ***************************
         OrderID: 10814120
  FirstStartTime: 2016-08-25 09:20:00
UG
       StartTime: 2016-08-26 10:45:00
       LimitWeek: 123456000000
    LimitWeekCur: 0
   LimitDayMoney: 0
LimitDayMoneyCur: 0
         MaxCost: 0
      MaxCostCur: 0
         AvgCost: 0
      AvgCostCur: 0
          AvgCPA: 0
       AvgCPACur: 0
        ROILevel: 0
          GoalID: 1138405
 LimitWeekClicks: 0
            Type: 3
    ContextLimit: 35
         Testing: 0
        Problems: 0
       DayWeight: 333333
    RegularSpent: 0
TransportDelayed: 0
    GenerateBids: 1
    OptimizeType: 1
   ReserveReturn: 0
   Profitability: 0
            Easy: 0
         Options:
  ChosenStrategy: cpc
1 row in set (0.00 sec)
mysql> select bannerid,phraseid,contexttype,resultcost,resultflatcost from PhrasePrice where orderid=10814120;
+------------+----------+-------------+------------+----------------+
| bannerid   | phraseid | contexttype | resultcost | resultflatcost |
+------------+----------+-------------+------------+----------------+
| 2378936318 |        9 |           9 |      10000 |          10000 |
+------------+----------+-------------+------------+----------------+
1 row in set (0.00 sec)


mysql> select bannerid,phraseid,contexttype,AvgCost/1e6,AvgCPA/1e6 from PhrasePrice where OrderID = 9050631 and bannerid = 1734942131 and !find_in_set('deleted', Options);
+------------+----------+-------------+-------------+------------+
| bannerid   | phraseid | contexttype | AvgCost/1e6 | AvgCPA/1e6 |
+------------+----------+-------------+-------------+------------+
| 1734942131 |    17404 |           8 |         0.3 |          0 |
+------------+----------+-------------+-------------+------------+
1 row in set (0.00 sec)


======


mysql> select baseno, sum(Clicks* (UpdateTime = '2016-08-29 16:00:00')) - sum(Clicks * (UpdateTime = '2016-08-22 16:00:00')) as ClicksDiff,sum(Cost/1e6* (UpdateTime = '2016-08-29 16:00:00')) - sum(Cost/1e6 * (UpdateTime = '2016-08-22 16:00:00')) as CostDiff from AutoBudgetMonitoringStat201608 where UpdateTime in ('2016-08-29 16:00:00', '2016-08-22 16:00:00')  and LimitDayMoney = 0 and NetCPC = 0 and Experiment=0 and LimitWeek = 1 and LimitWeekClicks=0 and AvgCost = 0 and AvgCPA = 0 and ROILevel = 0 and GoalID = 0 and RegularSpent = 0 and ContextType = 1 group by 1 order by 2 desc ;
+--------+------------+---------------------+
| baseno | ClicksDiff | CostDiff            |
+--------+------------+---------------------+
|     34 |        555 |  116.39465800000005 |
|     27 |        277 |  165.79648600000002 |
|     22 |        261 |   84.47490300000004 |
|     70 |        256 |   80.67684399999996 |
|     66 |        244 |   87.92077999999998 |
|     41 |        242 |  133.48396599999995 |
|     88 |        236 |  133.65592900000007 |
|     57 |        220 |  28.006481000000008 |
|    124 |        218 |   66.83558699999998 |
|    109 |        212 |   52.89585099999999 |
|     10 |        202 |  15.988051000000041 |
|    132 |        197 |   91.60542899999996 |
|     43 |        191 |          123.269495 |
|    105 |        190 |   79.82364400000003 |
|     61 |        180 |  30.539701000000036 |
|     75 |        178 |           41.477914 |
|     42 |        176 |  100.37578099999996 |
|     46 |        174 |   79.07020699999993 |
|    118 |        172 |   86.63292000000007 |
|    133 |        171 |   54.58434199999999 |
|     76 |        170 |   99.84241800000001 |
|    140 |        167 |           84.408095 |
|    142 |        164 |   40.83083799999997 |
|     90 |        163 |  109.36649899999998 |
|     23 |        162 |  46.832041999999944 |
|    129 |        162 |   95.74705300000005 |
|     16 |        157 |   25.26157699999999 |
|     64 |        156 |   90.17526799999996 |
|     85 |        156 |  110.39868500000006 |
|      8 |        154 |  61.479089999999985 |
|     29 |        147 |           36.790097 |
|     11 |        147 |   33.00901499999998 |
|     26 |        143 |   67.80127400000003 |
|     58 |        143 |   41.07477400000005 |
|     80 |        141 |  60.477355000000045 |
|     25 |        138 | -11.521234000000106 |
|    123 |        136 |   89.22323299999996 |
|     77 |        131 |   65.67549499999996 |
|    144 |        131 |          120.523755 |
|    110 |        130 |   94.54696699999997 |
|     51 |        129 |           76.540055 |
|     39 |        120 |   78.67233499999992 |
|    136 |        115 |           71.608517 |
|     20 |        107 |   87.29585499999996 |
|    126 |        107 |  46.911771999999985 |
|    101 |        106 |   41.92822499999997 |
|      6 |        105 | -60.720455000000015 |
|     65 |        103 |  -19.53110099999992 |
|     28 |        101 |    80.1860079999999 |
|    127 |        100 |          -14.214585 |
|    122 |        100 |   61.55192099999999 |
|     24 |         99 |   167.5322829999999 |
|    138 |         97 |          130.056162 |
|    107 |         97 |   28.02040200000002 |
|    116 |         95 |  15.283777000000015 |
|     87 |         93 |  -20.04021599999993 |
|     37 |         93 |  11.470079999999939 |
|    146 |         91 |   35.43872499999995 |
|     72 |         91 |  60.395779999999945 |
|    139 |         89 |   26.81274499999995 |
|    145 |         87 |   92.47774900000002 |
|    102 |         85 |  30.362304999999992 |
|     78 |         80 |  58.986046999999985 |
|     79 |         80 |   32.12157500000001 |
|      9 |         79 |   12.74094100000002 |
|     86 |         72 |   52.83288200000004 |
|     48 |         72 |  26.116235999999958 |
|     35 |         72 | -20.827642000000026 |
|    121 |         66 |   72.88509799999997 |
|    108 |         66 |  20.858269000000007 |
|     71 |         64 |          104.944662 |
|     31 |         63 |   36.64013999999992 |
|    134 |         63 |  116.34634899999998 |
|     82 |         62 |   4.674874000000017 |
|     68 |         61 |   63.51175999999998 |
|     32 |         61 |   63.95572300000006 |
|     30 |         61 |   -82.0359929999999 |
|     14 |         59 |   41.53726200000003 |
|    111 |         59 |  18.972320000000025 |
|     13 |         56 |   63.67372199999994 |
|     47 |         51 |  14.250229999999988 |
|      3 |         51 |   51.33444700000001 |
|    131 |         49 |   66.26237100000003 |
|     55 |         47 |  47.749255000000005 |
|    104 |         44 | -1.0144800000000203 |
|     50 |         38 |   63.88156600000002 |
|     52 |         38 |  -42.56941399999994 |
|     56 |         37 |   50.40615300000002 |
|    120 |         37 | -14.148644999999988 |
|      5 |         36 |   -22.6098980000001 |
|     83 |         30 | -20.765086999999994 |
|     60 |         28 |  53.030108999999925 |
|    103 |         28 | -10.569442999999978 |
|     84 |         27 |   83.02771699999994 |
|     59 |         26 |   54.50790399999994 |
|    130 |         26 |   53.60159799999991 |
|     36 |         24 | -13.704785000000015 |
|     44 |         24 |   17.12192399999992 |
|     54 |         23 |  15.281792000000053 |
|      1 |         18 | -22.626442999999995 |
|     12 |         17 |  -70.08653800000002 |
|     69 |         15 |  3.0253039999999487 |
|    125 |         15 |           56.813334 |
|     19 |         13 |  26.502125000000007 |
|     49 |         12 |  29.909901999999988 |
|     15 |         11 |           79.283747 |
|     63 |          9 |  -9.807834999999955 |
|    113 |          8 |   45.72611699999999 |
|     18 |          7 |  13.510902000000044 |
|    114 |          7 |  27.629920000000027 |
|     74 |          4 |  42.641804000000036 |
|     21 |          4 |  -70.77552100000003 |
|    147 |        -10 | -13.353231000000022 |
|      4 |        -19 |  -71.34685099999996 |
|    137 |        -19 |  -20.37164100000001 |
|      2 |        -24 |  18.484594999999956 |
|    115 |        -27 | -25.754805000000005 |
|    128 |        -28 | -18.204098000000045 |
|    112 |        -32 |   83.54878200000002 |
|     62 |        -33 |  -61.51030999999989 |
|     89 |        -37 |          -42.891896 |
|     67 |        -38 |  -36.02536100000003 |
|     81 |        -42 |  -57.22940099999994 |
|     33 |        -43 |   49.69270999999998 |
|    100 |        -49 |  -35.26015099999995 |
|    106 |        -49 |   51.93842000000001 |
|     17 |        -50 |  31.149211999999977 |
|    119 |        -57 | -47.934698999999966 |
|    117 |        -61 |  56.018798999999944 |
|      7 |        -67 |  38.103511999999995 |
|    141 |        -79 |  -24.40509000000003 |
|     38 |        -90 |  30.888491000000045 |
|     40 |       -139 |   90.98320100000007 |
|    135 |       -151 | -56.581106000000034 |
|     73 |       -173 | -15.760650000000055 |
|    143 |       -196 |  233.02823999999998 |
|     45 |       -298 | -411.71237200000013 |
|     53 |       -362 |   31.50518999999997 |
+--------+------------+---------------------+
138 rows in set (0.02 sec)

10882536
mysql>
mysql> select date(OrderInfo.UpdateTime), sum(Clicks * (OrderTargetStat.UpdateTime = '2016-08-29 16:00:00')) - sum(Clicks * (OrderTargetStat.UpdateTime = '2016-08-22 16:00:00')) as ClicksDiff from OrderTargetStat inner join OrderInfo using(OrderID) where OrderTargetStat.UpdateTime in ('2016-08-22 16:00:00', '2016-08-29 16:00:00')  group by 1 order by 2 desc limit 50;
+----------------------------+------------+
| date(OrderInfo.UpdateTime) | ClicksDiff |
+----------------------------+------------+
| 2016-08-29                 |        508 |
| 2016-08-27                 |         27 |
| 2016-08-17                 |          3 |
| 2016-08-16                 |          2 |
| 2016-02-06                 |          1 |
| 2016-07-30                 |          1 |
| 2016-08-07                 |          1 |
| 2016-08-04                 |          1 |
| 2016-07-16                 |          1 |
| 2016-07-11                 |          1 |
| 2016-08-01                 |          1 |
| 2016-06-06                 |          1 |
| 2016-08-10                 |          1 |
| 2016-06-07                 |          1 |
| 2016-06-01                 |          1 |
| 2016-06-22                 |          1 |
| 2016-07-12                 |          0 |
| 2016-07-26                 |          0 |
| 2016-06-29                 |          0 |
| 2016-06-04                 |          0 |
| 2016-06-15                 |          0 |
| 2016-03-01                 |          0 |
| 2016-07-13                 |          0 |
| 2016-07-19                 |          0 |
| 2016-07-23                 |          0 |
| 2016-03-02                 |          0 |
| 0000-00-00                 |          0 |
| 2016-06-16                 |          0 |
| 2016-06-03                 |          0 |
| 2016-01-23                 |          0 |
| 2016-07-15                 |          0 |
| 2016-06-05                 |          0 |
| 2016-05-12                 |          0 |
| 2016-05-28                 |          0 |
| 2016-04-12                 |          0 |
| 2016-07-29                 |          0 |
| 2016-08-11                 |          0 |
| 2016-02-27                 |          0 |
| 2016-07-31                 |          0 |
| 2016-06-24                 |          0 |
| 2016-06-25                 |          0 |
| 2016-01-22                 |          0 |
| 2016-04-11                 |          0 |
| 2016-07-08                 |          0 |
| 2016-08-09                 |          0 |
| 2016-04-13                 |          0 |
| 2016-03-31                 |          0 |
| 2016-07-28                 |          0 |
| 2016-05-25                 |          0 |
| 2016-07-20                 |          0 |
+----------------------------+------------+
50 rows in set (0.53 sec)

mysql> select OrderID,sum(Clicks * (UpdateTime = '2016-08-29 16:00:00')) - sum(Clicks * (UpdateTime = '2016-08-22 16:00:00')) as ClicksDiff from OrderTargetStat where UpdateTime in ('2016-08-22 16:00:00', '2016-08-29 16:00:00')  group by 1 order by 2 desc  limit 100;
+----------+------------+
| OrderID  | ClicksDiff |
+----------+------------+
| 10882536 |         63 |
|  5448365 |         46 |
|  3316779 |         46 |
|  1745128 |         44 |
|  9489387 |         35 |
|  8696160 |         30 |
|  4289649 |         28 |
| 10985125 |         27 |
|  3924205 |         26 |
|  4573041 |         24 |
|  3204973 |         23 |
|    74577 |         21 |
|  9771875 |         21 |
|  4163263 |         20 |
|  6050886 |         18 |
|  9488528 |         17 |
| 10731985 |         16 |
|  1719901 |         16 |
|  9875277 |         16 |
| 10216167 |         15 |
|  6738705 |         14 |
|  4868264 |         13 |
|  9324196 |         12 |
|  1249502 |         12 |
| 10953073 |         12 |
|  5407295 |         11 |
| 10488523 |         11 |
| 10957707 |         11 |
|    24304 |         10 |
| 10785746 |         10 |
|  7656300 |         10 |
| 10737900 |          9 |
|  9760035 |          9 |
| 10902697 |          9 |
| 10909845 |          9 |
| 10905004 |          9 |
|  7883457 |          9 |
| 10694765 |          9 |
| 10014356 |          8 |
|  6310491 |          8 |
|  6180812 |          8 |
|  7275656 |          8 |
| 10923495 |          8 |
| 10731544 |          8 |
|   206767 |          8 |
|  7486395 |          8 |
|  5134060 |          7 |
|  6339187 |          7 |
|  9184711 |          7 |
| 10904019 |          7 |
|  4808189 |          7 |
|  2394246 |          7 |
| 10762416 |          7 |
| 10675965 |          7 |
|   867809 |          7 |
|  7785074 |          6 |
| 10550897 |          6 |
|  3552325 |          6 |
|  7329608 |          6 |
|  6125757 |          6 |
|  8847370 |          6 |
|  5973673 |          6 |
| 10199065 |          6 |
|  4484034 |          6 |
| 10875188 |          6 |
|  3977177 |          6 |
|  7811334 |          6 |
| 10986018 |          6 |
| 10197378 |          6 |
|  7386569 |          6 |
|  7135314 |          6 |
|  7189868 |          6 |
|  6553352 |          6 |
|  7715275 |          6 |
| 10880687 |          6 |
|  6270732 |          6 |
| 10500487 |          5 |
| 10882985 |          5 |
| 10043672 |          5 |
|  8525690 |          5 |
| 10924258 |          5 |
|  2583879 |          5 |
|  6512839 |          5 |
|  2221169 |          5 |
|  7860771 |          5 |
|  6639726 |          5 |
|  2488895 |          5 |
| 10524087 |          5 |
| 10485710 |          5 |
|  8346862 |          5 |
|  2554712 |          5 |
| 10429032 |          5 |
|  7811618 |          5 |
|  6749102 |          5 |
|  7094230 |          5 |
|  6950350 |          5 |
|  6975978 |          4 |
|  7151012 |          4 |
| 10895875 |          4 |
|  5806270 |          4 |
+----------+------------+
100 rows in set (0.06 sec)


5271525

mysql> select exportid from OrderInfo where orderid = 1745128;
+----------+
| exportid |
+----------+
|  5271525 |
+----------+
1 row in set (0.00 sec)


===================================

mysql> select baseno from OrderInfo where orderid = 9050631;
ERROR 2006 (HY000): MySQL server has gone away
No connection. Trying to reconnect...
Connection id:    72579746
Current database: yabsdb

+--------+
| baseno |
+--------+
|     16 |
+--------+
1 row in set (0.07 sec)

rsync --list-only --contimeout=5 --timeout=30 rsync://$source_host/mysql_backups/$backup/$instance/arc$opt_date/$database
source_host in (
	bsbackup02g.yandex.ru
	bsbackup02i.yandex.ru
	bsbackup1-01e.yandex.ru
	bsbackup1-01i.yabs.yandex.ru
	bsbackup1-02g.yandex.ru
	bsbackup1-02i.yandex.ru
	bsbackup1-02k.yabs.yandex.ru
)
1144
1217


mysql> select resultflatcost/1e6 from PhrasePrice where BannerID = 1734942131 and PhraseID = 17404;
+--------------------+
| resultflatcost/1e6 |
+--------------------+
|              0.424 |
+--------------------+
1 row in set (0.00 sec)

mysql> select resultflatcost/1e6 from PhrasePrice where BannerID = 1734942131 and PhraseID = 17404;
+--------------------+
| resultflatcost/1e6 |
+--------------------+
|              0.171 |
+--------------------+
1 row in set (0.01 sec)

| 2355809784 |    17161 |           8 |              0.555 | autobroker,only-offer-retargeting         |
| 2355809785 |    17161 |           8 |              0.555 | autobroker,only-offer-retargeting         |
| 2355809786 |    17161 |           8 |              0.555 | autobroker,only-offer-retargeting         |
| 2355809787 |    17161 |           8 |              0.555 | autobroker,only-offer-retargeting         |
| 2355822349 |    14240 |           8 |              0.555 | autobroker,only-offer-retargeting         |
| 2355822350 |    14240 |           8 |              0.555 | autobroker,only-offer-retargeting         |
| 2355822351 |    14240 |           8 |              0.555 | autobroker,only-offer-retargeting         |
| 2355822352 |    14240 |           8 |              0.555 | autobroker,only-offer-retargeting         |
+------------+----------+-------------+--------------------+-------------------------------------------+
1706 rows in set (0.00 sec)

mysql> select * from AutoBudgetAdjustedStat where BannerID = 2355822350;
Empty set (0.00 sec)


'2355822350,14240,8'
mysql> select groupexportid from Banner16 where bannerid = 1655602458;
+---------------+
| groupexportid |
+---------------+
|    1503591194 |
+---------------+
1 row in set (0.00 sec)

mysql> select groupexportid from Banner16 where bannerid = 2355822350;
+---------------+
| groupexportid |
+---------------+
|    1503591194 |
+---------------+
1 row in set (0.01 sec)

'1655602458,14240,8'
'1734942131,17404,8'
mysql> select * from AutoBudgetAdjustedStat where bannerid = 1655602458 and PhraseID = 14240;
+------------+----------+-------------+------------+--------------+---------+----------------+----------+---------------+----------------+---------+----------+------------+-----------+---------------------+
| BannerID   | PhraseID | ContextType | TargetType | ABBidControl | BadTarg | RealCostBucket | Clicks   | VirtualClicks | AdjustedClicks | Cost    | RealCost | SourceCost | TimeCoeff | UpdateTime          |
+------------+----------+-------------+------------+--------------+---------+----------------+----------+---------------+----------------+---------+----------+------------+-----------+---------------------+
| 1655602458 |    14240 |           8 |          1 |            1 |       0 |             21 |        0 |       2701651 |              0 |       0 |        0 |          0 |   1000000 | 2016-08-23 11:00:00 |
| 1655602458 |    14240 |           8 |          1 |            1 |       0 |             41 | 23229857 |      66876391 |       20973247 | 9059644 |  9658975 |    3240565 | 316308398 | 2016-08-04 19:00:00 |
| 1655602458 |    14240 |           8 |          1 |            1 |       0 |             50 |        0 |      16286626 |              0 |       0 |        0 |          0 | 329588390 | 2016-08-23 23:00:00 |
| 1655602458 |    14240 |           8 |          1 |            1 |       0 |             84 |        0 |      47209626 |              0 |       0 |        0 |          0 | 206649930 | 2016-08-15 06:00:00 |
+------------+----------+-------------+------------+--------------+---------+----------------+----------+---------------+----------------+---------+----------+------------+-----------+---------------------+
4 rows in set (0.00 sec)

mysql> select * from AutoBudgetAdjustedStat where bannerid = 1734942131 and PhraseID = 17404;
+------------+----------+-------------+------------+--------------+---------+----------------+-------------+---------------+----------------+-------------+-------------+-------------+-----------+---------------------+
| BannerID   | PhraseID | ContextType | TargetType | ABBidControl | BadTarg | RealCostBucket | Clicks      | VirtualClicks | AdjustedClicks | Cost        | RealCost    | SourceCost  | TimeCoeff | UpdateTime          |
+------------+----------+-------------+------------+--------------+---------+----------------+-------------+---------------+----------------+-------------+-------------+-------------+-----------+---------------------+
| 1734942131 |    17404 |           8 |          1 |            1 |       0 |              4 |           0 |       6221335 |              0 |           0 |           0 |           0 | 332497096 | 2016-08-22 15:00:00 |
| 1734942131 |    17404 |           8 |          1 |            1 |       0 |              5 |           0 |      27282170 |              0 |           0 |           0 |           0 | 332162563 | 2016-08-12 02:00:00 |
| 1734942131 |    17404 |           8 |          1 |            1 |       0 |              7 |   146958526 |     228546731 |      145516167 |     9494485 |    11012026 |     9574825 | 332906709 | 2016-08-23 21:00:00 |
| 1734942131 |    17404 |           8 |          1 |            1 |       0 |              8 |   301428422 |     388527326 |      315290228 |    17831492 |    29221154 |    26353218 | 332913071 | 2016-08-24 00:00:00 |
| 1734942131 |    17404 |           8 |          1 |            1 |       0 |             11 |   135914372 |     729930626 |      228689552 |    12223790 |    15175539 |    12135727 | 332916846 | 2016-08-23 23:00:00 |
| 1734942131 |    17404 |           8 |          1 |            1 |       0 |             14 |  1127103308 |    1762960249 |     1185205682 |   109544901 |   168398988 |    99146941 | 332904137 | 2016-08-23 23:00:00 |
| 1734942131 |    17404 |           8 |          1 |            1 |       0 |             17 |  4390785544 |    4971503288 |     4017726386 |   515014047 |   782977701 |   394103653 | 332904141 | 2016-08-23 23:00:00 |
| 1734942131 |    17404 |           8 |          1 |            1 |       0 |             21 |  6361535303 |    8422865763 |     6570841529 |   950882297 |  1453936829 |   633798076 | 332901552 | 2016-08-23 21:00:00 |
| 1734942131 |    17404 |           8 |          1 |            1 |       0 |             27 | 10373050616 |   11568610646 |    10393833217 |  1954753558 |  2852286211 |  1319974672 | 332743178 | 2016-08-22 17:00:00 |
| 1734942131 |    17404 |           8 |          1 |            1 |       0 |             34 |  8517762437 |   12019780945 |     9245413107 |  1836440534 |  2828473252 |  1255433759 | 332728819 | 2016-08-22 09:00:00 |
| 1734942131 |    17404 |           8 |          1 |            1 |       0 |             41 | 14682515835 |   14094530750 |    14470675458 |  4072671187 |  6031447006 |  2166666085 | 331639124 | 2016-08-17 07:00:00 |
| 1734942131 |    17404 |           8 |          1 |            1 |       0 |             50 |  5553152846 |    5968571063 |     5600745716 |  1644339241 |  2651520992 |  1104748354 | 328440322 | 2016-08-17 12:00:00 |
| 1734942131 |    17404 |           8 |          1 |            1 |       0 |             63 |  4789609381 |    9271578080 |     5056708600 |  1930597372 |  3099787976 |  1475045935 | 317729007 | 2016-08-22 10:00:00 |
| 1734942131 |    17404 |           8 |          1 |            1 |       0 |             84 | 27097435042 |   39536653356 |    28205359601 | 13717660817 | 22348890878 | 11397964092 | 318326742 | 2016-08-22 23:00:00 |
| 1734942131 |    17404 |           8 |          1 |            1 |       0 |            122 | 28615292497 |   38249621975 |    26507201019 | 19850286589 | 34869326580 | 12009307479 | 265111663 | 2016-08-09 01:00:00 |
+------------+----------+-------------+------------+--------------+---------+----------------+-------------+---------------+----------------+-------------+-------------+-------------+-----------+---------------------+
15 rows in set (0.00 sec)


========


mysql> select baseno,sum(Clicks * (UpdateTime = '2016-08-30 11:00:00')) - sum(Clicks * (UpdateTime = '2016-08-23 11:00:00')) as ClicksDiff, sum(Cost/1e6 * (UpdateTime = '2016-08-30 11:00:00')) - sum(Cost/1e6 * (UpdateTime = '2016-08-23 11:00:00')) as CostDiff from AutoBudgetMonitoringStat201608 where UpdateTime in ('2016-08-23 11:00:00', '2016-08-30 11:00:00') and LimitDayMoney = 0  and NetCPC = 0 and ContextType =  1 and LimitWeekClicks = 0 and AvgCPA = 0  and ROILevel = 0 and GoalID = 0 and RegularSpent = 0 group by 1 order by 3 asc limit 100;
+--------+------------+---------------------+
| baseno | ClicksDiff | CostDiff            |
+--------+------------+---------------------+
|    133 |       -178 |         -267.155198 |
|     81 |       -274 | -264.89607200000006 |
|    137 |       -476 | -225.58601800000002 |
|     26 |       -301 | -179.87685200000004 |
|     59 |       -145 |  -176.4473959999999 |
|     50 |       -127 | -162.52092699999997 |
|    106 |       -288 | -145.63664399999996 |
|     14 |       -360 |         -143.152274 |
|     33 |       -278 | -140.08007100000003 |
|     56 |       -136 |  -134.7508870000001 |
|     25 |       -133 | -132.98789900000003 |
|     78 |       -114 | -126.97329500000006 |
|    140 |       -115 | -124.63156000000009 |
|     62 |        -52 | -117.82067199999995 |
|      6 |       -350 | -114.40289000000001 |
|    144 |        -38 | -112.86062200000006 |
|     15 |        -15 | -110.47107299999993 |
|     43 |       -209 | -107.16980600000005 |
|    102 |       -104 |  -106.3746479999999 |
|     65 |       -148 | -104.98040100000003 |
|     68 |       -211 | -104.52947800000004 |
|     87 |       -112 |         -102.404957 |
|     18 |       -865 | -101.24705099999994 |
|     36 |       -287 |  -98.20856999999998 |
|     13 |       -200 |  -97.77566499999989 |
|     60 |       -189 |  -94.90861700000002 |
|     67 |       -210 |  -92.47750799999997 |
|      7 |       -190 |  -90.58922499999997 |
|     16 |       -626 |  -89.98046100000002 |
|    128 |       -177 |  -89.79429300000001 |
|     32 |        -79 |  -84.82307700000007 |
|    100 |        -99 |  -83.91173900000004 |
|    136 |       -108 |  -83.14880899999991 |
|    145 |       -264 |  -80.02798200000007 |
|     58 |        -96 |  -78.83909499999999 |
|     79 |       -167 |   -77.1801309999999 |
|    111 |        108 |  -76.41589700000003 |
|      2 |       -139 |           -75.52713 |
|     72 |       -172 |  -74.55353000000008 |
|     80 |       -161 |  -73.74168099999997 |
|     34 |       -264 |  -71.12048899999996 |
|      5 |       -157 |  -70.40157299999998 |
|    119 |        -73 |  -70.33064999999999 |
|     69 |        -28 |  -69.21382700000004 |
|      3 |       -204 |          -66.810251 |
|     45 |       -220 |  -66.79314299999999 |
|     19 |        -87 |  -65.11648900000003 |
|     52 |         17 |  -64.71436799999998 |
|     54 |         48 |  -63.36717200000001 |
|     28 |         79 |  -63.33412299999998 |
|     63 |       -173 |  -60.21556599999997 |
|     12 |        -61 |  -59.98512699999992 |
|     64 |         14 |  -59.82743599999998 |
|     20 |        -69 |  -58.30996200000004 |
|     82 |       -130 | -56.072581999999954 |
|    113 |        -89 | -50.368813000000046 |
|     10 |       -200 |  -50.08603099999996 |
|    107 |        -36 |  -50.06948399999993 |
|    134 |        -39 |  -49.52776600000004 |
|     31 |       -834 |  -49.01126699999992 |
|     88 |        -69 | -48.255225999999965 |
|    108 |        -27 |  -47.59193399999995 |
|    141 |         21 |  -47.08449000000002 |
|     23 |        -63 | -46.578817999999956 |
|     11 |        -47 |  -46.27413200000001 |
|     48 |         -6 |          -43.865005 |
|    123 |       -162 |  -42.73795799999996 |
|    122 |        -76 |  -42.15436200000005 |
|    116 |        -50 |  -41.92887400000001 |
|     53 |       -408 |  -41.77491299999997 |
|     44 |       -175 |  -39.28929599999998 |
|     75 |         36 |  -37.25671499999993 |
|    110 |        -24 |  -35.63325200000003 |
|    109 |        -59 |  -34.07788599999998 |
|    132 |       -123 |  -33.81315099999995 |
|     89 |         -1 |  -33.70003199999999 |
|     46 |        -79 | -26.834334000000013 |
|     30 |        -19 |  -25.38786700000003 |
|     77 |        -99 | -23.790354000000036 |
|      9 |        -24 | -23.361685000000023 |
|     71 |       -179 | -23.240099999999927 |
|     49 |        -26 | -21.388690999999994 |
|     61 |       -137 |  -20.26788700000003 |
|    135 |        -45 | -16.386085999999978 |
|    101 |        -20 |  -15.93760500000002 |
|    142 |         39 | -14.515880999999979 |
|     47 |        -81 |  -14.19981899999999 |
|    121 |        -54 | -13.947032000000036 |
|     29 |        -56 |  -11.99897599999997 |
|     24 |        -44 |  -9.612460000000056 |
|    103 |         58 |  -9.292167000000035 |
|    131 |          2 |  -7.974946999999986 |
|     74 |        -72 |  -7.919214999999895 |
|    139 |         19 | -7.8211939999999345 |
|     35 |        -47 |  -6.011907000000065 |
|    146 |        -38 |  -5.550682999999992 |
|    127 |        -21 |  -1.349597999999986 |
|     41 |         69 | -1.1786549999999352 |
|     86 |       -142 |  0.9746489999999426 |
|    105 |         46 |   1.186526999999984 |
+--------+------------+---------------------+
100 rows in set (0.04 sec)

mysql>


baseno 81
|     81 |       -274 | -264.89607200000006 |


mysql> select UpdateTime,sum(Clicks) from OrderTargetStat inner join AutoBudgetOrder using(OrderID) where UpdateTime in ('2016-08-23 11:00:00', '2016-08-30 11:00:00') and AutoBudgetOrder.LimitWeek > 0  group by 1;
+---------------------+-------------+
| UpdateTime          | sum(Clicks) |
+---------------------+-------------+
| 2016-08-23 11:00:00 |         630 |
| 2016-08-30 11:00:00 |         313 |
+---------------------+-------------+
2 rows in set (0.08 sec)

orderid=  2753871

mysql> select * from AutoBudgetOrder where orderid = 2753871\G
*************************** 1. row ***************************
         OrderID: 2753871
  FirstStartTime: 2015-07-20 13:35:00
       StartTime: 2015-08-11 08:30:00
       LimitWeek: 3500000000
    LimitWeekCur: 0
   LimitDayMoney: 0
LimitDayMoneyCur: 0
         MaxCost: 0
      MaxCostCur: 0
         AvgCost: 0
      AvgCostCur: 0
          AvgCPA: 0
       AvgCPACur: 0
        ROILevel: 0
          GoalID: -1
 LimitWeekClicks: 0
            Type: 0
    ContextLimit: 5
         Testing: 0
        Problems: 0
       DayWeight: 333333
    RegularSpent: 0
TransportDelayed: 0
    GenerateBids: 1
    OptimizeType: 0
   ReserveReturn: 0
   Profitability: 0
            Easy: 0
         Options:
  ChosenStrategy: cpc
1 row in set (0.01 sec)

mysql> select OrderID,sum(Clicks * (UpdateTime = "2016-08-30 11:00:00" )) - sum(Clicks * (UpdateTime = "2016-08-23 11:00:00")) as ClicksDiff, sum(Clicks * (UpdateTime = "2016-08-30 11:00:00" )), sum(Clicks * (UpdateTime = "2016-08-23 11:00:00")) from OrderTargetStat inner join AutoBudgetOrder using(OrderID) where UpdateTime in ('2016-08-23 11:00:00', '2016-08-30 11:00:00') and AutoBudgetOrder.LimitWeek > 0 group by 1 order by 2 asc limit 50;
+----------+------------+-----------------------------------------------------+----------------------------------------------------+
| OrderID  | ClicksDiff | sum(Clicks * (UpdateTime = "2016-08-30 11:00:00" )) | sum(Clicks * (UpdateTime = "2016-08-23 11:00:00")) |
+----------+------------+-----------------------------------------------------+----------------------------------------------------+
|  2753871 |       -155 |                                                   0 |                                                155 |
|  8742554 |        -35 |                                                  11 |                                                 46 |
|  8661192 |        -14 |                                                   0 |                                                 14 |
|  8681109 |        -10 |                                                   0 |                                                 10 |
|  4582062 |         -9 |                                                   0 |                                                  9 |
|  3321275 |         -7 |                                                  21 |                                                 28 |
|  8023729 |         -6 |                                                   0 |                                                  6 |
|  8389341 |         -6 |                                                   4 |                                                 10 |
|  3237722 |         -6 |                                                   0 |                                                  6 |

2753871 выключена из-за отсутствия денег на счету

8742554 рестартовал

8661192 рестартовал

8681109 рестартовал

AutoBudgetOrder_20160830
AutoBudgetOrder_20160829
AutoBudgetOrder_20160823


mysql> select OrderID,sum(Shows * (OrderTargetStat.UpdateTime = "2016-08-30 11:00:00" )) - sum(Shows * (OrderTargetStat.UpdateTime = "2016-08-23 11:00:00")) as ClicksDiff, sum(Shows * (OrderTargetStat.UpdateTime = "2016-08-30 11:00:00" )) as Now, sum(Shows * (OrderTargetStat.UpdateTime = "2016-08-23 11:00:00")) as Prev from OrderTargetStat inner join AutoBudgetOrder using(OrderID) inner join OrderInfo using(OrderID) where OrderTargetStat.UpdateTime in ('2016-08-23 11:00:00', '2016-08-30 11:00:00') and AutoBudgetOrder.LimitWeek > 0 group by 1 order by 2 asc limit 20;
+----------+------------+------+------+
| OrderID  | ClicksDiff | Now  | Prev |
+----------+------------+------+------+
| 10218696 |      -8860 |  437 | 9297 |
|  6879517 |      -4484 |    0 | 4484 |
|  6049807 |      -3911 |    1 | 3912 |
|  7893706 |      -2140 |  251 | 2391 |
|  6565183 |      -1985 |    0 | 1985 |
| 10447964 |      -1548 | 1654 | 3202 |
|  9253341 |      -1236 |    0 | 1236 |
| 10257156 |      -1200 |    0 | 1200 |
|  4748357 |      -1117 |    0 | 1117 |
|  7853319 |      -1061 | 1454 | 2515 |
|  6311272 |       -993 |    0 |  993 |
|  7372263 |       -990 | 2005 | 2995 |
| 10447770 |       -980 |    0 |  980 |
|  7796723 |       -948 |    0 |  948 |
| 10214074 |       -903 | 4157 | 5060 |
|  8263196 |       -781 |  181 |  962 |
|  8799000 |       -773 |    0 |  773 |
|  2089524 |       -761 |  194 |  955 |
|  5656810 |       -752 |    0 |  752 |
|  6195289 |       -631 |   69 |  700 |
+----------+------------+------+------+
20 rows in set (0.05 sec)



mysql> select * from AutoBudgetOrder where orderid = 10218696\G
*************************** 1. row ***************************
         OrderID: 10218696
  FirstStartTime: 2016-07-05 12:50:00
       StartTime: 2016-08-19 00:00:00
       LimitWeek: 157333333
    LimitWeekCur: 47200000
   LimitDayMoney: 0
LimitDayMoneyCur: 0
         MaxCost: 157333
      MaxCostCur: 40000
         AvgCost: 0
      AvgCostCur: 0
          AvgCPA: 0
       AvgCPACur: 0
        ROILevel: 0
          GoalID: -1
 LimitWeekClicks: 0
            Type: 3
    ContextLimit: 80
         Testing: 0
        Problems: 30
       DayWeight: 333333
    RegularSpent: 0
TransportDelayed: 0
    GenerateBids: 1
    OptimizeType: 0
   ReserveReturn: 0
   Profitability: 0
            Easy: 0
         Options:
  ChosenStrategy: cpc
1 row in set (0.00 sec)


mysql> select CurrencyID,CurrencyDate from OrderInfo where orderid = 10218696;
+------------+---------------------+
| CurrencyID | CurrencyDate        |
+------------+---------------------+
|        643 | 2016-07-05 00:00:00 |
+------------+---------------------+
1 row in set (0.00 sec)


mysql> select find_in_set('netcpcoptimize', Options),count(*) from AutoBudgetOrder group by 1;
+----------------------------------------+----------+
| find_in_set('netcpcoptimize', Options) | count(*) |
+----------------------------------------+----------+
|                                      0 |  1851373 |
|                                      2 |  6386311 |
+----------------------------------------+----------+
2 rows in set (0.00 sec)
mysql> select find_in_set('netcpcoptimize', Options),count(*) from AutoBudgetOrder group by 1;
+----------------------------------------+----------+
| find_in_set('netcpcoptimize', Options) | count(*) |
+----------------------------------------+----------+
|                                      0 |  2000780 |
|                                      2 |  6252803 |
+----------------------------------------+----------+
2 rows in set (3.42 sec)


mysql> select find_in_set('autobudget', OrderInfo.Options) and  find_in_set('netcpcoptimize', AutoBudgetOrder.Options),count(*) from AutoBudgetOrder inner join OrderInfo using(OrderID) where Complete = 0 group by 1;
+----------------------------------------------------------------------------------------------------------+----------+
| find_in_set('autobudget', OrderInfo.Options) and  find_in_set('netcpcoptimize', AutoBudgetOrder.Options) | count(*) |
+----------------------------------------------------------------------------------------------------------+----------+
|                                                                                                        0 |   341104 |
|                                                                                                        1 |   737450 |
+----------------------------------------------------------------------------------------------------------+----------+
2 rows in set (7.26 sec)

mysql>  select find_in_set('autobudget', OrderInfo.Options) and  find_in_set('netcpcoptimize', AutoBudgetOrder.Options),count(*) from AutoBudgetOrder inner join OrderInfo using(OrderID) where Complete = 0 group by 1;
+----------------------------------------------------------------------------------------------------------+----------+
| find_in_set('autobudget', OrderInfo.Options) and  find_in_set('netcpcoptimize', AutoBudgetOrder.Options) | count(*) |
+----------------------------------------------------------------------------------------------------------+----------+
|                                                                                                        0 |   624643 |
|                                                                                                        1 |   475278 |
+----------------------------------------------------------------------------------------------------------+----------+
2 rows in set (9.94 sec)


mysql> select find_in_set('autobudget', OrderInfo.Options) , find_in_set('netcpcoptimize', AutoBudgetOrder.Options),count(*) from AutoBudgetOrder inner join OrderInfo using(OrderID) where Complete = 0 group by 1,2;
+----------------------------------------------+--------------------------------------------------------+----------+
| find_in_set('autobudget', OrderInfo.Options) | find_in_set('netcpcoptimize', AutoBudgetOrder.Options) | count(*) |
+----------------------------------------------+--------------------------------------------------------+----------+
|                                            0 |                                                      0 |    12336 |
|                                            0 |                                                      2 |    19854 |
|                                           13 |                                                      0 |   308914 |
|                                           13 |                                                      2 |   737450 |
+----------------------------------------------+--------------------------------------------------------+----------+
4 rows in set (7.51 sec)


mysql>  select find_in_set('autobudget', OrderInfo.Options) , find_in_set('netcpcoptimize', AutoBudgetOrder.Options),count(*) from AutoBudgetOrder inner join OrderInfo using(OrderID) where Complete = 0 group by 1,2;
+----------------------------------------------+--------------------------------------------------------+----------+
| find_in_set('autobudget', OrderInfo.Options) | find_in_set('netcpcoptimize', AutoBudgetOrder.Options) | count(*) |
+----------------------------------------------+--------------------------------------------------------+----------+
|                                            0 |                                                      0 |    12947 |
|                                            0 |                                                      2 |   176315 |
|                                           13 |                                                      0 |   435446 |
|                                           13 |                                                      2 |   475304 |
+----------------------------------------------+--------------------------------------------------------+----------+
4 rows in set (9.99 sec)


mysql> insert into autobudget_orders_2016083015 select  OrigOrderID, sum(CounterType = 2), sum(EventCost) from clicks_2016083015 C inner join AutoBudgetOrder ABO on  C.OrigOrderID = ABO.OrderID  where FraudBits = 0 and ContextType=1 and PageID = 2 group by OrigOrderID;

mysql> insert into autobudget_orders_2016082315 select  OrigOrderID, sum(CounterType = 2), sum(EventCost) from clicks_2016082315 C inner join AutoBudgetOrder ABO on  C.OrigOrderID = ABO.OrderID  where FraudBits = 0 and ContextType=1 and PageID = 2 group by OrigOrderID;

mysql> select OrderID, Pre.Clicks,Pre.Cost, Post.Clicks, Post.Cost  from autobudget_orders_2016082315 as Pre inner join autobudget_orders_2016083015 as Post using(OrderID) where Pre.Clicks > 100 and Post.Clicks > 100 and Post.Cost/Post.Clicks * 1.5 < Pre.Cost/Pre.Clicks order by Pre.Cost desc;
+----------+--------+-----------+--------+-----------+
| OrderID  | Clicks | Cost      | Clicks | Cost      |
+----------+--------+-----------+--------+-----------+
|  5975253 |   2731 | 386730387 |   3224 | 257828552 |
|  3427370 |    586 | 231638436 |    564 |  55866084 |
|  5975324 |    765 | 145772329 |   1003 |  74670950 |
|  9550650 |    838 | 137041186 |   1190 |  86729804 |
|  4504033 |    336 |  98703046 |    285 |  19426679 |
|  5979947 |    501 |  66146822 |    572 |  33539359 |
|  6201370 |    261 |  56620316 |    362 |  24170262 |
|  8066136 |    213 |  53198323 |    284 |  24709194 |
|  9773920 |    146 |  42436710 |    149 |  14069506 |
| 10750939 |    204 |  41028591 |    211 |  17629200 |
|  7191403 |    126 |  37556825 |    170 |  26229257 |
|  8297454 |    108 |  30461475 |    122 |  16378970 |
|  1896510 |    211 |  25727919 |    237 |  17275174 |
| 10164240 |    113 |  25503734 |    114 |  12173661 |
| 10590599 |    101 |  15819865 |    149 |  11398800 |
|  6414533 |    108 |  14026262 |    162 |  11473533 |
+----------+--------+-----------+--------+-----------+
16 rows in set (0.00 sec)
insert into autobudget_orders_2016082315 select  OrigOrderID, sum(CounterType = 2),sum(EventCost) from clicks_2016082315 C inner join AutoBudgetOrder ABO on  C.OrigOrderID = ABO.OrderID inner join Page using(PageID)  where  FraudBits = 0 and ContextType=1 and ABO.LimitWeek > 0 and TargetType  != 3  group by OrigOrderID;
i
mysql> select OrderID, post.Clicks - pre.Clicks ,pre.Clicks,post.Clicks from autobudget_orders_2016083015 post inner join autobudget_orders_2016082315 pre using(OrderID) order by 2 asc limit 10;
+----------+--------------------------+--------+--------+
| OrderID  | post.Clicks - pre.Clicks | Clicks | Clicks |
+----------+--------------------------+--------+--------+
|  8263195 |                     -174 |    176 |      2 |
|  7762854 |                     -141 |    266 |    125 |
|  8993238 |                     -121 |    300 |    179 |
|  1507384 |                     -106 |    156 |     50 |
| 10353491 |                     -104 |    152 |     48 |
|  2010966 |                     -102 |    284 |    182 |
|  9339820 |                      -89 |    213 |    124 |
|  8263386 |                      -88 |    272 |    184 |
|  4163263 |                      -75 |    148 |     73 |
|  6181551 |                      -68 |    218 |    150 |
+----------+--------------------------+--------+--------+
10 rows in set (0.03 sec)

mysql> insert into autobudget_orders_2016082315 select  OrigOrderID, sum(C.CounterType = 2),sum(EventCost) from clicks_2016082315 C inner join AutoBudgetOrder ABO on  C.OrigOrderID = ABO.OrderID inner join OrderInfo using(OrderID) inner join Page using(PageID)  where  FraudBits = 0 and ContextType=1 and ABO.LimitWeek > 0 and TargetType  != 3  and find_in_set('autobudget', OrderInfo.Options) and OrderInfo.Complete = 0 group by OrigOrderID;

mysql> insert into autobudget_orders_2016083015 select  OrigOrderID, sum(C.CounterType = 2),sum(EventCost) from clicks_2016083015 C inner join AutoBudgetOrder ABO on  C.OrigOrderID = ABO.OrderID inner join OrderInfo using(OrderID) inner join Page using(PageID)  where  FraudBits = 0 and ContextType=1 and ABO.LimitWeek > 0 and TargetType  != 3  and find_in_set('autobudget', OrderInfo.Options) and OrderInfo.Complete = 0 group by OrigOrderID;

BaseNo  CostDiff
45      -11035.259538999984
79      -7803.181302000001
41      -7782.459055999998
89      -7058.486243999978
118     -6707.586915000005
109     -6706.934923000004
48      -6686.987315999999
43      -6450.576746999985
76      -6404.745751000046
68      -6320.018305999982
4       -6280.640642999995
47      -6231.286439000009
24      -5917.1219910000145
75      -5895.428852000019
2       -5830.230011000009
63      -5768.286281999997
130     -5704.548304000024
9       -5698.252449000009
81      -5603.443573000013
46      -5599.801769000007


2016/08/30 20:48:59 453506 INFO  [load_order_sta] order 9992763 has holiday bit
PhrasePrice_89_20160831
PhrasePrice_89_20160830
Banner86_20160829
Banner86_20160831


mysql> select * from PhrasePrice where bannerid = 676577908 and phraseid = 230713\G
*************************** 1. row ***************************
                             OrderID: 5621570
                            EngineID: 7
                            BannerID: 676577908
                       GroupExportID: 742067086
                            PhraseID: 230713
                         ContextType: 1
                                Cost: 300
                      CostUpdateTime: 1971-01-01 00:00:01
                             AvgCost: 0
                   AvgCostUpdateTime: 0000-00-00 00:00:00
                              AvgCPA: 0
                    AvgCPAUpdateTime: 0000-00-00 00:00:00
                            FlatCost: 300
                  FlatCostUpdateTime: 0000-00-00 00:00:00
                          ResultCost: 300
                      ResultFlatCost: 300
                             Options: autobroker,currency
  OptionAutobrokerCurrencyUpdateTime: 2016-08-10 19:52:55
OptionOnlyOfferRetargetingUpdateTime: 0000-00-00 00:00:00
     OptionOnlyNewAuditoryUpdateTime: 0000-00-00 00:00:00
         OptionGoalContextUpdateTime: 0000-00-00 00:00:00
             OptionDeletedUpdateTime: 2016-08-10 19:52:55
                                Hits: 3538
                      HitsUpdateTime: 2016-08-26 16:11:30
                               PCTR0: 0
1 row in set (0.00 sec)


$ostat->[$O_TIME_TARG]->[7] == $TT_TIME_LIKE)

109 sub add_to_time_targ {
110         my $order_time_targ = shift;
111         my $tt_data = shift;
113         my $time_like = ($tt_data->[0] == 17) ? 1 : 0;
136         $order_time_targ->[7] = ($time_like ? $TT_TIME_LIKE : $TT_TIME_NOT_LIKE);

1142                                 add_to_time_targ($ostat->[$O_TIME_TARG], $pattern_time_tar->{$pat_id});


zasalamel@bstat26i:/mnt/raid/home/zasalamel$ ps aux | grep autobudget.pl
root        3319  0.0  0.0    176    32 ?        Ss   Mar31   4:50 runsv yabs-runit.autobudget.pl
yabs      837312  0.0  0.0  46288  2556 ?        S    15:48   0:00 su yabs -c $0 $@ -- /home/yabs/stat/autobudget.pl
yabs      856235  8.1  0.1 442468 245868 ?       S    15:49   0:20 /usr/bin/perl /home/yabs/stat/autobudget.pl
yabs      907197 41.0  0.6 1087372 886676 ?      R    15:52   0:28 /usr/bin/perl /home/yabs/stat/autobudget.pl
yabs      907605 41.1  0.7 1195428 995008 ?      R    15:52   0:28 /usr/bin/perl /home/yabs/stat/autobudget.pl
yabs      908032 50.8  0.8 1385120 1184564 ?     S    15:52   0:34 /usr/bin/perl /home/yabs/stat/autobudget.pl
yabs      912257 38.6  0.7 1254152 1054256 ?     R    15:52   0:18 /usr/bin/perl /home/yabs/stat/autobudget.pl
yabs      912471 30.9  0.6 1023172 822824 ?      S    15:52   0:14 /usr/bin/perl /home/yabs/stat/autobudget.pl
yabs      914947 48.2  0.6 1121732 921908 ?      S    15:52   0:15 /usr/bin/perl /home/yabs/stat/autobudget.pl
yabs      915804 37.1  0.5 886380 685908 ?       R    15:52   0:10 /usr/bin/perl /home/yabs/stat/autobudget.pl
yabs      922400 26.0  0.2 548036 347888 ?       S    15:53   0:02 /usr/bin/perl /home/yabs/stat/autobudget.pl
25267     927190  0.0  0.0  10856  2092 pts/7    S+   15:53   0:00 grep --color=auto autobudget.pl


mysql> select ContextID from OrderInfo where orderid =5361226;
+-----------+
| ContextID |
+-----------+
| 890392697 |
+-----------+
1 row in set (0.00 sec)

mysql> select * from Context52 where ContextID = 890392697;
+-----------+-------+----------------+---------+------------+------------+---------------------+---------+---------------------+
| ContextID | Level | Description    | PlaceID | SearchFreq | Expression | ExpressionMD5       | Options | CreateTime          |
+-----------+-------+----------------+---------+------------+------------+---------------------+---------+---------------------+
| 890392697 |     0 | order_11460383 |       0 |          0 | P181313    | 1740364616798507537 |         | 2015-05-13 09:44:53 |
+-----------+-------+----------------+---------+------------+------------+---------------------+---------+---------------------+
1 row in set (0.00 sec)

mysql> select distinct ContextID from Banner52 where OrderID= 5361226;
+-----------+
| ContextID |
+-----------+
| 890317224 |
| 890323550 |
+-----------+
2 rows in set (0.00 sec)

mysql> select * from Context52 where ContextID in(890317224,890323550);
+-----------+-------+-------------+---------+------------+--------------------------------+---------------------+---------+---------------------+
| ContextID | Level | Description | PlaceID | SearchFreq | Expression                     | ExpressionMD5       | Options | CreateTime          |
+-----------+-------+-------------+---------+------------+--------------------------------+---------------------+---------+---------------------+
| 890317224 |     0 | Direct      |     542 |          0 | (P2013|P3)&(P1|P112321|P24)&P2 | 6409742777864426480 |         | 2015-03-20 23:15:42 |
| 890323550 |     0 | Direct      |     542 |          0 | (P2013|P3)&(P1|P110471|P24)&P2 | 6910742799450906230 |         | 2015-03-25 10:52:15 |
+-----------+-------+-------------+---------+------------+--------------------------------+---------------------+---------+---------------------+
2 rows in set (0.00 sec)


mysql> select * from Pattern where PatternID in (3,2013,1,2,24,112321,110471,181313);
+-----------+-----------+-------------+-----------+--------+
| PatternID | KeywordID | OperationID | Data      | Weight |
+-----------+-----------+-------------+-----------+--------+
|         1 |        79 |           4 | 0         |      0 |
|         2 |         1 |           4 | 542       |      0 |
|         3 |        17 |           4 | 225       |      0 |
|        24 |        79 |           4 | 105       |      0 |
|      2013 |        17 |           4 | 977       |      0 |
|    110471 |        79 |           4 | 200000047 |      0 |
|    112321 |        79 |           4 | 200003525 |      0 |
|    181313 |       236 |          18 | DEFG      |      0 |
+-----------+-----------+-------------+-----------+--------+
8 rows in set (0.00 sec)

imysql> select * from KeywordType where KeywordID in (1,17,79,236) and type='system';
+-----------+--------+---------+------------------+
| KeywordID | Type   | Options | Data             |
+-----------+--------+---------+------------------+
|         1 | system |         | place-id         |
|        17 | system |         | reg-id           |
|        79 | system |         | flat-category-id |
|       236 | system |         | timetable-simple |
+-----------+--------+---------+------------------+
4 rows in set (0.01 sec)
mysql> select ContextID from OrderInfo where orderid = 5361226
    -> ;
+-----------+
| ContextID |
+-----------+
| 890392697 |
+-----------+
1 row in set (0.50 sec)

mysql>
mysql> select * from Context52 where ContextID=890392697;
+-----------+-------+----------------+---------+------------+----------------------------+---------------------+---------+---------------------+
| ContextID | Level | Description    | PlaceID | SearchFreq | Expression                 | ExpressionMD5       | Options | CreateTime          |
+-----------+-------+----------------+---------+------------+----------------------------+---------------------+---------+---------------------+
| 890392697 |     0 | order_11460383 |       0 |          0 | P181313&P24387&P24431&P545 | 4591008772382477449 |         | 2015-05-13 09:44:53 |
+-----------+-------+----------------+---------+------------+----------------------------+---------------------+---------+---------------------+
1 row in set (0.00 sec)

P181313&P24387&P24431&P545
mysql> select * from Pattern where PatternID in (24387,24431,545);
+-----------+-----------+-------------+------+--------+
| PatternID | KeywordID | OperationID | Data | Weight |
+-----------+-----------+-------------+------+--------+
|       545 |        77 |           5 | 2    |      0 |
|     24387 |        77 |           5 | 0    |      0 |
|     24431 |        77 |           5 | 1    |      0 |
+-----------+-----------+-------------+------+--------+
3 rows in set (0.00 sec)



 - AutoBudgetCoeffs (ab-category-coeffs.pl, AutoBudgetAdjusted.pm, ABFastAdjustedStat.pm, LoadData.pm, DirectLimitation.pm, autobudget-daily.pl)
    - ab-category-coeffs.pl можно не изменять
    - AutoBudgetAdjusted.pm после релиза yabs-autobudget2=101.6 при включении autobudget-filter-russian-coeffs начнет не рассматривать нерусские коэффициенты из AutoBudgetCoeffs
    - ABFastAdjustedStat.pm после релиза yabs-autobudget2=101.6 при включении autobudget-filter-russian-coeffs фильтрация русских праздников
    - LoadData.pm после релиза yabs-autobudget2=101.6 при включении autobudget-filter-russian-coeffs фильтрация русских праздников
    - DirectLimitation.pm ждем direct-limitation=020.2
    - autobudget-daily.pl после выкладки direct-limitations=019.1 и включение опций autobudget-daily-filter-russian-holidays и autobudget-daily-fill-russian-region-id
 - abforecastermodels


bstat34h.yandex.ru -- падает заказ 443948
bstat12f.yandex.ru -- Bad data length
bstat25i.yandex.ru -- Bad data length
bstat144i.yandex.ru -- Bad data length


2016/09/07 00:31:01 593231 INFO  [ update_baseno] Export baseno 132 succesfully finished

mysql> select * from DataTime; select date(UpdateTime), sum(ClearValue) from AutoBudgetCoeffs group by 1;
+--------------------+------------+---------------------+
| DataName           | BaseName   | UpdateTime          |
+--------------------+------------+---------------------+
| write-data-time.pl | dbm1       | 2012-04-23 17:29:02 |
| write-data-time.pl | st         | 2016-09-07 13:37:09 |
| write-data-time.pl | dbm        | 2016-09-07 13:37:09 |
| write-data-time.pl | mastertime | 2016-09-07 13:37:09 |
+--------------------+------------+---------------------+
4 rows in set (0.01 sec)

+------------------+---------------------+
| date(UpdateTime) | sum(ClearValue)     |
+------------------+---------------------+
| 2016-08-28       | 0.22520917866495438 |
| 2016-08-29       |  0.5060532158531714 |
| 2016-08-30       |  0.3562877963122446 |
| 2016-08-31       |  0.4917530245729722 |
| 2016-09-01       | 0.48761489894241095 |
| 2016-09-02       |  0.4598592772090342 |
| 2016-09-03       | 0.34214400572818704 |
| 2016-09-04       |  0.3562877963122446 |
| 2016-09-05       |  0.4803893571952358 |
| 2016-09-06       |  0.4735420431534294 |
| 2016-09-07       |   0.466726223094156 |
| 2016-09-08       | 0.46279868538840674 |
| 2016-09-09       |  0.4364556366344914 |
| 2016-09-10       |  0.3249047861318104 |
| 2016-09-11       |  0.3551832569355611 |
| 2016-09-12       | 0.41995803848840296 |
| 2016-09-13       | 0.41995803848840296 |
| 2016-09-14       | 0.41995803848840296 |
| 2016-09-15       | 0.41995803848840296 |
| 2016-09-16       |  0.5160520863719285 |
| 2016-09-17       |  0.3841576905979309 |
| 2016-09-18       | 0.41995803848840296 |
+------------------+---------------------+
22 rows in set (0.01 sec)

mysql>


====================


mysql> select distinct DSPPageID from SSPInfo;
+-----------+
| DSPPageID |
+-----------+
|         0 |
|    148660 |
|    162853 |
|    178082 |
+-----------+
4 rows in set (0.01 sec)


mysql> select distinct AltTemplateID from TemplatePage where PageID in (162853,148660,178082);
+---------------+
| AltTemplateID |
+---------------+
|           816 |
|           817 |
|           842 |
|           843 |
|           947 |
|           948 |
+---------------+
6 rows in set (0.01 sec)

select Title,Description from SSPInfo where DSPPageID !=0 ;
+------------------+-------------------------------------------------------------------------+
| Title            | Description                                                             |
+------------------+-------------------------------------------------------------------------+
| Smaato           | Smaato production (PageID=153979,Origin=1, BSDEV-52494, freakalert)     |
| Rubicon          | Rubicon production (PageID=154198/175313,Origin=0, BSDEV-52736, w495)   |
| MoPub            | MoPub production (PageID=160950,Origin=2, BSDEV-54109, w495)            |
| Inner-active     | Inner-active staging (PageID=160333,Origin=1, BSDEV-54227, w495)        |
| Inner-active     | Inner-active production (PageID=162504,Origin=1, BSDEV-54227, w495)     |
| MobFox           | MobFox production (PageID=167514,Origin=1,BSDEV-56076,w495)             |
| Mars Media Group | Mars Media Group production (PageID=167516,Origin=1,BSDEV-56076,w495)   |
| BidSwitch        | BidSwitch production (PageID=167513,Origin=2, BSDEV-56075, w495)        |
| Mars Media Group | Mars Media Group production (PageID=182987,Origin=1,BSDEV-56126,gremli) |
| Google           | Google staging (PageID=181147,BSPUB-197,gremli)                         |
+------------------+-------------------------------------------------------------------------+
10 rows in set (0.01 sec)

что делать когда PageID = 0?
что делать когда Origin = udnef или нет Origin?

====================

7944603

mysql> select ExceptionID from SSPInfo where SSPId = 7944603;
+-------------+
| ExceptionID |
+-------------+
|           0 |
+-------------+
1 row in set (0.01 sec)

У рубикона нет ExceptionID

ssp_id -> запись SSPInfo -- модифицируем Request
ssp_id -> SSPPageMapping.PageID -> запись в PageDSP (PageID, DSPID, ImpID) -> список dspid -> исправление DSPTemplate



=====
resource:
	YTOfferURLDict
	YTPerformanceImage
	YTResource

dspobject:
	YTDSPObjectStat



GetLock(__compress.base1.ChEventLog20160907120500) timeout
2016-09-07 21:54:40] GetLock(__compress.base1.ChEventLog20160907120500) timeout

================

1) Добавить другой логин и пароль для EXTERNAL_GENERATOR  (есть правка)
2) Добаить автоматическое заполнение HOSTOPTION_HOST (есть правка)
3) Добавить возможность ходить на тестинг (есть правка)
4) выпилить script-control (есть правка)
5) ходить снаружи в  DLockConfig, Hosts (есть локальная правка)
6) коннекты нетуда в BidMonitoring (есть локальная правка)
7) запускать привоз глобал-хост-опций периодически при настройке --
8) удалить крон конфиги --
9) bring_host_options без скрипт-контрола (есть правка)
10) хост-опции кешируются для какого-то хоста (есть локальная правка в yabs-host-util) yabs-host-util=159.2
11) локально добавить доступы в mysql для пользователя autobudget (локальная правка в yabs-mysql-grants) yabs-mysql-grants=000.788

EXTERNAL_GENERATOR=1 HOSTOPTION_HOST=bstatloadx2i.yandex.net /home/yabs/stat/autobudget.log
2a02:6b8:b000:130:e8:70ff:feb5:79a6

===================

orderid=8309023

mysql> select OrderID, sum(Clicks) from OrderTargetStat inner join AutoBudgetOrder using(OrderID)  where date(UpdateTime) = '2016-09-12' and TargetType=0 and LimitWeek > 0 group by 1 order by 2 desc limit 10;
+----------+-------------+
| OrderID  | sum(Clicks) |
+----------+-------------+
|  3819338 |         367 |
|  2677921 |         249 |
|  2071335 |         223 |
|  2463016 |         215 |
|  3950304 |         150 |
|  6004737 |         140 |
| 10215888 |         118 |
|  9821866 |         112 |
|  6743543 |         110 |
|   408431 |         106 |
+----------+-------------+
10 rows in set (1.46 sec)

orderid=2071335
ysql> select BaseNo,Clicks from AutoBudgetMonitoringStat201609 where UpdateTime = '2016-09-12 12:00:00' order by 2 desc limit 10
    ->
    -> ;
+--------+--------+
| BaseNo | Clicks |
+--------+--------+
|     69 |   2122 |  нет увеличения cpc
+--------+--------+
10 rows in set (0.04 sec)


olegts@olegts [ 12768.autobudget.start ] :~/arc/trunk/arcadia/yabs/stat/yabs-autobudget2$ mysql -hbsistat01i -uolegts -p yabsdb < query.sql
Enter password:
BaseNo  ClicksDiff      CostDiff
64      159     58.89428200000003
4       157     90.97340099999997
24      154     104.42173300000002
62      151     55.64094300000002
85      151     35.93907899999999

total_target_value = 24240
20160906        12375
20160907        10356
20160909        8958
20160908        8102
20160905        5632
20160912        3779
20160910        2268
20160911        2179
20101018        204
20130306        126
20160406        100



186975312       rplcat  2a02:6b8:0:2518:225:90ff:fe93:10e2:47570        vh      Sleep   25178           NULL 665541/schedule-upl
187044249       rplcat  2a02:6b8:0:2518:225:90ff:fe93:10e2:48700        vh      Sleep   25180           NULL 680049/input-stream
187050088       rplcat  2a02:6b8:0:2518:225:90ff:fe93:10e2:48854        vh      Sleep   25119           NULL 680049/input-stream
187050224       rplcat  2a02:6b8:0:2518:225:90ff:fe93:10e2:48858        vh      Query   25118   Waiting for table metadata lock lock tables\n               ContentGroup write,\n               ContentResource write,\n                665541/schedule-upl

187056729       rplcat  2a02:6b8:0:2518:225:90ff:fe93:10e2:48988        vh      Query   25059   Waiting for table metadata lock SELECT `ContentResource`.`ContentGroupID` AS `ContentResource_ContentGroupID`, `ContentResource`.`Re 680049/input-stream
187083612       rplcat  2a02:6b8:0:2518:225:90ff:fe93:10e2:49405        vh      Query   24845   Waiting for table metadata lock SELECT `ContentGroup`.`ContentGroupId` AS `ContentGroup_ContentGroupId`, `ContentGroup`.`ContentType 687032/video-manage


Ср. сент. 14 17:58:09 MSK 2016

Чт. сент. 15 01:57:09 MSK 2016
187050224       rplcat  2a02:6b8:0:2518:225:90ff:fe93:10e2:48858        vh      Query   118     Waiting for table metadata lock lock tables\n               Co  665541/schedule-upl
Ср. сент. 14 17:58:09 MSK 201
187056729       rplcat  2a02:6b8:0:2518:225:90ff:fe93:10e2:48988        vh      Sleep   28858           NULL  680049/input-stream
Чт. сент. 15 01:58:09 MSK 2016
189899842       rplcat  2a02:6b8:0:2518:225:90ff:fe93:10e2:43984        vh      Query   58      Waiting for table metadata lock SELECT `ContentResource`.`Cont 680049/input-stream
(END)

olegts@vh:~$ sudo netstat -p | grep 48988
tcp6       0      0 vh.yabs.yandex.ru:48988 bsdb02f.yandex.ru:mysql ESTABLISHED 680049/input-stream


lock\(
lock_content_group\(


orderid=11197272
bannerid=2486913844
group_export_id=1934354458
phraseid=1322470113
contexttype=1

bannerid = 2480789399 тоже имеет эту группу
2016/09/16 02:03:30 249349q
:
2016/09/16 02:10:19 442599


2016/09/18 16:27:10 8090  INFO  [apply_set_or_u] set for field OrderID: 13712 rows
2016/09/18 16:27:24 8090  INFO  [apply_set_or_u] set for field ClientID: 2263410 rows
2016/09/18 16:27:24 8090  INFO  [apply_set_or_u] unset for field OrderID: 0 rows
2016/09/18 16:27:24 8090  INFO  [apply_set_or_u] unset for field ClientID: 0 rows


mysql> select count(*) from OrderInfo where find_in_set('external-ssp', Options);
+----------+
| count(*) |
+----------+
|  2277122 |
+----------+
1 row in set (1.32 sec)
===================================



 86         foreach my $sb (@{$self->{collection}}) {
119                 my $itms = $sb->items($last_group_ts, $time_edge_ts, \@tables);


193         my ($sb_send, $items) = @{$subscr->get_items()};
196         _process_items($dprocess_params, $items, $sb_send) if $tt_send;

266         my $f_name = '/tmp/tmp_' . $dprocess_params->{TASK} . '_' . $dprocess_params->{ACTIONID};
267
268         DEBUG("PROCESSING ITEMS");
269         WriteFile($f_name, to_json({
270                 data => $items,
271                 sb_send => $sb_send
272         }, {utf8 => 1}));

olegts@bsint02g:/mnt/raid/home/olegts$ ls /var/lib/dprocess/LoggerSubscriptions1_735529_1
/var/lib/dprocess/LoggerSubscriptions1_735529_1

olegts@bsint02g:/mnt/raid/home/olegts$ ls  /tmp/tmp_LoggerSubscriptions1_724983
/tmp/tmp_LoggerSubscriptions1_724983


153         my $dp_name = Yabs::DProcess::get_default_table_name($dprocess_params);
154         my $data_file = join('/', $DPROCESS_PATH, $dp_name);
156         my $content = ReadFile($data_file);
157         my $data = from_json($content);
my $subscr_data = $data->{data};
my $time_data = $subscr_data->{ $subscription_id };
$items = $sb->append_rss($time_data, 'nosave')->{'items'};


pillar/monitoring/logcount.sls: monitoring: logcount-ng: script: logcount-ng.pl
pillar/yabs/stat-server.sls: include :monitoring.logcount
yabs-clusters/bsint02/init.sls: include: yabs.stat-server
pillar/top.sls: 'G@conductor:all_groups:yabs_bsint2': - match: compound : - yabs-clusters.bsint02

/common/monitoring/config/logcount-ng.conf:{% for k,v in limits|dictsort %} {{ k }} = {{ v }} {% endfor %}

========

on 39f4-39e6c-3ee0001-2eabf035
on 39f4-3a349-3ee0001-ee263046
on 39f4-3a5e4-3ee0001-af433831
on 39f4-3b027-3ee0001-1e07fe75
on 39f4-3b7c0-3ee0001-e622fba8
on 39f4-3bc34-3ee0001-c733dc29
on 39f4-3bffb-3ee0001-b86d1ce0
on 39f4-3c450-3ee0001-8fe1760e


======

common/monitoring/script/cdn-resources.pl
pillar/monitoring/cdn-resources.sls
pillar/yabs-clusters/bstat/init.sls monitoring.cdn-resources

-        self.connect_host(options)
         self.send_videos_and_tasks(self.get_not_sended_videos())
-        SessionMaker.session.commit()

-from cms_common.orm.session_maker import SessionMaker
-
+# TODO:  когда будет добавлены timestamps то можно будет сделать проверку что видео уже давно всё никак не загрузится
+# значит его нужно попробовать загрузить еще раз


one_min.bsyt03g_prestable_bstest_yandex_net.logcount_RotateResourceLog.count
one_min.bsyt02g_prestable_bstest_yandex_net.logcount_RotateHitLog.count
one_min.bsyt01g_prestable_bstest_yandex_net.logcount_RotateVisitLog.count
one_min.bsyt03g_prestable_bstest_yandex_net.logcount_RotateDspObjectLog.count


bsyt_pre
collect-stat-exclude-collectors-Visit YTExperimentStat,YTPerformanceStat
collect-stat-exclude-collectors-Hit YTExperimentStat,YTSearchQuery
collect-stat-exclude-collectors-Resource YTPerformanceImage,YTResource
выключили dsp-object https://bsint.yandex-team.ru/cgi-bin/transferdataconfig.cgi#hostfilter=/bsyt.*prestable.*/&logfilter=/dsp_object/&emptyfilter_hosts=1
выключили dsp https://bsint.yandex-team.ru/cgi-bin/transferdataconfig.cgi#hostfilter=/bsyt.*prestable.*/&logfilter=/dsp/&emptyfilter=1&emptyfilter_hosts=1


| 2016092009483805 |                     1 |      1474370111 |
| 2016092010083010 |                     1 |      1474373719 |
| 2016092010270506 |                     1 |      1474382014 |
| 2016092011391510 |                     1 |      1474382201 |
| 2016092104180509 |                     1 |      1474443247 |
| 2016092111140310 |                     1 |      1474489383 |

r2475437 | scripter | 2016-09-21 19:36:25 +0300 (Ср., 21 сент. 2016) | 1 line
r2450109 | antilost | 2016-08-30 22:19:19 +0300 (Вт., 30 авг. 2016) | 1 line
r2425806 | antilost | 2016-08-08 20:04:42 +0300 (Пн., 08 авг. 2016) | 1 line
r2413992 | a-sid | 2016-07-29 08:19:30 +0300 (Пт., 29 июля 2016) | 1 line
r2373339 | antilost | 2016-06-19 21:06:02 +0300 (Вс., 19 июня 2016) | 1 line
r2097088 | mllnr | 2016-01-27 13:05:56 +0300 (Ср., 27 янв. 2016) | 1 line
r1986635 | antilost | 2015-11-18 17:18:23 +0300 (Ср., 18 нояб. 2015) | 1 line
r1983281 | antilost | 2015-11-13 20:54:05 +0300 (Пт., 13 нояб. 2015) | 1 line
r1977345 | vsuvorov | 2015-11-07 17:16:17 +0300 (Сб., 07 нояб. 2015) | 1 line
r1976777 | antilost | 2015-10-31 04:34:20 +0300 (Сб., 31 окт. 2015) | 1 line


common/monitoring/script/logcount-all.py -- скрипт проверки
common/monitoring/config/logcount-all.yml -- конфиг проверки

bsarchive46h выключена
bsarchive110h выключена
bsarchive107h выключена
bsarchive98h



mysql> select * from PhraseDict where Data = 'ремонт рулевой рейки ~0';
+----------------------+-----------+------+-----------+-------------------------------------------+
| DataMD5              | PhraseID  | Type | WordCount | Data                                      |
+----------------------+-----------+------+-----------+-------------------------------------------+
| 15591593613006124934 | 143466325 |    0 |         3 | ремонт рулевой рейки ~0                   |
+----------------------+-----------+------+-----------+-------------------------------------------+
1 row in set (6.34 sec)
bannerid = 1444736540

a = []; ('table').find('td').each(function (undef, object) {text = $(object).html(); if (text.indexOf("seneca") != -1) {a.push(text)}}); a

RotatePhrasePriceChangeLog201609260353070013


2016/09/20 14:55:17 18875 INFO  [process_check_] one_day.table_monitoring.phrases_without_banners.bad: sent 20888
2016/09/20 14:55:17 18875 INFO  [process_check_] one_day.table_monitoring.phrases_without_banners.all: sent 860598429
2016/09/20 13:15:01 14312 INFO  [process_check_] one_day.table_monitoring.phrases_without_banners.bad: sent 115
2016/09/20 13:15:01 14312 INFO  [process_check_] one_day.table_monitoring.phrases_without_banners.all: sent 860490600


sudo /usr/bin/rsync --dry-run -c --delete-during --files-from=/tmp/cloner_only_files -aqH --sockopts=SO_SNDBUF=2621440,SO_RCVBUF=2621440 --exclude-from=/tmp/exclude_replica_tables --port 21784 fastbone.bsvault07g.yabs.yandex.ru::yabsclonner/mysql.yabs /mnt/shelf/mysql.yabs


rsync -av —ignore-existing -n where:/ to:/ 1>good.txt 2>bad.txt
rsync -av --ignore-existing -n


https://downloader.disk.yandex.ru/disk/e606e765c12e5fffcc082b8e82dbd6519c2e29997ba9d87f83361bcdf5d692f1/57ea87c1/zifJboqqZBJtUb_XFl6PF9VyQCRwacS7zqracjC3NIkZ3G5E-A0J3oXiBsVteTWdklk3nEsX8bWe-lVaovc1nA==?uid=0&filename=Pattern1.mp4&disposition=attachment&hash=ZcEMqBf75PLiYUt7YwE/xZU9yv25z/2PGciTfCpcwiw=:/BackVideos/Pattern1.mp4&limit=0&content_type=video/mp4&fsize=552007&hid=f590d96d84808128af7d3a87b6cb5fce&media_type=video&tknv=v2
https://downloader.disk.yandex.ru/disk/524e10db2f3d1db6b0c291ea5947de3bacba523c78339625773f547369603f5e/57ea8842/zifJboqqZBJtUb_XFl6PF5mW8WbMRzcLGs1eatRqMOA034iX-n-GvqswrRaBDQc_QGEcQDJL6SY0w2GQyNjlfQ==?uid=0&filename=Pattern4.mp4&disposition=attachment&hash=ZcEMqBf75PLiYUt7YwE/xZU9yv25z/2PGciTfCpcwiw=:/BackVideos/Pattern4.mp4&limit=0&content_type=video/mp4&fsize=616513&hid=6b7c27dbda115a37739cd0461436c376&media_type=video&tknv=v2
https://downloader.disk.yandex.ru/disk/a07037d8f06f143facc16209ba6793f37737b9a151e28d63111a7a1f7ba59854/57ea8849/zifJboqqZBJtUb_XFl6PF9-ggiS_XWsKUr2EjqlrbXVgXIqkKkxFbwnsaSxa_ItTMYH36Tt-7TxfTP94gKSAhw==?uid=0&filename=Pattern5.mp4&disposition=attachment&hash=ZcEMqBf75PLiYUt7YwE/xZU9yv25z/2PGciTfCpcwiw=:/BackVideos/Pattern5.mp4&limit=0&content_type=video/mp4&fsize=327345&hid=1d8f34d4306f93593ff06c704dc51030&media_type=video&tknv=v2


rsync -av --include-from=/home/olegts/files-diff-3-2.txt --ignore-existing  /mnt/shelf/mysql.yabs bsvault07e.yabs.yandex.ru:/mnt/shelf/
rsync -n -av --files-from=/home/olegts/files-diff-3-2.txt   /mnt/shelf/ bsvault07e.yabs.yandex.ru::restore-disk-olegts-share 1> good.txt.5 2> bad.txt.5


========


bannerid= 1310906588
tempalteid= 744


фомичев         13:40 26 число
щеглов сергей   15:55 26 число
парыгин         16:25 26 число


==========

Wed Sep 28 14:02:01 MSK 2016
myt1-2813-23202.vm.search.yandex.net
2016/09/28 14:02:02 140780 INFO  [         BEGIN] MYSQL_NOW = now(), mysql_generation_start_time = '20160928140000'
2016/09/28 14:02:02 140780 INFO  [         BEGIN] Search rel powers: 1.0000, 1.0000
2016/09/28 14:02:02 140780 INFO  [         BEGIN] 1065797 is testing for new net autobudget
2016/09/28 14:02:02 140780 INFO  [         BEGIN] 887680 is testing for new net autobudget
2016/09/28 14:02:02 140780 INFO  [         BEGIN] 1372561 is testing for new net autobudget
2016/09/28 14:02:02 140780 INFO  [         BEGIN] 1420541 is testing for new net autobudget
2016/09/28 14:02:02 140780 INFO  [         BEGIN] 1361014 is testing for new net autobudget
2016/09/28 14:02:02 140780 INFO  [         BEGIN] AutoBudget adjusted algoritm is active
2016/09/28 14:02:03 140780 INFO  [         BEGIN] autobudget-hourly-skip-min-hits: 0
2016/09/28 14:02:04 140780 INFO  [        main::] sync server = olegts.haze.yandex.net
2016/09/28 14:02:04 140780 INFO  [yabs_file_lock] locked
ReadGlobalInfo: Unable to read 'scriptcontrol/myt1-2813-23202.vm.search/autobudget': No such file or directory
2016/09/28 14:02:04 140780 INFO  [ CheckRunlevel] runlevel(unknown) != 3
2016/09/28 14:02:04 140780 INFO  [        main::] autobudget(100) 20160928140200 started
2016/09/28 14:02:06 140780 ERROR [  connect_host] connect_host(olegts.haze.yandex.net,yabsdb) failed after 3 attempts: Host '2a02:6b8:b000:a03c:58:6ff:fe56:ae5d' is not allowed to connect to this MySQL server (Yabs::CollectBase @/usr/share/perl5/Yabs/CollectBase.pm:538)
2016/09/28 14:02:06 140780 ERROR [  connect_host] connect_host(olegts.haze.yandex.net,yabsdb) failed after 3 attempts: Host '2a02:6b8:b000:a03c:58:6ff:fe56:ae5d' is not allowed to connect to this MySQL server (Yabs::CollectBase @/usr/share/perl5/Yabs/CollectBase.pm:538)
2016/09/28 14:02:06 140780 ERROR [connect_bstat_] connect_host bstatloadx2i failed (Yabs::AutoBudget::Constants @/usr/share/perl5/Yabs/AutoBudget/Constants.pm:1472)
2016/09/28 14:02:06 140780 ERROR [connect_bstat_] connect_host bstatloadx2i failed (Yabs::AutoBudget::Constants @/usr/share/perl5/Yabs/AutoBudget/Constants.pm:1472)
2016/09/28 14:02:06 140780 FATAL [        main::] connect_bstat_mysql failed (main @/home/yabs/stat/autobudget.pl:156)
2016/09/28 14:02:06 140780 FATAL [        main::] connect_bstat_mysql failed (main @/home/yabs/stat/autobudget.pl:156)
2016/09/29 13:19:55 350746 ERROR [      AUTOLOAD] [YT::MultiClient] Multiline message (12 rows):        (Yabs::YT::MultiClient @/usr/share/perl5/Yabs/YT/MultiClient.pm:100)
2016/09/29 13:19:55 350746 ERROR [      AUTOLOAD] [YT::MultiClient] > YT Exception: Operation timed out
2016/09/29 13:19:55 350746 ERROR [      AUTOLOAD] [YT::MultiClient] >     code            3
2016/09/29 13:19:55 350746 ERROR [      AUTOLOAD] [YT::MultiClient] >     origin          bsnewbt02i.yandex.net on 2016-09-29T10:19:55.919850Z (pid 350746, tid 4dd8655, fid 3f215aa0)
2016/09/29 13:19:55 350746 ERROR [      AUTOLOAD] [YT::MultiClient] >     timeout         8000
2016/09/29 13:19:55 350746 ERROR [      AUTOLOAD] [YT::MultiClient] >  at /usr/lib/perl5/Coro/State.pm line 90
2016/09/29 13:19:55 350746 ERROR [      AUTOLOAD] [YT::MultiClient] >   Coro::State::diehook('YT Exception: Operation timed out\x{a}    code            3\x{a}    o...') called at /usr/share/perl5/YT.pm line 167
2016/09/29 13:19:55 350746 ERROR [      AUTOLOAD] [YT::MultiClient] >   YT::_XSFacade::AUTOLOAD('Yabs::YT::Client=HASH(0x2017b5c8)', '//yabs/PhraseDict', 'ARRAY(0x19e41190)', 'ARRAY(0xf68bca0)', 'HASH(0x1b60b4e8)
2016/09/29 13:19:55 350746 ERROR [      AUTOLOAD] [YT::MultiClient] >   eval {...} called at /usr/share/perl5/Yabs/YT/MultiClient.pm line 95
2016/09/29 13:19:55 350746 ERROR [      AUTOLOAD] [YT::MultiClient] >   Yabs::YT::MultiClient::AUTOLOAD('Yabs::YT::MultiClient=HASH(0x205151d8)', '//yabs/PhraseDict', 'ARRAY(0x19e41190)', 'ARRAY(0xf68bca0)', 'HAS
2016/09/29 13:19:55 350746 ERROR [      AUTOLOAD] [YT::MultiClient] >   Yabs::BT::Drivers::YTHandlerWrapper::AUTOLOAD('Yabs::BT::Drivers::YTHandlerWrapper=HASH(0x1f8352d8)', '//yabs/PhraseDict', 'ARRAY(0x19e41190
2016/09/29 13:19:55 350746 ERROR [      AUTOLOAD] [YT::MultiClient] >   Yabs::BT::YT::__ANON__ called at /usr/lib/perl5/Coro.pm line 715
2016/09/29 13:19:55 350746 ERROR [      AUTOLOAD] [YT::MultiClient] >   Coro::_coro_run called at /home/yabs/stat/bt-launcher.pl line 0



https://downloader.disk.yandex.ru/disk/bbd42a93c76e079aae9b1a9f61064307831f692a0fc5f10081364314e0357534/57ed2793/zifJboqqZBJtUb_XFl6PF5mW8WbMRzcLGs1eatRqMOA034iX-n-GvqswrRaBDQc_QGEcQDJL6SY0w2GQyNjlfQ==?uid=0&filename=Pattern4.mp4&disposition=attachment&hash=ZcEMqBf75PLiYUt7YwE/xZU9yv25z/2PGciTfCpcwiw=:/BackVideos/Pattern4.mp4&limit=0&content_type=video/mp4&fsize=616513&hid=6b7c27dbda115a37739cd0461436c376&media_type=video&tknv=v2=
=================



SELECT sum(arraySum(lambda((goal_id, attribution_type, num), if((goal_id = 12787481) AND (attribution_type = 1), num, 0)), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num))
FROM OrderCounter
WHERE (OrderID = 10859053) AND (EventDate = '2016-09-28')

┌─sum(arraySum(lambda(tuple(goal_id, attribution_type, num), if(and(equals(goal_id, 12787481), equals(attribution_type, 1)), num, 0)), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num))─┐
│                                                                                                                                                                                         99 │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
↑ Progress: 245.97 thousand rows, 7.61 MB (25.96 million rows/s., 803.66 MB/s.)
1 rows in set. Elapsed: 0.010 sec. Processed 245.97 thousand rows, 7.61 MB (24.25 million rows/s., 750.75 MB/s.)

:) select sum(arraySum(goal_id, attribution_type, num -> if (goal_id = 12787481 and attribution_type = 0, num, 0) , GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num ))  from OrderCounter where OrderID = 10859053 and EventDate = '2016-09-28';

SELECT sum(arraySum(lambda((goal_id, attribution_type, num), if((goal_id = 12787481) AND (attribution_type = 0), num, 0)), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num))
FROM OrderCounter
WHERE (OrderID = 10859053) AND (EventDate = '2016-09-28')

┌─sum(arraySum(lambda(tuple(goal_id, attribution_type, num), if(and(equals(goal_id, 12787481), equals(attribution_type, 0)), num, 0)), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num))─┐
│                                                                                                                                                                                          0 │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
↗ Progress: 247.96 thousand rows, 7.70 MB (27.08 million rows/s., 840.57 MB/s.)
1 rows in set. Elapsed: 0.009 sec. Processed 247.96 thousand rows, 7.70 MB (26.96 million rows/s., 837.01 MB/s.)

:) select sum(arraySum(goal_id, attribution_type, num -> if (goal_id = 12787481 and attribution_type = 2, num, 0) , GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num ))  from OrderCounter where OrderID = 10859053 and EventDate = '2016-09-28';

SELECT sum(arraySum(lambda((goal_id, attribution_type, num), if((goal_id = 12787481) AND (attribution_type = 2), num, 0)), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num))
FROM OrderCounter
WHERE (OrderID = 10859053) AND (EventDate = '2016-09-28')

┌─sum(arraySum(lambda(tuple(goal_id, attribution_type, num), if(and(equals(goal_id, 12787481), equals(attribution_type, 2)), num, 0)), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num))─┐
│                                                                                                                                                                                        132 │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
→ Progress: 247.96 thousand rows, 7.70 MB (20.36 million rows/s., 632.03 MB/s.)
1 rows in set. Elapsed: 0.012 sec. Processed 247.96 thousand rows, 7.70 MB (19.82 million rows/s., 615.20 MB/s.)

:) select sum(arraySum(goal_id, attribution_type, num -> if (goal_id = 12787481 and attribution_type = 3, num, 0) , GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num ))  from OrderCounter where OrderID = 10859053 and EventDate = '2016-09-28';

SELECT sum(arraySum(lambda((goal_id, attribution_type, num), if((goal_id = 12787481) AND (attribution_type = 3), num, 0)), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num))
FROM OrderCounter
WHERE (OrderID = 10859053) AND (EventDate = '2016-09-28')

┌─sum(arraySum(lambda(tuple(goal_id, attribution_type, num), if(and(equals(goal_id, 12787481), equals(attribution_type, 3)), num, 0)), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num))─┐
│                                                                                                                                                                                          8 │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
↘ Progress: 247.96 thousand rows, 7.70 MB (25.34 million rows/s., 786.71 MB/s.)
1 rows in set. Elapsed: 0.010 sec. Processed 247.96 thousand rows, 7.70 MB (25.26 million rows/s., 784.03 MB/s.)

:) select sum(arraySum(goal_id, attribution_type, num -> if (goal_id = 12787481 and attribution_type = 4, num, 0) , GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num ))  from OrderCounter where OrderID = 10859053 and EventDate = '2016-09-28';

SELECT sum(arraySum(lambda((goal_id, attribution_type, num), if((goal_id = 12787481) AND (attribution_type = 4), num, 0)), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num))
FROM OrderCounter
WHERE (OrderID = 10859053) AND (EventDate = '2016-09-28')

┌─sum(arraySum(lambda(tuple(goal_id, attribution_type, num), if(and(equals(goal_id, 12787481), equals(attribution_type, 4)), num, 0)), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num))─┐
│                                                                                                                                                                                          0 │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
↓ Progress: 247.96 thousand rows, 7.70 MB (29.36 million rows/s., 911.57 MB/s.)
1 rows in set. Elapsed: 0.009 sec. Processed 247.96 thousand rows, 7.70 MB (28.50 million rows/s., 884.82 MB/s.)
===============

olegts@bsvault01g:/mnt/raid/home/olegts$ grep -E 'DataTime' -r /home/yabs/stat/*.pl /usr/share/perl5/
/usr/share/perl5/Yabs/Conf/MySQL.pm:				# because we add yabsdb.DataTime next
/usr/share/perl5/Yabs/Conf/MySQL.pm:				# because we add yabsdb.DataTime next
/usr/share/perl5/Yabs/Conf/MySQL.pm:			push(@{$item->{'replicate-do-table'}}, 'yabsdb.DataTime', 'checkslave.yabsdb_DataTime');
/usr/share/perl5/Yabs/CollectBase.pm:			yabsdb.DataTime
/usr/share/perl5/Yabs/CollectBase.pm:		WARN("It seems DataTime is not properly filled with ('write-data-time.pl','mastertime') key");
/usr/share/perl5/Yabs/MKDBCheck/HostState.pm:			DataTime
/usr/share/perl5/Yabs/MKDBCheck/HostState.pm:				LocalDataTime
/usr/share/perl5/Yabs/DProcess/Manager.pm:			yabsdb.DataTime
/usr/share/perl5/Yabs/DProcess/Manager.pm:	or return N_ERROR "select from DataTime error: " . $DBI::errstr;

:q
https://nanny.yandex-team.ru/v2/services/production_bk_zookeeper/current_state/instances/'


  - инфраструктура сборки https://arc.yandex-team.ru/wsvn/arc//trunk/arcadia/yabs/vh/cms/package/prepare_pkg.sh?rev=2470336&op=file&ignorews=1

  - faustkun удалить комментарий в коде https://arc.yandex-team.ru/wsvn/arc/trunk/arcadia/yabs/vh/cms/cms_common/cms_common/api/blueprints/admin_blueprint/__init__.py?op=diff&rev=2469969&peg=2469969

  - опять вернули костыль https://arc.yandex-team.ru/wsvn/arc//trunk/arcadia/yabs/vh/cms/cms_common/cms_common/models/content_group/base_content_group.py?rev=2469443&op=diff&ignorews=1

====
удалено содержимое файла
https://arc.yandex-team.ru/wsvn/arc/branches/yabs/yabs-export-scripts-fast/r029/ft/Yabs/TableDefs/ClickHousePhraseDict?op=diff&rev=2481591&peg=2481591

alyx=18_4,seneca-sas=18_4,seneca-fin=18_4,barney=18_5,pareto-man=17_5,pareto-myt=17_5,locke=18_4



========================


mysql> select TargetType,sum(CounterType = 1) from order_10162863_events3 inner join Page using(PageID) where FraudBits = 0  and BannerID=2046238722 and PhraseID = 7549236381295834335 and ContextType = 3 group by 1;
+------------+----------------------+
| TargetType | sum(CounterType = 1) |
+------------+----------------------+
|          0 |                   39 |
|          2 |                    1 |
+------------+----------------------+
2 rows in set (0.00 sec)



 !!! PRODUCTION !!! root@bstat31f.yandex.ru [yabsdb]> select TargetType,sum(Shows) from DirectPhraseStat201609 where orderid=10162863 and UpdateTime = '2016-09-28'  and BannerID=2046238722 and PhraseID = 7549236381295834335 and ContextType = 3 group by 1;
+------------+------------+
| TargetType | sum(Shows) |
+------------+------------+
|          0 |         41 |
|          2 |          2 |
+------------+------------+
2 rows in set (0.00 sec)


[Serial] > exec bstat31.* mysql -uroot yabsdb -e ' select *from DirectPhraseStat201609 where orderid=10162863 and UpdateTime = "2016-09-28"  and BannerID=2046238722 and PhraseID = 7549236381295834335 and ContextType = 3 and TargetType=2 group by 1'

=== bstat31i.yandex.ru (@sas-2-3-3), 1/3 ===
OrderID	UpdateTime	BannerID	PhraseID	TargetType	ContextType	Shows	Clicks	Cost	CostCur	SessionNum	SessionLen	SessionCost	GoalsNum	SessionDepth
10162863	2016-09-28 00:00:00	2046238722	7549236381295834335	2	3	2	0	0	0	0	0	0	0	0

=== bstat31f.yandex.ru (@myt6), 2/3 ===
OrderID	UpdateTime	BannerID	PhraseID	TargetType	ContextType	Shows	Clicks	Cost	CostCur	SessionNum	SessionLen	SessionCost	GoalsNum	SessionDepth
10162863	2016-09-28 00:00:00	2046238722	7549236381295834335	2	3	2	0	0	0	0	0	0	0	0
s
=== bstat31h.yandex.ru (@ugr7), 3/3 ===
OrderID	UpdateTime	BannerID	PhraseID	TargetType	ContextType	Shows	Clicks	Cost	CostCur	SessionNum	SessionLen	SessionCost	GoalsNum	SessionDepth
10162863	2016-09-28 00:00:00	2046238722	7549236381295834335	2	3	2	0	0	0	0	0	0	0	0
[Serial] >

order_10162863_events3


=====
0.918     Yabs::Funcs::GetTableRowsTime2                                                    Count=12.5  Min=0.059     Max=0.290     Avg=0.073     Speed=0.00
    0.913    ( 99.5%)  DBI-execute@Yabs::MySQL::Utils:944

8.624     Yabs::Funcs::GetTableRowsTime2                                                    Count=8.4   Min=0.639     Max=7.914     Avg=1.029     Speed=0.00
    8.621    (100.0%)  DBI-execute@Yabs::MySQL::Utils:944



order_1039857_events
order_10162863_events3

mysql> select TargetType,sum(CounterType = 1) from order_10162863_events3 inner join Page using(PageID) where FraudBits = 0  and BannerID=2046238722 and PhraseID = 7549236381295834335 and ContextType = 3 group by 1;
+------------+----------------------+
| TargetType | sum(CounterType = 1) |
+------------+----------------------+
|          0 |                   39 |
|          2 |                    1 |
+------------+----------------------+
2 rows in set (0.00 sec)

mysql> select TargetType,sum(CounterType = 1) from order_1039857_events2 inner join Page using(PageID) where FraudBits = 0  and BannerID=2046238722 and PhraseID = 7549236381295834335 and ContextType = 3 group by 1;
+------------+----------------------+
| TargetType | sum(CounterType = 1) |
+------------+----------------------+
|          0 |                    2 |
|          2 |                    1 |
+------------+----------------------+
2 rows in set (0.01 sec)

(Pdb) n
> /usr/lib/python2.7/dist-packages/sqlalchemy/sql/visitors.py(122)traverse_single()
-> return meth(obj, **kw)
(Pdb) n
ProgrammingError: Programm...ne 7")',)
> /usr/lib/python2.7/dist-packages/sqlalchemy/sql/visitors.py(122)traverse_single()
-> return meth(obj, **kw)

> /usr/lib/python2.7/dist-packages/sqlalchemy/engine/ddl.py(89)visit_table()
-> self.connection.execute(schema.CreateTable(table))
(Pdb)
ProgrammingError: Programm...ne 7")',)
> /usr/lib/python2.7/dist-packages/sqlalchemy/engine/ddl.py(89)visit_table()
-> self.connection.execute(schema.CreateTable(table))

(Pdb)
> /usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py(662)execute()
-> params)
(Pdb)
ProgrammingError: Programm...ne 7")',)
> /usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py(662)execute()
-> params)
(Pdb)

> /usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py(805)_execute_text()
-> statement, parameters
(Pdb)
ProgrammingError: Programm...xist")',)
> /usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py(805)_execute_text()
-> statement, parameters

(Pdb) bt
  /usr/bin/py.test(9)<module>()
-> load_entry_point('pytest==2.7.1', 'console_scripts', 'py.test')()
  /usr/lib/python2.7/dist-packages/_pytest/config.py(41)main()
-> return config.hook.pytest_cmdline_main(config=config)
  /usr/lib/python2.7/dist-packages/_pytest/core.py(521)__call__()
-> return self._docall(self.methods, kwargs)
  /usr/lib/python2.7/dist-packages/_pytest/core.py(528)_docall()
-> firstresult=self.firstresult).execute()
  /usr/lib/python2.7/dist-packages/_pytest/core.py(394)execute()
-> res = method(*args)
  /usr/lib/python2.7/dist-packages/_pytest/main.py(116)pytest_cmdline_main()
-> return wrap_session(config, _main)
  /usr/lib/python2.7/dist-packages/_pytest/main.py(84)wrap_session()
-> doit(config, session)
  /usr/lib/python2.7/dist-packages/_pytest/main.py(122)_main()
-> config.hook.pytest_runtestloop(session=session)
  /usr/lib/python2.7/dist-packages/_pytest/core.py(521)__call__()
-> return self._docall(self.methods, kwargs)
  /usr/lib/python2.7/dist-packages/_pytest/core.py(528)_docall()
-> firstresult=self.firstresult).execute()
  /usr/lib/python2.7/dist-packages/_pytest/core.py(394)execute()
-> res = method(*args)
  /usr/lib/python2.7/dist-packages/_pytest/main.py(142)pytest_runtestloop()
-> item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
  /usr/lib/python2.7/dist-packages/_pytest/core.py(521)__call__()
-> return self._docall(self.methods, kwargs)
  /usr/lib/python2.7/dist-packages/_pytest/core.py(528)_docall()
-> firstresult=self.firstresult).execute()
  /usr/lib/python2.7/dist-packages/_pytest/core.py(393)execute()
-> return wrapped_call(method(*args), self.execute)
  /usr/lib/python2.7/dist-packages/_pytest/core.py(107)wrapped_call()
-> call_outcome = CallOutcome(func)
  /usr/lib/python2.7/dist-packages/_pytest/core.py(123)__init__()
-> self.result = func()
  /usr/lib/python2.7/dist-packages/_pytest/core.py(394)execute()
-> res = method(*args)
  /usr/lib/python2.7/dist-packages/_pytest/runner.py(65)pytest_runtest_protocol()
-> runtestprotocol(item, nextitem=nextitem)
  /usr/lib/python2.7/dist-packages/_pytest/runner.py(72)runtestprotocol()
-> rep = call_and_report(item, "setup", log)
  /usr/lib/python2.7/dist-packages/_pytest/runner.py(119)call_and_report()
-> call = call_runtest_hook(item, when, **kwds)
  /usr/lib/python2.7/dist-packages/_pytest/runner.py(137)call_runtest_hook()
-> return CallInfo(lambda: ihook(item=item, **kwds), when=when)
  /usr/lib/python2.7/dist-packages/_pytest/runner.py(149)__init__()
-> self.result = func()
  /usr/lib/python2.7/dist-packages/_pytest/runner.py(137)<lambda>()
-> return CallInfo(lambda: ihook(item=item, **kwds), when=when)
  /usr/lib/python2.7/dist-packages/_pytest/core.py(521)__call__()
-> return self._docall(self.methods, kwargs)
  /usr/lib/python2.7/dist-packages/_pytest/core.py(528)_docall()
-> firstresult=self.firstresult).execute()
  /usr/lib/python2.7/dist-packages/_pytest/core.py(393)execute()
-> return wrapped_call(method(*args), self.execute)
  /usr/lib/python2.7/dist-packages/_pytest/core.py(107)wrapped_call()
-> call_outcome = CallOutcome(func)
  /usr/lib/python2.7/dist-packages/_pytest/core.py(123)__init__()
-> self.result = func()
  /usr/lib/python2.7/dist-packages/_pytest/core.py(394)execute()
-> res = method(*args)
  /usr/lib/python2.7/dist-packages/_pytest/runner.py(86)pytest_runtest_setup()
-> item.session._setupstate.prepare(item)
  /usr/lib/python2.7/dist-packages/_pytest/runner.py(403)prepare()
-> col.setup()
  /usr/lib/python2.7/dist-packages/_pytest/python.py(1187)setup()
-> fillfixtures(self)
  /usr/lib/python2.7/dist-packages/_pytest/python.py(692)fillfixtures()
-> request._fillfixtures()
  /usr/lib/python2.7/dist-packages/_pytest/python.py(1335)_fillfixtures()
-> item.funcargs[argname] = self.getfuncargvalue(argname)
  /usr/lib/python2.7/dist-packages/_pytest/python.py(1378)getfuncargvalue()
-> return self._get_active_fixturedef(argname).cached_result[0]
  /usr/lib/python2.7/dist-packages/_pytest/python.py(1395)_get_active_fixturedef()
-> result = self._getfuncargvalue(fixturedef)
  /usr/lib/python2.7/dist-packages/_pytest/python.py(1441)_getfuncargvalue()
-> val = fixturedef.execute(request=subrequest)
  /usr/lib/python2.7/dist-packages/_pytest/python.py(1907)execute()
-> self.yieldctx)
  /usr/lib/python2.7/dist-packages/_pytest/python.py(1832)call_fixture_func()
-> res = fixturefunc(**kwargs)
  /var/lib/yabs-parasprite-pytest/yabs-vh-backend-pt/ft/test_input_stream_uploader.py(161)input_stream_uploader_fixture()
-> pre_compare=request.param["out"].get("pre_queries"),
  /var/lib/yabs-parasprite-pytest/yabs-vh-backend-pt/ft/mysql_comparator.py(68)__init__()
-> bind=engine)
  /usr/lib/python2.7/dist-packages/sqlalchemy/schema.py(616)create()
-> checkfirst=checkfirst)
  /usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py(1479)_run_visitor()
-> conn._run_visitor(visitorcallable, element, **kwargs)
  /usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py(1122)_run_visitor()
-> **kwargs).traverse_single(element)
  /usr/lib/python2.7/dist-packages/sqlalchemy/sql/visitors.py(122)traverse_single()
-> return meth(obj, **kw)
  /usr/lib/python2.7/dist-packages/sqlalchemy/engine/ddl.py(89)visit_table()
-> self.connection.execute(schema.CreateTable(table))
  /usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py(662)execute()
-> params)
  /usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py(720)_execute_ddl()
-> compiled
  /usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py(867)_execute_context()
-> context)
> /usr/lib/python2.7/dist-packages/sqlalchemy/engine/default.py(324)do_execute()
-> cursor.execute(statement, parameters)
:

/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py:714

> /usr/lib/python2.7/dist-packages/sqlalchemy/sql/compiler.py(1939)visit_create_table()
-> processed = self.process(create_column,
(Pdb) p self.process(create_column,first_pk=column.primary_key and not first_pk)
'`Options` SET(deleted)'

(Pdb) n
> /usr/lib/python2.7/dist-packages/sqlalchemy/sql/compiler.py(1978)visit_create_column()
-> text = self.get_column_specification(
(Pdb) p self.get_column_specification(column,first_pk=first_pk)
'`Options` SET(deleted)'

> /usr/lib/python2.7/dist-packages/sqlalchemy/dialects/mysql/base.py(1512)get_column_specification()
-> colspec = [self.preparer.format_column(column),
(Pdb) p self.preparer.format_column(column)
'`Options`'
(Pdb) p self.dialect.type_compiler.process(column.type)
'SET(deleted)'
(Pdb)

parasprite ~ # dpkg -S /usr/lib/python2.7/dist-packages/sqlalchemy/dialects/mssql/base.py
dpkg-query: no path found matching pattern /usr/lib/python2.7/dist-packages/sqlalchemy/dialects/mssql/base.py.

:!diff /usr/lib/python2.7/dist-packages/sqlalchemy/dialects/mysql/base.py new_base.py
1925c1925
<                                         ",".join(type_._ddl_values))
---
>                                         ",".join(['"' + value + '"' for value in  type_._ddl_values]))

shell returned 1

/var/lib/yabs-parasprite-pytest/yabs-vh-backend-pt/ft/diff

yabs:yabs * postinstall-pt /usr/share/yabs-vh-backend-pt

yabs:yabs * cms_common/cms_common usr/lib/python2.7/dist-packages


/usr/lib/python2.7/dist-packages/sqlalchemy/engine/base.py:891

((Pdb)) l
777  	        Else the cursor is automatically closed and None is returned.
778
779  	        """
780  	        try:
781  	            row = self._fetchone_impl()
782  ->	            if row is not None:
783  	                return self.process_rows([row])[0]
784  	            else:
785  	                self.close()
786  	                return None
787  	        except Exception, e:
((Pdb)) p self.process_rows([row])[0]
(12, 1, 0, u'\u0420\u0415\u041d \u0422\u0412', u'\u0440\u0435\u043d \u0442\u0432', set([u'']), datetime.datetime(2016, 10, 5, 13, 30))
((Pdb)) p row
(12, 1, 0, '\xd0\xa0\xd0\x95\xd0\x9d \xd0\xa2\xd0\x92', '\xd1\x80\xd0\xb5\xd0\xbd \xd1\x82\xd0\xb2', u'', datetime.datetime(2016, 10, 5, 13, 30))
((Pdb))

Yabs::Stat::Collectors::ClickHousePerformanceDSPPageStat::_task_collect
Yabs::Stat::Collectors::BadDomains::_task_collect


-rw-rw---- 1 yabs yabs 268603356 окт.   5 20:59 /var/lib/mysql.yabs/bsdb-bin.575085

stop slave; change master to MASTER_HOST='bsdb02g.yandex.ru', MASTER_LOG_FILE='bsdb-bin.575085', MASTER_LOG_POS=0; start slave;


2016/10/06 16:03:19 5664  INFO  [write_to_resou] Inserted 815 rows to ResourcePreLog


dns-monkey.pl --zone-update --expression "add-cname(300) vh-backend-prod.yandex.ru vh01i.yabs.yandex.ru" --debug

(P1231432|P1231433|P1079307|P944734|(P1225608&P169922&P1225609)|(P1207079&P1225609))

3 больших бургера и сырные палочки

22 files


43,49


baseno 32, baseno 52 патч с делением на ноль
baseno 134, baseno 20, baseno 09 хост-опция autobudget-refine-banners-at-the-start

bstat46:
8694066
8694066

dbmon-phrases-without-banners-get-data-from-hahn BSDEV-59079 1
dbmon-performance-order-wins-get-data-from-hahn BSDEV-59059 1
dbmon-rotate-dsp-log-win-get-data-from-hahn BSDEV-59060 1


Первый запуск:
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] [22] Table base2.SetUIDLog20130202012000 NOT OK
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] [27] Table base2.QTailLog20131011102500 OK
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] Multiline message (8 rows):
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] > failed to select from base2.ChEventLog20140708095000 : DBD::mysql::db do failed: Incorrect information in
	file: './base2/ChEventLog20140708095000.frm' at host 'local' at ./detect-broken-tables.pl line 21.
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] >  at /usr/lib/perl5/Coro/State.pm line 90.
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] >     Coro::State::diehook('DBD::mysql::db do failed: Incorrect information in file: \'./...') called at ./d
	etect-broken-tables.pl line 21
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] >     eval {...} called at ./detect-broken-tables.pl line 20
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] >     main::check_tables_for_task('DBI::db=HASH(0x378e4a0)', 'ARRAY(0x197f380)', 25) called at /usr/share/pe
	rl5/PoolController.pm line 315
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] >     eval {...} called at /usr/share/perl5/PoolController.pm line 314
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] >     PoolController::__ANON__ called at /usr/lib/perl5/Coro.pm line 715
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] >     Coro::_coro_run called at ./detect-broken-tables.pl line 0
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] [25] Table base2.ChEventLog20140708095000 NOT OK
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] [23] Table base2.XUniqsLog20130514040500 OK
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] Multiline message (8 rows):
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] > failed to select from base2.FraudBitsLog20130418044000 : DBD::mysql::db do failed: Lost connection to MySQ
	L server during query at host 'local' at ./detect-broken-tables.pl line 21.
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] >  at /usr/lib/perl5/Coro/State.pm line 90.
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] >     Coro::State::diehook('DBD::mysql::db do failed: Lost connection to MySQL server dur...') called at ./d
	etect-broken-tables.pl line 21
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] >     eval {...} called at ./detect-broken-tables.pl line 20
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] >     main::check_tables_for_task('DBI::db=HASH(0x394f168)', 'ARRAY(0xa436e0)', 0) called at /usr/share/perl
	5/PoolController.pm line 315
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] >     eval {...} called at /usr/share/perl5/PoolController.pm line 314
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] >     PoolController::__ANON__ called at /usr/lib/perl5/Coro.pm line 715
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] >     Coro::_coro_run called at ./detect-broken-tables.pl line 0
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] [0] Table base2.FraudBitsLog20130418044000 NOT OK
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] Multiline message (8 rows):
	2016/10/10 17:43:49 155128 INFO  [check_tables_f] > failed to select from base2.XUniqsLog20120901115000 : DBD::mysql::db do failed: MySQL server has gone away at host 'local' at ./detect-broken-tables.pl line 21.


Второй запуск:

	2016/10/10 22:15:49 650477 INFO  [check_tables_f] [18] Table base2.FraudBitsLog20121203113000 OK
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] Multiline message (8 rows):
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] > failed to select from base2.QTailLog20121017233500 : DBD::mysql::db do failed: File './base2/QTailLog20121
	017233500.MYD' not found (Errcode: 13) at host 'local' at ./detect-broken-tables.pl line 21.
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] >  at /usr/lib/perl5/Coro/State.pm line 90.
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] >     Coro::State::diehook('DBD::mysql::db do failed: File \'./base2/QTailLog201210172335...') called at ./d
	etect-broken-tables.pl line 21
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] >     eval {...} called at ./detect-broken-tables.pl line 20
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] >     main::check_tables_for_task('DBI::db=HASH(0x38c7000)', 'ARRAY(0x191c258)', 27) called at /usr/share/pe
	rl5/PoolController.pm line 315
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] >     eval {...} called at /usr/share/perl5/PoolController.pm line 314
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] >     PoolController::__ANON__ called at /usr/lib/perl5/Coro.pm line 715
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] >     Coro::_coro_run called at ./detect-broken-tables.pl line 0
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] [27] Table base2.QTailLog20121017233500 NOT OK
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] Multiline message (8 rows):
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] > failed to select from base2.XUniqsLog20120806193500 : DBD::mysql::db do failed: Lost connection to MySQL s
	erver during query at host 'local' at ./detect-broken-tables.pl line 21.
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] >  at /usr/lib/perl5/Coro/State.pm line 90.
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] >     Coro::State::diehook('DBD::mysql::db do failed: Lost connection to MySQL server dur...') called at ./d
	etect-broken-tables.pl line 21
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] >     eval {...} called at ./detect-broken-tables.pl line 20
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] >     main::check_tables_for_task('DBI::db=HASH(0x38c7000)', 'ARRAY(0x191c258)', 27) called at /usr/share/pe
	rl5/PoolController.pm line 315
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] >     eval {...} called at /usr/share/perl5/PoolController.pm line 314
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] >     PoolController::__ANON__ called at /usr/lib/perl5/Coro.pm line 715
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] >     Coro::_coro_run called at ./detect-broken-tables.pl line 0
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] [27] Table base2.XUniqsLog20120806193500 NOT OK
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] Multiline message (8 rows):
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] > failed to select from base2.SlicedELog20131028190500 : DBD::mysql::db do failed: MySQL server has gone away at host 'local' at ./detect-broken-tables.pl line 21.
	2016/10/10 22:15:49 650477 INFO  [check_tables_f] >  at /usr/lib/perl5/Coro/State.pm line 90.



======================





--> 1) Таблицы, у которых нет 3 файлов
root@bsvault07e:/mnt/shelf# ls partially_saved_tables/ | wc -l
2246

--> 2) Таблицы, из-за чтения которых падает mysql server
root@bsvault07e:/mnt/shelf# ls damaged_tables/|wc -l
6

 base2.ChEventLog20140828064500


/var/lib/mysql.yabs/base1/ChEventLog20140828064000.frm


sudo -u yabs myisamchk --silent --recover --sort-buffer-size=1G --key-buffer-size=1G --sort-index --analyze /var/lib/mysql.yabs/base2/ChEventLog20140828064500.MYI
mysql> select count(EventCost) from base2.ChEventLog20140828064500;
+------------------+
| count(EventCost) |
+------------------+
|         12789409 |
+------------------+
1 row in set (0.00 sec)

mysql> select count(*) from base2.ChEventLog20140828064500;
+----------+
| count(*) |
+----------+
| 12789409 |
+----------+
1 row in set (0.00 sec)
i



OK  3) Файлы были с неправильным пермишном, исправили
root@bsvault07e:~# grep 'failed to select' detect-broken-tables.log.5  | grep 'File.*not found' | wc -l
35085

--> 4) Плохая frm. Пробовал заменить на frm-ки от соседних таблиц, а потом сделать repair table -- не получается
root@bsvault07e:~# grep 'failed to select' detect-broken-tables.log.5  | grep 'Incorrect information in file'|wc -l
3180

--> 5) Помогает repair table ... use_frm но данные становятся неполными

root@bsvault07e:~# grep 'failed to select' detect-broken-tables.log.5 | grep 'Incorrect file format' | wc -l
1137

FraudBitsLog20120802015000

/var/lib/mysql.yabs/base1/FraudBitsLog20120802091500.frm


root@bsvault07e:~# grep 'failed to select' detect-broken-tables.log.5 | grep 'is marked as crashed and should be repaired' | wc -l
762



6) не чинится

root@bsvault07e:~# grep 'failed to select' detect-broken-tables.log.5 | grep 'Unknown storage engine' | wc -l
6

---

7) Все плохие файлы перенесены в  /mnt/shelf/backup_crashed_tables/

root@bsvault07e:~# wc -l /home/yabs/broken-tables.txt
40173 /home/yabs/broken-tables.txt
root@bsvault07e:~# grep 'NOT OK' detect-broken-tables.log.5| wc -l
40173
root@bsvault07e:~# cat /home/yabs/broken-tables.txt | sort | uniq | wc -l
13391
Type "help", "copyright", "credits" or "license" for more information.
>>> 13391*3
40173
>>>
root@bsvault07e:~# ls /mnt/shelf/backup_crashed_tables  |wc -l
40170
root@bsvault07e:~# cat /home/yabs/broken-tables.txt|sort | uniq -c |grep base2.$
      3 base2.

8) Удалось восстановить 18 таблиц



9) Осталось 13373 плохих таблиц


Пробуем операции
check table
другая frm
flush table
check table
myisamchk
check table


root@bsvault07e:~# wc -l /root/broken-tables.txt
40173 /root/broken-tables.txt

root@bsvault07e:~# cat /root/broken-tables.txt | sed 's/[0-9]//g' | sort | uniq -c | sort -nk 1
      3 base.
      3 yabsdb.MySQLTablesMonStat
    156 base.SlicedELog
    255 base.ChEventLog
    267 base.EventBadLog
    291 base.LiteHitLog
    489 base.XUniqsLog
   1788 base.LiteVisitLog
   3039 base.FraudBitsLog
   6279 base.QTailLog
   9345 base.DspLog
  18258 base.SetUIDLog






root@bsvault07e:~# grep OK detect-broken-tables.log.5| wc -l
155523
root@bsvault07e:~# grep OK detect-broken-tables.log.5| grep -v 'NOT OK' | wc -l
115350
root@bsvault07e:~# grep 'NOT OK' detect-broken-tables.log.5| wc -l
40173

>>> 35085+3180+1137+762+6+3
40173




Yabs::Stat::Collectors::ClickHouseCoordStat::_task_collect
abs::Stat::Collectors::ClickHousePerformanceDSPPageStat::_task_collect :

(gdb) p U.Coeffs.size()
$4 = 1
(gdb) p this
$5 = (CauchyProblem * const) 0xaa3400

(gdb) p this
$6 = (CauchyProblem * const) 0x54d0a2 <PyEval_EvalFrameEx+6194>

(gdb) p this->U.Coeffs.size()
$7 = 1
(gdb) p this
$8 = (CauchyProblem * const) 0xb3b990

(gdb) p this
$9 = (CauchyProblem * const) 0x54d0a2 <PyEval_EvalFrameEx+6194>

(Pdb) p self.obj
11952832

(Pdb) p cauchy_problem.obj
11952832

(Pdb) p self_object
11952832

mysql> select * from BroadMatchShowsClicks where BannerID = 844230742 and BroadPhraseID = 4728139926459047763;
+-----------+---------------------+-------------+---------------------+--------+---------+----------+---------+
| BannerID  | BroadPhraseID       | ContextType | UpdateTime          | PShows | PClicks | DShows   | DClicks |
+-----------+---------------------+-------------+---------------------+--------+---------+----------+---------+
| 844230742 | 4728139926459047763 |           3 | 2016-10-11 00:00:00 |      0 |       0 | 11890918 |    9663 |
+-----------+---------------------+-------------+---------------------+--------+---------+----------+---------+
1 row in set (0.00 sec)

mysql> select * from BroadMatchShowsClicks where BannerID = 844230742 and BroadPhraseID = 4728139926459047763;
+-----------+---------------------+-------------+---------------------+--------+---------+----------+---------+
| BannerID  | BroadPhraseID       | ContextType | UpdateTime          | PShows | PClicks | DShows   | DClicks |
+-----------+---------------------+-------------+---------------------+--------+---------+----------+---------+
| 844230742 | 4728139926459047763 |           3 | 2016-10-11 00:00:00 |      0 |       0 | 11899918 |    9663 |
+-----------+---------------------+-------------+---------------------+--------+---------+----------+---------+
1 row in set (0.00 sec)

bsvault23i
bsvault24i
bsvault25i
bsvault26i
bsvault27i

1) bspstat05g.yandex.ru томозит collect-dsp
Yabs::Stat::Collectors::RtbDsp::_task_collect
 Yabs::Stat::Collectors::RtbPriceWeight::_task_collect

требуется замена памяти
2) bspstat07g.yandex.ru

требуется замена памяти


bspstat11h.yandex.ru


99.267    Yabs::Stat::Collectors::ClickHouseSSPCraterStat::_task_collect              Count=19.7  Min=1.275     Max=16.897    Avg=5.047     Speed=0.000
81.056    Yabs::Stat::Collectors::MakeHitLogBuffer::_task_collect                     Count=19.7  Min=0.937     Max=14.665    Avg=4.121     Speed=0.000
78.729    Yabs::Stat::Collectors::BadDomains::_task_collect                           Count=19.7  Min=0.593     Max=22.627    Avg=4.003     Speed=0.000
70.252    Yabs::Stat::Collectors::ClickHouseCoordStat::_task_collect                  Count=19.7  Min=0.888     Max=12.541    Avg=3.572     Speed=0.000
67.212    Yabs::Stat::Collectors::ClickHousePerformanceDSPPageStat::_task_collect     Count=19.7  Min=0.924     Max=11.418    Avg=3.418     Speed=0.000
59.627    Yabs::Stat::Collectors::ClickHousePerformanceSearchPageStat::_task_collect  Count=19.7  Min=0.858     Max=12.035    Avg=3.032     Speed=0.000
6.559     Yabs::Stat::Collectors::TmpPageSSP::_task_collect                           Count=19.7  Min=0.136     Max=8.375     Avg=0.334     Speed=0.000
0.881     Yabs::Stat::Collectors::TmpMainRegion::_task_collect                        Count=19.7  Min=0.017     Max=2.029     Avg=0.045     Speed=0.000
 production environment


| RtbGroupStat7 |    39664 |           1 | 2016-10-10 11:35:07 |     3 |             0 |
| RtbGroupStat7 |    39665 |           1 | 2016-10-10 11:50:12 |     2 |             0 |


MAN_AUTOBUDGET_GUEST

2a02:6b8:b000:6504:e8:6ff:fea0:70c8
production_yabs_autobudget_man



[pid=22818->30469]  DB<8> x $banid
0  1194838108




mysql> select * from ContentGroup where ContentGroupID in (2,139,3367,3368,3369,3370,3371,3372,3373,3374);
+----------------+---------------+----------+----------------------------------------------------------------------------+-----------------------------------------------------+---------------------+---------+-----------+---------------------+
| ContentGroupID | ContentTypeID | ParentID | Comment                                                                    | Name                                                | UpdateTime          | Options | OvsStatus | TMP_OvsServiceFlags |
+----------------+---------------+----------+----------------------------------------------------------------------------+-----------------------------------------------------+---------------------+---------+-----------+---------------------+
|              2 |             2 |        1 | Пример орбиты                                                              | Совершенно Cекретно (Москва)                        | 2016-10-17 17:44:35 |         |           |                     |
|            139 |             2 |      138 |                                                                            | РЕН ТВ                                              | 2016-10-17 17:44:35 |         |           |                     |
|           3367 |             2 |     3359 | кабельный канал «Браво ТВ»                                                 | Браво ТВ                                            | 2016-10-17 17:45:40 |         |           |                     |
|           3368 |             2 |     3360 | кабельный канал «Санкт-Петербург»                                          | Санкт-Петербург                                     | 2016-10-17 17:45:40 |         |           |                     |
|           3369 |             2 |     3361 | кабельный канал «Первый Интернет Канал»                                    | Первый Интернет Канал                               | 2016-10-17 17:45:40 |         |           |                     |
|           3370 |             2 |     3362 | кабельный канал «HardLife TV»                                              | HardLife TV                                         | 2016-10-17 17:45:40 |         |           |                     |
|           3371 |             2 |     3363 | кабельный канал «Global Star»                                              | Global Star                                         | 2016-10-17 17:45:40 |         |           |                     |
|           3372 |             2 |     3364 | кабельный канал «Успех»                                                    | Успех                                               | 2016-10-17 17:45:40 |         |           |                     |
|           3373 |             2 |     3365 | кабельный канал «Еда»                                                      | Еда                                                 | 2016-10-17 17:45:40 |         |           |                     |
|           3374 |             2 |     3366 | кабельный канал «PRO Business»                                             | PRO Business                                        | 2016-10-17 17:45:40 |         |           |                     |
+----------------+---------------+----------+----------------------------------------------------------------------------+-----------------------------------------------------+---------------------+---------+-----------+---------------------+
10 rows in set (0.01 sec)

mysql>  select ContentGroupID ,ContentVersionID from ContentVersionGroup where ContentGroupID in (2,139,3367,3368,3369,3370,3371,3372,3373,3374);
+----------------+------------------+
| ContentGroupID | ContentVersionID |
+----------------+------------------+
|              2 |                2 |
|            139 |                1 |
|           3367 |             1665 |
|           3368 |             1666 |
|           3369 |             1667 |
|           3370 |             1668 |
|           3371 |             1669 |
|           3372 |             1670 |
|           3373 |             1671 |
|           3374 |             1672 |
+----------------+------------------+
10 rows in set (0.01 sec)


https://st.yandex-team.ru/BSMON-4054
https://st.yandex-team.ru/BSMON-4056
https://st.yandex-team.ru/BSMON-4058
https://st.yandex-team.ru/BSMON-4060
https://st.yandex-team.ru/BSMON-4062
https://st.yandex-team.ru/BSMON-4064
https://st.yandex-team.ru/BSMON-4066
https://st.yandex-team.ru/BSMON-4069
https://st.yandex-team.ru/BSMON-4073
https://st.yandex-team.ru/BSMON-4075
https://st.yandex-team.ru/BSMON-4076
https://st.yandex-team.ru/BSMON-4077
https://st.yandex-team.ru/BSMON-4078
https://st.yandex-team.ru/BSMON-4080
https://st.yandex-team.ru/BSMON-4083

https://st.yandex-team.ru/BSMON-4072



Плохие тикеты с обработанными логами

плохая обработка only-name: bsarchive116:
https://st.yandex-team.ru/BSMON-4095
https://st.yandex-team.ru/BSMON-4093

bsarchive57h, неизвестная проблема
https://st.yandex-team.ru/BSMON-4080/
https://st.yandex-team.ru/BSMON-4083
https://st.yandex-team.ru/BSMON-4084
/
отсутствтующие хосты: bspstat05g, bspstat07g:
https://st.yandex-team.ru/BSMON-4047
https://st.yandex-team.ru/BSMON-4073
https://st.yandex-team.ru/BSMON-4075
https://st.yandex-team.ru/BSMON-4076
https://st.yandex-team.ru/BSMON-4077
https://st.yandex-team.ru/BSMON-4078
https://st.yandex-team.ru/BSMON-4080
https://st.yandex-team.ru/BSMON-4083
https://st.yandex-team.ru/BSMON-4084
https://st.yandex-team.ru/BSMON-4086
https://st.yandex-team.ru/BSMON-4088
https://st.yandex-team.ru/BSMON-4089
https://st.yandex-team.ru/BSMON-4091

другие bsarchive:
https://st.yandex-team.ru/BSMON-4066
https://st.yandex-team.ru/BSMON-4091

RotateAbuseLog2016101414281810
обработан на bsarchive43, bsarchive57
bsbuffer3-02k.yabs.yandex.ru: /home/yabs/stat/log/process-abuse.log.3.gz:2016/10/14 17:28:20 6295  INFO  [     put_value] [RotateAbuseLog2016101414281810] Task ProcRotateLogs3k_abuse, key RotateAbuseLog2016101414281810, value 20161014172617 61 20161014172801 need to be updated on 0 hosts
maxeventtime = 20161014172801

2016/11/07 16:21:36 1016913 INFO  [output_downloa] [1478524804,580] Got from 'https://bs.mega-graphite.search.yandex.net/render':
2016/11/07 16:21:36 1016913 INFO  [output_downloa] [1478524804,580]     search_clicks: from=1477311600, until=1478520900, timegroup=300, last_points = 46876,46285,46364,46429,47042,46514,46079,45871,46367,46594
2016/11/07 16:21:36 1016914 INFO  [get_graphite_h] [1478524804,532] Done getting balancer hosts
2016/11/07 16:21:36 1016913 INFO  [  analyze_data] [1478524804,580] Data tail is : 0, -174, 0, 0, 0, 0, 0, 0, 0, 0
2016/11/07 16:21:36 1016913 INFO  [  analyze_data] [1478524804,580] less_quantile = 0, more_quantile = -5404.7
2016/11/07 16:21:36 1016913 INFO  [  analyze_data] [1478524804,580] heavy_max = 0, heavy_min = -4864.23

2016/11/07 16:21:22 1028320 INFO  [output_downloa] [1478524804,221]     search_clicks: from=1477311600, until=1478520900, timegroup=300, last_points = undef,u
ndef,undef,undef,undef,undef,undef,undef,undef,undef
2016/11/07 16:21:22 1028320 INFO  [  analyze_data] [1478524804,221] Data tail is : -45978, -46461, -46046, -49348, -45633, -45842, -45186, -45371, -45668, -45
622
2016/11/07 16:21:22 1028320 INFO  [  analyze_data] [1478524804,221] less_quantile = 0, more_quantile = -41945.8
2016/11/07 16:21:22 1028320 INFO  [  analyze_data] [1478524804,221] heavy_max = 0, heavy_min = -37751.22




Добавлены тесты:
M       cms_common/cms_common/api/deprecated/vod_lib_api.py
M       cms_common/cms_common/api/deprecated/vod_episode_api.py
A       cms_common/cms_common/services/black_window_applier.py

Сборка:
A       black_window_applier
A       black_window_applier/CMakeLists.txt
A       black_window_applier/black-window-applier.py
M       debian/rules
M       debian/yabs-vh-backend.xinstall
M       cms_common/CMakeLists.txt
M       CMakeLists.txt


bssoap01g.yandex.ru: 2016/11/09 09:14:18 498200 INFO  [send_log_table] Log 'RotateAuctionLog201611090614170012' was successfully processed
bssoap03i.yabs.yandex.ru: 2016/11/09 09:08:22 494113 INFO  [send_log_table] Log 'RotateAuctionLog201611090608210032' was successfully processed
bssoap01h.yandex.ru: 2016/11/09 09:13:38 752980 INFO  [send_log_table] Log 'RotateAuctionLog201611090613380013' was successfully processed
bssoap02e.yandex.ru: 2016/11/09 09:12:54 554827 INFO  [send_log_table] Log 'RotateAuctionLog201611090612540020' was successfully processed
bssoap01i.yandex.ru: 2016/11/09 09:12:27 20344 INFO  [send_log_table] Log 'RotateAuctionLog201611090612270014' was successfully processed
bssoap02i.yandex.ru: 2016/11/09 09:07:09 36227 INFO  [send_log_table] Log 'RotateAuctionLog201611090607080024' was successfully processed
bssoap02h.yandex.ru: 2016/11/09 09:04:46 32683 INFO  [send_log_table] Log 'RotateAuctionLog201611090604450023' was successfully processed
bssoap02f.yandex.ru: 2016/11/09 09:02:50 979002 INFO  [send_log_table] Log 'RotateAuctionLog201611090602500021' was successfully processed



Хорошо составлены:

Обработаны:
bssoap03h.yabs.yandex.ru: 2016/11/09 09:13:36 932297 INFO  [send_log_table] Log 'RotateAuctionLog201611090613360031' was successfully processed
bssoap01f.yandex.ru: 2016/11/09 09:07:10 894299 INFO  [send_log_table] Log 'RotateAuctionLog201611090607090011' was successfully processed
bssoap02g.yandex.ru: 2016/11/09 09:14:31 1017030 INFO  [send_log_table] Log 'RotateAuctionLog201611090614300022' was successfully processed
bssoap01e.yandex.ru: 2016/11/09 09:08:48 1031264 INFO  [send_log_table] Log 'RotateAuctionLog201611090608480010' was successfully processed
bssoap03e.yabs.yandex.ru: 2016/11/09 09:13:35 726250 INFO  [send_log_table] Log 'RotateAuctionLog201611090613340030' was successfully processed


or 5.45.230.0/23 or 5.45.250.0/23 or 5.255.202.0/23 or 37.140.182.0/23 or 95.108.194.0/27 or 95.108.202.0/23 or 100.43.86.192/26 or 178.154.180.0/23 or 178.154.240.0/23 or 2620:10f:d00b:2::/64 or 2a02:6b8:0:872::/64 or 2a02:6b8:0:c12::/64 or 2a02:6b8:0:1407::/64 or 2a02:6b8:0:1804::/64 or 2a02:6b8:0:1a0a::/64 or 2a02:6b8:0:2518::/64 or 2a02:6b8:b010:87::/64 or 2a02:6b8:b010:9e::/64 or 2a02:6b8:b010:200::/56 or 2a02:6b8:b010:1011::/64 or 2a02:6b8:b010:204f::/64 or 2a02:6b8:b010:3033::/64 or 2a02:6b8:b011:200::/56 or 2a02:6b8:b011:2e00::/56 or 2a02:6b8:b020:3200::/56 or 2a02:6b8:b020:4100::/56 or 2a02:6b8:b020:4200::/56 or 2a02:6b8:b020:5000::/56 or 2a02:6b8:b020:5100::/56 or 2a02:6b8:b020:5600::/56



 TODO: переехать на какой-то один метод. Не стал модифицировать
 187:# тот что снизу т.к. на него уже что-то завязано

:q

yabs-yt-standalone-conf-18.4 yandex-yt-http-proxy=18.4.19881-prestable~97a8029 nodejs=0.8.26-yandex1 yandex-yt-perl=18.5.20952-prestable~7269a2b yandex-yt-perl-18.4=18.4.19881-prestable~97a8029 yandex-yt=18.4.20514-prestable~dfd8a22


bstat-ft autobudget yabs-yt-standalone-conf-18.4 yandex-yt-http-proxy=18.4.19881-prestable~97a8029 nodejs=0.8.26-yandex1 yandex-yt-perl=18.5.20952-prestable~7269a2b yandex-yt-perl-18.4=18.4.19881-prestable~97a8029 yandex-yt=18.4.20514-prestable~dfd8a22 yabs-yt-standalone-conf
bstat ~ # sudo apt-get install  yandex-yt-http-proxy=18.4.20514-prestable~dfd8a22 yandex-yt-perl=18.5.20952-prestable~7269a2b  yandex-yt-perl-18.4=18.4.20514-prestable~dfd8a22


Для неавтобюджетных заказов FlatProbatility возвращается для включенных баннеров скриптом flat-probability-restore.pl
calc_flat_probability
optimize_for_flat_only -> need_reser_prob -> calc_flat_probability
O_NET_LIMIT_ONLY -> calc_flat_probability
ab_convex && flat_allowed -> calc_flat_probability
ABTYPE_LAZY, ABTYPE_DAILY, ABTYPE_NETCPC, order_time_tar_coeff > 0 -> calc_flat_probability
NET_LIMIT_ONLY = ContextLimit > 0 and ContextLimit < 100

В транспорте flat_probability ресторится всегда, когда нет ContextLimtis


[2016-11-11 16:34:26] [info]: CHECK_TABLE 'ABCurWeekConv':
[2016-11-11 16:34:26] [info]: [ ok ] Проверка наличия таблицы 'ABCurWeekConv'
[2016-11-11 16:34:26] [info]: [ ok ] Проверка наличия ключа (OrderID=1003 AND Week=40)
[2016-11-11 16:34:26] [info]: [ ok ] Корректность значения 'Actions'
[2016-11-11 16:34:26] [info]: Проверяем test-target output:
[2016-11-11 16:34:26] [info]: avoid: error,uninitialized,warning
[2016-11-11 16:34:26] [error]: [Fail] найдена ошибка: 2016/11/11 16:34:26 195068 WARN  [unix_timestamp] Use of uninitialized value $time_arr[1] in
numeric lt (<) at /usr/share/perl5/Yabs/MarkTime.pm line 252.        (Yabs::MarkTime @/usr/share/perl5/Yabs/MarkTime.pm:252)
[2016-11-11 16:34:26] [error]: [Fail] найдена ошибка: 2016/11/11 16:34:26 195068 WARN  [unix_timestamp] Use of uninitialized value $time_arr[1] in
numeric lt (<) at /usr/share/perl5/Yabs/MarkTime.pm line 252.        (Yabs::MarkTime @/usr/share/perl5/Yabs/MarkTime.pm:252)
[2016-11-11 16:34:26] [error]: [Fail] найдена ошибка: 2016/11/11 16:34:26 195068 WARN  [unix_timestamp] Use of uninitialized value $time_arr[1] in
numeric lt (<) at /usr/share/perl5/Yabs/MarkTime.pm line 252.        (Yabs::MarkTime @/usr/share/perl5/Yabs/MarkTime.pm:252)
[2016-11-11 16:34:26] [error]: [Fail] найдена ошибка: 2016/11/11 16:34:26 195068 WARN  [unix_timestamp] Use of uninitialized value $time_arr[1] in
numeric lt (<) at /usr/share/perl5/Yabs/MarkTime.pm line 252.        (Yabs::MarkTime @/usr/share/perl5/Yabs/MarkTime.pm:252)
[2016-11-11 16:34:26] [info]: Продолжительность теста: 0.007 сек
[2016-11-11 16:34:26] [error]: * Test Failed *
 чёт он как то совсем не связан с orderStatchange
svn: E210002: Your commit message was left in a temporary file:
svn: E210002:    '/home/olegts/arc/trunk/arcadia/yabs/vh/svn-commit.7.tmp'



mysql> select sum(HitCount) from SerpTagHitsDetailed201611 where UpdateTime = '2016-11-14 05:00:00';
+---------------+
| sum(HitCount) |
+---------------+
|       2751673 |
+---------------+
1 row in set (0.01 sec)

:) select UpdateTime,sum(HitsCount) from SerpTagHitsCountry where UpdateTime = '2016-11-14 05:00:00' group by UpdateTime;

SELECT
    UpdateTime,
    sum(HitsCount)
FROM SerpTagHitsCountry
WHERE UpdateTime = '2016-11-14 05:00:00'
GROUP BY UpdateTime

┌──────────UpdateTime─┬─sum(HitsCount)─┐
│ 2016-11-14 05:00:00 │        2092854 │
└─────────────────────┴────────────────┘

mysql> select sum(HitCount) from SerpTagHits where UpdateTime = '2016-11-14 05:00:00'
    -> ;
+---------------+
| sum(HitCount) |
+---------------+
|       2092854 |
+---------------+
1 row in set (0.01 sec)

mysql> select sum(HitCount) from SerpTagHitsDetailed201611 where UpdateTime = '2016-11-14 05:00:00' and MainRegionID = 0;
+---------------+
| sum(HitCount) |
+---------------+
|       2092854 |
+---------------+
1 row in set (0.02 sec)

mysql> select sum(HitCount) from SerpTagHitsDetailed201611 where UpdateTime = '2016-11-14 05:00:00' and MainRegionID > 0;
+---------------+
| sum(HitCount) |
+---------------+
|        658819 |
+---------------+
1 row in set (0.02 sec)


AnalyzerCgiParamsStore,AnalyzerConfigs


100
          FromTime: 2016-11-06 14:00:00
         UntilTime: 2016-11-14 13:59:59


-17
-8
-9
-11:q

13:00 проверяем Автобюджет
15:00 проверяем Прогнозатор

    166 Sending data    insert into base1.DspLog20161120215000 (\n\t\t\tDataID,\n\t\t\tCreativeID,Options,PageI
    259 Sending data    select\n\t\t\tPageID,\n\t\t\tBannerID,\n\t\t\tPhraseID,\n\t\t\tCost11,\n\t\t\tCost1,\n\
    287 Sending data    insert into base1.HitLog20161121122500 (\n\t\t\tDataID,\n\t\t\tPossibleTargeting,Wizard
    297 copy to tmp table       alter table base1.CompressingChEventLog20161119100500 pack_keys=1
    305 Sending data    select\n\t\t\t\tDspLogID,BidReqID,ShowTime,EventTime,ResponseID,EventID,PageID,DSPID,Bi
    325 Sending data    select\n\t\t\t\t\tDspLogID,\n\t\t\t\t\tPageID,\n\t\t\t\t\tDSPFraudBits\n\t\t\t\tfrom\n\
    363 Sending data    insert into base1.DspLog20161120214000 (\n\t\t\tDataID,\n\t\t\tCreativeID,Options,PageI
    374 Slave has read all relay log; waiting for the slave I/O thread to update it     NULL
    430 Waiting for master to send event        NULL
    531 NULL    show full processlist
    531 State   Info

b 754 $pr_idx =~ /,636797/

 !!! PRODUCTION !!! root@bstat114i.yandex.ru [yabsdb]> select ABCRMConvStat.* from ABCRMConvStat inner join Banner114 using(BannerID) where OrderID=10756053 limit  1;
+------------+------------+-------------+------------+--------+---------------------+--------+---------+
| BannerID   | PhraseID   | ContextType | TargetType | TypeID | UpdateTime          | Clicks | Actions |
+------------+------------+-------------+------------+--------+---------------------+--------+---------+
| 2298274572 | 1318939591 |           1 |          0 |      1 | 2016-11-21 00:00:00 | 846026 |       0 |
+------------+------------+-------------+------------+--------+---------------------+--------+---------+
1 row in set (0.00 sec)

 !!! PRODUCTION !!! root@bstat114i.yandex.ru [yabsdb]> select Clicks >  0 , Actions > 0 , count(*) from ABCRMConvStat inner join Banner114 using(BannerID) where OrderID=10756053 group by 1,2;
+-------------+-------------+----------+
| Clicks >  0 | Actions > 0 | count(*) |
+-------------+-------------+----------+
|           0 |           0 |     1747 |
|           1 |           0 |     1341 |
|           1 |           1 |        5 |
+-------------+-------------+----------+
3 rows in set (0.02 sec)


mysql> select * from RotateABCRMLog2016112221111900014 where Actions > 0 ;
+---------------------+----------+----------------+----------------------+------------+--------+--------+---------+
| UpdateTime          | OrderID  | ExportBannerID | PhraseMD5            | TargetType | TypeID | Clicks | Actions |
+---------------------+----------+----------------+----------------------+------------+--------+--------+---------+
| 2016-11-21 00:00:00 | 10756053 |     2679470190 |  4427031246837263137 |          0 |      1 |      3 |    1400 |
| 2016-11-21 00:00:00 | 10756053 |     2679187192 | 17379224616062341057 |          0 |      1 |      1 |    3531 |
+---------------------+----------+----------------+----------------------+------------+--------+--------+---------+
2 rows in set (0.00 sec)

mysql> select * from RotateABCRMLog2016112215110000031 where Actions > 0 ;
+---------------------+----------+----------------+----------------------+------------+--------+--------+---------+
| UpdateTime          | OrderID  | ExportBannerID | PhraseMD5            | TargetType | TypeID | Clicks | Actions |
+---------------------+----------+----------------+----------------------+------------+--------+--------+---------+
| 2016-11-17 00:00:00 | 10756053 |     2679592623 | 16075708002065552566 |          0 |      2 |      1 |     433 |
| 2016-11-04 00:00:00 | 10756053 |     2679500202 |  8817371345290256585 |          0 |      1 |      1 |     724 |
| 2016-11-11 00:00:00 | 10756053 |     2678094652 | 11635640574340685628 |          0 |      1 |      1 |    3303 |
| 2016-11-21 00:00:00 | 10756053 |     2679470190 |  4427031246837263137 |          0 |      1 |      3 |    1400 |
| 2016-11-21 00:00:00 | 10756053 |     2679187192 | 17379224616062341057 |          0 |      1 |      1 |    3531 |
+---------------------+----------+----------------+----------------------+------------+--------+--------+---------+
5 rows in set (0.01 sec)

olegts@bstat135i:/mnt/raid/home/olegts$ ls -la /var/lib/mysql.yabs/yabsdb/.skyman_share/RotateAuction* | grep yabs |grep -v skynet
-rw-rw-rw- 1 yabs   yabs       1338 нояб. 24 08:37 /var/lib/mysql.yabs/yabsdb/.skyman_share/RotateAuctionLog2016112311431706.frm.lz4
-rw-rw-rw- 1 yabs   yabs 1460767535 нояб. 24 08:37 /var/lib/mysql.yabs/yabsdb/.skyman_share/RotateAuctionLog2016112311431706.MYD.lz4
-rw-rw-rw- 1 yabs   yabs  135069944 нояб. 24 08:37 /var/lib/mysql.yabs/yabsdb/.skyman_share/RotateAuctionLog2016112311431706.MYI.lz4
-rw-rw-rw- 1 yabs   yabs       1338 нояб. 24 08:41 /var/lib/mysql.yabs/yabsdb/.skyman_share/RotateAuctionLog2016112311441810.frm.lz4
-rw-rw-rw- 1 yabs   yabs 1196709283 нояб. 24 08:41 /var/lib/mysql.yabs/yabsdb/.skyman_share/RotateAuctionLog2016112311441810.MYD.lz4
-rw-rw-rw- 1 yabs   yabs  111165466 нояб. 24 08:41 /var/lib/mysql.yabs/yabsdb/.skyman_share/RotateAuctionLog2016112311441810.MYI.lz4
-rw-rw-rw- 1 yabs   yabs       1338 нояб. 24 08:38 /var/lib/mysql.yabs/yabsdb/.skyman_share/RotateAuctionLog2016112311454809.frm.lz4
-rw-rw-rw- 1 yabs   yabs  942095328 нояб. 24 08:38 /var/lib/mysql.yabs/yabsdb/.skyman_share/RotateAuctionLog2016112311454809.MYD.lz4
-rw-rw-rw- 1 yabs   yabs   88696582 нояб. 24 08:38 /var/lib/mysql.yabs/yabsdb/.skyman_share/RotateAuctionLog201611231FПш454809.MYI.lz4


olegts@bstat135i:/mnt/raid/home/olegts$ sudo ls -la  /var/lib/mysql.yabs/yabsdb/.skyman_share/RotateAuctionLog2016112311431706*
-rw-rw-rw- 1 yabs yabs       1338 нояб. 24 08:32 /var/lib/mysql.yabs/yabsdb/.skyman_share/RotateAuctionLog2016112311431706.frm.lz4
-rw-rw-rw- 1 yabs yabs 1460767535 нояб. 24 08:32 /var/lib/mysql.yabs/yabsdb/.skyman_share/RotateAuctionLog2016112311431706.MYD.lz4
-rw-rw-rw- 1 yabs yabs  135069944 нояб. 24 08:32 /var/lib/mysql.yabs/yabsdb/.skyman_share/RotateAuctionLog2016112311431706.MYI.lz4
 production environment
olegts@bstat135i:/mnt/raid/home/olegts$ sudo ls -la  /var/lib/mysql.yabs/yabsdb/.skyman_share/*
 production environment
olegts@bstat135i:/mnt/raid/home/olegts$ sudo ls -la  /var/lib/mysql.yabs/yabsdb/.skyman_share/*
 production environment
olegts@bstat135i:/mnt/raid/home/olegts$ sudo ls -la  /var/lib/mysql.yabs/yabsdb/.skyman_share/RotateAuctionLog2016112311431706*
-rw-rw-rw- 1 yabs yabs       1338 нояб. 24 08:37 /var/lib/mysql.yabs/yabsdb/.skyman_share/RotateAuctionLog2016112311431706.frm.lz4
-rw-rw-rw- 1 yabs yabs 1460767535 нояб. 24 08:37 /var/lib/mysql.yabs/yabsdb/.skyman_share/RotateAuctionLog2016112311431706.MYD.lz4
-rw-rw-rw- 1 yabs yabs  135069944 нояб. 24 08:37 /var/lib/mysql.yabs/yabsdb/.skyman_share/RotateAuctionLog2016112311431706.MYI.lz4
 production environment


   2 112
   2 114
   3 106

[Serial] > exec bstat112.* mysql -uroot yabsdb -e 'select count(*) from BroadPhrase'  | grep -v count

=== bstat112i.yandex.ru (@sas-1-1-1), 1/3 ===
21710334

=== bstat112h.yandex.ru (@ugr6), 2/3 ===
21710338

=== bstat112f.yandex.ru (@myt6), 3/3 ===

1710338



| DSPObjectModerationQueue0 |    53955 |        1726 | 2016-11-15 04:22:02 |     2 |             0 |




19.650    Yabs::Stat::Collectors::SummaryPPCHits::_task_collect                                     Count=0.8   Min=0.043     Max=61.753    Avg=24.220    Speed=0.000
13.921    Yabs::Stat::Collectors::ClickHouseFraudStat::_task_collect                                Count=0.8   Min=0.176     Max=43.429    Avg=17.158    Speed=0.000
13.839    Yabs::Stat::Collectors::ClickHouseTrafficHourStat::_task_collect                          Count=0.8   Min=0.046     Max=40.783    Avg=17.057    Speed=0.000
13.699    Yabs::Stat::Collectors::ClickHouseHolidayRegionStat::_task_collect                        Count=0.8   Min=4.181     Max=38.405    Avg=16.885    Speed=0.000
11.225    Yabs::Stat::Collectors::TrafficHourStat::_task_collect                                    Count=0.8   Min=2.783     Max=31.965    Avg=13.835    Speed=0.000
8.633     Yabs::Stat::Collectors::ClickHousePerformanceDSPPageStat::_task_collect                   Count=0.8   Min=0.045     Max=25.302    Avg=10.641    Speed=0.000
8.199     Yabs::Stat::Collectors::URLClusterStat::_task_collect                                     Count=0.8   Min=0.007     Max=25.202    Avg=10.105    Speed=0.000
8.028     Yabs::Stat::Collectors::ClickHouseSummaryTagDetailed::_task_collect                       Count=0.8   Min=0.035     Max=31.311    Avg=9.895     Speed=0.000
6.929     Yabs::Stat::Collectors::PageAlgStat::_task_collect                                        Count=0.8   Min=0.006     Max=22.590    Avg=8.540     Speed=0.000
5.931     Yabs::Stat::Collectors::ClickHouseDSPStat::_task_collect                                  Count=0.8   Min=0.048     Max=22.606    Avg=7.311     Speed=0.000
5.872     Yabs::Stat::Collectors::SummaryMix::_task_collect                                         Count=0.8   Min=0.004     Max=22.690    Avg=7.237     Speed=0.000
5.228     Yabs::Stat::Collectors::RtbSummary::_task_collect                                         Count=0.8   Min=0.002     Max=15.916    Avg=6.444     Speed=0.000
5.065     Yabs::Stat::Collectors::PageTagStat::_task_collect                                        Count=0.8   Min=0.004     Max=17.099    Avg=6.243     Speed=0.000
4.696     Yabs::Stat::Collectors::HostEventStat::_task_collect                                      Count=0.8   Min=0.028     Max=22.938    Avg=5.788     Speed=0.000
4.596     Yabs::Stat::Collectors::SummaryPartner::_task_collect                                     Count=0.8   Min=0.004     Max=15.396    Avg=5.665     Speed=0.000
4.432     Yabs::Stat::Collectors::ClickHouseSSPCraterStat::_task_collect                            Count=0.8   Min=0.004     Max=17.578    Avg=5.462     Speed=0.000
4.227     Yabs::Stat::Collectors::MakeEventLogBuffer::_task_collect                                 Count=0.8   Min=0.003     Max=19.826    Avg=5.210     Speed=0.000
4.106     Yabs::Stat::Collectors::TmpRegionMapping::_task_collect                                   Count=0.8   Min=3.580     Max=11.895    Avg=5.061     Speed=0.000
3.952     Yabs::Stat::Collectors::PagePosStat::_task_collect                                        Count=0.8   Min=0.001     Max=15.829    Avg=4.871     Speed=0.000
3.783     Yabs::Stat::Collectors::FastDataUsage::_task_collect                                      Count=0.8   Min=0.026     Max=15.158    Avg=4.663     Speed=0.000
3.615     Yabs::Stat::Collectors::UpdateDataTime::_task_collect                                     Count=0.8   Min=0.001     Max=13.871    Avg=4.455     Speed=0.000
2.293     Yabs::Stat::Collectors::SummaryTag::_task_collect                                         Count=0.8   Min=0.004     Max=17.207    Avg=2.827     Speed=0.000
2.183     Yabs::Stat::Collectors::ClickHousePerformanceSearchPageStat::_task_collect                Count=0.8   Min=0.004     Max=11.744    Avg=2.691     Speed=0.000
1.533     Yabs::Stat::Collectors::SerpStat::_task_collect                                           Count=0.8   Min=0.001     Max=14.994    Avg=1.889     Speed=0.000
1.366     Yabs::Stat::Collectors::TmpOrderType::_task_collect                                       Count=0.8   Min=1.399     Max=2.216     Avg=1.683     Speed=0.000
1.288     Yabs::Stat::Collectors::SummaryMediaMix::_task_collect                                    Count=0.8   Min=0.002     Max=3.369     Avg=1.588     Speed=0.000
0.106     Yabs::Stat::Collectors::RtbCostMonitoringStat::_task_collect_rtb_cost                     Count=0.8   Min=0.004     Max=1.380     Avg=0.131     Speed=0.000
0.090     Yabs::Stat::Collectors::RtbCostMonitoringStat::_task_collect_rtb_cost_stat                Count=0.8   Min=0.004     Max=0.418     Avg=0.110     Speed=0.000
0.033     Yabs::Stat::Collectors::TmpPageSSP::_task_collect                                         Count=0.8   Min=0.001     Max=0.328     Avg=0.041     Speed=0.000
0.015     Yabs::Stat::Collectors::TmpMainRegion::_task_collect                                      Count=0.8   Min=0.009     Max=0.272     Avg=0.019     Speed=0.000
0.007     Yabs::Stat::Collectors::TmpResourceMapping::_task_collect                                 Count=0.8   Min=0.001     Max=0.279     Avg=0.009     Speed=0.000



https://golem.yandex-team.ru/api/sms/send.sbml?resps=desertfury&msg=594%3A%20search_clicks%3A%2011%2F28%2012%3A25%3A00


 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> show tables like 'ABPrice%';
+-----------------------------+
| Tables_in_yabsdb (ABPrice%) |
+-----------------------------+
| ABPrice100_87807_1_backup   |
| ABPrice100_87808_2_backup   |
| ABPrice100_87809_2          |
| ABPrice100_87810_1          |
+-----------------------------+
4 rows in set (0.16 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> show tables like 'ABStatus%';
+------------------------------+
| Tables_in_yabsdb (ABStatus%) |
+------------------------------+
| ABStatus100_87807_1_backup   |
| ABStatus100_87808_2_backup   |
| ABStatus100_87809_2          |
| ABStatus100_87810_1          |
+------------------------------+
4 rows in set (0.10 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> show tables like 'ABProbUpdate%';
+----------------------------------+
| Tables_in_yabsdb (ABProbUpdate%) |
+----------------------------------+
| ABProbUpdate100_87807_1_backup   |
| ABProbUpdate100_87808_2_backup   |
| ABProbUpdate100_87809_2          |
| ABProbUpdate100_87810_1          |
+----------------------------------+
4 rows in set (0.12 sec)


Ставки различаются у заказа 8338967

ABVWForecasterAPC
AutoBudgetForecasterAPC
AutoBudgetForecasterCTR
ABVWForecasterPPC
AutoBudgetForecasterCTRMedia

./Yabs/AutoBudget/Forecast/PPC_VW.pm Нужна погруппная линейная модель
./Yabs/AutoBudget/Forecast/CTR.pm
./Yabs/AutoBudget/Forecast/APC_VW.pm
./Yabs/AutoBudget/Forecast/APC_CRM.pm
./Yabs/AutoBudget/Forecast/CTR_Media.pm
./Yabs/AutoBudget/Forecast/APC.pm
./Yabs/AutoBudget/Forecast/Base.pm
        "from=i"      => \$from,
        "to=i"        => \$to,
        "anthill=s"   => \$anthill,
        "no-clean"    => \$no_clean,
        "no-export"    => \$no_export,
        "order-ids=s" => \$order_ids_str,
        "threads=i"   => \$threads_amount,

Сравнение со старым кодом
OK rename table AutoBudgetForecasterCTR -> AutoBudgetForecasterCTR_new
OK rename table AutoBudgetForecasterCTRMedia -> AutoBudgetForecasterCTRMedia_new
OK rename table AutoBudgetForecasterAPC -> AutoBudgetForecasterAPC_new
OK rename table AutoBudgetForecasterAvgAPC -> AutoBudgetForecasterAvgAPC_new
OK rename table ABVWForecasterAPC -> ABVWForecasterAPC_new
OK rename table ABVWForecasterPPC -> ABVWForecasterPPC_new


Групповые прогнозаторы
OK rename table AutoBudgetForecasterCTRMedia -> AutoBudgetForecasterCTRMedia_new

2927559862
540076678
2064784721


 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> select  * from ABPrice100_87819_1 where BannerID=994776795 and PhraseID=129804314;
+---------+---------------+-----------+-----------+-------------+--------+-------+----------+--------+----------+--------+----------+
| OrderID | GroupExportID | BannerID  | PhraseID  | ContextType | BaseNo | Cost  | FlatCost | SlotID | Position | Export | Currency |
+---------+---------------+-----------+-----------+-------------+--------+-------+----------+--------+----------+--------+----------+
| 6845018 |     915231091 | 994776795 | 129804314 |           1 |    100 | 56000 |    30000 |      0 |        0 |      1 |        1 |
+---------+---------------+-----------+-----------+-------------+--------+-------+----------+--------+----------+--------+----------+
1 row in set (0.01 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> select  * from ABPrice100_87820_1 where BannerID=994776795 and PhraseID=129804314;
+---------+---------------+-----------+-----------+-------------+--------+-------+----------+--------+----------+--------+----------+
| OrderID | GroupExportID | BannerID  | PhraseID  | ContextType | BaseNo | Cost  | FlatCost | SlotID | Position | Export | Currency |
+---------+---------------+-----------+-----------+-------------+--------+-------+----------+--------+----------+--------+----------+
| 6845018 |     915231091 | 994776795 | 129804314 |           1 |    100 | 56000 |    26000 |      0 |        0 |      1 |        1 |
+---------+---------------+-----------+-----------+-------------+--------+-------+----------+--------+----------+--------+----------+
1 row in set (0.00 sec)

87826-1

87827_1

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> rename table ABPrice100_87827_1 to ABPrice100_87827_1_backup;
Query OK, 0 rows affected (0.03 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> rename table ABPrice100_87826_1 to ABPrice100_87827_1_backup;
ERROR 1050 (42S01): Table 'ABPrice100_87827_1_backup' already exists
 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> rename table ABPrice100_87826_1 to ABPrice100_87826_1_backup;
Query OK, 0 rows affected (0.14 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> rename table ABStatus100_87827_1 to ABStatus100_87827_1_backup;
Query OK, 0 rows affected (0.05 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> rename table ABStatus100_87826_1 to ABStatus100_87826_1_backup;
Query OK, 0 rows affected (0.10 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> rename table ABProbUpdate100_87827_1 to ABProbUpdate100_87827_1_backup;
Query OK, 0 rows affected (0.44 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> rename table ABProbUpdate100_87826_1 to ABProbUpdate100_87826_1_backup;
Query OK, 0 rows affected (0.00 sec)


i !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> select OrderID,BannerID,PhraseID,ContextType, abs(log(ABPrice100_87827_1_backup.Cost ) - log(ABPrice100_87826_1_backup.Cost)) from ABPrice100_87827_1_backup inner join ABPrice100_87826_1_backup using(OrderID,GroupExportID,BannerID,PhraseID,ContextType) group by 1,2,3,4 order by 5 desc limit 10;
+----------+------------+------------+-------------+---------------------------------------------------------------------------------+
| OrderID  | BannerID   | PhraseID   | ContextType | abs(log(ABPrice100_87827_1_backup.Cost ) - log(ABPrice100_87826_1_backup.Cost)) |
+----------+------------+------------+-------------+---------------------------------------------------------------------------------+
|  7853443 | 1232174094 |  103617192 |           1 |                                                               4.941642422609306 |
| 11984860 | 2833399043 | 1479447218 |           1 |                                                               4.402645921876617 |
| 11984860 | 2833399042 | 1479447218 |           1 |                                                               4.402645921876617 |
|  4657185 |  512510778 |  387359588 |           1 |                                                               4.096722684627068 |
|   578635 |    6352305 |        588 |           1 |                                                               4.083171261623976 |
|  6704855 |  937282745 |     386447 |           1 |                                                              3.8969093676180986 |
|  7720239 | 1196538922 |  974097822 |           1 |                                                              3.2375243839462726 |
|  7720239 | 1196537714 |  770606785 |           1 |                                                              3.1586357444908444 |
|  2714996 | 1486051679 |  108227128 |           1 |                                                              3.0726933146901185 |
|  2714996 |  193007673 |  108227128 |           1 |                                                              3.0726933146901185 |
+----------+------------+------------+-------------+---------------------------------------------------------------------------------+
10 rows in set (6.77 sec)


 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> select ABPrice100_87826_1_backup.Cost = ABPrice100_87827_1_backup.Cost and ABPrice100_87826_1_backup.FlatCost = ABPrice100_87827_1_backup.FlatCost as OK, count(distinct OrderID) from ABPrice100_87827_1_backup inner join ABPrice100_87826_1_backup using(OrderID,GroupExportID,BannerID,PhraseID,ContextType) group by 1;
+----+-------------------------+
| OK | count(distinct OrderID) |
+----+-------------------------+
|  0 |                     495 |
|  1 |                    1923 |
+----+-------------------------+
2 rows in set (3.75 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> select ABPrice100_87826_1_backup.Cost = ABPrice100_87827_1_backup.Cost , count(*) from ABPrice100_87827_1_backup inner join ABPrice100_87826_1_backup using(OrderID,GroupExportID,BannerID,PhraseID,ContextType) group by 1;
+-----------------------------------------------------------------+----------+
| ABPrice100_87826_1_backup.Cost = ABPrice100_87827_1_backup.Cost | count(*) |
+-----------------------------------------------------------------+----------+
|                                                               0 |     9936 |
|                                                               1 |   494462 |
+-----------------------------------------------------------------+----------+
2 rows in set (2.19 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> select ABPrice100_87826_1_backup.FlatCost = ABPrice100_87827_1_backup.FlatCost , count(*) from ABPrice100_87827_1_backup inner join ABPrice100_87826_1_backup using(OrderID,GroupExportID,BannerID,PhraseID,ContextType) group by 1;
+-------------------------------------------------------------------------+----------+
| ABPrice100_87826_1_backup.FlatCost = ABPrice100_87827_1_backup.FlatCost | count(*) |
+-------------------------------------------------------------------------+----------+
|                                                                       0 |    38716 |
|                                                                       1 |   465682 |
+-------------------------------------------------------------------------+----------+
2 rows in set (2.46 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> select ABStatus100_87826_1_backup.BannerPriority= ABStatus100_87827_1_backup.BannerPriority,count(*) from ABStatus100_87826_1_backup inner join ABStatus100_87827_1_backup using(BannerID) group by 1;
+--------------------------------------------------------------------------------------+----------+
| ABStatus100_87826_1_backup.BannerPriority= ABStatus100_87827_1_backup.BannerPriority | count(*) |
+--------------------------------------------------------------------------------------+----------+
|                                                                                    0 |       10 |
|                                                                                    1 |      645 |
+--------------------------------------------------------------------------------------+----------+
2 rows in set (0.13 sec)


 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> select ABProbUpdate100_87826_1_backup.FlatProbability = ABProbUpdate100_87827_1_backup.FlatProbability, count(*) from ABProbUpdate100_87826_1_backup inner join ABProbUpdate100_87827_1_backup using(BannerID) group by 1;
+-------------------------------------------------------------------------------------------------+----------+
| ABProbUpdate100_87826_1_backup.FlatProbability = ABProbUpdate100_87827_1_backup.FlatProbability | count(*) |
+-------------------------------------------------------------------------------------------------+----------+
|                                                                                               0 |      571 |
|                                                                                               1 |      404 |
+-------------------------------------------------------------------------------------------------+----------+
2 rows in set (0.04 sec)



 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> select truncate(log(ABProbUpdate100_87826_1_backup.FlatProbability)- log(ABProbUpdate100_87827_1_backup.FlatProbability), 2), count(*) from ABProbUpdate100_87826_1_backup inner join ABProbUpdate100_87827_1_backup using(BannerID) group by 1;
+-----------------------------------------------------------------------------------------------------------------------+----------+
| truncate(log(ABProbUpdate100_87826_1_backup.FlatProbability)- log(ABProbUpdate100_87827_1_backup.FlatProbability), 2) | count(*) |
+-----------------------------------------------------------------------------------------------------------------------+----------+
|                                                                                                                 -4.47 |        1 |
|                                                                                                                 -1.38 |        1 |
|                                                                                                                 -1.34 |        1 |
|                                                                                                                 -1.28 |        1 |
|                                                                                                                 -1.26 |        1 |
|                                                                                                                 -1.16 |        1 |
|                                                                                                                 -0.86 |        1 |
|                                                                                                                 -0.85 |        1 |
|                                                                                                                 -0.81 |        1 |
|                                                                                                                 -0.79 |        1 |
|                                                                                                                 -0.78 |        1 |
|                                                                                                                 -0.77 |        1 |
|                                                                                                                 -0.69 |       28 |
|                                                                                                                 -0.64 |        1 |
|                                                                                                                 -0.61 |        1 |
|                                                                                                                 -0.60 |        1 |
|                                                                                                                 -0.58 |        1 |
|                                                                                                                 -0.57 |        1 |
|                                                                                                                 -0.55 |        2 |
|                                                                                                                 -0.54 |        1 |
|                                                                                                                 -0.51 |        1 |
|                                                                                                                 -0.50 |        1 |
|                                                                                                                 -0.49 |        9 |
|                                                                                                                 -0.47 |        3 |
|                                                                                                                 -0.46 |        1 |
|                                                                                                                 -0.45 |        2 |
|                                                                                                                 -0.44 |        5 |
|                                                                                                                 -0.43 |        7 |
|                                                                                                                 -0.42 |        5 |
|                                                                                                                 -0.41 |        8 |
|                                                                                                                 -0.40 |      256 |
|                                                                                                                 -0.38 |        4 |
|                                                                                                                 -0.37 |        2 |
|                                                                                                                 -0.36 |        1 |
|                                                                                                                 -0.35 |        1 |
|                                                                                                                 -0.34 |        3 |
|                                                                                                                 -0.33 |        2 |
|                                                                                                                 -0.32 |        3 |
|                                                                                                                 -0.31 |        3 |
|                                                                                                                 -0.30 |        2 |
|                                                                                                                 -0.29 |        3 |
|                                                                                                                 -0.28 |        1 |
|                                                                                                                 -0.27 |        1 |
|                                                                                                                 -0.26 |        3 |
|                                                                                                                 -0.25 |        3 |
|                                                                                                                 -0.24 |        1 |
|                                                                                                                 -0.23 |        2 |
|                                                                                                                 -0.22 |        1 |
|                                                                                                                 -0.21 |        1 |
|                                                                                                                 -0.20 |        1 |
|                                                                                                                 -0.18 |        1 |
|                                                                                                                 -0.16 |        3 |
|                                                                                                                 -0.15 |        1 |
|                                                                                                                 -0.14 |        1 |
|                                                                                                                 -0.13 |        2 |
|                                                                                                                 -0.12 |        1 |
|                                                                                                                 -0.10 |        2 |
|                                                                                                                 -0.08 |        1 |
|                                                                                                                 -0.07 |        2 |
|                                                                                                                 -0.06 |        5 |
|                                                                                                                 -0.05 |        6 |
|                                                                                                                 -0.04 |        3 |
|                                                                                                                 -0.03 |        1 |
|                                                                                                                 -0.02 |        1 |
|                                                                                                                 -0.01 |       10 |
|                                                                                                                  0.00 |      414 |
|                                                                                                                 -0.00 |       17 |
|                                                                                                                  0.01 |        3 |
|                                                                                                                  0.03 |        1 |
|                                                                                                                  0.04 |        2 |
|                                                                                                                  0.05 |        1 |
|                                                                                                                  0.08 |        1 |
|                                                                                                                  0.10 |        1 |
|                                                                                                                  0.12 |        1 |
|                                                                                                                  0.14 |        2 |
|                                                                                                                  0.17 |        1 |
|                                                                                                                  0.21 |        1 |
|                                                                                                                  0.22 |        2 |
|                                                                                                                  0.23 |        1 |
|                                                                                                                  0.25 |        1 |
|                                                                                                                  0.29 |        1 |
|                                                                                                                  0.32 |        4 |
|                                                                                                                  0.37 |        1 |
|                                                                                                                  0.38 |        1 |
|                                                                                                                  0.40 |        1 |
|                                                                                                                  0.41 |        1 |
|                                                                                                                  0.43 |        2 |
|                                                                                                                  0.45 |        1 |
|                                                                                                                  0.52 |        1 |
|                                                                                                                  0.55 |        1 |
|                                                                                                                  0.58 |        2 |
|                                                                                                                  0.59 |        1 |
|                                                                                                                  0.60 |        2 |
|                                                                                                                  0.62 |        2 |
|                                                                                                                  0.68 |        1 |
|                                                                                                                  0.69 |       63 |
|                                                                                                                  0.72 |        1 |
|                                                                                                                  0.80 |        1 |
|                                                                                                                  0.81 |        1 |
|                                                                                                                  0.83 |        1 |
|                                                                                                                  0.84 |        1 |
|                                                                                                                  0.87 |        1 |
|                                                                                                                  0.96 |        1 |
|                                                                                                                  0.97 |        1 |
|                                                                                                                  0.99 |        1 |
|                                                                                                                  1.00 |        1 |
|                                                                                                                  1.05 |        1 |
|                                                                                                                  1.06 |        1 |
|                                                                                                                  1.09 |        1 |
|                                                                                                                  1.14 |        1 |
|                                                                                                                  1.24 |        1 |
|                                                                                                                  1.33 |        1 |
|                                                                                                                  1.36 |        1 |
+-----------------------------------------------------------------------------------------------------------------------+----------+
113 rows in set (0.01 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> rename table ABPrice100_87834_1 to ABPrice100_87834_1_backup;
Query OK, 0 rows affected (0.01 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> rename table ABProbUpdate100_87834_1 to ABProbUpdate100_87834_1_backup;
Query OK, 0 rows affected (0.02 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> rename table ABStatus100_87834_1  to ABStatus100_87834_1_backup;
Query OK, 0 rows affected (0.00 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> rename table ABPrice100_87835_1 to ABPrice100_87835_1_backup;
Query OK, 0 rows affected (0.00 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> rename table ABProbUpdate100_87835_1 to ABProbUpdate100_87835_1_backup;
Query OK, 0 rows affected (0.02 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> rename table ABStatus100_87835_1  to ABStatus100_87835_1_backup;
Query OK, 0 rows affected (0.00 sec)


 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> select ABPrice100_87834_1_backup.Cost = ABPrice100_87835_1_backup.Cost , count(*) from ABPrice100_87834_1_backup inner join ABPrice100_87835_1_backup using(OrderID,GroupExportID,BannerID,PhraseID,ContextType) group by 1;
+-----------------------------------------------------------------+----------+
| ABPrice100_87834_1_backup.Cost = ABPrice100_87835_1_backup.Cost | count(*) |
+-----------------------------------------------------------------+----------+
|                                                               0 |     7853 |
|                                                               1 |   497480 |
+-----------------------------------------------------------------+----------+
2 rows in set (4.16 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> select ABPrice100_87834_1_backup.FlatCost = ABPrice100_87835_1_backup.FlatCost , count(*) from ABPrice100_87834_1_backup inner join ABPrice100_87835_1_backup using(OrderID,GroupExportID,BannerID,PhraseID,ContextType) group by 1;
+-------------------------------------------------------------------------+----------+
| ABPrice100_87834_1_backup.FlatCost = ABPrice100_87835_1_backup.FlatCost | count(*) |
+-------------------------------------------------------------------------+----------+
|                                                                       0 |    31821 |
|                                                                       1 |   473512 |
+-------------------------------------------------------------------------+----------+
2 rows in set (2.76 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> select ABStatus100_87834_1_backup.BannerPriority= ABStatus100_87835_1_backup.BannerPriority,count(*) from ABStatus100_87834_1_backup inner join ABStatus100_87835_1_backup using(BannerID) group by 1;
+--------------------------------------------------------------------------------------+----------+
| ABStatus100_87834_1_backup.BannerPriority= ABStatus100_87835_1_backup.BannerPriority | count(*) |
+--------------------------------------------------------------------------------------+----------+
|                                                                                    0 |        1 |
|                                                                                    1 |      520 |
+--------------------------------------------------------------------------------------+----------+
2 rows in set (0.09 sec)


 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]> select ABProbUpdate100_87834_1_backup.FlatProbability = ABProbUpdate100_87835_1_backup.FlatProbability, count(*) from ABProbUpdate100_87834_1_backup inner join ABProbUpdate100_87835_1_backup using(BannerID) group by 1;
+-------------------------------------------------------------------------------------------------+----------+
| ABProbUpdate100_87834_1_backup.FlatProbability = ABProbUpdate100_87835_1_backup.FlatProbability | count(*) |
+-------------------------------------------------------------------------------------------------+----------+
|                                                                                               0 |      643 |
|                                                                                               1 |      459 |
+-------------------------------------------------------------------------------------------------+----------+
2 rows in set (0.47 sec)

 !!! PRODUCTION !!! root@bstatx1.yandex.ru [yabsdb]>  select truncate(log(ABProbUpdate100_87834_1_backup.FlatProbability)- log(ABProbUpdate100_87835_1_backup.FlatProbability), 2), count(*) from ABProbUpdate100_87834_1_backup inner join ABProbUpdate100_87835_1_backup using(BannerID) group by 1;
+-----------------------------------------------------------------------------------------------------------------------+----------+
| truncate(log(ABProbUpdate100_87834_1_backup.FlatProbability)- log(ABProbUpdate100_87835_1_backup.FlatProbability), 2) | count(*) |
+-----------------------------------------------------------------------------------------------------------------------+----------+
|                                                                                                                 -0.69 |        9 |
|                                                                                                                 -0.66 |        7 |
|                                                                                                                 -0.57 |        1 |
|                                                                                                                 -0.55 |        1 |
|                                                                                                                 -0.51 |        1 |
|                                                                                                                 -0.48 |        3 |
|                                                                                                                 -0.45 |        3 |
|                                                                                                                 -0.44 |        1 |
|                                                                                                                 -0.43 |        1 |
|                                                                                                                 -0.40 |      363 |
|                                                                                                                 -0.38 |        1 |
|                                                                                                                 -0.37 |        1 |
|                                                                                                                 -0.35 |        1 |
|                                                                                                                 -0.34 |        1 |
|                                                                                                                 -0.33 |        1 |
|                                                                                                                 -0.32 |        1 |
|                                                                                                                 -0.31 |        2 |
|                                                                                                                 -0.30 |        1 |
|                                                                                                                 -0.29 |        2 |
|                                                                                                                 -0.28 |        1 |
|                                                                                                                 -0.26 |        2 |
|                                                                                                                 -0.25 |        3 |
|                                                                                                                 -0.23 |        8 |
|                                                                                                                 -0.22 |        3 |
|                                                                                                                 -0.21 |        3 |
|                                                                                                                 -0.20 |        1 |
|                                                                                                                 -0.18 |        4 |
|                                                                                                                 -0.17 |        1 |
|                                                                                                                 -0.16 |        1 |
|                                                                                                                 -0.15 |        3 |
|                                                                                                                 -0.14 |        3 |
|                                                                                                                 -0.13 |        3 |
|                                                                                                                 -0.12 |        3 |
|                                                                                                                 -0.11 |        1 |
|                                                                                                                 -0.10 |        1 |
|                                                                                                                 -0.09 |        3 |
|                                                                                                                 -0.08 |        1 |
|                                                                                                                 -0.07 |        1 |
|                                                                                                                 -0.06 |        4 |
|                                                                                                                 -0.05 |        3 |
|                                                                                                                 -0.04 |        1 |
|                                                                                                                 -0.03 |        3 |
|                                                                                                                 -0.02 |       14 |
|                                                                                                                 -0.01 |        7 |
|                                                                                                                 -0.00 |        8 |
|                                                                                                                  0.00 |      471 |
|                                                                                                                  0.03 |        3 |
|                                                                                                                  0.04 |        2 |
|                                                                                                                  0.05 |        4 |
|                                                                                                                  0.06 |        1 |
|                                                                                                                  0.08 |        1 |
|                                                                                                                  0.09 |        2 |
|                                                                                                                  0.10 |        1 |
|                                                                                                                  0.12 |        4 |
|                                                                                                                  0.13 |        2 |
|                                                                                                                  0.14 |        1 |
|                                                                                                                  0.15 |        2 |
|                                                                                                                  0.16 |        2 |
|                                                                                                                  0.18 |        1 |
|                                                                                                                  0.19 |        1 |
|                                                                                                                  0.20 |        1 |
|                                                                                                                  0.21 |        1 |
|                                                                                                                  0.22 |        1 |
|                                                                                                                  0.23 |        1 |
|                                                                                                                  0.24 |        1 |
|                                                                                                                  0.25 |        1 |
|                                                                                                                  0.26 |        1 |
|                                                                                                                  0.27 |        1 |
|                                                                                                                  0.28 |        1 |
|                                                                                                                  0.29 |        1 |
|                                                                                                                  0.31 |        1 |
|                                                                                                                  0.32 |        2 |
|                                                                                                                  0.34 |        3 |
|                                                                                                                  0.35 |        1 |
|                                                                                                                  0.37 |        1 |
|                                                                                                                  0.38 |        1 |
|                                                                                                                  0.39 |        3 |
|                                                                                                                  0.40 |        1 |
|                                                                                                                  0.43 |        1 |
|                                                                                                                  0.44 |        1 |
|                                                                                                                  0.45 |        1 |
|                                                                                                                  0.46 |        2 |
|                                                                                                                  0.48 |        7 |
|                                                                                                                  0.49 |        1 |
|                                                                                                                  0.50 |        2 |
|                                                                                                                  0.52 |        1 |
|                                                                                                                  0.54 |        2 |
|                                                                                                                  0.55 |        1 |
|                                                                                                                  0.56 |        1 |
|                                                                                                                  0.58 |        1 |
|                                                                                                                  0.61 |        1 |
|                                                                                                                  0.62 |        2 |
|                                                                                                                  0.63 |        1 |
|                                                                                                                  0.64 |        1 |
|                                                                                                                  0.66 |        1 |
|                                                                                                                  0.68 |        1 |
|                                                                                                                  0.69 |       64 |
|                                                                                                                  1.45 |        1 |
|                                                                                                                  2.99 |        1 |
+-----------------------------------------------------------------------------------------------------------------------+----------+
99 rows in set (0.01 sec)




me table AutoBudgetForecasterCTR -> AutoBudgetForecasterCTR_old
rename table AutoBudgetForecasterCTRMedia -> AutoBudgetForecasterCTRMedia_old
rename table AutoBudgetForecasterAPC -> AutoBudgetForecasterAPC_old
rename table AutoBudgetForecasterAvgAPC -> AutoBudgetForecasterAvgAPC_old
rename table ABVWForecasterAPC -> ABVWForecasterAPC_old
rename table ABVWForecasterPPC -> ABVWForecasterPPC_old

Проверка на одинаковость по версиям кода:

Проверка на одинаковость по группам баннеров

page_106253_dsp_total


[skipped] test_disaev.py::test_yabs_test (0.00 s) Skipped: Too long
[skipped] test_qlab.py::test_yabs_test (0.00 s) Skipped: Too long
[skipped] test_lilil.py::test_yabs_test (0.00 s) Skipped: Too long
[skipped] test_fortuna.py::test_yabs_test (0.00 s) Skipped: Too long
[skipped] test_klarissa.py::test_yabs_test (0.00 s) Skipped: Too long
[skipped] test_darth.py::test_yabs_test (0.00 s) Skipped: Too long
[skipped] test_gremli.py::test_yabs_test (0.00 s) Skipped: Too long
[skipped] test_akornet.py::test_yabs_test (0.00 s) Skipped: Too long
[skipped] test_debug_output.py::TestDebugOutput::test_with_mx (0.00 s) Skipped: Need matrixnets

yabs/server/test/qxl/floret/test <pytest>
[skipped] test_floret.py::test_yabs_test (0.00 s) Skipped: Too long
[fail] test_floret.py::test_metrika (0.27 s)
yabs/server/test/qxl/floret/test/test_floret.py:40: in test_metrika
    return regression.run_test(config, role='metrika')
yabs/server/test/lib/regression.py:459: in run_test
    with run_cluster(config) as cluster:
contrib/tools/python/src/Lib/contextlib.py:17: in __enter__
    ???
yabs/server/test/lib/engine.py:604: in run_cluster
    cluster = Cluster.construct(pgroup, config, extra_env)
contrib/python/trace_event/trace_event_impl/decorators.py:73: in traced_function
    return func(*args, **kwargs)
yabs/server/test/lib/engine.py:538: in construct
    config.inst_dir.remove()
contrib/python/py-1.4.30/py/_path/local.py:207: in remove
    ignore_errors=ignore_errors)
contrib/python/py-1.4.30/py/_error.py:84: in checked_call
    raise cls("%s%r" % (func.__name__, args))
E   ENOTEMPTY: [Directory not empty]: rmtree('/mnt/raid/home/olegts/arc/trunk/arcadia/yabs/server/test/qxl/floret/test/test-results/test/instance',)
Log: /mnt/raid/home/olegts/arc/trunk/arcadia/yabs/server/test/qxl/floret/test/test-results/test/testing_out_stuff/test_floret.py.test_metrika.log
------- FAIL: 4 - GOOD, 1 - FAIL, 1 - SKIPPED yabs/server/test/qxl/floret/test
[skipped] test_bratgrim.py::test_yabs_test (0.00 s) Skipped: Too long
[skipped] test_raccoon.py::test_yabs_test (0.00 s) Skipped: Too long

 !!! PRODUCTION !!! root@bsdb02g.yandex.ru [vh]> select * from ContentResource where ContentGroupID in (14777295659888586628,17753214808876525743);
+----------------------+------------+------------+---------------------+--------------+
| ContentGroupID       | ResourceNo | Value      | UpdateTime          | ResourceName |
+----------------------+------------+------------+---------------------+--------------+
| 14777295659888586628 |          1 | 1480887900 | 0000-00-00 00:00:00 | start_time   |
| 14777295659888586628 |          2 | 1480896000 | 0000-00-00 00:00:00 | stop_time    |
| 17753214808876525743 |          1 | 1480802280 | 0000-00-00 00:00:00 | start_time   |
| 17753214808876525743 |          2 | 1480814174 | 0000-00-00 00:00:00 | stop_time    |
+----------------------+------------+------------+---------------------+--------------+
4 rows in set (0.00 sec)


rtb task https://olegts.haze.yandex.net/mon/cgi-bin/taskspage.cgi?func=get_result&task_id=10737&called_from=main_page
event task https://olegts.haze.yandex.net/mon/cgi-bin/taskspage.cgi?func=get_result&task_id=10739&called_from=main_page


tmp_rtb_multiplier
tmp_table
tmp_rtbmultipliers
:q


2016/12/09 17:32:13 912693 INFO  [        main::]   * Creating tablet cells
2016/12/09 17:33:14 912693 WARN  [yt_await_table] await tablet cell '//sys/tablet_cells/1-fe-2bc-39b18013' to become 'good', current_state: initializing	(Yabs::YT @/usr/share/perl5/Yabs/YT.pm:1158)


2016-12-09 18:12:07,741 I       Network Localhost FQDN reported by getaddrinfo: faustkun-fin.haze.yandex.net    f37f5a0062f00764        ffff15c37eb9af5e
[root@local] yt> get //sys/nodes/faustkun-fin.haze.yandex.net:9014/@tablet_slots ;
[
   {
      "cell_id" : "1-fd-2bc-99feb62",
      "peer_id" : 0,
      "state" : "leading"
   }
]
2016-12-09 17:32:13

[root@local] yt> get //sys/nodes/faustkun-fin.haze.yandex.net:9016/@tablet_slots ;
[
   {
      "cell_id" : "1-d8-2bc-dcc67fff",
      "peer_id" : 0,
      "state" : "leading"
   }
]

2016-12-09 17:32:12
[root@local] yt> get //sys/nodes/faustkun-fin.haze.yandex.net:9018/@tablet_slots ;
[
   {
      "cell_id" : "1-fc-2bc-86c840cc",
      "peer_id" : 0,
      "state" : "leading"
   }
]
2016-12-09 17:32:13


2016-12-09 17:32:28

2016-12-09 17:32:12,062 I       Hive    Cell reconfigured (CellId: 1-d8-2bc-dcc67fff, ConfigVersion: 1) 5d2c60f99d3214bd        ffff15c312d59efb
2016-12-09 17:32:12,538 I       Hive    Cell reconfigured (CellId: 1-d8-2bc-dcc67fff, ConfigVersion: 2) 5d2c60f99d3214bd        ffff15c309e41bc4
2016-12-09 17:32:13,879 I       Hive    Cell reconfigured (CellId: 1-fc-2bc-86c840cc, ConfigVersion: 1) 5d2c60f99d3214bd        ffff15c2f02e176b
2016-12-09 17:32:13,890 I       Hive    Cell reconfigured (CellId: 1-fd-2bc-99feb62, ConfigVersion: 1)  5d2c60f99d3214bd        ffff15c2ef998673
2016-12-09 17:32:13,902 I       Hive    Cell reconfigured (CellId: 1-fe-2bc-39b18013, ConfigVersion: 1) 5d2c60f99d3214bd        ffff15c2ef079ca4
2016-12-09 17:32:14,530 I       Hive    Cell reconfigured (CellId: 1-fd-2bc-99feb62, ConfigVersion: 2)  5d2c60f99d3214bd        ffff15c2e28ac8a7
2016-12-09 17:32:14,530 I       Hive    Cell reconfigured (CellId: 1-fc-2bc-86c840cc, ConfigVersion: 2) 5d2c60f99d3214bd        ffff15c2e28ac8a7




 !!! PRODUCTION !!! root@bstat148i.yandex.ru [yabsdb]> select Weight, count(*), avg(BannerPriority) from (select BannerID, BannerPriority  from Banner148 where OrderID in (10643394, 10643972, 10644340, 9021929,9021943,9021952,9021958) ) T left join InterfaceTagToObj on T.BannerID = ObjID and ObjTypeID = 4 inner join InterfaceTag using(InterfaceTagID) group by 1;
+---------+----------+---------------------+
| Weight  | count(*) | avg(BannerPriority) |
+---------+----------+---------------------+
|       0 |      388 |         -27602.4845 |
| 1200000 |      858 |         -26741.1713 |
| 1500000 |     1276 |         -26188.4647 |
+---------+----------+---------------------+
3 rows in set (15.76 sec)


i !!! PRODUCTION !!! root@bstat148i.yandex.ru [yabsdb]> select InterfaceTagID, Weight, count(*), avg(BannerPriority) from (select BannerID, BannerPriority  from Banner148 where OrderID in (10643394, 10643972, 10644340, 9021929,9021943,9021952,9021958) ) T left join InterfaceTagToObj on T.BannerID = ObjID and ObjTypeID = 4 inner join InterfaceTag using(InterfaceTagID) group by 1,2;
+----------------+---------+----------+---------------------+
| InterfaceTagID | Weight  | count(*) | avg(BannerPriority) |
+----------------+---------+----------+---------------------+
|             92 | 1500000 |     1276 |         -26188.4647 |
|             94 |       0 |       46 |         -30272.3478 |
|             95 | 1200000 |      368 |         -27431.9701 |
|             97 | 1200000 |      490 |         -26222.3673 |
|            109 |       0 |      309 |         -27227.4951 |
|            114 |       0 |       33 |         -27392.1212 |
+----------------+---------+----------+---------------------+
6 rows in set (14.69 sec)


 !!! PRODUCTION !!! root@bstat148i.yandex.ru [yabsdb]> select InterfaceTagID, Weight, count(*), avg(BannerPriority) from (select BannerID, BannerPriority  from Banner148 where OrderID in (10643394, 10643972, 10644340, 9021929,9021943,9021952,9021958) ) T left join InterfaceTagToObj on T.BannerID = ObjID and ObjTypeID = 4 inner join InterfaceTag using(InterfaceTagID) group by 1,2;
+----------------+---------+----------+---------------------+
| InterfaceTagID | Weight  | count(*) | avg(BannerPriority) |
+----------------+---------+----------+---------------------+
|             92 | 1500000 |     1276 |         -37044.8495 |
|             94 |       0 |       46 |         -27562.5000 |
|             95 | 1200000 |      368 |         -32697.1576 |
|             97 | 1200000 |      490 |         -31466.7653 |
|            109 |       0 |      309 |         -27226.8932 |
|            114 |       0 |       33 |         -27392.1212 |
+----------------+---------+----------+---------------------+
6 rows in set (14.18 sec)



imported-black-windows
ovs-item-channel
ovs-item-episode
ovs-item-vod-episode
source-tech-info-channels
vod-feed-libraries
service-flag-page-inheritence-channels
service-flag-page-inheritence-episodes
check-intersection-episodes
input-stream-channels

order_11619584_events
order_12440915_events


autobudget.pl
banner-badtarg-limitation.pl
bring-host-options.pl
check-day-money-limit-overdraft.pl
check-sticked-orders.pl
find-avgcpa-deviation.pl
find-overdraft-reasons.pl
flat-probability-restore.pl
load-search-conv.pl
test-host-options.pl
Yabs/AutoBudget/Limitations.pm
Yabs/AutoBudget/GroupMatch.pm
Yabs/AutoBudget/Algorithms/Limit.pm
Yabs/AutoBudget/Algorithms/RegisterChanges.pm
Yabs/AutoBudget/Algorithms/Limit/Derivative.pm
Yabs/AutoBudget/Algorithms/Limit/Avg.pm
Yabs/AutoBudget/Algorithms/Limit/Sum.pm
Yabs/AutoBudget/Algorithms/Hull.pm
Yabs/AutoBudget/ABGroupStatDay.pm
Yabs/AutoBudget/TimeTargetting.pm
Yabs/AutoBudget/Optimization.pm
Yabs/AutoBudget/OrderInfo/NamesHelper.pm
Yabs/AutoBudget/OrderInfo/HashOfOrderInfo.pm
Yabs/AutoBudget/OrderInfo/ArrayType.pm
Yabs/AutoBudget/OrderInfo/OrderInfo.pm
Yabs/AutoBudget/OrderInfo/UniType.pm
Yabs/AutoBudget/OrderInfo/RootHelper.pm
Yabs/AutoBudget/OrderInfo/Trace.pm
Yabs/AutoBudget/OrderInfo/HashType.pm
Yabs/AutoBudget/ShowsCorr.pm
Yabs/AutoBudget/LoadData.pm
Yabs/AutoBudget/GroupBannerProcessor.pm
Yabs/AutoBudget/Constants.pm
Yabs/AutoBudget/PhraseUpdateTime.pm
Yabs/AutoBudget/NormPhrase.pm
Yabs/DProcess/CustomSubs/AutoBudgetSearchVisit.pm
Yabs/DProcess/CustomSubs/BannerBadtargLimitation.pm
Yabs/DProcess/CustomSubs/AutoBudgetAvgCPADeviation.pm
Yabs/DProcess/CustomSubs/AutoBudget.pm
Yabs/DProcess/CustomSubs/AutoBudgetOverdraft.pm


alerts.cgi
alerts_task_controller.cgi

Dec 20 16:20:00 bsint02h CRON[43033]: (yabs) CMD ($STATPATH/anomalies-detector.pl slow 1>>$STATPATH/log/anomalies-detector.log 2>>$STATPATH/log/anomalies-detector.err &)
Dec 20 16:30:00 bsint02h CRON[174120]: (yabs) CMD ($STATPATH/anomalies-detector.pl slow 1>>$STATPATH/log/anomalies-detector.log 2>>$STATPATH/log/anomalies-detector.err &)


https://bs-mg.yandex-team.ru/render/?width=586&height=308&_salt=1397555374.633&lineMode=connected&title=Worst%20by%20min%20current%20time&target=aliasSub(highestCurrent(removeAboveValue(yabsStatLag(five_sec.bstat%5B0-9%5D%5B0-9%5D*_ru.update_group-phrase-context-cost_ys_st.min_updatetime)%2C%202400)%2C5)%2C%20%22%5E.*(bstat%5Cd%2B%5Cw).*%24%22%2C%20%22%5C1%22)

https://bs-mg.yandex-team.ru/render/?width=586&height=308&_salt=1397555497.838&lineMode=connected&title=Worst%20by%20max%20current%20time&target=aliasSub(highestCurrent(removeAboveValue(yabsStatLag(five_sec.bstat%5B0-9%5D%5B0-9%5D*_ru.update_group-phrase-context-cost_ys_st.max_updatetime)%2C%202400)%2C5)%2C%20%22%5E.*(bstat%5Cd%2B%5Cw).*%24%22%2C%20%22%5C1%22)

https://bs-mg.yandex-team.ru/render/?width=586&height=308&_salt=1397555571.158&lineMode=connected&title=Worst%20by%20min%20average%20time&target=aliasSub(highestAverage(removeAboveValue(yabsStatLag(five_sec.bstat%5B0-9%5D%5B0-9%5D*_ru.update_group-phrase-context-cost_ys_st.min_updatetime)%2C%202400)%2C5)%2C%20%22%5E.*(bstat%5Cd%2B%5Cw).*%24%22%2C%20%22%5C1%22)

https://bs-mg.yandex-team.ru/render/?width=586&height=308&_salt=1397555589.274&lineMode=connected&title=Worst%20by%20max%20average%20time&target=aliasSub(highestAverage(removeAboveValue(yabsStatLag(five_sec.bstat%5B0-9%5D%5B0-9%5D*_ru.update_group-phrase-context-cost_ys_st.max_updatetime)%2C%202400)%2C5)%2C%20%22%5E.*(bstat%5Cd%2B%5Cw).*%24%22%2C%20%22%5C1%22)

https://bs-mg.yandex-team.ru/render/?width=586&height=308&_salt=1396459132.798&lineMode=connected&title=Best%20and%20average%20total%20time&target=alias(averageSeries(removeAboveValue(yabsStatLag(five_sec.bstat*_ru.update_group-phrase-context-cost_ys_st.min_updatetime)%2C%202400))%2C%20%22Average%20worst%20time%22)&target=alias(minSeries(removeAboveValue(yabsStatLag(five_sec.bstat*_ru.update_group-phrase-context-cost_ys_st.min_updatetime)%2C%202400))%2C%20%22Best%20of%20the%20worst%20time%22)&target=alias(averageSeries(removeAboveValue(yabsStatLag(five_sec.bstat*_ru.update_group-phrase-context-cost_ys_st.max_updatetime)%2C%202400))%2C%20%22Average%20best%20time%22)&target=alias(minSeries(removeAboveValue(yabsStatLag(five_sec.bstat*_ru.update_group-phrase-context-cost_ys_st.max_updatetime)%2C%202400))%2C%20%22Best%20of%20the%20best%20time%22)

https://bs-mg.yandex-team.ru/render/?width=586&height=308&_salt=1396459271.679&lineMode=connected&title=Worst%20total%20time&target=alias(maxSeries(removeAboveValue(yabsStatLag(five_sec.bstat*_ru.update_group-phrase-context-cost_ys_st.max_updatetime)%2C%202400))%2C%20%22Worst%20of%20the%20best%20time%22)&target=alias(maxSeries(removeAboveValue(yabsStatLag(five_sec.bstat*_ru.update_group-phrase-context-cost_ys_st.min_updatetime)%2C%202400))%2C%20%22Worst%20of%20the%20worst%20time%22)

https://bs-mg.yandex-team.ru/render/?width=586&height=308&_salt=1395741388.97&lineMode=connected&title=Top%205%20YS%20usage&hideLegend=false&target=aliasSub(highestCurrent(transformNull(one_min.*bsst*_ru.yabs_storage_memory.usage%2C0)%2C5)%2C%20%22%5E.*%5C.(%5Cw*bsst%5B%5E_%5D%2B).*%24%22%2C%20%22%5C1%22)&target=alias(minSeries(one_min.*bsst*_ru.yabs_storage_memory.limit)%2C%20%22Limit%22)

https://bs-mg.yandex-team.ru/render/?width=586&height=308&_salt=1395741770.234&lineMode=connected&title=YS%20errors&target=alias(sumSeries(five_sec.bstat*_ru.update_group-phrase-context-cost_ys_st.errors)%2C%20%22Errors%22)&target=alias(sumSeries(five_sec.bstat*_ru.update_group-phrase-context-cost_ys_st.fatals)%2C%20%22Fatals%22)

62
69





первый запуск нового алгоритма
74.18user 1.91system 6:25.63elapsed 19%CPU (0avgtext+0avgdata 3196736maxresident)k
8inputs+3208outputs (0major+308597minor)pagefaults 0swaps
второй запуск нового алгоритма
74.87user 1.89system 1:30.26elapsed 85%CPU (0avgtext+0avgdata 3198160maxresident)k
0inputs+3160outputs (0major+307840minor)pagefaults 0swaps
75.84user 1.88system 1:30.54elapsed 85%CPU (0avgtext+0avgdata 3197680maxresident)k
8inputs+3136outputs (0major+307739minor)pagefaults 0swaps
2017/01/01 16:36:02 30498
2017/01/01 16:36:20 31262 INFO  [load_order_sta] Order 233736 future expect: clicks 0, cost 0, actions 0
2017/01/01 16:37:32 30498 INFO  [        main::] 20170101163600 finished


первый запуск старого алгоритма
ш44.10user 2.06system 0:58.28elapsed 79%CPU (0avgtext+0avgdata 2950400maxresident)k
0inputs+2488outputs (0major+290272minor)pagefaults 0swaps
второй запуск старого алгоритма
43.31user 2.05system 0:54.59elapsed 83%CPU (0avgtext+0avgdata 2950416maxresident)k
0inputs+2496outputs (0major+290312minor)pagefaults 0swaps
2017/01/01 16:34:12 20670 INFO  [         BEGIN] MYSQL_NOW = now(), mysql_generation_start_time = '20170101163000'
2017/01/01 16:34:29 21410 INFO  [load_order_sta] order 5393208 has holiday bit
2017/01/01 16:35:06 20670 INFO  [        main::] 20170101163400 finished

Yabs/AutoBudget/Optimization.pm:2057:   foreach my $pr_idx (@{$banner_phrases->get_all_ids_by_order(order_id => $oid)}) {
Yabs/AutoBudget/Optimization.pm:2307:   foreach my $pr_idx (@{$banner_phrases->get_all_ids_by_order(order_id => $oid)}) {

1135416817,150386512,1
2608772764,835945,1

1135658549,150386512,1
[pid=6645->6883]  DB<26> x $seltype_data->{1135658549}                                                                                                        0  ARRAY(0x13893710)
   0  0.21399403555862
   1  2.43237729362864
   2  598.492286596121
   3  71.331342979037
[pid=4070->6439]  DB<18> x $seltype_data->{1135658549}
0  ARRAY(0x14014ec0)
   0  0.42798807111724
   1  5.79512696864594
   2  1425.90493656749
   3  142.662685958074

Press ENTER or type command to continue
1135658549      150386512       1       1       0       41433169.66946706       30096191.19160497       5918926.4555253405      8760007.607644916       313785070.71058726
1135658549      150386512       1       1       0       815748.9417202908       359220.87371574197      97080.4931664421        119969.7287718932       333333323.019169
1135658549      150386512       1       1       0       493231.05337745626      176487.42198801885      53728.32371197536       65143.72403098479       333333322.9881334
1135658549      150386512       1       1       0       38857951.53801137       26636067.115707487      11299733.152099716      12054323.601868626      333331595.52119935
1135658549      150386512       1       1       0       22978202.125802167      14063376.37602083       6792080.659559394       8595087.74440143        333330012.0716045
1135658549      150386512       1       1       1       232138303.31855866      322673091.35551447      73866836.55466579       161866916.07790178      246052406.4929437
1135658549      150386512       1       1       1       140888768.4987401       275819195.2406061       291835188.1597746       206128786.52995476      163276453.91986948


1135658549      150386512       1       1       0       43636548.79675959       28754253.008403823      5655013.006181634       8369413.196399867       313785070.71058726
1135658549      150386512       1       1       0       1847756.8616287133      929367.2501892727       245742.12220509606      342642.0122489857       333333333.12284017
1135658549      150386512       1       1       0       642063.8557833529       278032.1043352546       81142.25905056307       97972.4214695121        333333328.05517006
1135658549      150386512       1       1       0       38763855.9517844        27116599.596997317      11492051.130409531      12283735.947807048      333331595.52119935
1135658549      150386512       1       1       0       24065533.135930415      13924179.70047417       6536761.389478431       8570175.308354156       333330012.0716045
1135658549      150386512       1       1       1       328528331.6048654       493648024.3180253       108370148.63452758      248498841.43156126      246052406.4929437
1135658549      150386512       1       1       1       38037995.69622537       73483995.61041045       77750991.10273218       54917015.111147135      163276453.91986948


-------------------

Что надо протестировать по группе:
  - ShowsCorrBuffer сложный случай


Отдельно:
M       Yabs/Stat/Collectors/AutoBudgetShowsCorrBuffer.pm

mysql> select  * from AutoBudgetBadTargHistory L left join NewAutoBudgetBadTargHistory R using(BannerID) inner join (select BannerID, truncate(sum(Clicks * pow(0.997, (unix_timestamp('20170106231500') - unix_timestamp(least(UpdateTime,'20170106231500'))) div 3600)) /max(TimeCoeff * pow(0.997, (unix_timestamp('20170106231500') - unix_timestamp(least(UpdateTime,'20170106231500'))) div 3600)+ 1e6 * (1 - pow(0.997, (unix_timestamp('20170106231500') - unix_timestamp(least(UpdateTime,'20170106231500'))) div 3600)) / (1 - 0.997)) * 1e6, 0) as BadStat from AutoBudgetAdjustedStat where AdjustedClicks > 0 and Cost > 0 and SourceCost  > 0 and TimeCoeff > 0 and  UpdateTime > '20170106231500' - interval 14 day and BadTarg = 1 and TargetType > 0 group by BannerID )  T using(BannerID) left join (select BannerID, truncate(sum(Clicks * pow(0.997, (unix_timestamp('20170106231500') - unix_timestamp(least(UpdateTime,'20170106231500'))) div 3600)) /max(TimeCoeff * pow(0.997, (unix_timestamp('20170106231500') - unix_timestamp(least(UpdateTime,'20170106231500'))) div 3600)+ 1e6 * (1 - pow(0.997, (unix_timestamp('20170106231500') - unix_timestamp(least(UpdateTime,'20170106231500'))) div 3600)) / (1 - 0.997)) * 1e6, 0) as BadStat from ABAdjustedStatTZCoeff where AdjustedClicks > 0 and Cost > 0 and SourceCost  > 0 and TimeCoeff > 0 and  UpdateTime > '20170106231500' - interval 14 day and BadTarg = 1 and TargetType > 0 group by BannerID )  T2 using(BannerID)  where  L.BadStat != R.BadStat and R.BadStat != T.BadStat and R.BadStat != T2.BadStat limit 1\G
*************************** 1. row ***************************

mysql> select  * from AutoBudgetBadTargHistory L left join NewAutoBudgetBadTargHistory R using(BannerID) inner join (select BannerID, truncate(sum(Clicks * pow(0.997, (unix_timestamp('20170106231500') - unix_timestamp(least(UpdateTime,'20170106231500'))) div 3600)) /max(TimeCoeff * pow(0.997, (unix_timestamp('20170106231500') - unix_timestamp(least(UpdateTime,'20170106231500'))) div 3600)+ 1e6 * (1 - pow(0.997, (unix_timestamp('20170106231500') - unix_timestamp(least(UpdateTime,'20170106231500'))) div 3600)) / (1 - 0.997)) * 1e6, 0) as BadStat from AutoBudgetAdjustedStat where AdjustedClicks > 0 and Cost > 0 and SourceCost  > 0 and TimeCoeff > 0 and  UpdateTime > '20170106231500' - interval 14 day and BadTarg = 1 and TargetType > 0 group by BannerID )  T using(BannerID) left join (select BannerID, truncate(sum(Clicks * pow(0.997, (unix_timestamp('20170106231500') - unix_timestamp(least(UpdateTime,'20170106231500'))) div 3600)) /max(TimeCoeff * pow(0.997, (unix_timestamp('20170106231500') - unix_timestamp(least(UpdateTime,'20170106231500'))) div 3600)+ 1e6 * (1 - pow(0.997, (unix_timestamp('20170106231500') - unix_timestamp(least(UpdateTime,'20170106231500'))) div 3600)) / (1 - 0.997)) * 1e6, 0) as BadStat from ABAdjustedStatTZCoeff where AdjustedClicks > 0 and Cost > 0 and SourceCost  > 0 and TimeCoeff > 0 and  UpdateTime > '20170106231500' - interval 14 day and BadTarg = 1 and TargetType > 0 group by BannerID )  T2 using(BannerID)   where  L.BadStat != R.BadStat and R.BadStat != T.BadStat and R.BadStat != T2.BadStat limit 1\G


MySQLClusterPrestablePrePreBilling_GLOBAL




mysql> select * from AuctionBannerPhrase_bstat01i inner join AuctionBannerPhrase_bstat01h using(BannerID,PhraseID,ContextType,PageID,Level) where AuctionBannerPhrase_bstat01i.UpdateTime between '2017/01/10 11:30:00' and '2017/01/10 13:40:00' and AuctionBannerPhrase_bstat01h.UpdateTime between '2017/01/10 11:30:00' and '2017/01/10 13:40:00' and (AuctionBannerPhrase_bstat01i.EventCount!=AuctionBannerPhrase_bstat01h.EventCount or AuctionBannerPhrase_bstat01i.RotationCount!=AuctionBannerPhrase_bstat01h.RotationCount or AuctionBannerPhrase_bstat01i.RotationShown!=AuctionBannerPhrase_bstat01h.RotationShown or AuctionBannerPhrase_bstat01i.CPC11!=AuctionBannerPhrase_bstat01h.CPC11 or AuctionBannerPhrase_bstat01i.Cost11!=AuctionBannerPhrase_bstat01h.Cost11 or AuctionBannerPhrase_bstat01i.CPC12!=AuctionBannerPhrase_bstat01h.CPC12 or AuctionBannerPhrase_bstat01i.Cost12!=AuctionBannerPhrase_bstat01h.Cost12 or AuctionBannerPhrase_bstat01i.CPC13!=AuctionBannerPhrase_bstat01h.CPC13 or AuctionBannerPhrase_bstat01i.Cost13!=AuctionBannerPhrase_bstat01h.Cost13 or AuctionBannerPhrase_bstat01i.Cost1!=AuctionBannerPhrase_bstat01h.Cost1 or AuctionBannerPhrase_bstat01i.CPC21!=AuctionBannerPhrase_bstat01h.CPC21 or AuctionBannerPhrase_bstat01i.Cost21!=AuctionBannerPhrase_bstat01h.Cost21 or AuctionBannerPhrase_bstat01i.CPC22!=AuctionBannerPhrase_bstat01h.CPC22 or AuctionBannerPhrase_bstat01i.Cost22!=AuctionBannerPhrase_bstat01h.Cost22 or AuctionBannerPhrase_bstat01i.CPC23!=AuctionBannerPhrase_bstat01h.CPC23 or AuctionBannerPhrase_bstat01i.Cost23!=AuctionBannerPhrase_bstat01h.Cost23 or AuctionBannerPhrase_bstat01i.CPC24!=AuctionBannerPhrase_bstat01h.CPC24 or AuctionBannerPhrase_bstat01i.Cost24!=AuctionBannerPhrase_bstat01h.Cost24 or AuctionBannerPhrase_bstat01i.Cost2!=AuctionBannerPhrase_bstat01h.Cost2 or AuctionBannerPhrase_bstat01i.Cost3!=AuctionBannerPhrase_bstat01h.Cost3 or AuctionBannerPhrase_bstat01i.RotationBid!=AuctionBannerPhrase_bstat01h.RotationBid or AuctionBannerPhrase_bstat01i.CPM1!=AuctionBannerPhrase_bstat01h.CPM1 or AuctionBannerPhrase_bstat01i.CPM2!=AuctionBannerPhrase_bstat01h.CPM2 or AuctionBannerPhrase_bstat01i.FailedAuctions!=AuctionBannerPhrase_bstat01h.FailedAuctions) limit 1\G

OfferShows
CostCur
SessionCost
MaxHostTime

Shows -> ParentShows + ChildShows
OfferShows -> Shows

mysql -hbsarchive52h -urplcat -pslvrkng base1 -A

mysql> select * from EventBadLog20170108143500 where LogID=18188727218830838486;
Empty set (0.00 sec)

2017-01-08 17:35:00


:)  select sum(Shows) from FiveMinFraudStat where EventDate = '2017-01-08' and PageID = 186 and IsUnique=0 and Source=1 and GoodEvent=2 and UpdateTime='2017-01-08 17:35:00';

SELECT sum(Shows)
FROM FiveMinFraudStat
WHERE (EventDate = '2017-01-08') AND (PageID = 186) AND (IsUnique = 0) AND (Source = 1) AND (GoodEvent = 2) AND (UpdateTime = '2017-01-08 17:35:00')

┌─sum(Shows)─┐
│       3625 │
└────────────┘
↗ Progress: 24.58 thousand rows, 638.98 KB (3.66 million rows/s., 95.04 MB/s.)
1 rows in set. Elapsed: 0.007 sec. Processed 24.58 thousand rows, 638.98 KB (3.64 million rows/s., 94.57 MB/s.)

:)  select sum(Shows) from FiveMinFraudStat where EventDate = '2017-01-08' and PageID = 172351 and IsUnique=0 and Source=1 and GoodEvent=2 and UpdateTime='2017-01-08 17:35:00';

SELECT sum(Shows)
FROM FiveMinFraudStat
WHERE (EventDate = '2017-01-08') AND (PageID = 172351) AND (IsUnique = 0) AND (Source = 1) AND (GoodEvent = 2) AND (UpdateTime = '2017-01-08 17:35:00')

┌─sum(Shows)─┐
│       3595 │
└────────────┘
→ Progress: 32.77 thousand rows, 851.97 KB (5.01 million rows/s., 130.18 MB/s.)
1 rows in set. Elapsed: 0.007 sec. Processed 32.77 thousand rows, 851.97 KB (4.97 million rows/s., 129.21 MB/s.)

:)

olegts@olegts [ 22844.download-hahn-table.start ] :~/arc/trunk/arcadia/junk/olegts/download-hahn-table$ cat hahn-table2.txt |tabgrep '$eventtime >= 1483886100  && $eventtime <= 1483886399  && ($eventflags & ( 65536 + 1024 + 32 + 16 + 8 + 4 )) > 0 && $countertype==1' | wc -l
3626
olegts@olegts [ 22844.download-hahn-table.start ] :~/arc/trunk/arcadia/junk/olegts/download-hahn-table$ cat hahn-table.txt |tabgrep '$eventtime >= 1483886100  && $eventtime <= 1483886399  && ($eventflags & ( 65536 + 1024 + 32 + 16 + 8 + 4 )) > 0 && $countertype==1' | wc -l
3596

mysql> select sum(CounterType=1) from page_186_badevents where unix_timestamp(EventTime) between 1483886100 and 1483886399 ;
+--------------------+
| sum(CounterType=1) |
+--------------------+
|               3615 |
+--------------------+
1 row in set (0.09 sec)

mysql> select sum(CounterType=1) from page_172351_badevents where unix_timestamp(EventTime) between 1483886100 and 1483886399 ;
+--------------------+
| sum(CounterType=1) |
+--------------------+
|               3594 |
+--------------------+
1 row in set (0.10 sec)


cpu на bstat




BillCost,CostBits,CostCur,CostTaxFree,EventCost,EventCostCur,InitCost,InitCostCur,InitCostTaxFree,PartnerCostRubTaxFree,RealCost,RealCostCur,SourceCost,SourceCostCur,

Коллекторы Автобюждета:
  - ABFastAdjustedStat
  - ABGroupExportPhraseStatDay
  - ABBannerPhraseCurWeek
  - AutoBudgetShowsCorrBuffer.pm
  - ABPhraseClusterStat.pm
  - AutoBudgetAdjusted.pm

Коллекторы YT:
  - OrderCounter
  - OrderCounterGoalStat

Модули прогнозатора:
  - CTR.pm -- просто поставить хост-опцию
  - APC.pm -- поменять хост-опицю
  - APC_CRM.pm -- поменять хост-опции

vw-модели прогнозатора:
  - ABVWForecasterAPC
  - ABVWForecasterPPC


Коллекторы прогнозатора:
  - AutoBudgetForecasterRestart.pm
  - AutoBudgetIntentEventLog.pm
  - AutoBudgetForecaster.pm
  - AutoBudgetConv.pm
  - AutoBudgetForecasterAPCMonitoring.pm

Статистика аукциона:
  - AuctionCurve.pm
  - AuctionCurveRankRequest.pm

привет. у меня есть разработка — поддержка relevance match в Автобюджете. про сам RM можно почитать тут https://st.yandex-team.ru/BSSERVER-1649, а для поддержки этой функциональности в Автобюджете нужно выполнить эти задачи https://st.yandex-team.ru/BSDEV/order:updated:false/filter?tags=autobudget-relevance-match&resolution=empty() в основном это правки коллекторов. Можно мне немного времени Антона и Димы чтобы эта задача хорошо распараллелилась и побыстрее сошлась? Я тоже возьму себе часть этих тасков конечно же.


Доступ нужен для хранения фидов внешних партнеров для видео-хостинга.

Ответы на вопросы:

1) Какой предполагается доступ к данным, которые вы положите в S3?
а) данные должны быть доступны всему миру
 2) Кол-во объёктов в одном вашем bucket'e?
неограничено
 3) Суммарное кол-во bucket'ов?
200
 4) Предполагаются ли листинги и фильтрация при листингах в процессе работы?
да
 5) Какой суммарный занимаемый объём для ваших данных за полгода?
5 TB
 6) Какая нагрузка на чтение и запись в rps?
10 RPS
 7) Кто будет заливать данные (робот, или люди)? От этого зависит способ авторизации в S3.
Робот


//home/logfeller/logs/bs-dspobject-log/1h/2017-01-09T21:00:00


PRAGMA refselect; PRAGMA yt.DataSizePerJob="100000000"; use hahn;
range([//home/logfeller/logs/bs-dspobject-log/1h], [2017-01-17T07:00:00], [2017-01-17T07:00:00])
			where

DSPCreative


$RELEVANCE_MATCH_CONTEXT_TYPES =  host_option('relevance-match-context-types', 11);


_BSNETS_
{"pwdLastSet": "1601-01-01T00:00:00", "sAMAccountName": "olegts_test", "countryCode": "0", "objectGUID": "21c2248e-f900-c244-b101-e341dc9efa22", "userPrincipalName": "olegts_test@tst.virtual", "description": null, "distinguishedName": "CN=olegts_test,CN=Users,DC=tst,DC=virtual", "displayName": "Oleg I. Tsarkov", "name": "olegts_test", "memberOf": null, "sn": "Tsarkov", "telephoneNumber": null, "givenName": "Oleg"}


curl -X POST --data 'client_id=101&grant_type=client_credentials&ts=1484740550&ts_sign=tc6dcA3qmLkaRlT8NAOdQKWldaNZUyaFoLRxKKo-awE=' 'https://tvm-api-test.yandex.net'
curl -X POST --data 'client_id=101&grant_type=client_credentials&ts=1484741810&ts_sign=LY9jSzLl6eG8b3UqD-UbH8wP0Y_oPj5B-GOtmKSyVG4=' 'https://tvm-api-test.yandex.net'





Это роль для БК-шного робота который будет ходить через YQL в хан





		select
			Value
		from
			AntiDown
		where
				ScriptName = 'collect-fulldspbuf'
			and
				DataID = 2017011915444110
			and
				SubDataID = 188382
			and
				InfoName = 'bits'
//home/bs/yabs-log/201701/JoinedEFH201701400


522193260,534180696

122489:2017/01/23 11:56:37 832882 INFO  [is_avg_strateg] Order 4826032 has avg_strategy_only

210621:2017/01/23 11:59:05 832882 INFO  [autobudget_mai] Order 13023088 is daily limited



kages:
                                          : M2Crypto: A Python crypto and SSL toolkit
                                          : M2Crypto for Windows (64-bit)
Found 10 packages


Вт. янв. 24 10:10:34 MSK 2017
0
Вт. янв. 24 10:10:35 MSK 2017
1
Вт. янв. 24 10:10:36 MSK
Fix shuffle import, fix fatals, fix AutoBudgetUpdateTime, die on empty cloud launch.:q


ls /home/yabs/stat/ml-models/vw_apc_3_prod
ls /home/yabs/stat/ml-models/vw_apc_3_group_export
desc



2017-01-24 13:19:40,758 DEBUG scraper: Scraped from <200 http://[64:ff9b::c32e:b068]/exp/tv/yandexTV.jsp>
{'access': u'all',
 'feed_source_referer': None,
 'feed_source_url': 'http://www.ntv.ru/exp/tv/yandexTV.jsp',
 'feed_vendor_url': 'ntv.ru',
 'start_time': u'2017-01-23T08:00:00+03:00',
 'stop_time': u'2016-01-17T08:05:00+03:00'}


77:~ olegts$ grep -n '2017-01-23T08:00:00+03:00' ntv-148525315*.txt
ntv-1485253152.txt:5509:                    <end-time>2017-01-23T08:00:00+03:00</end-time>
ntv-1485253152.txt:5522:                    <begin-time>2017-01-23T08:00:00+03:00</begin-time>
ntv-1485253152.txt:428105:             <begin-time>2017-01-23T08:00:00+03:00</begin-time>
ntv-1485253152.txt:629328:             <begin-time>2017-01-23T08:00:00+03:00</begin-time>
ntv-1485253154.txt:5509:                    <end-time>2017-01-23T08:00:00+03:00</end-time>
ntv-1485253154.txt:5522:                    <begin-time>2017-01-23T08:00:00+03:00</begin-time>
ntv-1485253154.txt:428105:             <begin-time>2017-01-23T08:00:00+03:00</begin-time>
ntv-1485253154.txt:629328:             <begin-time>2017-01-23T08:00:00+03:00</begin-time>


YQL.pm


_fillSliceFields:q
:w

ren tv contentgroup 3689381176963379650

| 10047224462142226886 | 2017-01-27 21:00:00  |
| 13847266576362321704 | 2017-01-27 22:50:00  |
|  2681930699321912829 | 2017-01-28 00:00:00  |
|  2408169827934364959 | 2017-01-28 02:00:00  |
|  3101836519894428883 | 2017-01-28 03:50:00  |
|  3409675470402498641 | 2017-01-28 04:40:00  |
| 11954017096278352112 | 2017-01-28 05:00:00  |
|  7938189344957251320 | 2017-01-28 07:50:00  |

select ContentGroupID, from_unixtime(Value) from ContentGroup inner join ContentResource using(ContentGroupID) where ContentTypeID = 8 and ParentID = 3689381176963379650 and ResourceName = 'start_time' order by 2;

BSRELEASE-72549
106.1


 !!! PRODUCTION !!! root@bstat138i.yandex.ru [yabsdb]> select ResultFlatCost/1e4,count(*)  from PhrasePrice  where OrderID=10262998 and !find_in_set('deleted', Options) group by 1;
+--------------------+----------+
| ResultFlatCost/1e4 | count(*) |
+--------------------+----------+
|                1.8 |       21 |
|                2.4 |       21 |
|                2.5 |       21 |
|                2.6 |       42 |
|                2.7 |       42 |
|                  3 |       21 |
|                3.4 |       42 |
|                3.7 |       21 |
+--------------------+----------+
8 rows in set (0.00 sec)

 !!! PRODUCTION !!! root@bstat138i.yandex.ru [yabsdb]> select avg(APC1/1e6),avg(APC2/1e6) from ABVWForecasterAPC where OrderID=10262998;
+-----------------------+-----------------------+
| avg(APC1/1e6)         | avg(APC2/1e6)         |
+-----------------------+-----------------------+
| 0.0021299740259740226 | 0.0019181471861471847 |
+-----------------------+-----------------------+
1 row in set (0.00 sec)


 !!! PRODUCTION !!! root@bstat138i.yandex.ru [yabsdb]> select * from AutoBudgetOrder where OrderID=10262998\G
*************************** 1. row ***************************
         OrderID: 10262998
  FirstStartTime: 2016-07-07 18:35:00
       StartTime: 2017-01-19 19:00:00
       LimitWeek: 786666667
    LimitWeekCur: 236000000
   LimitDayMoney: 0
LimitDayMoneyCur: 0
         MaxCost: 0
      MaxCostCur: 0
         AvgCost: 393333
      AvgCostCur: 118000
          AvgCPA: 23600000
       AvgCPACur: 7080000
        ROILevel: 0
          GoalID: 4341593
 LimitWeekClicks: 0
            Type: 3
    ContextLimit: 0
         Testing: 0
        Problems: 0
       DayWeight: 333333
    RegularSpent: 0
TransportDelayed: 0
    GenerateBids: 0
    OptimizeType: 1
   ReserveReturn: 0
   Profitability: 0
            Easy: 0
         Options:
  ChosenStrategy: cpa
1 row in set (1.84 sec)


1111820810 | 1111820810 |  931256563 |  9312565

AutoBudgetStatCurWeek
AutoBudgetOrder
OrderStatCurDay
OrderInfo
Pattern
TimeZone
AutoBudgetPriority
AutoBudgetCoeffs
ContextLimits
BroadmatchLimits
Holiday
AutoBudgetMap
OrderStat
Stopword
TargetDomain
Uniword
Currency
CurrencyRates
SelectType
DataTime
ABOrderGroups
TaxHistory
InterfaceTag
InterfaceTagToObj
RegionTree
OrderHitForecast
Place
ContextProperty
Operation
AuctionGroupBannerPhrase
AutoBudgetForecasterAvgAPC
ABVWForecasterPPC
ABExperimentCurWeek
AutoBudgetShowsCorr
BroadMatchBanner
BroadMatchBannerTime
AutoBudgetAdjustedStat
AutoBudgetConvStat
OrderTargetStat
AuctionBannerPhrase
AutoBudgetForecasterStat
AutoBudgetSearchConvStat
AutoBudgetForecasterAPC
AutoBudgetForecasterCTR
PhrasePrice
AutoBudgetConvStat
ABVWForecasterAPC
ABBannerPhraseCurWeek
AutoBudgetOrderHistory
AutoBudgetOrderHistoryClicks
AutoBudgetOrderHistoryDaily
ABAdjustedStatTZCoeff
LocalOrderInfo


PRAGMA refselect; PRAGMA yt.DataSizePerJob="100000000"; use hahn;
insert into [//tmp/olegts_26101_1485767609_1] select * from [//tmp/olegts_26101_1485767609] where CounterType == 2 limit 10;


:) select EventDate, sum(arraySum(id, attr_type, num -> if(id = 23128920 and attr_type = 1, num, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num)) / sum(Clicks) as APC from OrderCounter where OrderID = 11690851 and  EventDate >= '2017-01-09' group by EventDate ;

SELECT
    EventDate,
    sum(arraySum((id, attr_type, num) -> if((id = 23128920) AND (attr_type = 1), num, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num)) / sum(Clicks) AS APC
FROM OrderCounter
WHERE (OrderID = 11690851) AND (EventDate >= '2017-01-09')
GROUP BY EventDate

↗ Progress: 26.26 million rows, 897.12 MB (234.57 million rows/s., 8.01 GB/s.) ┌──EventDate─┬───────────────────APC─┐
│ 2017-01-09 │  0.004105243515581265 │
│ 2017-01-10 │  0.003831982313927782 │
│ 2017-01-11 │  0.005949656750572082 │
│ 2017-01-12 │  0.003486142583231654 │
│ 2017-01-13 │  0.004918032786885246 │
│ 2017-01-14 │  0.006154357950765137 │
│ 2017-01-15 │  0.005499379102359411 │
│ 2017-01-16 │  0.004336124401913876 │
│ 2017-01-17 │  0.005861664712778429 │
│ 2017-01-18 │  0.002723867892407218 │
│ 2017-01-19 │  0.006351446718419196 │
│ 2017-01-20 │ 0.0066272871344186714 │
│ 2017-01-21 │ 0.0058823529411764705 │
│ 2017-01-22 │  0.004361684281160879 │
│ 2017-01-23 │  0.003868289461269931 │
│ 2017-01-24 │  0.005001316135825217 │
│ 2017-01-25 │  0.005188516084399862 │
│ 2017-01-26 │  0.005631159080244017 │
│ 2017-01-27 │  0.006100422336931018 │
│ 2017-01-28 │   0.00636604774535809 │
│ 2017-01-29 │  0.004551365409622887 │
│ 2017-01-30 │ 0.0048357848075760625 │
└────────────┴───────────────────────┘
→ Progress: 50.03 million rows, 1.71 GB (250.50 million rows/s., 8.56 GB/s.)
22 rows in set. Elapsed: 0.200 sec. Processed 50.03 million rows, 1.71 GB (250.44 million rows/s., 8.56 GB/s.)

:)

mysql> select truncate(APC2/1e2, 0)/1e4,count(*)  from (select BannerID,PhraseID,ContextType,APC2 from ABVWForecasterAPC  where OrderID=11690851) T inner join PhrasePrice using(BannerID,PhraseID,ContextType)  inner join Banner111 using(BannerID)  where !find_in_set('deleted', PhrasePrice.Options) and Banner111.Contextpriority > 0  group by 1;
+---------------------------+----------+
| truncate(APC2/1e2, 0)/1e4 | count(*) |
+---------------------------+----------+
|                     0.001 |        1 |
|                    0.0012 |       12 |
|                    0.0013 |       12 |
|                    0.0014 |       42 |
|                    0.0015 |       82 |
|                    0.0016 |      297 |
|                    0.0017 |     6177 |
|                    0.0018 |      166 |
|                    0.0019 |      426 |
|                     0.002 |     1709 |
|                    0.0021 |     4291 |
|                    0.0022 |      113 |
|                    0.0023 |      142 |
|                    0.0024 |      132 |
|                    0.0025 |       98 |
|                    0.0026 |      123 |
|                    0.0027 |      147 |
|                    0.0028 |      102 |
|                    0.0029 |      489 |
|                     0.003 |       28 |
|                    0.0031 |       23 |
|                    0.0032 |       23 |
|                    0.0033 |        5 |
|                    0.0034 |       20 |
|                    0.0035 |       21 |
|                    0.0036 |       33 |
|                    0.0037 |        3 |
|                    0.0038 |        5 |
|                    0.0039 |        3 |
|                     0.004 |        1 |
|                    0.0041 |        4 |
|                    0.0042 |        8 |
|                    0.0043 |        2 |
|                    0.0044 |        4 |
|                    0.0045 |        4 |
|                    0.0046 |        2 |
|                    0.0047 |        1 |
|                    0.0049 |        1 |
|                     0.005 |        4 |
|                    0.0053 |        1 |
|                    0.0055 |        1 |
|                    0.0057 |        1 |
|                    0.0064 |        1 |
|                    0.0065 |        1 |
+---------------------------+----------+
44 rows in set (0.00 sec)

mysql>

 !!! PRODUCTION !!! root@bsdb02g.yandex.ru [vh]> select ContentTypeID, count(*) from ContentGroup group by 1;
+---------------+----------+
| ContentTypeID | count(*) |
+---------------+----------+
|             1 |       47 |
|             2 |     2824 |
|             3 |    63088 |
|             4 |      208 |
|             5 |    19932 |
|             6 |      185 |
|             7 |      513 |
|             8 |      759 |
+---------------+----------+
8 rows in set (0.24 sec)


 !!! PRODUCTION !!! root@bsdb02g.yandex.ru [vh]> select ContentTypeID, count(*) from ContentGroup group by 1;
+---------------+----------+
| ContentTypeID | count(*) |
+---------------+----------+
|             1 |       47 |
|             2 |     2824 |
|             3 |    63118 |
|             4 |      208 |
|             5 |    19932 |
|             6 |      185 |
|             7 |      513 |
|             8 |      759 |
+---------------+----------+
8 rows in set (0.05 sec)

 !!! PRODUCTION !!! root@bsdb02g.yandex.ru [vh]> select ContentTypeID, count(*) from ContentGroup group by 1;
+---------------+----------+
| ContentTypeID | count(*) |
+---------------+----------+
|             1 |       47 |
|             2 |     2824 |
|             3 |    63118 |
|             4 |      208 |
|             5 |    19932 |
|             6 |      185 |
|             7 |      513 |
|             8 |      759 |
+---------------+----------+
8 rows in set (0.06 sec)


патч применен в понедельник, 30 января 2017 г. 21:21:03 (MSK)


стерся прогноз понедельник, 30 января 2017 г. 22:05:11 (MSK)


HostID

ExperimentBits
inet6_ntoa(ClientIP6) as ClientIP6

bstat50
bstat72


 !!! PRODUCTION !!! root@bsdb02g.yandex.ru [yabsdb]> select * from  PropertyDisplay where KeywordID=395\G
*************************** 1. row ***************************
    PropertyDisplayID: 127
            KeywordID: 395
          OperationID: 4
PropertyConvertTypeID: 1
PropertySnippetTypeID: 0
      PropertyGroupID: 0
             Position: 1741
              Snippet: NULL
          Description: Установлено приложение (395)
             Negation: 0
                 Tied: 0
            HasWeight: 0
*************************** 2. row ***************************
    PropertyDisplayID: 128
            KeywordID: 395
          OperationID: 5
PropertyConvertTypeID: 1
PropertySnippetTypeID: 0
      PropertyGroupID: 0
             Position: 1751
              Snippet: NULL
          Description: Установлено приложение (395) НЕ
             Negation: 1
                 Tied: 0
            HasWeight: 0
2 rows in set (0.00 sec)

 !!! PRODUCTION !!! root@bsdb02g.yandex.ru [yabsdb]> desc ContextProperty;
+----------------------------+--------------+------+-----+---------+----------------+
| Field                      | Type         | Null | Key | Default | Extra          |
+----------------------------+--------------+------+-----+---------+----------------+
| ContextPropertyID          | bigint(20)   | NO   | PRI | NULL    | auto_increment |
| PlaceID                    | bigint(20)   | NO   |     | 0       |                |
| KeywordID                  | bigint(20)   | NO   |     | 0       |                |
| OperationID                | bigint(20)   | NO   |     | 0       |                |
| ValueType                  | tinyint(4)   | NO   | MUL | 1       |                |
| ContextPropertyEditable    | tinyint(4)   | NO   |     | 1       |                |
| ContextPropertyMultiPart   | tinyint(4)   | NO   |     | 0       |                |
| ContextPropertyAll         | tinyint(4)   | NO   |     | 0       |                |
| ContextPropertyRequired    | tinyint(4)   | NO   |     | 1       |                |
| ContextPropertyHidden      | tinyint(4)   | NO   |     | 0       |                |
| ContextPropertyInherit     | tinyint(4)   | NO   |     | 1       |                |
| ContextPropertyNullable    | tinyint(4)   | NO   |     | 0       |                |
| ContextPropertyDescription | varchar(255) | YES  |     | NULL    |                |
| ContextPropertyDefault     | varchar(255) | YES  |     | NULL    |                |
+----------------------------+--------------+------+-----+---------+----------------+
14 rows in set (0.01 sec)

 !!! PRODUCTION !!! root@bsdb02g.yandex.ru [yabsdb]> desc PropertyConvertType;
+-----------------------+--------------+------+-----+---------+----------------+
| Field                 | Type         | Null | Key | Default | Extra          |
+-----------------------+--------------+------+-----+---------+----------------+
| PropertyConvertTypeID | int(11)      | NO   | PRI | NULL    | auto_increment |
| Name                  | varchar(255) | YES  |     | NULL    |                |
| Nature                | varchar(255) | YES  |     | NULL    |                |
| Description           | varchar(255) | YES  |     | NULL    |                |
+-----------------------+--------------+------+-----+---------+----------------+
4 rows in set (0.00 sec)

 !!! PRODUCTION !!! root@bsdb02g.yandex.ru [yabsdb]> select * from PropertyConvertType;
+-----------------------+-----------------+------------------+--------------------------------------------------------+
| PropertyConvertTypeID | Name            | Nature           | Description                                            |
+-----------------------+-----------------+------------------+--------------------------------------------------------+
|                     1 | asis            | NULL             | без изменений                                          |
|                     2 | external        | NULL             | внешний источник данных                                |
|                     3 | assign          | NULL             | как признак                                            |
|                     4 | regexp          | NULL             | регулярное выражения                                   |
|                     5 | wYYYYMMDDHHmmSS | NULL             | регулярное выражения времени                           |
|                     6 | unixdaysec      | NULL             | секунды с начала дня в unixtime                        |
|                     7 | unixtime        | NULL             | время в unixtime                                       |
|                     8 | ipaddr          | NULL             | IP адрес                                               |
|                     9 | schedule        | NULL             | расписание                                             |
|                    10 | external        | regionname       | внешний: регионы                                       |
|                    11 | external        | networkname      | внешний: оператор связи                                |
|                    12 | asis            | innergoalcontext | внешний: InnerGoalContext, но отображаем без изменений |
|                    13 | expression      | NULL             | выражения                                              |
|                    14 | expression      | innergoalcontext | выражения: для таблицы InnerGoalContext                |
|                    15 | external        | browsername      | внешний: uatraits Browser Name                         |
|                    16 | external        | browserengine    | внешний: uatraits Browser Engine                       |
|                    17 | external        | browserbase      | внешний: uatraits Browser Base                         |
|                    18 | external        | browsershell     | внешний: uatraits Browser Shell                        |
|                    19 | external        | osfamily         | внешний: uatraits OS Family                            |
|                    20 | external        | devicevendor     | внешний: uatraits Device Vendor                        |
|                    21 | osversion       | NULL             | версия ОС                                              |
|                    22 | external        | distrib_product  | Установленный софт (десктоп)                           |
+-----------------------+-----------------+------------------+--------------------------------------------------------+
22 rows in set (0.00 sec)


1) редактируем список шардов URL: svn+ssh://arcadia.yandex.ru/arc/trunk/arcadia/yabs/admin/yabs-zoo-lock-config/config/zoo_lock_config.json

2) собираем пакет yabs-zoo-lock-config

3)
olegts@bsdist01i:~$ sudo dmove -yp stable yabs-zoo-lock-config 000.48 unstable
Processing. Please await...

Moving yabs-zoo-lock-config_000.48_all.deb to /repo/yabs-precise/stable//all
Moving yabs-zoo-lock-config_000.48.dsc to /repo/yabs-precise/stable//source
Moving yabs-zoo-lock-config_000.48.tar.gz to /repo/yabs-precise/stable//source
Moving yabs-zoo-lock-config_000.48_amd64.changes to /repo/yabs-precise/stable//

SUCCEED: Mini-dinstall will automatically reindex repositories in some seconds

4) запуск сборки слоя https://sandbox.yandex-team.ru/task/87718797/view
5) нажать release

6) заново редактируем список шардов остальных
7) URL: svn+ssh://arcadia.yandex.ru/robots/trunk/genconf/PORTOVM заходим сюда

8) коммитим версию в yabs_autobudget_yabs-autobudget2.sh

9) заходим в таску https://sandbox.yandex-team.ru/task/87722245/view

10) Сервисы в няне
https://nanny.yandex-team.ru/ui/#/services/catalog/production_yabs_autobudget_msk/
https://nanny.yandex-team.ru/ui/#/services/catalog/production_yabs_autobudget_sas/
https://nanny.yandex-team.ru/ui/#/services/catalog/production_yabs_autobudget_man/

11)

что проверить


geo-model
product-service
device
output_stream_resource.py
rightholder_resource.py


 test_input_stream_uploader[upload_new_videos]


2702226
2701253
2701561


ft/device_fixture.py
ft/output_stream_fixture.py
ft/product_service_fixture.py
ft/rightholder_fixture.py

Got models to use : simple, default: simple
 Got models to use : simple, default: simple


798  10693

-rw-------   1 yabs yabs 27001133 Feb  3 04:19 service_105_1486084082.86.log
rw-------   1 yabs yabs 27322425 Feb  3 04:38 service_105_1486085282.7.log
-rw-------   1 yabs yabs 27272877 Feb  3 04:59 service_105_1486086482.6.log
20192

-rw-------   1 yabs yabs 23149301 Feb  4 03:19 service_105_1486166882.58.log
-rw-------   1 yabs yabs 19375104 Feb  4 04:06 service_105_1486169282.42.log
-rw-------   1 yabs yabs 10659090 Feb  4 04:46 service_105_1486171682.39.log
-rw-------   1 yabs yabs 23215224 Feb  4 05:03 service_105_1486172882.94.log
-rw-------   1 yabs yabs 23268568 Feb  4 05:37 service_105_1486175282.67.log
-rw-------   1 yabs yabs 23382481 Feb  4 05:57 service_105_1486176482.65.log
https://bs-mg.yandex-team.ru/render/?target=one_min.bstat105*.logcount_Rotate*.count&noCache=True&from=1486155600&until=1486188000
https://bs-mg.yandex-team.ru/render/?target=one_min.bstat105*.slavestat_yabs.behind_master&noCache=True&from=1486155600&until=1486188000



{"spec"={"sort_job_io"={"control_attributes"={"enable_key_switch"=%true}};"output_table_paths"=["//upqie4fR7Q/tmp/ABGroupExportPhraseStatDay"];"reduce_job_io"={"control_attributes"={"enable_key_switch"=%true}};"title"="GroupExportPhraseVisit.MR";"sort_by"=["OrderID";"GroupExportID";"PhraseID";"ContextType";"Experiment";"UpdateTime"];"reduce_by"=["OrderID";"GroupExportID";"PhraseID";"ContextType";"Experiment";"UpdateTime"];"started_by"={"user"="olegts";"hostname"="olegts.haze.yandex.net";"wrapper_version"="YT C++ native r2415724";"command"=["/home/olegts/.ya/build/build_root/3477756b316279753761653833346f6a/yabs/sbyt/ytstatcollector/autobudget/18_5/autobudget";"run";"GroupExportPhraseVisit";"--input";"//upqie4fR7Q/input";"--invocation-id";"8329415578396859470";"--proxy";"localhost:18945";"--yt-dest-path";"//upqie4fR7Q";"--yt-dict-path";"//upqie4fR7Q";"--yt-tmp-path";"//upqie4fR7Q/tmp"];"pid"=17730};"mapper"={"class_name"="NCollectVisit::TMapper";"file_paths"=[<"file_name"="jobstate">"//tmp/yt_wrapper/file_storage/hash/c6/77a6c4170d5032fdc71e8ba0ff5248c6"];"output_format"=<"format"="binary">"yson";"input_format"=<"format"="binary">"yson";"environment"={"YABS_YT_DRIVER_PATH"="/home/olegts/.ya/build/build_root/3477756b316279753761653833346f6a/yabs/sbyt/ytstatcollector/autobudget/tests/test-results/yabs-sbyt-ytstatcollector-autobudget-tests_modulo0/testing_out_stuff/yt_wd/3d809a3f-055d-442b-8b91-506aa6d65eb3/console_driver_config.yson"};"command"="/home/olegts/.ya/build/build_root/3477756b316279753761653833346f6a/yabs/sbyt/ytstatcollector/autobudget/18_5/autobudget --yt-map \"NCollectVisit::TMapper\" 1 1"};"map_job_io"={"control_attributes"={"enable_row_index"=%true}};"reducer"={"class_name"="TReducer";"file_paths"=[];"output_format"=<"format"="binary">"yson";"input_format"=<"format"="binary">"yson";"command"="/home/olegts/.ya/build/build_root/3477756b316279753761653833346f6a/yabs/sbyt/ytstatcollector/autobudget/18_5/autobudget --yt-reduce \"TReducer\" 1 0"};"input_table_paths"=[<"columns"=["OrderID";"GoalReaches";"AttributionType";"ContextType";"PhraseID";"TargetPhraseID";"GroupExportID";"OptionsAbExp";"Type";"EventTime"]>"//upqie4fR7Q/input"]}}


E   Expected data contain more records:Go
E     {'OrderID': 3, 'CostCur': -2, 'PhraseID': 5, 'Cost': -2, 'Clicks': 0, 'Shows': 0}
E   Actual data contain more records:
E     {'OrderID': 3, 'CostCur': -1, 'PhraseID': 5, 'Cost': -1, 'Clicks': 0, 'Shows': 0}
E     {'OrderID': 3, 'CostCur': -2, 'PhraseID': 5, 'Cost': -2, 'Clicks': -1, 'Shows': 0}
Last Changed Rev: 2705181:q
:w

12800878 83
12800879 59



GoalID = 79167 url: содержит «/basket/complete»

4024049834
https://metrika.yandex.ru/stat/sources?id=214245&ulogin=e96-ru&filter_id=1000196100&filter=(ym%3Apv%3AURL%3D*%27http%3A%2F%2Fopenbank.e96.ru%2F%27)
https://metrika.yandex.ru/stat/sources?id=214245&ulogin=e96-ru&filter_id=1000008410&filter=(ym%3As%3AlastUTMCampaign%3D*%27yandex-market-omsk%27)

 !!! PRODUCTION !!! root@bsdb02f.yandex.ru [yabsdb]> select * from InterfaceTagToObj where ObjTypeID = 4 and ObjID in (3187237743,3187237777,3187237781,3187237787,3187237788,3187237797,3187237798,3187237802,3187237803,3344597880,3344605831,3344611921,3344614851);
+------------+----------------+-----------+--------+------------+---------------------+--------+
| TagToObjID | InterfaceTagID | ObjTypeID | BaseNo | ObjID      | CreateTime          | UserID |
+------------+----------------+-----------+--------+------------+---------------------+--------+
|      98437 |            123 |         4 |   NULL | 3187237803 | 2016-12-21 17:09:36 |  15078 |
|      98438 |            123 |         4 |   NULL | 3187237797 | 2016-12-21 17:09:36 |  15078 |
|      98439 |            123 |         4 |   NULL | 3187237787 | 2016-12-21 17:09:36 |  15078 |
|      98440 |            123 |         4 |   NULL | 3187237798 | 2016-12-21 17:09:36 |  15078 |
|      98441 |            123 |         4 |   NULL | 3187237788 | 2016-12-21 17:09:36 |  15078 |
|      98442 |            123 |         4 |   NULL | 3187237802 | 2016-12-21 17:09:36 |  15078 |
|      98443 |            123 |         4 |   NULL | 3187237781 | 2016-12-21 17:09:36 |  15078 |
|      98444 |            123 |         4 |   NULL | 3187237777 | 2016-12-21 17:09:36 |  15078 |
|      98445 |            123 |         4 |   NULL | 3187237743 | 2016-12-21 17:09:36 |  15078 |
|     115828 |            123 |         4 |   NULL | 3344597880 | 2017-01-19 12:45:51 |  15078 |
|     115829 |            123 |         4 |   NULL | 3344605831 | 2017-01-19 12:46:56 |  15078 |
|     115830 |            123 |         4 |   NULL | 3344611921 | 2017-01-19 12:47:51 |  15078 |
|     115831 |            123 |         4 |   NULL | 3344614851 | 2017-01-19 12:48:29 |  15078 |
+------------+----------------+-----------+--------+------------+---------------------+--------+
13 rows in set (0.02 sec)

 !!! PRODUCTION !!! root@bsdb02f.yandex.ru [yabsdb]> select * from InterfaceTag where InterfaceTagID=123;
+----------------+----------------+--------------------+---------------------+--------+--------------+--------+
| InterfaceTagID | Name           | NameMd5            | CreateTime          | UserID | Options      | Weight |
+----------------+----------------+--------------------+---------------------+--------+--------------+--------+
|            123 | super:launcher | 322905178524535677 | 2016-12-21 17:09:12 |  15078 | match-filter |  20000 |
+----------------+----------------+--------------------+---------------------+--------+--------------+--------+
1 row in set (0.00 sec)

 !!! PRODUCTION !!! root@bsdb02f.yandex.ru [yabsdb]> select Weight/1e6 from InterfaceTag where InterfaceTagID=123;
+------------+
| Weight/1e6 |
+------------+
|       0.02 |
+------------+
1 row in set (0.01 sec)



Mon Feb  6 19:55:43 MSK 2017 abmedia-conv-online-formula-noise-places:q


 !!! PRODUCTION !!! root@bsdb02f.yandex.ru [yabsdb]> select InterfaceTagID ,count(*) from InterfaceTagToObj inner join Banner148 on InterfaceTagToObj.ObjID = Banner148.BannerID and InterfaceTagToObj.ObjTypeID = 4 where Banner148.OrderID = 9021913 group by 1;
+----------------+----------+
| InterfaceTagID | count(*) |
+----------------+----------+
|             92 |     5754 |
|             95 |      156 |
|             97 |      228 |
|            102 |       58 |
|            109 |      148 |
+----------------+----------+
5 rows in set (0.81 sec)


 !!! PRODUCTION !!! root@bsdb02f.yandex.ru [yabsdb]> select InterfaceTagID ,count(*) from InterfaceTagToObj inner join Banner148 on InterfaceTagToObj.ObjID = Banner148.BannerID and InterfaceTagToObj.ObjTypeID = 4 where Banner148.OrderID = 12699425 group by 1;
+----------------+----------+
| InterfaceTagID | count(*) |
+----------------+----------+
|            102 |       57 |
+----------------+----------+
1 row in set (0.41 sec)

 !!! PRODUCTION !!! root@bsdb02f.yandex.ru [yabsdb]> select InterfaceTagID ,count(*) from InterfaceTagToObj inner join Banner148 on InterfaceTagToObj.ObjID = Banner148.BannerID and InterfaceTagToObj.ObjTypeID = 4 where Banner148.OrderID = 13379375 group by 1;
+----------------+----------+
| InterfaceTagID | count(*) |
+----------------+----------+
|             92 |     7012 |
+----------------+----------+
1 row in set (0.47 sec)


 !!! PRODUCTION !!! root@bsdb02f.yandex.ru [yabsdb]> select * from InterfaceTag where InterfaceTagID in (92,102);
+----------------+------------------+----------------------+---------------------+--------+--------------+---------+
| InterfaceTagID | Name             | NameMd5              | CreateTime          | UserID | Options      | Weight  |
+----------------+------------------+----------------------+---------------------+--------+--------------+---------+
|             92 | super:browser    | 12689744963128082092 | 2016-03-15 13:53:24 |  14081 | match-filter | 1500000 |
|            102 | super:searchline | 13233935837738835232 | 2016-03-15 15:15:15 |  14081 | match-filter |  150000 |
+----------------+------------------+----------------------+---------------------+--------+--------------+---------+
2 rows in set (0.00 sec)


 !!! PRODUCTION !!! root@bsdb02f.yandex.ru [yabsdb]> select BannerPriority, count(*) from Banner148 where OrderID = 13379375 group by 1;
+----------------+----------+
| BannerPriority | count(*) |
+----------------+----------+
|         -40766 |     6609 |
+----------------+----------+
1 row in set (0.01 sec)

 !!! PRODUCTION !!! root@bsdb02f.yandex.ru [yabsdb]> select BannerPriority, count(*) from Banner148 where OrderID = 12699425 group by 1;
+----------------+----------+
| BannerPriority | count(*) |
+----------------+----------+
|          -4076 |       54 |
+----------------+----------+
1 row in set (0.00 sec)


https://olegts.haze.yandex.net/cgi-bin/autobudget-check-deploy.cgi?cur_start=2017%2F02%2F05+07%3A00%3A00&cur_finish=2017%2F02%2F06+07%3A00%3A00&prev_start=2017%2F01%2F29+07%3A00%3A00&prev_finish=2017%2F01%2F30+07%3A00%3A00&BaseNo=70%2C71%2C72%2C73%2C74%2C75%2C76%2C77%2C78%2C79#[0,1,1,1,1,0,1,1,1,1]
https://bsint2.yandex-team.ru/cgi-bin/autobudget-check-deploy.cgi?cur_start=2017%2F02%2F06+11%3A00%3A00&cur_finish=2017%2F02%2F07+07%3A00%3A00&prev_start=2017%2F01%2F30+11%3A00%3A00&prev_finish=2017%2F01%2F31+07%3A00%3A00&BaseNo=70%2C71%2C72%2C73%2C74%2C75%2C76%2C77%2C78%2C79


2017-02-07 14:13:27,813 W       Concurrency     Delayed executor stall detected (Delta: 110)    84c9f1cfaf77d5cd
2017/02/07 14:14:25 476196 WARN  [  with_timeout] Interrupted by timeout at /usr/share/perl5/Yabs/Timeout.pm line 132, <$handle> line 529.      (Yabs::Timeout @/usr/share/perl5/Yabs/Timeout.pm:132)
i


2017/02/07 14:11:36 476798 INFO  [autobudget_mai] Order 7449124 money total_to_spent= 25.1345 c, spent_plan = 7.0398 c, context_limit = 70, broad=5, ab_problems = 30
2017/02/07 14:11:36 476798 INFO  [autobudget_mai] Order 7449124 clicks total_to_spent = 0.0000, spent_plan = 0.2076
2017/02/07 14:11:36 476798 INFO  [calc_flat_bids] Calculate net bids for order 7449124
2017/02/07 14:12:20 476798 INFO  [calc_flat_bids] Order 7449124, total clicks capacity: 0.10
2017/02/07 14:12:20 476798 INFO  [calc_flat_bids] Order 7449124 net limits: eis 0.1759$, eic 0.0000, eir -0.0300$
2017/02/07 14:13:09 476798 INFO  [calc_flat_bids] Order 7449124, net_plan_money: 0.00$, net_plan_clicks: 0.06
2017/02/07 14:13:10 476798 INFO  [calc_flat_prob] Calculate net probability for order 7449124
2017/02/07 14:13:17 476798 INFO  [calc_flat_prob] Order 7449124, total clicks capacity: 0.00000
2017/02/07 14:13:17 476798 INFO  [calc_flat_prob] Order 7449124 nothing to spent in net
2017-02-07 14:13:27,813 W       Concurrency     Delayed executor stall detected (Delta: 110)    84c9f1cfaf77d5cd
2017/02/07 14:14:25 476196 WARN  [  with_timeout] Interrupted by timeout at /usr/share/perl5/Yabs/Timeout.pm line 132, <$handle> line 529.      (Yabs::Timeout @/usr/share/perl5/Yabs/Timeout.pm:132)
2017/02/07 14:14:25 476196 WARN  [  with_timeout] Interrupted by timeout at /usr/share/perl5/Yabs/Timeout.pm line 132, <$handle> line 529.      (Yabs::Timeout @/usr/share/perl5/Yabs/Timeout.pm:132)
2017/02/07 14:14:25 476196 ERROR [   master_work] Generate result with_timeout failed for action 123279, subaction 2, task AutoBudget13 (DProcess::DProcess @/usr/share/perl5/DProcess/DProcess.pm:766)
2017/02/07 14:14:25 476196 ERROR [   master_work] Generate result with_timeout failed for action 123279, subaction 2, task AutoBudget13 (DProcess::DProcess @/usr/share/perl5/DProcess/DProcess.pm:766)


2017-02-07 14:30:52,579 W       Concurrency     Delayed executor stall detected (Delta: 180)    e56ac0cc3544aa02
2017/02/07 14:32:17 604500 INFO  [optimize_with_] AutoBudget order 7449124 (total pr_ph=237161, have costs=162177)
2017-02-07 14:33:14,771 W       Concurrency     Delayed executor stall detected (Delta: 146)    e56ac0cc3544aa02
2017/02/07 14:34:09 604500 INFO  [autobudget_mai] Order 7449124 money total_to_spent= 25.8743 c, spent_plan = 7.2112 c, context_limit = 70, broad=5, ab_problems = 30
2017/02/07 14:34:09 604500 INFO  [autobudget_mai] Order 7449124 clicks total_to_spent = 0.0000, spent_plan = 0.2127
2017/02/07 14:34:09 604500 INFO  [calc_flat_bids] Calculate net bids for order 7449124
2017/02/07 14:34:27 603242 WARN  [  with_timeout] Interrupted by timeout at /usr/share/perl5/Yabs/Timeout.pm line 132.  (Yabs::Timeout @/usr/share/perl5/Yabs/Timeout.pm:132)
2017/02/07 14:34:27 603242 WARN  [  with_timeout] Interrupted by timeout at /usr/share/perl5/Yabs/Timeout.pm line 132.  (Yabs::Timeout @/usr/share/perl5/Yabs/Timeout.pm:132)
2017/02/07 14:34:27 603242 ERROR [   master_work] Generate result with_timeout failed for action 123279, subaction 3, task AutoBudget13 (DProcess::DProcess @/usr/share/perl5/DProcess/DProcess.pm:766)
2017/02/07 14:34:27 603242 ERROR [   master_work] Generate result with_timeout failed for action 123279, subaction 3, task AutoBudget13 (DProcess::DProcess @/usr/share/perl5/DProcess/DProcess.pm:766)
2017/02/07 14:34:27 603242 ERROR [       do_work] master_work failed()  (DProcess::DProcess @/usr/share/perl5/DProcess/DProcess.pm:801)
2017/02/07 14:34:27 603242 ERROR [       do_work] master_work failed()  (DProcess::DProcess @/usr/share/perl5/DProcess/DProcess.pm:801)
2017/02/07 14:34:27 603242 ERROR [        main::] do_work failed        (main @/home/yabs/stat/autobudget.pl:466)
2017/02/07 14:34:27 603242 ERROR [        main::] do_work failed        (main @/home/yabs/stat/autobudget.pl:466)
Waiting for data... (interrupt to abort)



mysql> select orderid,resultcost/1e6 from PhrasePrice where BannerID = 1638744673 and PhraseID = 152861386;
+---------+----------------+
| orderid | resultcost/1e6 |
+---------+----------------+
| 9076069 |           0.31 |
+---------+----------------+
1 row in set (0.00 sec)

d



[pid=9311->9585]  DB<6> x grep {$_->[4] =~ /1638744673,152861386/} @$slopes
0  ARRAY(0x185c2df0)
   0  0.066551
   1  0.066551
   2  0
   3  0
   4  '1638744673,152861386,1;9076069'
1  ARRAY(0x185c2f28)
   0  0.250234
   1  0.250234
   2  1
   3  0
   4  '1638744673,152861386,1;9076069'
2  ARRAY(0x185c3060)
   0  0.356889
   1  0.356889
   2  2
   3  0
   4  '1638744673,152861386,1;9076069'
3  ARRAY(0x185c3198)
   0  0.463543
   1  0.463543
   2  3
   3  0
   4  '1638744673,152861386,1;9076069'
4  ARRAY(0x185c32d0)
   0  0.570198
   1  0.570198
   2  4
   3  0
   4  '1638744673,152861386,1;9076069'
5  ARRAY(0x185c3408)
   0  0.676853
   1  0.676853
   2  5
   3  0
   4  '1638744673,152861386,1;9076069'
6  ARRAY(0x185c40e8)
   0  0.783507
   1  0.783507
   2  6
   3  0
   4  '1638744673,152861386,1;9076069'
7  ARRAY(0x185c4220)
   0  0.890162
   1  0.890162
   2  7
   3  0
   4  '1638744673,152861386,1;9076069'
8  ARRAY(0x185c4358)
   0  0.996817
   1  0.996817
   2  8
   3  0
   4  '1638744673,152861386,1;9076069'
9  ARRAY(0x185c4490)
   0  1.054679
   1  1.054679
   2  9
   3  1
   4  '1638744673,152861386,1;9076069'
10  ARRAY(0x185c45c8)
   0  1.284171
   1  1.284171
   2  10
   3  1
   4  '1638744673,152861386,1;9076069'
11  ARRAY(0x185c4700)
   0  2.189749
   1  2.189749
   2  11
   3  2
   4  '1638744673,152861386,1;9076069'
12  ARRAY(0x185c4838)
   0  3.305563
   1  3.305563
   2  12
   3  3
   4  '1638744673,152861386,1;9076069'
13  ARRAY(0x185c4970)
   0  10.957023
   1  10.957023
   2  13
   3  10
   4  '1638744673,152861386,1;9076069'
14  ARRAY(0x185c4aa8)
   0  16.562843
   1  16.562843
   2  14
   3  16
   4  '1638744673,152861386,1;9076069'

[pid=9311->9585]  DB<12> p $sl->[3]
3


orderid =  7608101


ABVWForecasterAPC AutoBudgetForecasterAPC AutoBudgetForecasterCTR ABVWForecasterPPC AutoBudgetForecasterCTRMedia

2017/02/08 09:44:22 31351 INFO  [  rename_table] Done ABVWForecasterAPC -> ABVWForecasterAPC_129_20170208
2017/02/08 09:44:22 31351 INFO  [  rename_table] Done AutoBudgetForecasterAPC -> AutoBudgetForecasterAPC_129_20170208
2017/02/08 09:44:22 31351 INFO  [  rename_table] Done AutoBudgetForecasterCTR -> AutoBudgetForecasterCTR_129_20170208
2017/02/08 09:44:22 31351 INFO  [  rename_table] Done ABVWForecasterPPC -> ABVWForecasterPPC_129_20170208
2017/02/08 09:44:22 31351 INFO  [  rename_table] Done AutoBudgetForecasterCTRMedia -> AutoBudgetForecasterCTRMedia_129_20170208

2017/02/08 09:44:36 31351 INFO  [  rename_table] Done ABVWForecasterAPC -> ABVWForecasterAPC_129_20170207
2017/02/08 09:44:36 31351 INFO  [  rename_table] Done AutoBudgetForecasterAPC -> AutoBudgetForecasterAPC_129_20170207
2017/02/08 09:44:36 31351 INFO  [  rename_table] Done AutoBudgetForecasterCTR -> AutoBudgetForecasterCTR_129_20170207
2017/02/08 09:44:36 31351 INFO  [  rename_table] Done ABVWForecasterPPC -> ABVWForecasterPPC_129_20170207
2017/02/08 09:44:36 31351 INFO  [  rename_table] Done AutoBudgetForecasterCTRMedia -> AutoBudgetForecasterCTRMedia_129_20170207

bannerid=1569211594 and phraseID = 130946066

06
┌───BannerID─┬───PhraseID─┬─ContextType─┬─Clicks─┬───────────────Cost─┐
│ 1164819706 │ 1113248309 │           1 │    763 │ 23.340000000000128 │
│ 1569211597 │ 1113248320 │           1 │    593 │ 19.990000000000062 │
│ 1569211594 │  130946066 │           1 │    416 │ 13.299999999999935 │
│ 1569211595 │  130946066 │           1 │    413 │ 13.589999999999932 │
│ 1569211596 │ 1113248320 │           1 │    278 │  9.939999999999964 │
│ 1569211594 │  845044662 │           1 │    244 │   7.56000000000001 │
│ 1164819706 │ 1113248320 │           1 │    240 │  8.839999999999982 │
│ 1569211594 │  132206984 │           1 │    236 │  8.040000000000008 │
│ 1164819704 │  130946066 │           1 │    146 │  4.449999999999995 │
│ 1569211595 │  132206984 │           1 │    143 │ 4.3399999999999945 │
└────────────┴────────────┴─────────────┴────────┴────────────────────┘
07
┌───BannerID─┬───PhraseID─┬─ContextType─┬─Clicks─┬───────────────Cost─┐
│ 1569211594 │          1 │           3 │     51 │ 2.2300000000000004 │
│ 1569211594 │  845044662 │           1 │     45 │ 1.4100000000000006 │
│ 1569211594 │  130946066 │           1 │     34 │ 1.1200000000000003 │
│ 1569211595 │  132206984 │           1 │     27 │ 0.8200000000000001 │
│ 1569211595 │  845044662 │           1 │     26 │ 0.9300000000000002 │
│ 1569211595 │          1 │           3 │     25 │ 2.4200000000000004 │
│ 1569211594 │  132206984 │           1 │     24 │ 0.7300000000000003 │
│ 1569211596 │ 1113248320 │           1 │     22 │               0.59 │
│ 1164819706 │ 1113248320 │           1 │     20 │               0.44 │
│ 1164819704 │  130946066 │           1 │     18 │ 0.6100000000000002 │
└────────────┴────────────┴─────────────┴────────┴────────────────────┘


r058-alter-PerformanceDSPPageStat.pl
r2462047


:) select * from SerpTagHitsCountry limit 10;

SELECT *
FROM SerpTagHitsCountry
LIMIT 10

┌──EventDate─┬──────────UpdateTime─┬─PageID─┬─TagID─┬─PlaceID─┬─DeviceType─┬─CountryRegionID─┬──────────BrowserName─┬─Clid─┬─VendorID─┬─HitsCount─┐
│ 2016-10-20 │ 2016-10-20 13:00:00 │    184 │     0 │       0 │          3 │               0 │  9998278561774023877 │    0 │       -1 │         2 │
│ 2016-10-20 │ 2016-10-20 13:00:00 │    184 │     0 │       0 │          3 │               0 │ 10255085975453141110 │    0 │       -1 │         1 │
│ 2016-10-20 │ 2016-10-20 13:00:00 │    184 │     0 │       0 │          3 │               0 │ 12593298750978155300 │    0 │       -1 │         1 │
│ 2016-10-20 │ 2016-10-20 13:00:00 │    184 │     0 │       0 │          3 │               0 │ 15736523298221610511 │    0 │       -1 │         8 │
│ 2016-10-20 │ 2016-10-20 13:00:00 │    184 │     0 │       0 │          3 │               1 │  3972595548998913786 │    0 │       -1 │         4 │
│ 2016-10-20 │ 2016-10-20 13:00:00 │    184 │     0 │       0 │          3 │               1 │  4176753272509253579 │    0 │       -1 │         1 │
│ 2016-10-20 │ 2016-10-20 13:00:00 │    184 │     0 │       0 │          3 │               1 │  4738512312088211624 │    0 │       -1 │         9 │
│ 2016-10-20 │ 2016-10-20 13:00:00 │    184 │     0 │       0 │          3 │               1 │  9900974266853911005 │    0 │       -1 │         2 │
│ 2016-10-20 │ 2016-10-20 13:00:00 │    184 │     0 │       0 │          3 │               1 │  9998278561774023877 │    0 │       -1 │        15 │
│ 2016-10-20 │ 2016-10-20 13:00:00 │    184 │     0 │       0 │          3 │               1 │ 12593298750978155300 │    0 │       -1 │        92 │
└────────────┴─────────────────────┴────────┴───────┴─────────┴────────────┴─────────────────┴──────────────────────┴──────┴──────────┴───────────┘

10 rows in set. Elapsed: 0.005 sec. Processed 8.19 thousand rows, 409.60 KB (1.53 million rows/s., 76.68 MB/s.)



Пт. февр. 10 11:50:21 MSK 2017

Пт. февр. 10 11:50:22 MSK 2017
1


common/repository/init.sls

/etc/apt/sources.list.d/{{ name }}.list:
 file.managed:
 - source: salt://{{ slspath }}/repo.list
 - template: jinja
 - context:
    repo: {{ repo.get('name', name) }}
    server: {{ repo['server'] }}
    branch: {{ repo['branch']|yaml }}
 - require_in:
   - file: /etc/apt/sources.list.d


olegts@olegts:~/git/saltstages$ cat common/repository/repo.list
{% for name, arches in branch|dictsort %}
 {% for arch in arches %}
deb http://{{ server }}/{{ repo }} {{ name }}/{{ arch }}/
 {% endfor %}
{% endfor %}

pillar/common/init.sls
- repository.search-kernel


pillar/repository/search-kernel.sls

repository:
2	 search-kernel:
3	  server: dist.yandex.ru
4	  gpgkey: yandex-archive-keyring
5	  pinning: search-kernel
6	  branch:
7	   stable:
8	   - all
9	   - {{ grains['osarch'] }}
10	   prestable:
11	   - all
12	   - {{ grains['osarch'] }}


==========================================

pillar/repository/saltstack-external.sls

1	repository:
2	 saltstack-external:
3	  server: dist.yandex.ru
4	  gpgkey: yandex-archive-keyring
5	  branch:
6	   {{ grains['oscodename'] }}:
7	    - amd64


pillar/common/init.sls

#- repository.saltstack-external

Пн. февр. 13 08:40:35 MSK 2017
1
Пн. февр. 13 08:40:37 MSK 2017
0

Пн. февр. 13 12:55:10 MSK 2017
93830,49688,92550,127716,117822,69119,132258,185193,188232,142867,64581,126873,75301,10175,12966,184964,145653,187988,86962,189165,185548,135962,188181,85125,186411,117325

olegts@bspstat09i:/mnt/raid/home/olegts$ ps aux | grep alter
root      914565 14.4  0.0 324896 124388 pts/9   S+   21:34   0:02 /usr/bin/perl /usr/share/yabs-bspstat-collectors/postinstall-scripts/r071-alter-clickhouse-SerpTagHitsCountry.pl


yabs/server/test/qxl/raccoon/test
test_raccoon.py::test_metasearch[1-2]
test_raccoon.py::test_metasearch[2-2]

Расхождение поля BannerID в запросах
yabs/server/tools/mkdb_info/test
test_mkdb_info.py::test_canonical

yabs/server/test/qxl/fortuna/test
test_fortuna.py::test_metarank

yabs/server/test/qxl/fdrstrok/test
test_fdrstrok.py::test_metarank

yabs/server/test/qxl_chkdb
test_chkdb.py::test_chkdb[st]

yabs/server/cs/test
[timeout] test_cs.py::TestCS::test_cs_cycle[st002]

yabs/server/test/qxl/disaev/test
[timeout] test_disaev.py::test_metarank



autobudget-roi-mix-avg-formula
Вт. февр. 14 13:45:38 MSK 2017

Вт. февр. 14 13:45:40 MSK 2017
1


-----




496133 -- зависший процесс

olegts@bspstat09i:/mnt/raid/home/olegts$ sudo strace -p 496133
Process 496133 attached - interrupt to quit
write(1, "2017/02/15 10:54:55 496133 INFO "..., 64

r071-alte 496133 root    1w  FIFO                0,8      0t0 2341770919 pipe


olegts@bspstat09i:/mnt/raid/home/olegts$ sudo lsof | grep 2341770919
sudo       495107               root    1w     FIFO                0,8         0t0 2341770919 pipe
sudo       495108               root    0r     FIFO                0,8         0t0 2341770919 pipe
apt-get    495109               root    1w     FIFO                0,8         0t0 2341770919 pipe
tee        495110               root    0r     FIFO                0,8         0t0 2341770919 pipe
dpkg       496012               root    1w     FIFO                0,8         0t0 2341770919 pipe
yabs-bsps  496023               root    1w     FIFO                0,8         0t0 2341770919 pipe
r071-alte  496133               root    1w     FIFO                0,8         0t0 2341770919 pipe
 production environment


1)
iolegts@bspstat09i:/mnt/raid/home/olegts$ sudo strace -p 495108
Process 495108 attached - interrupt to quit
select(7, [4 6], [], NULL, NULL^C <unfinished ...>

sudo    495108 root    7w  FIFO                0,8      0t0 2341765101 pipe

olegts@bspstat09i:/mnt/raid/home/olegts$ sudo lsof |grep 2341765101
sudo       495108               root    6r     FIFO                0,8         0t0 2341765101 pipe
sudo       495108               root    7w     FIFO                0,8         0t0 2341765101 pipe

2)
olegts@bspstat09i:/mnt/raid/home/olegts$ sudo strace -p 495110
Process 495110 attached - interrupt to quit
write(1, "2017/02/15 10:40:29 496133 INFO "..., 66^C <unfinished ...>

tee     495110 root    1w  FIFO    0,8      0t0 2341775965 pipe

olegts@bspstat09i:/mnt/raid/home/olegts$ sudo lsof |grep 2341775965
sshd       495100 robot-bs-autoadmin   11r     FIFO                0,8         0t0 2341775965 pipe
sh         495101 robot-bs-autoadmin    1w     FIFO                0,8         0t0 2341775965 pipe
sudo       495108               root    1w     FIFO                0,8         0t0 2341775965 pipe
tee        495110               root    1w     FIFO                0,8         0t0 2341775965 pipe

olegts@bspstat09i:/mnt/raid/home/olegts$ sudo strace -p 495100
Process 495100 attached - interrupt to quit
select(14, [3 7], [], NULL, NULL

14 номера нет в lsof



GroupABShowsCorr

GroupABShowsCorrBuffer$num

Наверно, чтобы базгенерация больше не падала, она у нас все время падает когда значение поля null. Ну и в остальных всех таблицах БК всегда not null добавляется в деф, потому что мы наталкивались на странные ошибки (но на какие именно, вспомнить трудно), когда не было такого в дефе.
Чт. февр. 16 12:00:21 MSK 2017

Чт. февр. 16 12:00:22 MSK 2017
1
Чт. февр. 16 12:00:24 MSK 2017


bannerselect
PageSlotSequence
PlaceSelect -- алгоритм отбора BANNER_SELECT_DISTRIBUTION


banner_select_distribution priority.cpp
found[got].sort_param = yabs_sort_weight(*sort_params, found[got], weight_type_t::distribution);


static inline double yabs_sort_weight(yabs_formula_params const& params, yabs_banner_index const& banner, weight_type_t type) {
    return general_weight(params, get_weight_components(banner, type), /* greedy */ false);
}

general_weight autobroker.h
general_weight_function autobroker.h

пример использования json params
proto.GetPremiumPositions  premium_positions.cpp

https://a.yandex-team.ru/arc/trunk/arcadia/yabs/server/libs/server/auto_video_frequency.h?rev=2727574&blame=true#L78 -- тут пример хеша с сложным ключем, парсинга массива массивов в хеш
yabs/server/libs/server/handler_page.cpp:841: -- распарсить args->ctr_params снаружи двух циклов

Прокинуть InterfaceTag со статов

fill_banner_match -> структура match
libs/server/protocol/proto/banner_index.proto
libs/server/protocol/banner_index.cpp добавить dump_simple и LOAD_SIMPLE


test/ft/BSSERVER-1465/test_ctr_in_ps26.py


yabs_prepare_page

 4003 static i32 banner_select_distribution(yabs_args* args, yabs_banner_match_info* match, i32 total,
 4004                                       yabs_banner_index* found, i32 got, i32 need,
 4005                                       TSortParams const& sort_params, TSelectParams const& select_params, yabs_vcg_info& vcg_info) {


 4014         found[got].sort_param = yabs_sort_weight(args->weight_function, sort_params, found[got], weight_type_t::distribution);

 2300 static inline double yabs_sort_weight(const TWeightFunction<yabs_formula_params>& weight_function, yabs_formula_params const& params,
 2301                                       const yabs_banner_index& banner, weight_type_t type) {
 2302     return general_weight(weight_function, params, get_weight_components(banner, type), /* greedy */ false);
 2303 }


 63 template <typename params_t>
 64 static inline double general_weight(const TWeightFunction<params_t>& weight_function,
 65                                     params_t const& params, weight_components_t const& wcomps, bool greedy) {
 66     return weight_function(wcomps.cost, params, wcomps, greedy).GetOrElse(0);
 67 }


args.cpp
 weight_function = general_weight_function<yabs_formula_params>();




------- [PB] {FAILED} $(B)/yabs/server/libs/server/protocol/proto/stat_request.pb.{cc, h}
command /home/olegts/.ya/build/build_root/686475677238376b637630746a307539/contrib/tools/protoc/protoc -I=./ -I=/home/olegts/arc/trunk/arcadia/ -I=/home/olegts/.ya/build/build_root/686475677238376b637630746a307539 -I=/home/olegts/arc/trunk/arcadia/contrib/libs/protobuf --cpp_out=/home/olegts/.ya/build/build_root/686475677238376b637630746a307539/ --cpp_styleguide_out=/home/olegts/.ya/build/build_root/686475677238376b637630746a307539/ --plugin=protoc-gen-cpp_styleguide=/home/olegts/.ya/build/build_root/686475677238376b637630746a307539/contrib/tools/protoc/plugins/cpp_styleguide/cpp_styleguide yabs/server/libs/server/protocol/proto/stat_request.proto failed with exit code 1
yabs/server/libs/server/protocol/proto/args.proto:287:14: "yabs.proto.Profile.TRegularCoord" is not defined.
yabs/server/libs/server/protocol/proto/stat_request.proto: Import "yabs/server/libs/server/protocol/proto/args.proto" was not found or had errors.
yabs/server/libs/server/protocol/proto/stat_request.proto:7:14: "yabs_args" is not defined.
------- [PB] {FAILED} $(B)/yabs/server/libs/server/protocol/proto/args.pb.{cc, h}
command /home/olegts/.ya/build/build_root/643436376777666c377a777a64673176/contrib/tools/protoc/protoc -I=./ -I=/home/olegts/arc/trunk/arcadia/ -I=/home/olegts/.ya/build/build_root/643436376777666c377a777a64673176 -I=/home/olegts/arc/trunk/arcadia/contrib/libs/protobuf --cpp_out=/home/olegts/.ya/build/build_root/643436376777666c377a777a64673176/ --cpp_styleguide_out=/home/olegts/.ya/build/build_root/643436376777666c377a777a64673176/ --plugin=protoc-gen-cpp_styleguide=/home/olegts/.ya/build/build_root/643436376777666c377a777a64673176/contrib/tools/protoc/plugins/cpp_styleguide/cpp_styleguide yabs/server/libs/server/protocol/proto/args.proto failed with exit code 1
yabs/server/libs/server/protocol/proto/args.proto:287:14: "yabs.proto.Profile.TRegularCoord" is not defined.
[libprotobuf WARNING /home/olegts/arc/trunk/arcadia/contrib/libs/protobuf/descriptor.cc:5430] Warning: Unused import: "yabs/server/libs/server/protocol/proto/args.proto" imports "yabs/proto/user_profile.proto" which is not used.
Failed


Revision: 2729120




....
and
 " . (defined($some_option) ? "UpdateTime > noiw() - interval $some_option seconds" : "1")


ya make -tA test/ft/BSSERVER-1465/ --keep-temps

metasearch.req.log

600     2017-02-20 17:47:47.014 +0300   ::1:55821       200     49439   83
GET /count/4b5hsOspWzu40000gO10Zh4Pi8e5KPK1cm9kGoI80Oa3c4AT0QO1YWBS0hq1gWAb4zq1aR5pQRe7ZxNCEia2dxWLM3C6cGL2ZA2qn0IWeBJ41A-WjCG4sQ2qn0Idd0eIgB50MNC7hkn4W6kb_W2ViG6oe1000ldiH81hfVu0dxkme0eP1C7__________m_2-hFSEsLL8YO8ql__________3zF__________m_k0VNEeINbnqJssuLKYtMFL7eM?region=225&charset=utf8 HTTP/1.1
Accept-Encoding: identity
x-yabs-debug-token: 52ef808412345678
user-agent: MSIE 6.0
x-yabs-debug-options-json: {"keywords": true, "logs": true, "mx": true, "mx_zero_features": true}
host: yabs.yandex.ru
Cookie: yabs-exp-sid=52ef808412345678; yandexuid=1099999744
x-yabs-debug-output: json

metasearch port=48999



$30 = (const TSortParams &) @0x7fbc80835d30: {
  <TWeightParams> = {
    _vptr$TWeightParams = 0x59f2148 <vtable for TSortParams+16>,
    A = 0,
    B = 1,
    C = 0,
    D = 0,
    E = 0,
    F = 0,
    G = 0,
    H = 0,
    I = 0,
    J = 0,
    K = 0,
    L = 0,
    M = 0,
    N = 0,
    O = 0,
    P = 1,
    R = 0,
    S = 0,
    T = 0,
    U = 0,
    V = 0,
    W = 0,
    X = 0,
    IsInitialized = true,
    args = @0x7fbf80430030,
    ParamId = 2
  }, <No data fields>}
(gdb) p select_params
$31 = (const TSelectParams &) @0x7fbc80835e08: {
  <TWeightParams> = {
    _vptr$TWeightParams = 0x59e3380 <vtable for TSelectParams+16>,
    A = 0,
    B = 0,
    C = 0,
    D = 0,
    E = 0,
    F = 0,
    G = 0,
    H = 0,
    I = 0,
    J = 0,
    K = 0,
    L = 0,
    M = 0,
    N = 0,
    O = 0,
    P = 1,
    R = 0,
    S = 0,
    T = 0,
    U = 0,
    V = 0,
    W = 0,
    X = 0,
    IsInitialized = true,
    args = @0x7fbf80430030,
    ParamId = 3
  }, <No data fields>}


(gdb) p yabs_sort_weight(args->weight_function, sort_params, found[got], weight_type_t::distribution)
$3 = 0.85954442956409649


E   Info: Table formula: 7 rows; select (ParamID|0) as ParamID, FormulaID, MXID, LinearModelSetID, BaselineFactorID, LinearModelID, A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V, W, X, Y, Z, UserGroupSetID, MatrixID, BMCategoryRelevanceModelID, IFNULL(JsonParameters, '') from FormulaParameters
E   Error: Unable parse FormulaParameters from json: {"InterfaceTagParams": [{"BannerPrioritySubtrahend": 0, "SortSubtrahend": 1, "PlaceID": 933, "InterfaceTag": 11}]} (library/protobuf/json/json2proto.cpp:242: expected json map)

/home/olegts/.ya/build/build_root/6a77377a367671357766357466657869/yabs/server/tools/yt/mkdb/yt_mkdb --console --no-trace --outputs 0 --small-base --timestamp 1469700000 --save-file /home/olegts/.ya/build/build_root/6a77377a367671357766357466657869/yabs/server/test/qabs_bsserver_pytest/_bases/__tests__.test_ctr_in_ps26_with_value_restriction_0__9617a8ecc6cc131f8dcf0fcb32a8bc84.dbMmDpTp/formula.yabs --content-system-key 1 < /home/olegts/.ya/build/build_root/6a77377a367671357766357466657869/yabs/server/test/qabs_bsserver_pytest/_bases/__tests__.test_ctr_in_ps26_with_value_restriction_0__9617a8ecc6cc131f8dcf0fcb32a8bc84.dbMmDpTp/formula.yson


без использования констант
(gdb) p yabs_sort_weight(args->weight_function, sort_params, match[i].idx, weight_type_t::distribution)
$1 = 0.85954442956409649

с использованием BannerSubtrahend
(gdb) p  yabs_sort_weight(args->weight_function, sort_params, match[i].idx, weight_type_t::distribution)
$1 = -0.1288921269723529G
7


с использованием SortSubtrahend
-0.14045557043590351
 !!! PRODUCTION !!! root@bstat72i.yandex.ru [yabsdb]> select resultcost/1e6,count(*) from (select bannerid,phraseid,contexttype,resultcost from PhrasePrice where OrderID = 9076069 and !find_in_set('deleted', Options)) PP inner join (select BannerID from Banner72 where OrderID = 9076069 and ContextPriority > 0 and !find_in_set('deleted', Options)) B using(BannerID) group by 1;
+----------------+----------+
| resultcost/1e6 | count(*) |
+----------------+----------+
|           0.03 |        8 |
|           0.04 |       20 |
|           0.05 |        4 |
|           0.06 |        4 |
|           0.07 |       12 |
|           0.08 |        4 |
|           0.09 |       16 |
|            0.1 |        8 |
|           0.11 |        8 |
|           0.12 |        4 |
|           0.13 |       28 |
|           0.14 |       20 |
|           0.15 |       24 |
|           0.16 |       20 |
|           0.17 |       20 |
|           0.18 |       28 |
|           0.19 |       16 |
|            0.2 |       20 |
|           0.21 |       28 |
|           0.22 |       28 |
|           0.23 |       28 |
|           0.24 |       28 |
|           0.25 |       32 |
|           0.26 |       12 |
|           0.27 |       20 |
|           0.28 |       28 |
|           0.29 |       28 |
|            0.3 |       40 |
|           0.31 |       56 |
|           0.32 |       44 |
|           0.33 |       48 |
|           0.34 |       40 |
|           0.35 |       48 |
|           0.36 |       44 |
|           0.37 |       40 |
|           0.38 |       72 |
|           0.39 |       52 |
|            0.4 |       32 |
|           0.41 |       76 |
|           0.42 |       64 |
|           0.43 |       68 |
|           0.44 |       32 |
|           0.45 |       56 |
|           0.46 |       64 |
|           0.47 |       60 |
|           0.48 |       60 |
|           0.49 |       80 |
|            0.5 |       72 |
|           0.51 |       52 |
|           0.52 |       60 |
|           0.53 |      292 |
|           0.54 |      144 |
|           0.55 |      216 |
|           0.56 |      124 |
|           0.57 |      132 |
|           0.58 |     1296 |
+----------------+----------+
56 rows in set (0.09 sec)



ya svn ci -m   $'BSSERVER-2400: use banner priority and global subtrahend in sort params for distribution\nREVIEW:243524'

(gdb) p sort_param
$1 = 0.85954442956409649



1818 static void yabs_handler_real_page(yabs_binding* b, int origin, int is_dsp) {

1832     yabs_record* record;
2007         record = &rec;
2201     record = b->pool.allocate_array<yabs_record>(orig_page->total + 10);
2202     yabs::memzero_array(record, orig_page->total + 10);
2203
2204     total = yabs_prepare_page(b, args, page_id, record, orig_page_id);

2234     for (i = 0; i <= total; ++i) {
2235         ui64& parent_event_hash = record[0].parent_event_hash;
2236         yabs_record_filter(args, &client, page, &record[i]);
2237         if (is_dsp) {
2238             record[i].options |= (1 << yabs_rec_option_dsp);
2239         }
2240         if (args->is_auction_stable) {
2241             record[i].options |= (1 << yabs_rec_option_auction_stable);
2242         }
2243         if (
2244             !record[i].parent_banner_id &&
2245             record[i].options & (1 << yabs_rec_option_performance) &&
2246             record[i].options & (1 << yabs_rec_option_dynamic_banner) &&
2247             !parent_event_hash)
2248         {
2249             parent_event_hash = get_event_hash(args, &record[i]);
2250         }
2251     }
2252
2253     for (i = 1; i <= total; i++) {
2254         if (!record[i].fake_premium) {
2255             total_real++;
2256         }
2257     }

2373         if (!yabs_meta_write_code(
2374                 b, bases, args, block_page_id, origin,
2375                 record, total, client.event_flags,
2376                 false, ref_page->cat_keyword_id))
2377         {

2385             b->logs.log = yabs_fill_log_list(bases, args, record, total, client.event_flags);
2386
2387             NYabsLua::NApi::TContext cntx(args, bases, block_page_id, record, total);


2391             b->logs.log = yabs_write_page(
2392                 &b->reply_content, bases, args, block_page_id, origin,
2393                 record, total, client.event_flags);


 yabs_write_instant_rf_stat(b, args, nullptr, record + 1, total, now);
2404         b->logs.log = yabs_log_append(bases, args, b->logs.log, &(record[0]), false);


ban_or_grid_value
	Yabs::AutoBudget::Structures::Phrase::get_id
		много раз
	get_ban_or_order_group_value
		Banner::get_id
			get_data OK
			get_id_by_pr_idx OK
			add_phrase OK


LoadData.pm
PhraseUpdateTime
Structures/Banner.pm
Structures/Phrase.pm


0.9791
Пн. февр. 27 17:00:16 MSK 2017
1
Пн. февр. 27 17:00:17 MSK 2017


 !!! PRODUCTION !!! root@bstat111i.yandex.ru [yabsdb]> select * from Banner111 where BannerID = 2373536928\G
*************************** 1. row ***************************
                        BannerID: 2373536928
__ROW_MODIFY_TIME_DO_NOT_TOUCH__: 2017-02-15 16:18:48
                        ExportID: 2744347480
                        EngineID: 7
                   GroupExportID: 1868787602
                  ParentExportID: 2744347480
                      BannerHash: 0
                 DynamicBannerID: 0
                         PlaceID: 542
                       ContextID: 1740067389
                         OrderID: 10932056
                 ContextPriority: 0
                  BannerPriority: 1
                 FlatProbability: 1000000
                      TemplateID: 744
                        DomainID: 0
                  TargetDomainID: 10470997
                      BannerType: 1
                    BannerWeight: 1
                     CounterType: 1
                         Options: dynamic,dynamic-template,performance
                           Flags: 0
                            Lang: ru
                      UpdateTime: 2017-02-15 16:18:40
                   ResourceFlags:
1 row in set (0.00 sec)



active_package:
{'keywordid': 395L, 'data': 'str', 'propertydisplayid': 127L, 'operationid': 4L}

distrib_product
{'keywordid': 509L, 'data': 'str', 'propertydisplayid': 125L, 'operationid': 1L}


1) Расхождения в FlatCostUpdateTime, CostUpdateTime


mysql> select * from PhrasePrice where OrderID=193970 and GroupExportID = 504403 and PhraseID = 7808385;
+---------+----------+-----------+---------------+----------+-------------+--------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+---------------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+------+---------------------+-------+
| OrderID | EngineID | BannerID  | GroupExportID | PhraseID | ContextType | Cost   | CostUpdateTime      | AvgCost | AvgCostUpdateTime   | AvgCPA | AvgCPAUpdateTime    | FlatCost | FlatCostUpdateTime  | ResultCost | ResultFlatCost | Options             | OptionAutobrokerCurrencyUpdateTime | OptionOnlyOfferRetargetingUpdateTime | OptionOnlyNewAuditoryUpdateTime | OptionGoalContextUpdateTime | OptionDeletedUpdateTime | Hits | HitsUpdateTime      | PCTR0 |
+---------+----------+-----------+---------------+----------+-------------+--------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+---------------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+------+---------------------+-------+
|  193970 |        7 |   1343766 |        504403 |  7808385 |           1 | 103000 | 2015-07-06 10:47:28 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |    51000 | 2015-07-06 10:47:28 |     103000 |          51000 | autobroker,currency | 2017-02-02 19:15:08                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2017-02-02 19:15:08     |   95 | 2017-02-15 07:18:16 |   757 |
|  193970 |        7 | 201040055 |        504403 |  7808385 |           1 | 103000 | 2015-07-06 10:47:28 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |    51000 | 2015-07-06 10:47:28 |     103000 |          51000 | autobroker,currency | 2017-02-02 19:15:08                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2017-02-02 19:15:08     |   95 | 2017-02-15 07:18:16 |   757 |
|  193970 |        7 | 747608948 |        504403 |  7808385 |           1 | 103000 | 1971-01-01 00:00:01 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |    51000 | 0000-00-00 00:00:00 |     103000 |          51000 | autobroker,currency | 2017-02-02 19:15:08                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2017-02-02 19:15:08     |   95 | 2017-02-15 07:18:16 |     0 |
+---------+----------+-----------+---------------+----------+-------------+--------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+---------------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+------+---------------------+-------+
3 rows in set (0.00 sec)

2) Расхождения в ценах когда фраза удалена


mysql> select * from PhrasePrice where GroupExportID=504403 and PhraseID = 17248461;
+---------+----------+-----------+---------------+----------+-------------+--------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+--------------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+------+---------------------+-------+
| OrderID | EngineID | BannerID  | GroupExportID | PhraseID | ContextType | Cost   | CostUpdateTime      | AvgCost | AvgCostUpdateTime   | AvgCPA | AvgCPAUpdateTime    | FlatCost | FlatCostUpdateTime  | ResultCost | ResultFlatCost | Options            | OptionAutobrokerCurrencyUpdateTime | OptionOnlyOfferRetargetingUpdateTime | OptionOnlyNewAuditoryUpdateTime | OptionGoalContextUpdateTime | OptionDeletedUpdateTime | Hits | HitsUpdateTime      | PCTR0 |
+---------+----------+-----------+---------------+----------+-------------+--------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+--------------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+------+---------------------+-------+
|  193970 |        7 |   1343766 |        504403 | 17248461 |           1 | 230000 | 2015-07-06 10:47:28 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |    10000 | 2015-07-06 10:47:28 |     230000 |          10000 | deleted,autobroker | 2015-09-15 13:39:15                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2017-02-02 19:15:08     |    3 | 2015-09-15 13:39:15 |   373 |
|  193970 |        7 | 201040055 |        504403 | 17248461 |           1 | 260000 | 2015-07-06 10:47:28 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |    10000 | 2015-07-06 10:47:28 |     260000 |          10000 | deleted,autobroker | 2015-09-15 13:39:15                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2017-02-02 19:15:08     |    3 | 2015-09-15 13:39:15 |   395 |
|  193970 |        7 | 747608948 |        504403 | 17248461 |           1 |  60000 | 1971-01-01 00:00:01 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |    10000 | 0000-00-00 00:00:00 |      60000 |          10000 | deleted,autobroker | 2015-09-15 13:39:15                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2017-02-02 19:15:08     |    3 | 2015-09-15 13:39:15 |     0 |
+---------+----------+-----------+---------------+----------+-------------+--------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+--------------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+------+---------------------+-------+
3 rows in set (0.00 sec)

3) Одна фраза удалена, другая нет

mysql> select * from PhrasePrice where GroupExportID=327666666 and PhraseID = 396371686;
+---------+----------+-----------+---------------+-----------+-------------+--------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+-----------------------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+------+---------------------+-------+
| OrderID | EngineID | BannerID  | GroupExportID | PhraseID  | ContextType | Cost   | CostUpdateTime      | AvgCost | AvgCostUpdateTime   | AvgCPA | AvgCPAUpdateTime    | FlatCost | FlatCostUpdateTime  | ResultCost | ResultFlatCost | Options                     | OptionAutobrokerCurrencyUpdateTime | OptionOnlyOfferRetargetingUpdateTime | OptionOnlyNewAuditoryUpdateTime | OptionGoalContextUpdateTime | OptionDeletedUpdateTime | Hits | HitsUpdateTime      | PCTR0 |
+---------+----------+-----------+---------------+-----------+-------------+--------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+-----------------------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+------+---------------------+-------+
| 2326011 |        7 | 260540520 |     327666666 | 396371686 |           1 | 600000 | 2017-03-02 02:02:51 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |   420000 | 2017-03-01 21:42:53 |     600000 |         420000 | autobroker,currency         | 2017-03-02 02:02:51                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2016-11-26 13:46:44     |   14 | 2017-03-02 02:02:51 |     0 |
| 2326011 |        7 | 470858465 |     327666666 | 396371686 |           1 | 600000 | 2017-03-02 02:02:51 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |   420000 | 2017-03-01 21:42:53 |     600000 |         420000 | deleted,autobroker,currency | 2017-03-02 02:02:51                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 0000-00-00 00:00:00     |   14 | 2017-03-02 02:02:51 |     0 |
+---------+----------+-----------+---------------+-----------+-------------+--------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+-----------------------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+------+---------------------+-------+
2 rows in set (0.03 sec)

mysql>

4) Других расхождений поля Options нет


mysql> select * from PhrasePrice inner join GroupPhrasePrice using(OrderID,GroupExportID,PhraseID,ContextType) inner join ActiveGroups using(OrderID,GroupExportID) where  !find_in_set('deleted', PhrasePrice.Options) and !find_in_set('deleted', GroupPhrasePrice.Options) and PhrasePrice.Options != GroupPhrasePrice.Options limit 1;
Empty set (8 min 58.33 sec)

5) Различается HitsUpdateTime
mysql> select * from PhrasePrice where GroupExportID=287180090 and PhraseID = 20345500;
+---------+----------+-----------+---------------+----------+-------------+------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+---------------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+------+---------------------+-------+
| OrderID | EngineID | BannerID  | GroupExportID | PhraseID | ContextType | Cost | CostUpdateTime      | AvgCost | AvgCostUpdateTime   | AvgCPA | AvgCPAUpdateTime    | FlatCost | FlatCostUpdateTime  | ResultCost | ResultFlatCost | Options             | OptionAutobrokerCurrencyUpdateTime | OptionOnlyOfferRetargetingUpdateTime | OptionOnlyNewAuditoryUpdateTime | OptionGoalContextUpdateTime | OptionDeletedUpdateTime | Hits | HitsUpdateTime      | PCTR0 |
+---------+----------+-----------+---------------+----------+-------------+------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+---------------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+------+---------------------+-------+
|  776103 |        7 | 223610725 |     287180090 | 20345500 |           1 | 7000 | 1971-01-01 00:00:01 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |     3000 | 0000-00-00 00:00:00 |       7000 |           3000 | autobroker,currency | 2016-12-26 17:07:23                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2016-12-26 17:07:23     |    9 | 2017-02-14 11:22:41 |     0 |
|  776103 |        7 | 933074858 |     287180090 | 20345500 |           1 | 7000 | 1971-01-01 00:00:01 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |     3000 | 0000-00-00 00:00:00 |       7000 |           3000 | autobroker,currency | 2016-12-26 17:07:23                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2016-12-26 17:07:23     |    9 | 2017-02-14 11:22:42 |     0 |
+---------+----------+-----------+---------------+----------+-------------+------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+---------------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+------+---------------------+-------+

5) Различается FlatCost у старого завершенного Автобюджетного заказа
mysql> select * from PhrasePrice where GroupExportID=61349290 and PhraseID = 11426491;
+---------+----------+-----------+---------------+----------+-------------+--------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+------+---------------------+-------+
| OrderID | EngineID | BannerID  | GroupExportID | PhraseID | ContextType | Cost   | CostUpdateTime      | AvgCost | AvgCostUpdateTime   | AvgCPA | AvgCPAUpdateTime    | FlatCost | FlatCostUpdateTime  | ResultCost | ResultFlatCost | Options    | OptionAutobrokerCurrencyUpdateTime | OptionOnlyOfferRetargetingUpdateTime | OptionOnlyNewAuditoryUpdateTime | OptionGoalContextUpdateTime | OptionDeletedUpdateTime | Hits | HitsUpdateTime      | PCTR0 |
+---------+----------+-----------+---------------+----------+-------------+--------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+------+---------------------+-------+
| 1401669 |        7 |  44984272 |      61349290 | 11426491 |           1 | 890000 | 2014-08-21 18:10:11 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |   760000 | 2014-08-21 18:10:11 |     890000 |         760000 | autobroker | 2015-04-29 13:59:40                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2015-04-29 13:59:40     |   39 | 2017-03-02 02:41:52 |   703 |
| 1401669 |        7 | 210125334 |      61349290 | 11426491 |           1 | 890000 | 2014-08-21 18:10:11 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |   940000 | 2014-08-21 18:10:11 |     890000 |         940000 | autobroker | 2015-04-29 13:59:40                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2015-04-29 13:59:40     |   39 | 2017-03-02 02:41:52 |  1730 |
+---------+----------+-----------+---------------+----------+-------------+--------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+------+---------------------+-------+
2 rows in set (0.00 sec)

6) Различается ставка у ленивых фраз которые пропущены в Автобюджете

 !!! PRODUCTION !!! root@bstat129i.yandex.ru [yabsdb]> select * from PhrasePrice where GroupExportID=168979674 and PhraseID = 204102;
+---------+----------+------------+---------------+----------+-------------+------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+---------------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+--------+---------------------+-------+
| OrderID | EngineID | BannerID   | GroupExportID | PhraseID | ContextType | Cost | CostUpdateTime      | AvgCost | AvgCostUpdateTime   | AvgCPA | AvgCPAUpdateTime    | FlatCost | FlatCostUpdateTime  | ResultCost | ResultFlatCost | Options             | OptionAutobrokerCurrencyUpdateTime | OptionOnlyOfferRetargetingUpdateTime | OptionOnlyNewAuditoryUpdateTime | OptionGoalContextUpdateTime | OptionDeletedUpdateTime | Hits   | HitsUpdateTime      | PCTR0 |
+---------+----------+------------+---------------+----------+-------------+------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+---------------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+--------+---------------------+-------+
| 1706140 |        7 |  121478091 |     168979674 |   204102 |           2 |    0 | 2017-01-19 14:27:52 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |   127000 | 2017-01-19 14:27:52 |          0 |         127000 | autobroker,currency | 2017-02-09 17:45:09                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2017-02-09 17:45:09     | 100000 | 2017-01-26 15:23:57 |     0 |
| 1706140 |        7 |  296841144 |     168979674 |   204102 |           2 |    0 | 2017-01-19 14:27:52 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |   127000 | 2017-01-19 14:27:52 |          0 |         127000 | autobroker,currency | 2017-02-09 17:45:09                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2017-02-09 17:45:09     | 100000 | 2017-01-26 15:23:57 |     0 |
| 1706140 |        7 | 1793120252 |     168979674 |   204102 |           2 |    0 | 2017-01-19 14:27:52 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |   127000 | 2017-01-19 14:27:52 |          0 |         127000 | autobroker,currency | 2017-02-09 17:45:09                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2017-02-09 17:45:09     | 100000 | 2017-01-26 15:23:57 |     0 |
| 1706140 |        7 | 1793120253 |     168979674 |   204102 |           2 |    0 | 2017-01-19 14:27:52 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |   127000 | 2017-01-19 14:27:52 |          0 |         127000 | autobroker,currency | 2017-02-09 17:45:09                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2017-02-09 17:45:09     | 100000 | 2017-01-26 15:23:57 |     0 |
| 1706140 |        7 | 1793120254 |     168979674 |   204102 |           2 |    0 | 2017-01-19 14:27:52 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |   127000 | 2017-01-19 14:27:52 |          0 |         127000 | autobroker,currency | 2017-02-09 17:45:09                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2017-02-09 17:45:09     | 100000 | 2017-01-26 15:23:57 |     0 |
| 1706140 |        7 | 1793120255 |     168979674 |   204102 |           2 |    0 | 2017-01-19 14:27:52 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |   127000 | 2017-01-19 14:27:52 |          0 |         127000 | autobroker,currency | 2017-02-09 17:45:09                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2017-02-09 17:45:09     | 100000 | 2017-01-26 15:23:57 |     0 |
| 1706140 |        7 | 3399238509 |     168979674 |   204102 |           2 |    0 | 1971-01-01 00:00:01 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |        0 | 0000-00-00 00:00:00 |          0 |           3000 | autobroker,currency | 2017-02-09 17:45:09                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2017-02-09 17:45:09     | 100000 | 0000-00-00 00:00:00 |     0 |
| 1706140 |        7 | 3399238510 |     168979674 |   204102 |           2 |    0 | 1971-01-01 00:00:01 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |        0 | 0000-00-00 00:00:00 |          0 |           3000 | autobroker,currency | 2017-02-09 17:45:09                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2017-02-09 17:45:09     | 100000 | 0000-00-00 00:00:00 |     0 |
| 1706140 |        7 | 3399238511 |     168979674 |   204102 |           2 |    0 | 1971-01-01 00:00:01 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |        0 | 0000-00-00 00:00:00 |          0 |           3000 | autobroker,currency | 2017-02-09 17:45:09                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2017-02-09 17:45:09     | 100000 | 0000-00-00 00:00:00 |     0 |
| 1706140 |        7 | 3399238512 |     168979674 |   204102 |           2 |    0 | 1971-01-01 00:00:01 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |        0 | 0000-00-00 00:00:00 |          0 |           3000 | autobroker,currency | 2017-02-09 17:45:09                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2017-02-09 17:45:09     | 100000 | 0000-00-00 00:00:00 |     0 |
+---------+----------+------------+---------------+----------+-------------+------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+---------------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+--------+---------------------+-------+
10 rows in set (0.00 sec)

 !!! PRODUCTION !!! root@bstat129i.yandex.ru [yabsdb]>

7) Различаются OptionsDeletedUpdateTime и OptionsAutobrokerCurrencyUpdateTime

mysql> select * from PhrasePrice where GroupExportID=313758408  and PhraseID = 387237843;
+---------+----------+-----------+---------------+-----------+-------------+-------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+---------------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+------+---------------------+-------+
| OrderID | EngineID | BannerID  | GroupExportID | PhraseID  | ContextType | Cost  | CostUpdateTime      | AvgCost | AvgCostUpdateTime   | AvgCPA | AvgCPAUpdateTime    | FlatCost | FlatCostUpdateTime  | ResultCost | ResultFlatCost | Options             | OptionAutobrokerCurrencyUpdateTime | OptionOnlyOfferRetargetingUpdateTime | OptionOnlyNewAuditoryUpdateTime | OptionGoalContextUpdateTime | OptionDeletedUpdateTime | Hits | HitsUpdateTime      | PCTR0 |
+---------+----------+-----------+---------------+-----------+-------------+-------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+---------------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+------+---------------------+-------+
| 3138122 |        7 | 251677376 |     313758408 | 387237843 |           1 | 13000 | 2016-07-29 09:44:43 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |    53000 | 2016-07-29 09:44:43 |      13000 |          53000 | autobroker,currency | 2016-07-29 11:14:13                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2016-07-29 11:14:13     |    1 | 2017-01-30 21:40:33 |   630 |
| 3138122 |        7 | 268416854 |     313758408 | 387237843 |           1 | 13000 | 2016-07-29 09:44:43 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |    53000 | 2016-07-29 09:44:43 |      13000 |          53000 | autobroker,currency | 2016-07-29 11:14:13                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2016-07-29 11:14:13     |    1 | 2017-01-30 21:40:33 |   253 |
| 3138122 |        7 | 268416855 |     313758408 | 387237843 |           1 | 13000 | 2016-07-29 09:44:43 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |    53000 | 2016-07-29 09:44:43 |      13000 |          53000 | autobroker,currency | 2016-07-29 11:14:13                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2016-07-29 11:14:13     |    1 | 2017-01-30 21:40:33 |   273 |
| 3138122 |        7 | 427696492 |     313758408 | 387237843 |           1 | 13000 | 2016-07-29 09:44:43 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |    53000 | 2016-07-29 09:44:43 |      13000 |          53000 | autobroker,currency | 2016-07-29 11:14:13                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2016-07-29 11:14:13     |    1 | 2017-01-30 21:40:33 |  1002 |
| 3138122 |        7 | 427696493 |     313758408 | 387237843 |           1 | 13000 | 2016-07-29 09:44:43 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |    53000 | 2016-07-29 09:44:43 |      13000 |          53000 | autobroker,currency | 2016-07-29 11:14:13                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2016-07-29 11:14:13     |    1 | 2017-01-30 21:40:33 |  1066 |
| 3138122 |        7 | 427696494 |     313758408 | 387237843 |           1 | 13000 | 2016-07-29 09:44:43 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |    53000 | 2016-07-29 09:44:43 |      13000 |          53000 | autobroker,currency | 2016-07-29 11:14:13                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2016-07-29 11:14:13     |    1 | 2017-01-30 21:40:33 |  1064 |
| 3138122 |        7 | 853250055 |     313758408 | 387237843 |           1 | 13000 | 2016-07-10 22:53:42 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |    53000 | 2016-07-10 22:53:42 |      13000 |          53000 | autobroker,currency | 2016-07-10 22:53:42                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2015-11-04 14:56:51     |    1 | 2017-01-30 21:40:33 |     0 |
| 3138122 |        7 | 853250056 |     313758408 | 387237843 |           1 | 13000 | 2016-07-10 22:53:42 |       0 | 0000-00-00 00:00:00 |      0 | 0000-00-00 00:00:00 |    53000 | 2016-07-10 22:53:42 |      13000 |          53000 | autobroker,currency | 2016-07-10 22:53:42                | 0000-00-00 00:00:00                  | 0000-00-00 00:00:00             | 0000-00-00 00:00:00         | 2015-11-04 14:56:51     |    1 | 2017-01-30 21:40:33 |     0 |
+---------+----------+-----------+---------------+-----------+-------------+-------+---------------------+---------+---------------------+--------+---------------------+----------+---------------------+------------+----------------+---------------------+------------------------------------+--------------------------------------+---------------------------------+-----------------------------+-------------------------+------+---------------------+-------+
8 rows in set (0.00 sec)

8) Других расхождений нет

mysql> select PhrasePrice.* from PhrasePrice inner join GroupPhrasePrice using(OrderID,GroupExportID,PhraseID,ContextType) inner join ActiveGroups using(OrderID,GroupExportID) inner join OrderInfo using(OrderID) where  (PhrasePrice.AvgCost != GroupPhrasePrice.AvgCost or PhrasePrice.AvgCost or PhrasePrice.AvgCPA != GroupPhrasePrice.AvgCPA or PhrasePrice.AvgCPAUpdateTime != GroupPhrasePrice.AvgCPAUpdateTime or PhrasePrice.ResultCost != GroupPhrasePrice.ResultCost or PhrasePrice.ResultFlatCost != GroupPhrasePrice.ResultFlatCost or PhrasePrice.Options != GroupPhrasePrice.Options  or PhrasePrice.OptionOnlyOfferRetargetingUpdateTime != GroupPhrasePrice.OptionOnlyOfferRetargetingUpdateTime or PhrasePrice.OptionOnlyNewAuditoryUpdateTime != GroupPhrasePrice.OptionOnlyNewAuditoryUpdateTime or PhrasePrice.OptionGoalContextUpdateTime != GroupPhrasePrice.OptionGoalContextUpdateTime or PhrasePrice.Hits != GroupPhrasePrice.Hits ) and !find_in_set('deleted', PhrasePrice.Options) and !find_in_set('deleted', GroupPhrasePrice.Options) and Complete = 0 and PhrasePrice.Hits not in (1000, 100000) limit 1\G
Empty set (1 min 32.57 sec)


P408212&P408222&P415630&P726941&P726942&P906021&P1022575:8395149;(P1096050|P1096048|P1096049|P1096047):8853773,8731341,8466427,8877561,8850183,8800238;(P1166238|P1210596):10004444;P1166560:10244167;P1208734:10141078;P877915:8096440;P838967:13606378;P838967:13900475;P960348:14057730;P960348:14057793;P960348:14057725;P960348:14057777;P960348:14066713;P960348:14066441;P960348:14066444;P960348:14067368;P960348:14078790;



[pid=8332->24327]  DB<26> x 320000/2
0  160000
[pid=8332->24327]  DB<27> x $slope_arr->{2.752371}
0  ARRAY(0x1c05d0d8)
   0  ARRAY(0x1c05d108)
      0  '2338114528,1329906378,1;4826032'
      1  11
[pid=8332->24327]  DB<28> x $sl
0  ARRAY(0x1ae045c8)
   0  4.452012
   1  4.452012
   2  10
   3  4.452
   4  '1712702687,1329905560,1;4826032'



record: ['OrderID', 'EventTime', 'ExperimentBits', 'NewEventCost', 'FraudBits', 'TargetPhraseID', 'PhraseID', 'ContextType', 'EventCost', 'BannerID', 'SimDistance', 'OldEventCost']

schema: [{'type': 'int64', 'name': 'OrderID'}, {'type': 'int64', 'name': 'EventTime'}, {'type': 'uint64', 'name': 'ExperimentBits'}, {'type': 'int64', 'name': 'BannerID'}, {'type': 'uint64', 'name': 'PhraseID'}, {'type': 'uint64', 'name': 'TargetPhraseID'}, {'type': 'int64', 'name': 'SimDistance'}, {'type': 'uint64', 'name': 'FraudBits'}, {'type': 'int64', 'name': 'ContextType'}, {'type': 'int64', 'name': 'EventCost'}]


^CCtrl-C -- sending "KILL QUERY 1073395" to server ...
Ctrl-C -- query aborted.
ERROR 1028 (HY000): Sort aborted: Query execution was interrupted
mysql> select bstat129f_PhrasePrice.OptionDeletedUpdateTime,bstat129f_PhrasePrice.Options  from bstat129f_PhrasePrice left join bstat129i_PhrasePrice using(BannerID,PhraseID,ContextType) where isnull(bstat129i_PhrasePrice.BannerID) and  (!find_in_set('deleted', bstat129f_PhrasePrice.Options) or bstat129f_PhrasePrice.OptionDeletedUpdateTime > now() - interval 30 day) order by 1;
+-------------------------+-----------------------------+
| OptionDeletedUpdateTime | Options                     |
+-------------------------+-----------------------------+
| 2017-03-04 00:41:40     | deleted,autobroker,currency |
| 2017-03-04 00:41:40     | deleted,autobroker,currency |
| 2017-03-04 00:41:40     | deleted,autobroker,currency |
| 2017-03-04 00:47:04     | deleted,autobroker          |
| 2017-03-04 01:21:46     | deleted,autobroker,currency |
| 2017-03-04 01:21:46     | deleted,autobroker,currency |
| 2017-03-04 01:21:46     | deleted,autobroker,currency |
| 2017-03-04 01:21:46     | deleted,autobroker,currency |
| 2017-03-04 01:21:46     | deleted,autobroker,currency |
| 2017-03-04 01:21:46     | deleted,autobroker,currency |
| 2017-03-04 01:47:46     | deleted,autobroker,currency |
| 2017-03-04 01:47:46     | deleted,autobroker,currency |
| 2017-03-04 01:51:15     | deleted,autobroker,currency |
| 2017-03-04 01:51:15     | deleted,autobroker,currency |
| 2017-03-04 01:51:15     | deleted,autobroker,currency |
| 2017-03-04 01:51:15     | deleted,autobroker,currency |
| 2017-03-04 01:51:15     | deleted,autobroker,currency |
| 2017-03-04 01:51:15     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:56:51     | deleted,autobroker,currency |
| 2017-03-04 01:57:37     | deleted,autobroker          |
| 2017-03-04 01:57:37     | deleted,autobroker          |
| 2017-03-04 02:07:39     | deleted,autobroker,currency |
| 2017-03-04 02:07:39     | deleted,autobroker,currency |
| 2017-03-04 02:07:39     | deleted,autobroker,currency |
| 2017-03-04 02:07:39     | deleted,autobroker,currency |
| 2017-03-04 02:07:39     | deleted,autobroker,currency |
| 2017-03-04 02:07:39     | deleted,autobroker,currency |
| 2017-03-04 02:54:31     | deleted,autobroker,currency |
| 2017-03-04 02:54:31     | deleted,autobroker,currency |
| 2017-03-04 02:54:31     | deleted,autobroker,currency |
| 2017-03-04 02:54:31     | deleted,autobroker,currency |
| 2017-03-04 03:47:08     | deleted,autobroker,currency |
| 2017-03-04 03:47:08     | deleted,autobroker,currency |
| 2017-03-04 03:47:08     | deleted,autobroker,currency |
| 2017-03-04 03:47:08     | deleted,autobroker,currency |
| 2017-03-04 04:05:36     | deleted,autobroker,currency |
| 2017-03-04 04:26:39     | deleted,autobroker,currency |
| 2017-03-04 04:26:39     | deleted,autobroker,currency |
| 2017-03-04 04:26:39     | deleted,autobroker,currency |
| 2017-03-04 05:15:48     | deleted,autobroker,currency |
| 2017-03-04 05:15:48     | deleted,autobroker,currency |
| 2017-03-04 05:15:48     | deleted,autobroker,currency |
| 2017-03-04 05:16:18     | deleted,autobroker,currency |
| 2017-03-04 05:57:27     | deleted,autobroker,currency |
| 2017-03-04 05:57:27     | deleted,autobroker,currency |
| 2017-03-04 06:11:52     | deleted,autobroker,currency |
| 2017-03-04 06:11:52     | deleted,autobroker,currency |
| 2017-03-04 06:51:12     | deleted,autobroker,currency |
| 2017-03-04 06:51:12     | deleted,autobroker,currency |
| 2017-03-04 06:51:12     | deleted,autobroker,currency |
| 2017-03-04 06:51:12     | deleted,autobroker          |
| 2017-03-04 06:51:12     | deleted,autobroker,currency |
| 2017-03-04 06:51:12     | deleted,autobroker          |
| 2017-03-04 06:51:12     | deleted,autobroker,currency |
| 2017-03-04 06:51:12     | deleted,autobroker          |
| 2017-03-04 06:51:12     | deleted,autobroker          |
| 2017-03-04 06:51:12     | deleted,autobroker          |
| 2017-03-04 06:51:12     | deleted,autobroker,currency |
| 2017-03-04 06:51:12     | deleted,autobroker          |
| 2017-03-04 06:51:12     | deleted,autobroker          |
| 2017-03-04 06:51:12     | deleted,autobroker          |
| 2017-03-04 06:51:12     | deleted,autobroker          |
| 2017-03-04 06:51:12     | deleted,autobroker          |
| 2017-03-04 06:51:12     | deleted,autobroker          |
| 2017-03-04 06:51:12     | deleted,autobroker          |
| 2017-03-04 07:49:45     | deleted,autobroker,currency |
| 2017-03-04 07:49:45     | deleted,autobroker,currency |
| 2017-03-04 07:49:45     | deleted,autobroker,currency |
| 2017-03-04 07:49:45     | deleted,autobroker,currency |
| 2017-03-04 07:49:45     | deleted,autobroker,currency |
| 2017-03-04 07:49:45     | deleted,autobroker,currency |
| 2017-03-04 07:49:45     | deleted,autobroker,currency |
| 2017-03-04 07:49:45     | deleted,autobroker,currency |
| 2017-03-04 07:52:22     | deleted,autobroker          |
| 2017-03-04 07:56:03     | deleted,autobroker,currency |
| 2017-03-04 07:56:03     | deleted,autobroker,currency |
| 2017-03-04 08:26:08     | deleted,autobroker,currency |
| 2017-03-04 09:19:54     | deleted,autobroker          |
| 2017-03-04 09:19:54     | deleted,autobroker          |
| 2017-03-04 09:19:54     | deleted,autobroker          |
| 2017-03-04 09:19:54     | deleted,autobroker          |
| 2017-03-04 09:26:42     | deleted,autobroker,currency |
| 2017-03-04 09:26:42     | deleted,autobroker,currency |
| 2017-03-04 09:26:42     | deleted,autobroker,currency |
| 2017-03-04 09:26:42     | deleted,autobroker,currency |
| 2017-03-04 09:26:42     | deleted,autobroker,currency |
| 2017-03-04 09:26:42     | deleted,autobroker,currency |
| 2017-03-04 09:26:42     | deleted,autobroker,currency |
| 2017-03-04 09:26:42     | deleted,autobroker,currency |
| 2017-03-04 09:26:42     | deleted,autobroker,currency |
| 2017-03-04 09:26:42     | deleted,autobroker,currency |
| 2017-03-04 09:26:42     | deleted,autobroker,currency |
| 2017-03-04 09:31:57     | deleted,autobroker,currency |
| 2017-03-04 09:38:55     | deleted,autobroker          |
| 2017-03-04 09:38:55     | deleted,autobroker          |
| 2017-03-04 09:41:24     | deleted,autobroker          |
| 2017-03-04 09:41:24     | deleted,autobroker          |
| 2017-03-04 09:41:24     | deleted,autobroker          |
| 2017-03-04 09:41:24     | deleted,autobroker          |
| 2017-03-04 09:55:33     | deleted,autobroker,currency |
| 2017-03-04 10:11:23     | deleted,autobroker,currency |
| 2017-03-04 10:17:38     | deleted,autobroker,currency |
| 2017-03-04 10:17:38     | deleted,autobroker,currency |
| 2017-03-04 11:14:36     | deleted,autobroker,currency |
| 2017-03-04 11:14:36     | deleted,autobroker,currency |
| 2017-03-04 11:14:36     | deleted,autobroker,currency |
| 2017-03-04 11:14:36     | deleted,autobroker,currency |
| 2017-03-04 11:17:36     | deleted,autobroker,currency |
| 2017-03-04 11:17:36     | deleted,autobroker,currency |
| 2017-03-04 11:17:36     | deleted,autobroker,currency |
| 2017-03-04 11:17:36     | deleted,autobroker,currency |
| 2017-03-04 11:52:39     | deleted,autobroker,currency |
| 2017-03-04 11:52:39     | deleted,autobroker,currency |
| 2017-03-04 11:52:39     | deleted,autobroker,currency |
| 2017-03-04 11:52:39     | deleted,autobroker,currency |
| 2017-03-04 12:05:34     | deleted,autobroker          |
| 2017-03-04 12:05:34     | deleted,autobroker          |
| 2017-03-04 12:05:34     | deleted,autobroker          |
| 2017-03-04 12:05:34     | deleted,autobroker          |
| 2017-03-04 12:12:50     | deleted,autobroker,currency |
| 2017-03-04 12:33:44     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker,currency |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker,currency |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:08:36     | deleted,autobroker          |
| 2017-03-04 13:10:45     | deleted,autobroker,currency |
| 2017-03-04 13:10:45     | deleted,autobroker,currency |
| 2017-03-04 13:10:45     | deleted,autobroker,currency |
| 2017-03-04 13:10:45     | deleted,autobroker,currency |
| 2017-03-04 13:10:45     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:24:28     | deleted,autobroker,currency |
| 2017-03-04 13:34:24     | deleted,autobroker,currency |
| 2017-03-04 13:34:24     | deleted,autobroker,currency |
| 2017-03-04 14:31:54     | deleted,autobroker,currency |
| 2017-03-04 14:31:54     | deleted,autobroker,currency |
| 2017-03-04 14:31:54     | deleted,autobroker,currency |
| 2017-03-04 14:31:54     | deleted,autobroker,currency |
| 2017-03-04 14:31:54     | deleted,autobroker,currency |
| 2017-03-04 14:31:54     | deleted,autobroker,currency |
| 2017-03-04 14:31:54     | deleted,autobroker,currency |
| 2017-03-04 14:31:54     | deleted,autobroker,currency |
| 2017-03-04 14:31:54     | deleted,autobroker,currency |
| 2017-03-04 14:31:54     | deleted,autobroker,currency |
| 2017-03-04 14:31:54     | deleted,autobroker,currency |
| 2017-03-04 14:31:54     | deleted,autobroker,currency |
| 2017-03-04 14:31:54     | deleted,autobroker,currency |
| 2017-03-04 14:31:54     | deleted,autobroker,currency |
| 2017-03-04 14:31:54     | deleted,autobroker,currency |
| 2017-03-04 14:31:54     | deleted,autobroker,currency |
| 2017-03-04 14:32:53     | deleted,autobroker,currency |
| 2017-03-04 14:32:53     | deleted,autobroker,currency |
| 2017-03-04 14:32:53     | deleted,autobroker,currency |
| 2017-03-04 14:32:53     | deleted,autobroker,currency |
| 2017-03-04 14:32:53     | deleted,autobroker,currency |
| 2017-03-04 14:32:53     | deleted,autobroker,currency |
| 2017-03-04 14:32:53     | deleted,autobroker,currency |
| 2017-03-04 14:32:53     | deleted,autobroker,currency |
| 2017-03-04 14:32:53     | deleted,autobroker,currency |
| 2017-03-04 14:32:53     | deleted,autobroker,currency |
| 2017-03-04 14:32:53     | deleted,autobroker,currency |
| 2017-03-04 14:32:53     | deleted,autobroker,currency |
| 2017-03-04 14:32:53     | deleted,autobroker,currency |
| 2017-03-04 14:32:53     | deleted,autobroker,currency |
| 2017-03-04 15:05:30     | deleted,autobroker,currency |
| 2017-03-04 16:13:37     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 16:52:38     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
`| 2017-03-04 17:00:00     | deleted,autobroker,currency |



| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:00:00     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:03:56     | deleted,autobroker,currency |
| 2017-03-04 17:14:26     | deleted,autobroker,currency |
| 2017-03-04 17:42:38     | deleted,autobroker,currency |
| 2017-03-04 17:47:11     | deleted,autobroker          |
| 2017-03-04 17:47:11     | deleted,autobroker          |
| 2017-03-04 17:47:11     | deleted,autobroker          |
| 2017-03-04 17:47:11     | deleted,autobroker          |
| 2017-03-04 17:47:11     | deleted,autobroker          |
| 2017-03-04 17:47:11     | deleted,autobroker          |
| 2017-03-04 18:23:47     | deleted,autobroker          |
| 2017-03-04 18:23:47     | deleted,autobroker          |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:32:12     | deleted,autobroker,currency |
| 2017-03-04 18:50:01     | deleted,autobroker,currency |
| 2017-03-04 19:07:55     | deleted,autobroker,currency |
| 2017-03-04 19:07:55     | deleted,autobroker,currency |
| 2017-03-04 19:07:55     | deleted,autobroker,currency |
| 2017-03-04 19:29:48     | deleted,autobroker,currency |
| 2017-03-04 19:29:48     | deleted,autobroker,currency |
| 2017-03-04 19:29:48     | deleted,autobroker,currency |
| 2017-03-04 19:29:48     | deleted,autobroker,currency |
| 2017-03-04 19:29:48     | deleted,autobroker,currency |
| 2017-03-04 19:29:48     | deleted,autobroker,currency |
| 2017-03-04 19:29:48     | deleted,autobroker,currency |
| 2017-03-04 19:29:48     | deleted,autobroker,currency |
| 2017-03-04 19:29:48     | deleted,autobroker,currency |
| 2017-03-04 19:29:48     | deleted,autobroker,currency |
| 2017-03-04 19:29:48     | deleted,autobroker,currency |
| 2017-03-04 19:29:48     | deleted,autobroker,currency |
| 2017-03-04 19:36:45     | deleted,autobroker,currency |
| 2017-03-04 19:40:53     | deleted,autobroker,currency |
| 2017-03-04 19:40:53     | deleted,autobroker,currency |
| 2017-03-04 19:40:53     | deleted,autobroker,currency |
| 2017-03-04 19:41:44     | deleted,autobroker,currency |
| 2017-03-04 20:49:24     | deleted,autobroker,currency |
| 2017-03-04 20:49:24     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 21:46:36     | deleted,autobroker,currency |
| 2017-03-04 22:14:29     | deleted,autobroker,currency |
| 2017-03-04 22:14:29     | deleted,autobroker,currency |
| 2017-03-04 22:17:39     | deleted,autobroker          |
| 2017-03-04 22:55:40     | deleted,autobroker,currency |
| 2017-03-04 22:55:40     | deleted,autobroker,currency |
| 2017-03-04 22:55:40     | deleted,autobroker,currency |
| 2017-03-04 23:33:28     | deleted,autobroker,currency |
| 2017-03-04 23:33:28     | deleted,autobroker,currency |
+-------------------------+-----------------------------+
2418 rows in set (2 min 23.72 sec)

mysql>



sudo -u yabs PERL5LIB=.:/home/olegts/arc/trunk/arcadia/yabs/utils/broadmatch-limitation:/home/olegts/arc/trunk/arcadia/yabs/utils/broadmatch-limitation/ft:/usr/bin /home/olegts/arc/trunk/arcadia/yabs/utils/broadmatch-limitation/broadmatch-limitation.pl


sudo -u yabs PERL5LIB=.:/home/olegts/arc/trunk/arcadia/yabs/utils/broadmatch-limitation:/home/olegts/arc/trunk/arcadia/yabs/utils/broadmatch-limitation/ft:/usr/bin /home/olegts/arc/trunk/arcadia/yabs/utils/broadmatch-limitation/broadmatch-limitation.pl
 649
 650         my $tn_broadmatch_diff = $dprocess_params->{RESULT_TABLES}->{BroadMatchLimitationDiff};
 651
 652         create_table($dbh, {
 653                 'def_name' => 'BroadMatchLimitationDiff',
 654                 'table_name' => $tn_broadmatch_diff,
 655         })
 656         or return N_ERROR("Creating table $tn_broadmatch_diff failed");

 920         my $tn_diff = $dprocess_params->{RESULT_TABLES}->{BroadMatchOrderLimitationDiff};
 921         my $tn_score = $dprocess_params->{RESULT_TABLES}->{BroadMatchOrderScoreThreshold};
 922
 923         create_table($dbh, {
 924                 'def_name' => 'OrderNobroad',
 925                 'table_name' => $tn_diff,
 926         })
 927         or return N_ERROR("Creating table $tn_diff failed");
 928


928



Очистка старых удаленных строчек из PhrasePrice
alexpv,bahbka,behemot,dkulikovsky,italiano,keyd,saint,say,zahacker,yottatsa,slepovss,kiwi,zlo,olegts
UP 1440 ET 0 TIMEOUT 10080


r2753443 | yanush77 | 2017-03-06 03:22:28 +0300 (Пн., 06 марта 2017) | 1 line
Changed paths:
   M /trunk/arcadia/yabs/stat/rtb-adaptive/Yabs/DProcess/CustomSubs/RtbGroupStat.pm

BSDEV-62509: Add ability to get statistic from controlpoint
------------------------------------------------------------------------
r2753414 |

:q
:q
Жй
nixx


2017/02/04 13:17:04 807231




 RotateVisitLog2017030613590407                failed     03753b900126d749224f2a0913560f98c89e46f4  2017/03/06 16:59:34  2017/03/06 23:52:40  /mnt/yabslogmem/
 RotateVisitLog2017030613592606                failed     886ef8e6f5b0e5ec5354f0c7fa8cababa058ec86  2017/03/06 17:00:43  2017/03/06 23:52:40  /mnt/yabslogmem/
 RotateVisitLog2017030614013106                failed     093bc31e827f8a6989a98b1ee8b5aeaa026e88e6  2017/03/06 17:03:38  2017/03/06 23:53:41  /mnt/yabslogmem/
 RotateVisitLog2017030614070510                failed     ccfff9d0395a91f473b1e59225441ffa5714ef57  2017/03/06 17:07:59  2017/03/06 23:52:40  /mnt/yabslogmem/
 RotateVisitLog2017030614081410                failed     fdb9d488c89c1d279e718956e37738702ef1a9ce  2017/03/06 17:10:15  2017/03/06 23:52:40  /mnt/yabslogmem/
 RotateVisitLog2017030614113105                failed     b0af862a58f628a8af49a65851ea71aaa789c766  2017/03/06 17:13:00  2017/03/06 23:54:44  /mnt/yabslogmem/
 RotateVisitLog2017030614114609                failed     a2f98b890eaa70b9002fb0db720741dab75f691d  2017/03/06 17:13:22  2017/03/06 23:54:44  /mnt/yabslogmem/
 RotateVisitLog2017030614131507                failed     5860573ea62c60333eceea2dab5e5b451d2121c0  2017/03/06 17:14:01  2017/03/06 23:55:41  /mnt/yabslogmem/
 RotateVisitLog2017030614142608                failed     5d452c44d75b1d74732be66af025d57e68fcb053  2017/03/06 17:15:20  2017/03/06 23:55:41  /mnt/yabslogmem/
 RotateVisitLog2017030614150731                failed     42d1c0e9484d2991c83e816d943244e97bffc23d  2017/03/06 17:15:32  2017/03/06 23:56:49  /mnt/yabslogmem/
 RotateVisitLog2017030614153707                failed     242b1eb2440943aff385d00b297948c5a3cdb3d8  2017/03/06 17:16:15  2017/03/06 23:56:49  /mnt/yabslogmem/
 RotateVisitLog2017030614163008                failed     05839f02fb0db935ea6614e649dc32d70b208cc3  2017/03/06 17:17:24  2017/03/06 23:56:49  /mnt/yabslogmem/
 RotateVisitLog2017030614171405                failed     5ac7ba4fd6df68acf6e72aae8ed6b8fddc4a261f  2017/03/06 17:18:19  2017/03/06 23:56:49  /mnt/yabslogmem/
 RotateVisitLog2017030614174208                failed     f7260a1357c151cb4957d5ddf47e3b144d9d5335  2017/03/06 17:18:20  2017/03/06 23:56:49  /mnt/yabslogmem/


| 65356482 | rplcat      | 2a02:6b8:0:1a0a:225:90ff:fec5:16ea:36401 | yabsinfo | Query   |   1036 | Writing to net                   | select
							LogMD5,
							Status,
							Rows,
							UsedRows,
							unix_timestamp(UpdateTime) |

https://planner.yandex-team.ru/projects/15887/




config-monitoring-yabs-file-transport
config-yabs-cgroups
config-yabs-file-transport-generator
yabs-dbrestore-conf
yabs-file-transport
yabs-machine-learning-common
yabs-jemalloc
yabs-iocheck-disk
yabs-mkdb-bstat
yabs-mkdb-utils
yabs-mkdb
yabs-p2p-daemon-config
yabs-p2p-metrics
yabs-pack
yabs-servant-client


2017/03/08 15:42:42 347303 INFO  [          save] Filling ABBannerPhraseRestartHistory using GroupExportID
2017/03/08 16:53:36 330084 INFO  [cleanupProcess] /var/lib/mysql.yabs/yabsdb/RotatePhrasePriceChangeLog2017030812360900011.frm.lz4 was succesfully removed
i2017/03/08 15:47:41 428846 INFO  [yabs_file_lock] locked
2017/03/08 15:47:41 428846 INFO  [           new] Script is already run with timeout 3600 (by runit?)
2017/03/08 15:47:42 428846 INFO  [        main::] Current max request id is 6886980751
2017/03/08 16:47:41 318354 INFO  [yabs_file_lock] locked



olegts@bstat143h:/mnt/raid/home/olegts$ mysql -uroot yabsdb -e 'show full  processlist' | grep 'dpresults.UpdateGroupPhraseContextCostYSST'
97890121	rplcat	localhost	yabsdb	Query	299	Copying to tmp table	insert ignore into dpresults.UpdateGroupPhraseContextCostYSST143_C_2558875_1 (\n\t\t\tOrderID,\n\t\t\tGroupExportID,\n\t\t\tPhraseID,\n\t\t\tContextType,\n\t\t\tResultCost,\n\t\t\tResultFlatCost,\n\t\t\tOptions,\n\t\t\tUpdateTime\n\t\t)\n\t\tselect\n\t\t\tP.OrderID,\n\t\t\tP.GroupExportID,\n\t\t\tP.PhraseID,\n\t\t\tP.ContextType,\n\t\t\tmax(P.ResultCost),\n\t\t\tmax(P.ResultFlatCost),\n\t\t\tmax(P.Options),\n\t\t\tmax(S.UpdateTime)\n\t\tfrom\n\t\t\t(\n\t\t\t\tselect\n\t\t\t\t\tC.OrderID,\n\t\t\t\t\tC.GroupExportID,\n\t\t\t\t\tC.ContextType,\n\t\t\t\t\tC.UpdateTime\n\t\t\t\tfrom\n\t\t\t\t\tGroupPhraseContextCostChanges C\n\t\t\t\tleft join\n\t\t\t\t\tGroupPhraseContextCostYSSTAppliedUpdates A using (OrderID, GroupExportID, PhraseID, ContextType)\n\t\t\t\twhere\n\t\t\t\t\t\tC.PhraseID = 0\n\t\t\t\t\tand\n\t\t\t\t\t\tC.RequestID > 6890980751\n\t\t\t\t\tand \n\t\t\t\t\t\tC.RequestID <= 6891498191\n\t\t\t\t\tand\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\tA.UpdateTime is null\n\t\t\t\t\t\t\tor\n\t\t\t\t\t\t\t\tC.UpdateTime > A.UpdateTime\n\t\t\t\t\t\t)\n\t\t\t) S\n\t\tinner join\n\t\t\tPhrasePrice P using(OrderID, GroupExportID, ContextType)\n\t\twhere\n\t\t\tS.UpdateTime >= P.CostUpdateTime\n\t\tgroup by 1,2,3,4
 production environment



96804547	rplcat	localhost	yabsdb	Query	1	Copying to tmp table	insert into dpresults.UpdateGroupPhraseContextCostYSST143_C_2558884_1 (\n\t\t\tOrderID,\n\t\t\tGroupExportID,\n\t\t\tPhraseID,\n\t\t\tContextType,\n\t\t\tResultCost,\n\t\t\tResultFlatCost,\n\t\t\tOptions,\n\t\t\tUpdateTime\n\t\t)\n\t\tselect\n\t\t\tP.OrderID,\n\t\t\tP.GroupExportID,\n\t\t\tP.PhraseID,\n\t\t\tP.ContextType,\n\t\t\tmax(P.ResultCost),\n\t\t\tmax(P.ResultFlatCost),\n\t\t\tmax(P.Options),\n\t\t\tmax(S.UpdateTime)\n\t\tfrom\n\t\t\t(\n\t\t\t\tselect\n\t\t\t\t\tC.OrderID,\n\t\t\t\t\tC.GroupExportID,\n\t\t\t\t\tC.PhraseID,\n\t\t\t\t\tC.ContextType,\n\t\t\t\t\tC.UpdateTime\n\t\t\t\tfrom\n\t\t\t\t\tGroupPhraseContextCostChanges C\n\t\t\t\tleft join\n\t\t\t\t\tGroupPhraseContextCostYSSTAppliedUpdates A using (OrderID, GroupExportID, PhraseID, ContextType)\n\t\t\t\twhere\n\t\t\t\t\t\tC.RequestID > 6901649535\n\t\t\t\t\tand\n\t\t\t\t\t\tC.RequestID <= 6901659500\n\t\t\t\t\tand\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\tA.UpdateTime is null\n\t\t\t\t\t\t\tor\n\t\t\t\t\t\t\t\tC.UpdateTime > A.UpdateTime\n\t\t\t\t\t\t)\n\t\t\t) S\n\t\tinner join\n\t\t\tPhrasePrice P using (OrderID, GroupExportID, PhraseID, ContextType)\n\t\twhere\n\t\t\tS.UpdateTime >= P.CostUpdateTime\n\t\tgroup by 1,2,3,4


/home/yabs/stat/bs-log/rtcloud14268f/event.6093098729445795028.MYD.20170308102016


:scripter olegts faustkun antilost alesap vsuvorov w495 danilgrig superman radolga abordonos kirgiz zasalamel andbortnik yarulin skrrydg kacher robot-bs-autoadmin
RotateUndoDspLog201703090654295302
    RotateDspLog2017030117203908


Gbsdb01f_Banner88.ExportID != bsdb02f_Banner88.ExportID or bsdb01f_Banner88.EngineID != bsdb02f_Banner88.EngineID or bsdb01f_Banner88.GroupExportID != bsdb02f_Banner88.GroupExportID or bsdb01f_Banner88.ParentExportID != bsdb02f_Banner88.ParentExportID or bsdb01f_Banner88.BannerHash != bsdb02f_Banner88.BannerHash or bsdb01f_Banner88.PlaceID != bsdb02f_Banner88.PlaceID or bsdb01f_Banner88.ContextID != bsdb02f_Banner88.ContextID or bsdb01f_Banner88.OrderID != bsdb02f_Banner88.OrderID or bsdb01f_Banner88.ContextPriority != bsdb02f_Banner88.ContextPriority or bsdb01f_Banner88.BannerPriority != bsdb02f_Banner88.BannerPriority or bsdb01f_Banner88.FlatProbability != bsdb02f_Banner88.FlatProbability or bsdb01f_Banner88.TemplateID != bsdb02f_Banner88.TemplateID or bsdb01f_Banner88.DomainID != bsdb02f_Banner88.DomainID or bsdb01f_Banner88.TargetDomainID != bsdb02f_Banner88.TargetDomainID or bsdb01f_Banner88.BannerType != bsdb02f_Banner88.BannerType or bsdb01f_Banner88.BannerWeight != bsdb02f_Banner88.BannerWeight or bsdb01f_Banner88.CounterType != bsdb02f_Banner88.CounterType or bsdb01f_Banner88.Options != bsdb02f_Banner88.Options or bsdb01f_Banner88.Flags != bsdb02f_Banner88.Flags or bsdb01f_Banner88.Lang != bsdb02f_Banner88.Lang or bsdb01f_Banner88.UpdateTime != bsdb02f_Banner88.UpdateTime or bsdb01f_Banner88.ResourceFlags != bsdb02f_Banner88.ResourceFlags



olegts@bsyt01k:/mnt/raid/home/olegts$ sudo find /var/lib/mysql.yabs/yabsdb -type f -name RotateDspObject*|sort
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030913560706.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030913560706.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030913560706.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914292210.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914292210.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914292210.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914292708.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914292708.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914292708.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914294605.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914294605.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914294605.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914313310.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914313310.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914313310.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914360610.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914360610.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914360610.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914391706.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914391706.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914391706.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914402310.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914402310.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914402310.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914412406.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914412406.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914412406.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914423010.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914423010.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914423010.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914474506.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914474506.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914474506.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914580810.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914580810.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030914580810.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915133010.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915133010.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915133010.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915141909.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915141909.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915141909.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915180606.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915180606.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915180606.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915180710.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915180710.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915180710.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915201306.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915201306.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915201306.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915202310.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915202310.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915202310.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915202909.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915202909.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030915202909.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030916122006.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030916122006.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030916122006.MYI.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030916390706.frm.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030916390706.MYD.lz4
/var/lib/mysql.yabs/yabsdb/RotateDspObjectLog2017030916390706.MYI.lz4
 production environment
olegts@bsyt01k:/mnt/raid/home/olegts$






sudo kill -9 $(ps aux | grep send-logs-from-yabsdb-to-yabslogmem.pl | grep -v grep | awk '{print $2}')

exec bsyt01k nohup perl send-logs-from-yabsdb-to-yabslogmem.pl 1>> send-logs-from-yabsdb-to-yabslogmem.log 2>&1 &

RotateEventLog2017020310165703


mysql>  select * from PhrasePrice where BannerID = 3100003 and PhraseID = 4100001\G
*************************** 1. row ***************************
                             OrderID: 1100002
                            EngineID: 7
                            BannerID: 3100003
                       GroupExportID: 2001
                            PhraseID: 4100001
                         ContextType: 1
                                Cost: 310000
                      CostUpdateTime: 2017-03-10 10:37:29
                             AvgCost: 0
                   AvgCostUpdateTime: 0000-00-00 00:00:00
                              AvgCPA: 0
                    AvgCPAUpdateTime: 0000-00-00 00:00:00
                            FlatCost: 300000
                  FlatCostUpdateTime: 2017-03-10 10:37:29
                          ResultCost: 310000
                      ResultFlatCost: 300000
                             Options: autobroker,currency
  OptionAutobrokerCurrencyUpdateTime: 2017-03-10 10:37:29
OptionOnlyOfferRetargetingUpdateTime: 0000-00-00 00:00:00
     OptionOnlyNewAuditoryUpdateTime: 0000-00-00 00:00:00
         OptionGoalContextUpdateTime: 0000-00-00 00:00:00
             OptionDeletedUpdateTime: 2017-03-10 10:37:29
                                Hits: 48
                      HitsUpdateTime: 2017-03-10 10:37:29
                               PCTR0: 0
1 row in set (0.00 sec)



mysql>  select * from PhrasePrice where BannerID = 3100003 and PhraseID = 4100001\G
*************************** 1. row ***************************
                             OrderID: 1100002
                            EngineID: 7
                            BannerID: 3100003
                       GroupExportID: 2001
                            PhraseID: 4100001
                         ContextType: 1
                                Cost: 310000
                      CostUpdateTime: 2017-03-10 10:40:26
                             AvgCost: 0
                   AvgCostUpdateTime: 0000-00-00 00:00:00
                              AvgCPA: 0
                    AvgCPAUpdateTime: 0000-00-00 00:00:00
                            FlatCost: 300000
                  FlatCostUpdateTime: 2017-03-10 10:40:26
                          ResultCost: 310000
                      ResultFlatCost: 300000
                             Options: autobroker,currency
  OptionAutobrokerCurrencyUpdateTime: 2017-03-10 10:40:26
OptionOnlyOfferRetargetingUpdateTime: 0000-00-00 00:00:00
     OptionOnlyNewAuditoryUpdateTime: 0000-00-00 00:00:00
         OptionGoalContextUpdateTime: 0000-00-00 00:00:00
             OptionDeletedUpdateTime: 2017-03-10 10:40:02
                                Hits: 48
                      HitsUpdateTime: 2017-03-10 10:40:26
                               PCTR0: 0
1 row in set (0.00 sec)



2017/03/10 16:03:08 9261  INFO  [processLogsMYD] [RotateRtbLog2017031011441510] rtcloud13392k/rtb.5853470487886783095.MYD.20170310114401        1189600248 in 0.001 sec
2017/03/10 16:03:08 9261  INFO  [processLogsMYD] [RotateRtbLog2017031011441510] rtcloud13393k/rtb.5853470487886783095.MYD.20170310114401        1190494724 in 0.001 sec
2017/03/10 16:03:08 9261  INFO  [processLogsMYD] [RotateRtbLog2017031011441510] rtcloud13394k/rtb.5853470487886783095.MYD.20170310114401        1191387872 in 0.001 sec
2017/03/10 16:03:08 9261  INFO  [processLogsMYD] [RotateRtbLog2017031011441510] rtcloud13395k/rtb.5853470487886783095.MYD.20170310114402        1191883488 in 0.001 sec
2017/03/10 16:03:08 9261  INFO  [processLogsMYD] [RotateRtbLog2017031011441510] rtcloud13396k/rtb.5853470487886783095.MYD.20170310114402        1192792576 in 0.001 sec

1191883488
1191883484


CREATE TABLE `BroadMatch` (
  `BannerID` bigint(20) unsigned NOT NULL DEFAULT '0',
  `PhraseID` int(11) NOT NULL DEFAULT '0',
  `ContextType` tinyint(3) unsigned NOT NULL DEFAULT '1',
  `BroadPhraseID` bigint(20) unsigned NOT NULL DEFAULT '0',
  `UpdateTime` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
  `Options` set('premium','dis-partner','lm-phrase') NOT NULL DEFAULT '',
  `CTR` int(10) unsigned NOT NULL DEFAULT '0',
  `PCTR` int(10) unsigned NOT NULL DEFAULT '0',
  `SimDistance` int(10) unsigned NOT NULL DEFAULT '1',
  `APCRatio` int(10) unsigned NOT NULL DEFAULT '1000000',
  `BLPhraseTemplateID` bigint(20) unsigned NOT NULL DEFAULT '0',
  `Score` int(10) unsigned NOT NULL DEFAULT '0',
  PRIMARY KEY (`BannerID`,`PhraseID`,`ContextType`,`BroadPhraseID`,`SimDistance`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8


1191883484
:q

RotateUndoDspLog201703100312322102
RotateUndoDspLog201703100336570602



olegts@bssoap01e:/mnt/raid/home/olegts$ sudo lsof | grep yabs-perl-logger
/usr/sbin    1736   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/    7988   www-data   14w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
send-auct    8076       yabs    7w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs    8107       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
export-ds   10436   www-data    3w      REG                9,1         280     135965 /var/lib/yabs-perl-logger/logger.log (deleted)
/var/www/   11708   www-data   13w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
test-host   12045       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
export-ds   15861   www-data    4w      REG                9,1        1830     135604 /var/lib/yabs-perl-logger/logger.log (deleted)
/var/www/   22797   www-data   14w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/   23062   www-data   13w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs   23528       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-rsyn   40231       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yt-get-co   40291       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs   40303       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-kafk   46477       yabs    4w      REG                9,1     2089239     133949 /var/lib/yabs-perl-logger/logger.log (deleted)
yabs-kafk   46502       yabs    4w      REG                9,1     2089239     133949 /var/lib/yabs-perl-logger/logger.log (deleted)
yabs-kafk   46526       yabs    4w      REG                9,1     2089239     133949 /var/lib/yabs-perl-logger/logger.log (deleted)
yabs-kafk   46570       yabs    4w      REG                9,1     2089239     133949 /var/lib/yabs-perl-logger/logger.log (deleted)
yabs-kafk   46595       yabs    4w      REG                9,1     2089239     133949 /var/lib/yabs-perl-logger/logger.log (deleted)
yabs-kafk   46643       yabs    4w      REG                9,1     2089239     133949 /var/lib/yabs-perl-logger/logger.log (deleted)
yabs-kafk   46674       yabs    4w      REG                9,1     2089239     133949 /var/lib/yabs-perl-logger/logger.log (deleted)
yabs-kafk   47047       yabs    4w      REG                9,1     2089239     133949 /var/lib/yabs-perl-logger/logger.log (deleted)
yabs-kafk   47470       yabs    4w      REG                9,1     2089239     133949 /var/lib/yabs-perl-logger/logger.log (deleted)
yabs-kafk   47509       yabs    4w      REG                9,1     2089239     133949 /var/lib/yabs-perl-logger/logger.log (deleted)
yabs-kafk   47580       yabs    4w      REG                9,1     2089239     133949 /var/lib/yabs-perl-logger/logger.log (deleted)
yabs-kafk   47616       yabs    4w      REG                9,1     2089239     133949 /var/lib/yabs-perl-logger/logger.log (deleted)
yabs-kafk   47868       yabs    4w      REG                9,1     2089239     133949 /var/lib/yabs-perl-logger/logger.log (deleted)
yabs-kafk   47901       yabs    4w      REG                9,1     2089239     133949 /var/lib/yabs-perl-logger/logger.log (deleted)
yabs-kafk   47932       yabs    4w      REG                9,1     2089239     133949 /var/lib/yabs-perl-logger/logger.log (deleted)
soap-quer   48638       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs   54797       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs   61020       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs   68775       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs   84206       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/   97248   www-data   15w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yt-get-co   99137       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs   99152       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  115052       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  126754       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  132777       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/  135761   www-data   14w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  140719       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yt-get-co  155986       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  155995       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
import-me  156008       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/  167413   www-data   13w      REG                9,1       13258     135627 /var/lib/yabs-perl-logger/logger.log (deleted)
rt-graphs  170724       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
summary_s  187050   www-data    5w      REG                9,1       13258     135627 /var/lib/yabs-perl-logger/logger.log (deleted)
rt-graphs  187507       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
summary_s  188530   www-data    5w      REG                9,1       13258     135627 /var/lib/yabs-perl-logger/logger.log (deleted)
summary_s  188616   www-data    5w      REG                9,1       13258     135627 /var/lib/yabs-perl-logger/logger.log (deleted)
/var/www/  192381   www-data   13w      REG                9,1        2901     134231 /var/lib/yabs-perl-logger/logger.log (deleted)
/var/www/  197757   www-data   13w      REG                9,1       11541     164441 /var/lib/yabs-perl-logger/logger.log (deleted)
rt-graphs  199848       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  205143       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  213934       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yt-get-co  213936       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/  228305   www-data   14w      REG                9,1       32634     163987 /var/lib/yabs-perl-logger/logger.log (deleted)
rt-graphs  229376       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  243975       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  260438       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  270474       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yt-get-co  276534       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  276543       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  285704       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-rsyn  285726       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  302240       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  316053       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
export-ds  329123   www-data    3w      REG                9,1     2718633     133972 /var/lib/yabs-perl-logger/logger.log (deleted)
rt-graphs  331749       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
export-ds  332496   www-data    4w      REG                9,1    37286852     136105 /var/lib/yabs-perl-logger/logger.log (deleted)
export-ds  332780   www-data    4w      REG                9,1    37286852     136105 /var/lib/yabs-perl-logger/logger.log (deleted)
export-ds  333737   www-data    4w      REG                9,1    37286852     136105 /var/lib/yabs-perl-logger/logger.log (deleted)
export-ds  337679   www-data    4w      REG                9,1     6779685     163985 /var/lib/yabs-perl-logger/logger.log (deleted)
export-ds  340001   www-data    4w      REG                9,1    26390393     135199 /var/lib/yabs-perl-logger/logger.log (deleted)
rt-graphs  342784       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yt-get-co  342791       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
moderate-  347248       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
moderate-  347291       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
moderate-  347292       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
moderate-  347578       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
moderate-  347579       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
moderate-  347580       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
moderate-  347716       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
moderate-  347722       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
moderate-  347726       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
moderate-  347803       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
moderate-  347841       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
moderate-  348518       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  349560       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  360393       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
moderate-  371232       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  376689       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/  376958   www-data   15w      REG                9,1        1917     163867 /var/lib/yabs-perl-logger/logger.log (deleted)
/var/www/  386083   www-data   14w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  390205       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  406890       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yt-get-co  406940       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  415427       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/  420258   www-data   13w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  421780       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  436168       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  452920       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  466447       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yt-get-co  466500       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  466526       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
export-ds  468661   www-data    3w      REG                9,1     5869955     163953 /var/lib/yabs-perl-logger/logger.log (deleted)
/var/www/  469172   www-data   13w      REG                9,1    25683154     164790 /var/lib/yabs-perl-logger/logger.log (deleted)
export-ds  469224   www-data    4w      REG                9,1     1669664     134814 /var/lib/yabs-perl-logger/logger.log (deleted)
rt-graphs  482424       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  488952       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
dprocess-  492906       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  494926       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
dprocess-  496933       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  497765       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  498003       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  498819       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  499818       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  499820       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  499824       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
slice_ord  509897       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  509915       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  522718       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  522719       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  522720       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  523047       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  523433       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  523467       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  523793       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  524655       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  525104       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
dprocess-  525290       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  525364       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  525374       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yt-get-co  525428       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  526354       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  527700       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  530046       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-rsyn  539429       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-rsyn  539437       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
write-low  539457       yabs    7w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
slice_ord  539461       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs  539468       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
export-au  539469       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  539475       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
direct_re  539496       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
export-au  539498       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
push-clie  541472       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548249       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548251       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548254       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548259       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548262       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548268       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548274       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548276       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548282       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548283       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548284       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548285       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548287       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548290       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548291       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548292       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548293       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548295       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548298       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548300       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548301       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548303       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548304       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548308       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548309       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548313       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548314       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548316       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548318       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548319       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548320       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548321       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548323       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548324       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548326       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548329       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548331       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548333       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548337       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548340       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548341       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548345       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548346       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548351       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548352       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548354       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548356       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548357       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548360       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548361       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548363       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548364       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548367       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548368       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548369       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548370       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548372       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548374       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548375       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548376       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548378       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548380       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548402       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548406       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  548411       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549195       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549198       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549199       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549200       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549201       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549205       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549209       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549216       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549218       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549220       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549221       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549222       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549223       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549224       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549225       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549227       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549230       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549233       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549235       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549236       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
soap-quer  549238       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-resb  550201       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/  590296   www-data   13w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/  595453   www-data   13wW     REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/  615316   www-data   13w      REG                9,1     5456998     164411 /var/lib/yabs-perl-logger/logger.log (deleted)
/var/www/  642679   www-data   13w      REG                9,1    16579506     133067 /var/lib/yabs-perl-logger/logger.log (deleted)
export-au  644434       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
summary_s  669246   www-data    3w      REG                9,1    10554294     164450 /var/lib/yabs-perl-logger/logger.log (deleted)
export-au  671417       yabs    6w      REG                9,1       82585     164798 /var/lib/yabs-perl-logger/logger.log (deleted)
summary_s  672239   www-data    5w      REG                9,1     3031716     134352 /var/lib/yabs-perl-logger/logger.log (deleted)
/var/www/  679640   www-data   14w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
summary_s  684031   www-data    5w      REG                9,1     3031716     134352 /var/lib/yabs-perl-logger/logger.log (deleted)
/var/www/  734712   www-data   13w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/  750704   www-data   13w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
export-ds  768335   www-data    3w      REG                9,1     3071084     135607 /var/lib/yabs-perl-logger/logger.log (deleted)
export-ds  774910   www-data    4w      REG                9,1        5328     134151 /var/lib/yabs-perl-logger/logger.log (deleted)
/var/www/  784597   www-data   13w      REG                9,1      331156     133939 /var/lib/yabs-perl-logger/logger.log (deleted)
/var/www/  799976   www-data   13w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/  822689   www-data   13w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/  849718   www-data   13w      REG                9,1    15907689     164783 /var/lib/yabs-perl-logger/logger.log (deleted)
/var/www/  880663   www-data   16w      REG                9,1       14096     135907 /var/lib/yabs-perl-logger/logger.log (deleted)
/var/www/  907835   www-data   13w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/  941449   www-data   13w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/  942217   www-data   13w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin  944754   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin  945270   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin  945808   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin  946295   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yabs-perl  946545       yabs    1w      REG                9,1      450972     431101 /var/log/yabs-perl-logger/yabs-perl-logger-prepare.log
yabs-perl  946545       yabs    2w      REG                9,1       20313     431102 /var/log/yabs-perl-logger/yabs-perl-logger-prepare.err
yabs-perl  946545       yabs    3uW     REG               0,18           0      14283 /run/lock/yabs-perl-logger-prepare.lock
yabs-perl  946545       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin  946671   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin  948336   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin  959668   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/  965845   www-data   13w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/  976853   www-data   13w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
write-low  977018       yabs    7w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin  979650   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin  980587   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin  981048   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin  983570   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin  984423   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin  984991   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin  985390   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/  995674   www-data   13w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/  998862   www-data   14w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
export-ds  999727   www-data    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/ 1001600   www-data   13w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/ 1007450   www-data   15w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
export-au 1008548       yabs    6w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs 1008563       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin 1022205   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin 1022692   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
send-bann 1022810       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
yt-get-co 1022996       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
mon-webse 1022999       yabs    5w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs 1023006       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin 1024829   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/ 1026228   www-data   16w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin 1028232   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin 1030507   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin 1030738   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin 1030739   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
direct_re 1031281       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs 1031301       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin 1033054   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
direct_re 1033063       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
direct_re 1033100       yabs    4w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/ 1033751   www-data   14w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin 1034258   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin 1035080   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin 1036205   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin 1036624   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/ 1036954   www-data   13w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin 1036980   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin 1039159   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin 1039480   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin 1039482   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
rt-graphs 1039921       yabs    9w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/usr/sbin 1043157   www-data   18w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
/var/www/ 1047068   www-data   13w      REG                9,1      394965     135266 /var/lib/yabs-perl-logger/logger.log
 production environment
olegts@bssoap01e:/mnt/raid/home/olegts$




r135907:r135916

/home/yabs/stat/log/build-url-antispam-list.log:2017/03/11 01:00:04 690945 INFO  [          lock] Get quorum(6/4) while locking
bstat147h
                                         bssoap01h.yandex.ru: 907891 ::1 - - [07/Mar/2017:22:38:30 +0300] "GET /export/export_broadmatch_stat2.cgi?date_from=20100909&date_to=20170307&format=1&order_ids=2023814&task_id=6394819056893567881 HTTP/1.0" 200 8 "2a02:6b8:0:1604:9c04:f844:db29:8aea" "2a02:6b8:0:1604:9c04:f844:db29:8aea" "-" "-" "libwww-perl/6.05" "-" "-" "text/plain" 105194

p_exec bssoap.* zgrep -E 'export_direct_report|export_broadmatch_stat2.cgi' /home/yabs/stat/log/apache2-export/access.log.4.gz


925652436
925652440

2017/03/11 18:53:35 24549 INFO  [processLogsMYD] [RotateHitLog2017031114570806] rtcloud13740f/hit.15484053257898723302.MYD.20170311145601       924964312 in 0.002 sec
2017/03/11 18:53:35 24549 INFO  [processLogsMYD] [RotateHitLog2017031114570806] rtcloud13741f/hit.15484053257898723302.MYD.20170311145602       925652440 in 0.001 sec



ИНН: 772088969478
Номер: 4513 003904
Дата выдачи: 15.06.2013

ОКТМО 45309000
КОД 7720
Инспекция Федеральной налоговой службы № 20 по г.Москве
111141,Москва г,,,,Зеленый пр-кт,7а,,ё
Код ОКПО:29290208 Понедельник, среда с 9-00 до 18-00; вторник, четверг с 9-00 до 20-00; пятница с 9-00 до 16-45 Вторую и четвертую субботу календарного месяца с 10.00 до 15.00

Получатель платежа	Управление Федерального казначейства по г. Москве (Инспекция Федеральной налоговой службы № 20 по г.Москве)
ИНН получателя	7720143220
КПП получателя	772001001
Банк получателя	ГУ Банка России по ЦФО
БИК	044525000
Корр. счет №	(нет данных)
Счет №	40101810045250010041

Отчеты брокера (Plan Contract Notes)

772088969478 @6zQMGYB

Чего ждать:
  - справка 2 ндфл (https://wiki.yandex-team.ru/HR/Spravka/2ndfl/)

/Users/olegts/win-xp

https://www.prolinux.org/post/gotovyi-obraz-windows-xp-v-kvm/

RUYA05004 45380

https://lkfl.nalog.ru/ndfl/decl.html?declar=58984933&t=1489531144344

Номер декларации: 2016-58984933



r135935:r135940


clean-phraseprice
Очистка старых удаленных строчек из PhrasePrice
logtype phrasepriceF
UP 1440
TIMEOUT 10080
USERS alexpv,bahbka,behemot,dkulikovsky,italiano,keyd,saint,say,zahacker,yottatsa,slepovss,kiwi,zlo,olegts

 !!! PRODUCTION !!! root@bsdb02f.yandex.ru [vh]> select * from ContentGroup inner join ContentResource using(ContentGroupID) where ContentTypeID = 2 and Name = 'РЕН ТВ' and ResourceName = 'region_id' and Value = 213\G
*************************** 1. row ***************************
     ContentGroupID: 3689381176963379650
      ContentTypeID: 2
           ParentID: 8487637902660948267
            Comment: РЕН ТВ - канал ориентирован на активную аудиторию зрителей среднего возраста (30-45 лет). В эфире представлены информационные программы, реалити-шоу, циклы журналистских расследований, документальные фильмы и познавательные программы, сериалы и художественные фильмы преимущественно остросюжетного плана.
               Name: РЕН ТВ
         UpdateTime: 2017-03-15 13:30:29
            Options:
          OvsStatus: published
TMP_OvsServiceFlags: ya-tv,ya-main,ya-serp,ya-video,channel
               UUID: RK36s2PpbnCjfwjv1EKSyg
         CreateTime: 0000-00-00 00:00:00
       ResourceName: region_id
              Value: 213
         UpdateTime: 2017-03-15 13:30:29
         CreateTime: 0000-00-00 00:00:00
1 row in set (0.08 sec)


vh-backend-yabs.yandex.ru

olegts@bsmon01i:~$ /usr/bin/jctl add check -host vh-backend-yabs.yandex.ru -service vh-vendor-data -ttl 300 -rtime 60 -module more_than_limit_is_problem -kwargs '{"unreach_service": [{"ignore_nodata": "true", "service": "UNREACHABLE", "ttl": "300"}], "warn_limit": 1, "unreach_mode": "force_ok", "crit_limit": 2}' -methods GOLEM -children CGROUP%yabs_bsint:vh-monitor-vendor-data
RPC error happened!
URL: http://localhost:8998/api-slb/proxy/golem/host_exists
Answer: 'ERROR: http://ro.admin.yandex-team.ru/api/host_query.sbml?hostname=vh-backend-yabs.yandex.ru HTTP Error 500: Internal Server Error \'<html>\\r\\n<head><title>500 Internal Server Error</title></head>\\r\\n<body bgcolor="white">\\r\\n<center><h1>500 Internal Server Error</h1></center>\\r\\n<hr><center>nginx/1.8.1</center>\\r\\n</body>\\r\\n</html>\\r\\n\' (34a5be3b5a8e4d18b7d93f29704239b0)'
HTTP code: 500
HTTP status: Internal Error
Exception: HTTPError()


testtag pages: 50359,45045,136261,148383:


EventTime: 2017-01-16 02:05:00
LogID: 18355282045649557013

RotateDspLog2017030518130408
RotateDspLog2017030518131406
RotateDspLog2017030518131605
RotateDspLog2017030518131709
RotateDspLog2017030518133010
RotateDspLog2017030518141805
RotateDspLog2017030518142008
RotateDspLog2017030518142009
RotateDspLog2017030518142406
RotateDspLog2017030610014510
RotateDspLog2017030810363306


mysql> select * from RotateDspLog2017030518133010 where DspLogID =1013745838193383021\G
*************************** 1. row ***************************
     RequestID: L?4 m  ?ط?I
  HitRequestID: ?}??m  )ʔ??I
      DspLogID: 1013745838193383021
      BidReqID: 1013744670697854573
      ShowTime: 2017-03-05 21:12:09
     EventTime: 2017-03-05 21:12:13
    ResponseID: 1013744670697854573
       EventID: 0
        PageID: 2008
         DSPID: 1
         BidID: 1013744673923012205
         ImpID: 1
 DSPEventFlags: 0
  DSPFraudBits: 32
     RealPrice: 1969
         Price: 1660
  PartnerPrice: 789
     FakePrice: 0
   YandexPrice: 0
 CPMMultiplier: 879230
        MinCPM: 789
           Win: 17
   CounterType: 1
       Options:
      RegionID: 194
  OrigRegionID: 0
  DealExportID: 0
 DealProductID: 0
ExperimentBits: 899527213056
       TestTag: 0
        UniqID: 9318961841433224603
    CreativeID: 0
        AdType: text
    BlockWidth: 320
   BlockHeight: 50
      CryptaID: 1701210000000323720
          Clid: 0
      VendorID: -1
 PartnerStatID: 0
1 row in set (0.00 sec)



https://a.yandex-team.ru/arc/trunk/arcadia/yabs/utils/yabs-alerts/Alerts/SeriesMonitoring/AnomaliesDetector.pm?rev=2770686&blame=true
https://a.yandex-team.ru/arc/trunk/arcadia/yabs/utils/yabs-alerts/Alerts/SeriesMonitoring/AnomaliesDetector.pm?rev=1731278&blame=true#L85



insert into AnalyzerAggregatorInitializerParams
values
	(
		cast(yabs_md5('Yabs::AnomaliesModules::AnomaliesAggregator::YQL') as unsigned),
		'{"query_types":{"hahn.JoinedEFH":{"time_column":"L.EventTime","time_column_format":"%s","cluster":"hahn","location":{"path":"//home/bs/yabs-log/%Y%m/JoinedEFH%Y%m%d%H","time_interval":3600},"alias":"L","aggregate_fields":[{"name":"Clicks","sql":"if(L.CounterType == 2, 1, 0)","aggregation_type":"sum"}],"initial_slice_fields":[{"name":"PageID","sql":"L.PageID"},{"name":"PlaceID","sql":"L.PlaceID"},{"name":"SlotID","sql":"L.SlotID"},{"name":"TypeID","sql":"L.TypeID"},{"name":"SequenceID","sql":"L.SequenceID"},{"name":"ResourceNo","sql":"L.ResourceNo"},{"name":"Position","sql":"L.Position"},{"name":"PageNO","sql":"L.PageNO"},{"name":"RegionID","sql":"L.RegionID"},{"name":"SelectType","sql":"L.SelectType"},{"name":"DeviceType","sql":"L.DeviceType"},{"name":"ContextType","sql":"L.ContextType"},{"name":"LogOptions","sql":"L.Options"},{"name":"OrderID","sql":"L.OrderID"},{"name":"DomainID","sql":"L.DomainID"},{"name":"TagID","sql":"L.TagID"},{"name":"order_options","sql":"OrderInfo.Options"},{"name":"HostID","sql":"L.HostID"},{"name": "ExperimentBits","sql": "L.ExperimentBits"},{"name":"ClientIP","sql":"L.ClientIP"}],"dictionaries":[{"name":"OrderInfo", "path":"//home/bs/dbrestore/bsdb/yabsdb/OrderInfo","join_condition":"L.OrderID == OrderInfo.OrderID"}],"condition":"L.CounterType == 2"}}}'
	)
;


(gdb) p modulo_subtree_paths
$3 = std::vector of length 12, capacity 12 = {15, 12, 7, 5, 1, 0, 2, 1, 1, 0, 1, 0}
5 =
1) нечетные пути поддеревьев: 1
2) четные пути от корней: 2
3) произведения количеств путей разных четностей: (2, 1), (1, 0) 1




RealCost/SourceCost

PRAGMA refselect; PRAGMA yt.DataSizePerJob="100000000"; use hahn;

insert into [//tmp/olegts_order_11690851_2_week_events] with truncate
select
	*
from
	range([//home/logfeller/logs/bs-event-log/1d], [2017-03-06], [2017-03-19])
where
		OrderID == 11690851
	and
		CounterType == 2
;
v

if(GoalReached = 0, '', group_concat(distinct concat(GoalID, '\t', Price, '\n') order by GoalID separator '')) as GoalReaches,

use hahn;

SELECT
  substring(iso_eventtime, 1, 10) as EventDate,
  sum(if(GoalReaches like '%23128920%', 1, 0)) as Actions
from
    [//tmp/olegts_order_11690851_2_week_advisits]
group by
  EventDate
;


use hahn;
insert into [//tmp/olegts_order_11690851_2_week_advisits_banner_phrase] with truncate
SELECT
  BannerID,
  PhraseID,
  ContextType,
  Actions,
  Clicks,
  Actions / Clicks as APC
from
(
SELECT
  BannerID,
  PhraseID,
  ContextType,
  sum(if(GoalReaches like '%23128920%', 1, 0) * if(Type == "1", 1, -1) * if(AttributionType == "1", 1, 0)) as Actions
from
    [//tmp/olegts_order_11690851_2_week_advisits]
group by
  BannerID,
  PhraseID,
  ContextType
)
left join
(
SELECT
  BannerID,
  PhraseID,
  ContextType,
  count(*) as Clicks
from
    [//tmp/olegts_order_11690851_2_week_events]
WHERE
     CounterType == 2
    and
     FraudBits == 0
group by
  BannerID,
  PhraseID,
  ContextType
)
using (BannerID,PhraseID,ContextType)

use hahn;
insert into [//tmp/olegts_order_11690851_2_week_advisits_banner_phrase] with truncate
SELECT
  BannerID,
  PhraseID,
  ContextType,
  Actions,
  Clicks,
  Actions / Clicks as APC
from
(
SELECT
  bannerid,
  phraseid,
  contexttype,
  count(*) as Clicks
from
    [//tmp/olegts_order_11690851_2_week_events]
WHERE
     countertype == 2
    and
     fraudbits == 0
group by
  bannerid,
  phraseid,
  contexttype
) as event
left join
(
SELECT
  BannerID,
  PhraseID,
  ContextType,
  sum(if(GoalReaches like '%23128920%', 1, 0) * if(Type == "1", 1, -1) * if(AttributionType == "1", 1, 0)) as Actions
from
    [//tmp/olegts_order_11690851_2_week_advisits]
group by
  BannerID,
  PhraseID,
  ContextType
) as visit
on
    event.bannerid == visit.BannerID
  and
    event.phraseid == visit.PhraseID
  AND
    event.contexttype == visit.ContextType


 !!! PRODUCTION !!! root@bspstat11i.yabs.yandex.ru [yabsdb]> select  sum(Cost)/sum(Price / 30 * 1.18) from RtbPageStat where PageID = 93830 and ImpID = 9 and ExperimentBits = 0 and UpdateTime between '2017-03-18 00:00:00' and '2017-03-20 00:00:00' ;
+----------------------------------+
| sum(Cost)/sum(Price / 30 * 1.18) |
+----------------------------------+
|                           0.4674 |
+----------------------------------+
1 row in set (0.00 sec)


7/03/19 23:12:15 218674 INFO  [      calc_all] AutoBudget oscillator: instant_multiplier = 1.07381863235031, new_multiplier = 8.7071342023521, cur_multipli
er = 8.692041, new_multiplier_delta = -0.0738186323503138, cur_multiplier_delta = -0.071073, dm = 0.0150932023521004
2017/03/19 23:12:15 218674 INFO  [      calc_all] PageID-ImpID-ExperimentBits: 93830-9-0 :: CurMultiplier: 8.6920 -> 8.7071
2017/03/19 23:12:15 218674 INFO  [      calc_all] Skip filling RtbGroupStat for page 93830

Включенная опция
  DB<15> x $exp_stat_mult
0  HASH(0x7cc6788)
   'AlienPrice' => 0
   'Clicks' => 9301841142
   'Cost' => 3399002822
   'CurMultiplier' => 8805215
   'ExperimentBits' => 0
   'FactorUpdateTime' => 20170318020000
   'Hits' => 352453846906
   'ImpID' => 9
   'LostPrice' => 0
   'NormPrice' => 67354773803
   'PageID' => 93830
   'Price' => 95895517457
   'RealPrice' => 95896942209
   'Shows' => 832869096721
   'StartTime' => 20170318020000
   'UpdateTime' => 20170320010000
   'WinHits' => 209103524264
  DB<16> x $page_def_stat
0  HASH(0x7c3b2a0)
   'AlienPrice' => 0
   'Clicks' => 9301841142
   'Cost' => 3399002822
   'CurMultiplier' => 1000000
   'ExperimentBits' => 0
   'FactorUpdateTime' => 20170318020000
   'Hits' => 352453846906
   'ImpID' => 9
   'LostPrice' => 0
   'NormPrice' => 67354773803
   'PageID' => 93830
   'Price' => 95895517457
   'RealPrice' => 95896942209
   'Shows' => 832869096721
   'StartTime' => 20170318020000
   'UpdateTime' => 20170320010000
   'WinHits' => 209103524264
  DB<36> x 3399002822*30/95895517457
0  1.06334568459599


Выключенная опция;



  DB<4> x $exp_stat_mult
0  HASH(0x8fa19e0)
   'AlienPrice' => 0
   'Clicks' => 63207913064
   'Cost' => 22688180298
   'CurMultiplier' => 8805215
   'ExperimentBits' => 0
   'FactorUpdateTime' => 20170318020000
   'Hits' => 2413300727757
   'ImpID' => 9
   'LostPrice' => 0
   'NormPrice' => 162737367455
   'PageID' => 93830
   'Price' => 1404791488181
   'RealPrice' => 1404804448573
   'Shows' => 5638439086247
   'StartTime' => 20170318020000
   'UpdateTime' => 20170320010000
   'WinHits' => 1418527907982
  DB<5> x $page_def_stat
0  HASH(0x8f9a6b8)
   'AlienPrice' => 0
   'Clicks' => 63207913064
   'Cost' => 22688180298
   'CurMultiplier' => 1000000
   'ExperimentBits' => 0
   'FactorUpdateTime' => 20170318020000
   'Hits' => 2413300727757
   'ImpID' => 9
   'LostPrice' => 0
   'NormPrice' => 162737367455
   'PageID' => 93830
   'Price' => 1404791488181
   'RealPrice' => 1404804448573
   'Shows' => 5638439086247
   'StartTime' => 20170318020000
   'UpdateTime' => 20170320010000
   'WinHits' => 1418527907982


  DB<6> x 22688180298*30/1404791488181
0  0.484517036632487


sas1-6580-23202.vm.search.yandex.net



autobudget-load-ABFastAdjustedStat-from-yt

Ср. марта 22 11:45:41 MSK 2017

Ср. марта 22 11:45:43 MSK 2017
1


bstat01?
 broadmatch-limitation-new-expstat-orders
broadmatch-limitation-new-limit
Ср. марта 22 14:20:14 MSK 2017

Ср. марта 22 14:20:15 MSK 2017
1



TWideProfile wideProfile = CollectProfile(UrlRouter, *localDat


 !!! PRODUCTION !!! root@bsint02i.yabs.yandex.ru [yabsdb]> select * from AnomaliesDetectorAlerts where TAskID = 602 and AlertTime='2017-03-15 20:32:00';
+--------+---------+--------------------------+---------------------+---------------------+---------------------+---------------------+--------------------+------------+------+
| TaskID | AlertID | SeriesName               | UpdateTime          | AlertTime           | FromTime            | UntilTime           | NotificationStatus | Experiment | Note |
+--------+---------+--------------------------+---------------------+---------------------+---------------------+---------------------+--------------------+------------+------+
|    602 |     870 | clicks:count:an_with_rtb | 2017-03-15 20:43:00 | 2017-03-15 20:32:00 | 2017-03-15 20:23:00 | 2017-03-15 20:32:59 |                  1 |          0 |      |
|    602 |     871 | shows:count:an_with_rtb  | 2017-03-15 20:43:00 | 2017-03-15 20:32:00 | 2017-03-15 20:23:00 | 2017-03-15 20:32:59 |                  1 |          0 |      |
+--------+---------+--------------------------+---------------------+---------------------+---------------------+---------------------+--------------------+------------+------+
2 rows in set (0.00 sec)
17/03/15 20:43:11 1024194 INFO  [output_downloa] [1489599781,602]     shows:count:an_with_rtb: from=1489598580, until=1489599170, timegroup=10, last_points
= 207556,193389,192641,206620,149792,125457,150185,169446,171609,200706

Факап случился в 22 минуты


# Counters	count
18	1
20	1
23	1
310	1
51	1
87	1
19	2
27	2`
14	4
16	4
13	7
12	14
11	32
10	64
9	178
8	667
7	1778
6	3912
5	8944
4	23420
3	77356
2	334874
1	2882459

число каунтеров 1, 5, 10, 20, 50, 200
1 - 548283278
5 - 2810830554
10 - 1584156684
20 - 2769852366
50 - 1566673611
87 - 2923234620

1 - 18446744073709549300
5 - 18446744073709551232
10 - 18446744073709551550
20 - 18446744073709551517
50 - 18446744073709551439
200 - 18446744073709524537


olegts@olegts:~$ cat yt_tmp_b7affb1-b5ae5ee6-100aa981-70 | tabgrep '$Counters == 10' | tabsort -nrk CounterOffers |head -10
# CounterOffers	Counters	UniqID	_yql_column_0
65	10	1584156684	18446744073709551550
62	10	1429220081	18446744073709551553
43	10	1828988688	18446744073709551572
42	10	481747623	18446744073709551573
42	10	2513544802	18446744073709551573
41	10	148424288	18446744073709551574
39	10	137754038	18446744073709551576
37	10	3887664786	18446744073709551578
36	10	293966481	18446744073709551579
olegts@olegts:~$ cat yt_tmp_b7affb1-b5ae5ee6-100aa981-70 | tabgrep '$Counters == 20' | tabsort -nrk CounterOffers |head -10
# CounterOffers	Counters	UniqID	_yql_column_0
98	20	2769852366	18446744073709551517
olegts@olegts:~$ cat yt_tmp_b7affb1-b5ae5ee6-100aa981-70 | tabgrep '$Counters == 51' | tabsort -nrk CounterOffers |head -10
# CounterOffers	Counters	UniqID	_yql_column_0:q

176	51	1566673611	18446744073709551439
olegts@olegts:~$ cat yt_tmp_b7affb1-b5ae5ee6-100aa981-70 | tabgrep '$Counters == 87' | tabsort -nrk CounterOffers |head -10
# CounterOffers	Counters	UniqID	_yql_column_0


std::cout << "windows_count = " << windows_count << " size =  " << window_sizes[series_num]  << " series_num = " << ngramm_indices[series_num] << std::endl;
windows_count = 18 size =  83333.3 series_num = 19





$multiplier_delta_imp_exclude->{ $imp_id } = $page_imp_exp_params->{$pageimp_key}->{"cpm_multiplier_delta"}


Пн. марта 27 15:25:45 MSK 2017
0
Пн. марта 27 15:25:46 MSK 2017
1
Пн. марта 27 15:25:47 MSK 2017

alexpv,bahbka,behemot,dkulikovsky,italiano,keyd,saint,say,zahacker,yottatsa,slepovss,kiwi,olegts,pgriffin
Убийство просроченных запросов от mkdb

Пн. марта 27 17:25:13 MSK 2017

Пн. марта 27 17:25:14 MSK 2017
3784



Oleg Tsarkov:
	привет
insight:
	привет
Oleg Tsarkov:
	а можешь посоветовать пожалуйста библотеку умножения с матрицами?
	умножения матриц
	посоветовали у тебя спросить
insight:
	какой язык?
Oleg Tsarkov:
	плюсы
insight:
	#include <contrib/libs/intel/mkl/include/mkl.h>
	PEERDIR(
    contrib/libs/clapack
)
	матричное умножение - это cblas_sgemm / cblas_dgemm https://developer.apple.com/reference/accelerate/1513264-cblas_sgemm?language=objc
Oleg Tsarkov:
	а есть простой пример?
	использования
	библиотеки clapack
insight:
	а в целом гуглить BLAS
	простых примеров с этой штукой не бывает :(
	можешь посмотреть ads/quality/experiments/nn/lib/batch_ops.h:TLinearTransform
Oleg Tsarkov:
	кстати у меня специфика в том что тред только один
	в этом случае все равно лучше выбирать clapack?
insight:
	а без разницы
	я тоже в один поток как правило умножаю
	короче, как напишешь умножение - напиши тест что правильно написал, и матрицы желательно прямоугольные - так как легко ошибиться
	может есть обертки вокруг этого, конечно
	Eigen какой-нибудь
	я не использовал
	если ты матрицу на вектор умножаешь, там есть другая функция для этого, может быстрее отработает
	только не надо считать что ты clapack используешь. Там хитрый CMakeLists
	он mkl как правило собирает


Про кластера -- Олег Игнатьев


Ср. марта 29 10:50:43 MSK 2017

Ср. марта 29 10:50:44 MSK 2017
2


:q
vl_set_alloc_func

Пн. апр.  3 13:20:12 MSK 2017

Пн. апр.  3 13:20:13 MSK 2017
1

grep STAT knn.log  | perl -le 'use List::Util qw(min max ); while (my $line = <>) {chomp($line) ; my $data = [splice([split(/\t/, $line)], 1)]; my $nums = [splice(@$data, 2)]; my $min = min(@$nums);  my $max = max(@$nums); print("||" . join("|", @$data, map {$_ eq $min ?  "<#<span style=\"color: #00AA00\">$_</span>#>" : $_ eq $max ? "<#<span style=\"color: #AA0000\">$_</span>#>" : $_} @$nums) . "||")}'


Пн. апр.  3 18:25:10 MSK 2017
tags/stable-97-r9
Пн. апр.  3 18:25:11 MSK 2017
tags/stable-97-r9,tags/stable-98-r12
Пн. апр.  3 18:25:12 MSK 2017

[pid=21494->23022]  DB<12> x $exp_stat_mult
0  HASH(0x87c5f10)
   'AlienPrice' => 0
   'Clicks' => 81522000000
   'Cost' => 29218785434
   'CurMultiplier' => 9713115
   'ExperimentBits' => 0
   'FactorUpdateTime' => 20170401030000
   'Hits' => 3055039000000
   'ImpID' => 9
   'LostPrice' => 0
   'NormPrice' => 709749333682
   'PageID' => 93830
   'Price' => 509377778067
   'RealPrice' => 509389700570
   'Shows' => 7471647000000
   'StartTime' => 20170401030000
   'UpdateTime' => 20170403020000
   'WinHits' => 1788453000000


https://paste.yandex-team.ru/223967

>>> s
'QKG3Th6WbOauOLi4Y5M_3A'
uuid.UUID(bytes=base64.b64decode(s + '==', '_-')).hex
>>> uuid.UUID(bytes=base64.b64decode(s + '==', '_-')).hex
'40a1b74e1e966ce6ae38b8b863933edc'
>>> base64.b64encode(uuid.UUID(hex='40a1b74e1e966ce6ae38b8b863933edc').bytes, '_-').strip('==')
'QKG3Th6WbOauOLi4Y5M_3A'




 - https://a.yandex-team.ru/arc/trunk/arcadia/ads/bsyeti/eagle/services/eagle_handler.cpp?rev=2861014&blame=true

https://a.yandex-team.ru/arc/trunk/arcadia/ads/bsyeti/eagle/services/eagle_handler.cpp?rev=2773748&blame=true#L27 CollectProfile она возвращает wideProfile из него надо взять .Profile->Offers

https://a.yandex-team.ru/arc/trunk/arcadia/ads/bsyeti/eagle/wide_profile/wide_profile.h?rev=2738478&blame=true#L47

https://a.yandex-team.ru/arc/trunk/arcadia/yabs/proto/user_profile.proto?rev=2598608#L42

https://a.yandex-team.ru/arc/trunk/arcadia/ads/bsyeti/libs/profile/offer_map.h?rev=2667326&blame=true#L74

HasRecommendation -- только для таких офферов надо подбирать рекомендации

%%
for (auto& pair: wideProto.Profile->Offers) {
  offer = pair.second;
  proto = offet.Get();
  offer.HashRecommendation -- только для этих
}
%%

Тесты https://a.yandex-team.ru/arc/trunk/arcadia/ads/bsyeti/libs/profile/ut/merge_user_items_test.cpp?rev=2861014&blame=true
ads/bsyeti/libs один файл с одной функцией которая ищет новые товары.

это используется library/on_disk/st_hash



https://a.yandex-team.ru/arc/trunk/arcadia/ads/bsyeti/eagle/data/data.h?rev=2788926#L81
Тут добавляем подгрузку файла


Тут можно исопользовать переменную LocalData, чтобы использовать базку
https://a.yandex-team.ru/arc/trunk/arcadia/ads/bsyeti/eagle/services/eagle_handler.cpp?rev=2773748&blame=true#L25

класс должен быть thread-safe

Как запаковывать данные в бинраную базу:

Если пользователь зашел на сайт то рекомендации с него

Надо написать скрипт который скачивает данные и кладет из в базку

Потом надо будет положить скрипт в самогон

Пример такого скрипта https://a.yandex-team.ru/arc/trunk/arcadia/ads/bsyeti/scripts/dump_wordstat/main.cpp?rev=2861277&blame=true

вызовг https://a.yandex-team.ru/arc/trunk/arcadia/ads/bsyeti/samogon/plugin/wordstat.py?rev=2679126&blame=true#L22


https://a.yandex-team.ru/arc/trunk/arcadia/ads/bsyeti/libs/info_keeper/info_keeper.h тут тоже зашить название файла

Поднятие eagle

ya make -r && ./eagle --port 10003 --debug 0 -t 5 -c ../url_router/config.txt -u 10004 -x 10005
curl "localhost:10003/bigb?bigb-uid=123&pretty=1"
Саша Митин умеет расшифровывать OfferID

ads/bsyeti/eagle/daemon



statitic hash map https://a.yandex-team.ru/arc/trunk/arcadia/library/on_disk/st_hash/static_hash_map.h


+olegts

Кажется, базу для рекомендаций лучше всего будет сразу генерировать в сандбоксе - доставка делается 5 строчками кода.

--
Егор Хайруллин
http://staff.yandex-team.ru/mikari/

On 13 Apr 2017, at 03:11, Khayrullin Egor <mikari@yandex-team.ru> wrote:

Привет!

Мы сегодня как раз обсуждали про доставку ресурсов из сандбокса до eagle.

Оказывается, в самогоне уже есть такая штука. Можно запилить сервант, указать у него в зависимостях конкретные условия поиска в sandbox'е. Файл из ресурса будет скачиваться автоматически и будет доступен по симлинку /samogon/{key}/active/user/{servant_name}/internal/{package_name} (есть апи генерирующее большую часть пути, если что).
Эта штука будет сама ходить в sandbox, кэшировать его ответ для всего кластера и по необходимости скачивать данные.
Возможно, для некоторых целей нужно будет допилить (кажется, пока эта штука умеет только один файл из ресурса брать).

https://wiki.yandex-team.ru/samogon/FAQ/#kakdostavitstaticheskiedannyedoservanta

--
Егор Хайруллин
http://staff.yandex-team.ru/mikari/

'::google::protobuf::RepeatedPtrField< ::yabs::proto::Profile_ProfileItem> *' to 'TStorage *' (aka 'google::protobuf::RepeatedPtrField<yabs::proto::Profile_OfferProfile> *'

google::protobuf::RepeatedPtrField<iyabs::proto::Profile_ProfileItem> *
google::protobuf::RepeatedPtrField<yabs::proto::Profile_OfferProfile> *'

order_9076069_events_20170403


BroadMatchBanner
BroadMatchOrderExperiment
//yabs/BMBannerExp
//yabs/OrderTimeExpBMStat

Пт. апр. 14 11:40:59 MSK 2017

Пт. апр. 14 11:41:00 MSK 2017
1

1
Пт. апр. 14 12:15:43 MSK 2017
1
Пт. апр. 14 12:15:44 MSK 2017
0
NBSYeti
i
Пт. апр. 14 13:15:43 MSK 2017
1
Пт. апр. 14 13:15:45 MSK 2017
0

Egor Khairullin, [14 апр. 2017 г., 14:02]:
select_type - нужно создать новый select_type

и написать его в ads/bsyeti/libs/constants.h

0.7
0

Пн. апр. 17 13:06:02 MSK 2017

Пн. апр. 17 13:06:03 MSK 2017
1

/home/olegts/arc/trunk/arcadia/ads/bsyeti/libs/fast_recommendations

2017-04-17 13:13:07 status installed yabs-autobudget2 109.2


Пн. апр. 17 16:50:51 MSK 2017
0
Пн. апр. 17 16:50:52 MSK 2017
1
Пн. апр. 17 16:50:54 MSK 2017

 !!! PRODUCTION !!! root@bstat148i.yandex.ru [yabsdb]> select 310000000/7/1e6*4;
+--------------------+
| 310000000/7/1e6*4  |
+--------------------+
| 177.14285714285714 |
+--------------------+
1 row in set (0.00 sec)

[pid=24934->25577]  DB<17> x $pr_stat->{cost}
0  176255.541910268
[pid=24934->25577]  DB<18> x $pr_stat->{clicks}
0  0.0120242888873432

[pid=24934->18279]  DB<17> x $astat
0  ARRAY(0x14d816d0)
   0  0.0110210752281295
   1  161550.142795763
   2  170862.128783829
   3  26894939.044988617
   4  0.0170862128697967
   5  empty slot
   6  empty slot
   7  1492084800
d
3885231190,9,9;14928650

7 число кликов
10 средняя цена
0.27 средняя цена
0.189000 кликов


2017-04-18 16:57:20 status unpacked yabs-yt-api 000.129
2017/04/18 17:14:02 118317 INFO  [yabs_file_lock] locked

3756896260715038659

(Pdb) p event[2].content_group_id
15586038244727173835L


set([(parent_id=3121694289333262498,start_time=1491964200,start_time=1491964200,stop_time=1491975005,stop_time=1491975005,content_type_id=16,name=,comment=,options=set([]),content_group_id=3756896260715038659,service_flag=set([]),ovs_status=set([]),agreement_id=28,target_id=0)])
(Pdb) n
> /home/olegts/miniconda2/envs/video-hosting/lib/python2.7/site-packages/cms_common/services/black_window_applier.py(86)periodic_action()
-> if len(timepoint_black_windows) == 0:
(Pdb) p timepoint_black_windows
set([])
(Pdb) p event[2]
(parent_id=3121694289333262498,start_time=1491964200,start_time=1491964200,stop_time=1491975000,stop_time=1491975000,content_type_id=16,name=,comment=,options=set([]),content_group_id=15586038244727173835,service_flag=set([]),ovs_status=set([]),agreement_id=28,target_id=0)


приоритеты рекоммендаций, поле Priority https://yt.yandex-team.ru/hahn/#page=navigation&path=//home/bs/stat/ECommerceStat/201704/ECommerceStat20170401&offsetMode=row
https://yt.yandex-team.ru/hahn/#page=navigation&path=//home/bs/ads/ecom/Offer2Vec/201704/Offer2Vec20170402&offsetMode=row


vim arc/trunk/arcadia/kikimr/yql/ci/udfs_deps/ya.make


высокий - 13087909. 0
Низкий - 13082791 12787481


┌──OrderID─┬─sum(Clicks)─┐
│ 13082791 │         534 │
│ 13087909 │         380 │

:) select sum(arraySum(id,attr, num -> if(id = 12787481 and attr = 1, num, 0), GoalsMap.ID, GoalsMap.Num, GoalsMap.Num)) as Actions from OrderCounter where OrderID = 13082791 and EventDate = '2017-04-21' group by OrderID;

SELECT sum(arraySum((id, attr, num) -> if((id = 12787481) AND (attr = 1), num, 0), GoalsMap.ID, GoalsMap.Num, GoalsMap.Num)) AS Actions
FROM OrderCounter
WHERE (OrderID = 13082791) AND (EventDate = '2017-04-21')
GROUP BY OrderID

┌─Actions─┐
│       2 │



:) select sum(arraySum(id,attr, num -> if(id = 0 and attr = 1, num, 0), GoalsMap.ID, GoalsMap.Num, GoalsMap.Num)) as Actions from OrderCounter where OrderID = 13087909 and EventDate = '2017-04-21' group by OrderID;

SELECT sum(arraySum((id, attr, num) -> if((id = 0) AND (attr = 1), num, 0), GoalsMap.ID, GoalsMap.Num, GoalsMap.Num)) AS Actions
FROM OrderCounter
WHERE (OrderID = 13087909) AND (EventDate = '2017-04-21')
GROUP BY OrderID

┌─Actions─┐
│     387 │
└─────────┘


14253552

 !!! PRODUCTION !!! root@bstat148i.yandex.ru [yabsdb]> select sum(ClearValue) from AutoBudgetCoeffs where UpdateInterval = 3600 and UpdateTime >= '2017-04-21' and UpdateTime <= '2017-04-23 23:59:59';
+---------------------+
| sum(ClearValue)     |
+---------------------+
| 0.37781065166927874 |
+---------------------+
1 row in set (0.00 sec)

 !!FF! PRODUCTION !!! root@bstat148i.yandex.ru [yabsdb]> select StartTime,LimitWeek/1e6 from AutoBudgetOrder where OrderID = 14253552\G
*************************** 1. row ***************************
    StartTime: 2017-04-21 00:20:00
LimitWeek/1e6: 57190
1 row in set (0.12 sec)


 !!! PRODUCTION !!! root@bstat148i.yandex.ru [yabsdb]> select 57190 * 0.37781065166927874;
+-----------------------------+
| 57190 * 0.37781065166927874 |
+-----------------------------+
|     21606.99116896605114060 |
+-----------------------------+
1 row in set (0.00 sec)

:) select sum(Cost)/1e6 from OrderCounter where OrderID = 14253552 and EventDate = '2017-04-21';

SELECT sum(Cost) / 1000000.
FROM OrderCounter
WHERE (OrderID = 14253552) AND (EventDate = '2017-04-21')

┌─divide(sum(Cost), 1000000.)─┐
│                      1540.5 │
└─────────────────────────────┘
→ Progress: 168.41 thousand rows, 2.36 MB (23.23 million rows/s., 325.17 MB/s.)
1 rows in set. Elapsed: 0.007 sec. Processed 168.41 thousand rows, 2.36 MB (23.12 million rows/s., 323.69 MB/s.)

:)


 !!! PRODUCTION !!! root@bstat148i.yandex.ru [yabsdb]> select sum(ClearValue) from AutoBudgetCoeffs where UpdateInterval = 3600 and UpdateTime >= '2017-04-21' and UpdateTime <= '2017-04-21 19:30:00';
+---------------------+
| sum(ClearValue)     |
+---------------------+
| 0.11823132639983669 |
+---------------------+
1 row in set (0.00 sec)


 !!! PRODUCTION !!! root@bstat148i.yandex.ru [yabsdb]> select sum(ClearValue) from AutoBudgetCoeffs where UpdateInterval = 3600 and UpdateTime >= '2017-04-17' and UpdateTime <= '2017-04-21 19:30:00';
+--------------------+
| sum(ClearValue)    |
+--------------------+
| 0.7404206689097919 |
+--------------------+
1 row in set (0.00 sec)


784
870
884
920
922
940
942
968

 !!! PRODUCTION !!! root@bstat148i.yandex.ru [yabsdb]> select sum(ClearValue) from AutoBudgetCoeffs where UpdateInterval = 3600 and UpdateTime >= '2017-04-17' and UpdateTime <= '2017-04-21 00:00:00';
+--------------------+
| sum(ClearValue)    |
+--------------------+
| 0.6249002215918154 |
+--------------------+
1 row in set (0.00 sec)
v
 !!! PRODUCTION !!! root@bstat148i.yandex.ru [yabsdb]> select 0.6249002215918154 * 57190;
+----------------------------+
| 0.6249002215918154 * 57190 |
+----------------------------+
|     35738.0436728359227260 |
+----------------------------+
1 row in set (0.00 sec)

18673.7650064873


 !!! PRODUCTION !!! root@bstat148i.yandex.ru [yabsdb]> select BannerID,PhraseID,ResultFlatCost/1e6,ContextPriority,BannerPriority from PhrasePrice inner join Banner148 using(BannerID)  where PhrasePrice.OrderID = 14253552 and !find_in_set('deleted', PhrasePrice.Options);
+------------+----------+--------------------+-----------------+----------------+
| BannerID   | PhraseID | ResultFlatCost/1e6 | ContextPriority | BannerPriority |
+------------+----------+--------------------+-----------------+----------------+
| 3646174410 |        9 |               0.06 |               0 |              1 |
| 3646174411 |        9 |               1.93 |               0 |              1 |
| 3646174469 |        9 |               0.06 |               0 |              1 |
| 3646174702 |        9 |               1.93 |               0 |              1 |
| 3646174703 |        9 |               0.06 |               0 |              1 |
| 3646174704 |        9 |               1.93 |               0 |              1 |
| 3646174718 |        9 |               0.06 |               0 |              1 |
| 3646174719 |        9 |               1.93 |               0 |              1 |
| 3833960866 |        9 |               2.65 |              20 |              1 |
| 3833960867 |        9 |                  2 |               0 |              1 |
| 3833964609 |        9 |               2.65 |               0 |              1 |
| 3833978688 |        9 |                  2 |              20 |              1 |
| 3833978689 |        9 |               2.65 |              20 |              1 |
| 3834007715 |        9 |                  2 |              20 |              1 |
| 3834010728 |        9 |                  2 |               0 |              1 |
| 3834020873 |        9 |               2.65 |               0 |              1 |
+------------+----------+--------------------+-----------------+----------------+


/home/olegts/arc/trunk/arcadia/ads/bsyeti/scripts/make_fast_recommendations_bin_base

Пн. апр. 24 14:05:55 MSK 2017

Пн. апр. 24 14:05:57 MSK 2017
1

ЧП. Расследование и сериалы

2928670982952130415

 !!! PRODUCTION !!! root@bsdb02f.yandex.ru [vh]> select *from VendorData where Vendor='ntv.ru' and StartDownloadTime <= '2017-04-14 14:01:54' + interval 5 minute and '2017-04-14 14:01:54' <= StopDownloadTime + interval 5 minute;
+--------+---------------------+---------------------+-----------------------+---------------------+---------------------+
| Vendor | StartDownloadTime   | StopDownloadTime    | DataName              | CreateTime          | UpdateTime          |
+--------+---------------------+---------------------+-----------------------+---------------------+---------------------+
| ntv.ru | 2017-04-14 13:57:15 | 2017-04-14 13:57:45 | 1492167435_1492167465 | 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |
| ntv.ru | 2017-04-14 14:01:15 | 2017-04-14 14:01:44 | 1492167675_1492167704 | 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |
| ntv.ru | 2017-04-14 14:05:15 | 2017-04-14 14:05:46 | 1492167915_1492167946 | 0000-00-00 00:00:00 | 0000-00-00 00:00:00 |
+--------+---------------------+---------------------+-----------------------+---------------------+---------------------+
3 rows in set (0.17 sec)

 !!! PRODUCTION !!! root@bsdb02f.yandex.ru [vh]> select * from ContentGroup where ContentGroupID= 2928670982952130415\G
*************************** 1. row ***************************
     ContentGroupID: 2928670982952130415
      ContentTypeID: 8
           ParentID: 165918585174792679
            Comment:
               Name:
            Options:
          OvsStatus:
	TMP_OvsServiceFlags:
		       UUID: 4a9381376e9d1dc2bb590614b78889dc
		 CreateTime: 2017-04-14 14:01:54
		 UpdateTime: 2017-04-14 18:28:00
		AgreementID: 0
		   TargetID: 0
	1 row in set (0.00 sec)





	mysql> select OrderID, MaxCost/1e6,LimitWeek/1e6  from AutoBudgetOrder where OrderID in (13079128,13080614,13080366,14253552) order by 1;
	+----------+-------------+---------------+
	| OrderID  | MaxCost/1e6 | LimitWeek/1e6 |
	+----------+-------------+---------------+
	| 13079128 |        0.13 |          2469 |
	| 13080366 |        0.09 |          2690 |
	| 13080614 |       10.74 |        134221 |
	| 14253552 |        5.85 |         57190 |
	+----------+-------------+---------------+
	4 rows in set (0.00 sec)

	mysql> select OrigOrderID ,sum(CounterType = 1 ) as Shows, sum(CounterType =2) as Clicks, round(sum(CounterType = 2) / sum(CounterType = 1)  * 100,2) as CTR ,round(sum(EventCost/1e6),2) as Cost, truncate(sum(EventCost/1e6)/sum(CounterType=2), 2) as RealCPC,  truncate(sum((SourceCost * (CounterType = 2)/1e6))/sum(CounterType=2),2 ) as SourceCPC from order_uk_20170424 where FraudBits = 0  group by OrigOrderID ;
	+-------------+--------+--------+------+---------+---------+-----------+
	| OrigOrderID | Shows  | Clicks | CTR  | Cost    | RealCPC | SourceCPC |
	+-------------+--------+--------+------+---------+---------+-----------+
	|    13079128 |    432 |      7 | 1.62 |    0.69 |    0.09 |      0.09 |
	|    13080366 |   2147 |     21 | 0.98 |    1.71 |    0.08 |      0.07 |
	|    13080614 | 121481 |    155 | 0.13 | 1341.42 |    8.65 |     10.30 |
	|    14253552 | 499417 |    450 | 0.09 | 2327.00 |    5.17 |      4.64 |
	+-------------+--------+--------+------+---------+---------+-----------+
	4 rows in set (1.12 sec)

	13079128: CTR=0.2%, APC=38,48%. Ожидалось получить 25% трафика, это 234 319 показов.
	13080366: CTR=0.13%, APC= 35,32%. Ожидалось получить 25% трафика, это 234 319 показов.
	13080614: CTR=0.13%, APC=0.71%. Ожидалось получить 25% трафика, это 234 319 показов.
	14253552: CTR=0.1%, APC=1.66%. Ожидалось получить 25% трафика, это 234 319 показов.


	1) двойной дневной бюджет OK
	2) netcpcoptimize без дневного OK
	3) нет стратегии OK
	4) стратегия недельного бюджета с упиранием в geid OK
	6) проверить, что неинициализация АБ параметров в пределах функции load_order_stat не вызывает проблем (вызввает, исправлено) OK

	8) собрана ли нужная статистика для компаний - детей, которые не являются Автобюджетными? OrderStatCurDay кажется не собрана
	7) все ли поля автобюджета, инициализированнные раннее в OrderInfo, можно переписывать ? (вопрос про if ($chosen_orderstat->{$oid}->[$O_STARTTIME] < $start) {)
	5) проверить что проблемы не будут просто так экспортироваться для неАвтобюджетных компаний (ждем ответ от Кашина) ответ: не надо править


	orderid = 11123578
	baseno = 137
	CostCur=59000.0 is more than MaxCostCur=48000 * coef=1.180
	Вт. апр. 25 00:00:00 MSK 2017


	simdistanct = 25


	Кирилл Лабетов: Миша Чичварин
	Федор Строк: Шестимеров Андрей, Антон Полднев
	Лена Сысоева: Илья Никитин
	Виталий Суворов: Тимур Власов
	Павел Мельничук: Сергей Кальсин
	Олег Смоляков: Андрей Сагулин

	привет, от Олега (saint) поступила просьба спросить хочешь ли ты, чтобы Миша Чичварин принимал участие в дежурстве за кандидатами. Если да, то хочется, чтобы правила дежурства написанные тут https://wiki.yandex-team.ru/users/olegts/bannernajakrutilka/interview/ были устно проговорены.

	привет, от Олега (saint) поступила просьба спросить хочешь ли ты, чтобы Шестимеров Андрей, Антон Полднев принимали участие в дежурстве за кандидатами. Если да, то хочется, чтобы правила дежурства написанные тут https://wiki.yandex-team.ru/users/olegts/bannernajakrutilka/interview/ были устно проговорены.
	привет, от Олега (saint) поступила просьба спросить хочешь ли ты, чтобы Илья Никитин принимал участие в дежурстве за кандидатами. Если да, то хочется, чтобы правила дежурства написанные тут https://wiki.yandex-team.ru/users/olegts/bannernajakrutilka/interview/ были устно проговорены.

	привет, от Олега (saint) поступила просьба спросить хочешь ли ты, чтобы Тимур Власов принимал участие в дежурстве за кандидатами. Если да, то хочется, чтобы правила дежурства написанные тут https://wiki.yandex-team.ru/users/olegts/bannernajakrutilka/interview/ были устно проговорены.

	привет, от Олега (saint) поступила просьба спросить хочешь ли ты, чтобы Сергей Кальсин принимал участие в дежурстве за кандидатами. Если да, то хочется, чтобы правила дежурства написанные тут https://wiki.yandex-team.ru/users/olegts/bannernajakrutilka/interview/ были устно проговорены.

	привет, от Саши поступила просьба спросить тебя хочешь ли ты, чтобы Андрей Сагулин принимал участие в дежурстве за кандидатами. Если да, то хочется, чтобы правила дежурства написанные тут https://wiki.yandex-team.ru/users/olegts/bannernajakrutilka/interview/ были устно проговорены c Андреем.


	Egor Khairullin, [25 апр. 2017 г., 21:38]:
	ну, sandbox ресурсы - это про продакшен

	для разработки и впиливания в eagle это знать не нужно

	на bsnewbt01i eagle можно запустиь вот так:

	ya make -r && ./eagle --port 10003 --debug 1 -t 5 -c ../url_router/config.txt -u 10004 -x 10005

	где eagle - ads/bsyeti/eagle/daemon

	дергать: curl "localhost:10003/bigb?bigb-uid=1234567&pretty=1"

	0.069566
	0.167171
	0.057012
	0.019914
	0.019922

	0.186216
	0.024241
	0.021082
	0.01828
	0.035688

	eportid = 22249934
	orderid = 11703799
	goalid = 2312892

	orderid = 11702657
	baseno = 89

	2017/04/28 13:32:23 19784 INFO  [  calc_eis_eic] Order 11702657 money coeffs: corr 3.0000, shift 0.8000, final 0.0090
	2017/04/28 13:32:23 19784 INFO  [  calc_eis_eic] Order 11702657 money overdraft = -13%, balance_by_plan = 4214.02$, balance = 6172.75$
	2017/04/28 13:32:23 19784 INFO  [_get_contract_] Order 11702657 prev week correction (is_full_cost = 0): actions += 7.14753476660628 * 1
	2017/04/28 13:32:24 19784 WARN  [      calc_eir] Order 11702657 has negative reserve -1494.44$  (Yabs::AutoBudget::Limitations @/usr/share/perl5/Yabs/AutoBudget/Limitations.pm:753)
	2017/04/28 13:32:24 19784 INFO  [      calc_eir] Order 11702657 reserve 0.00$, reserve overdraft 0.13, eir 0.0000, is_full_cost$
	2017/04/28 13:32:24 19784 INFO  [_get_contract_] Order 11702657 prev week correction (is_full_cost = 1): actions += 16.6741666666667 * 1
	2017/04/28 13:32:24 19784 INFO  [      calc_eir] Order 11702657 reserve -1496.93$, reserve overdraft 0.13, eir -13.0080, is_full_cost$
	2017/04/28 13:32:24 19784 INFO  [get_avg_strate] Calc max cost using sigma: value = 882982.602507563 (x = -0.184917948717949, real_reserve = -1494438809.3294, avg_cost = 326746.5978744, amnesty_adj = 2, real_spent = 55, bottom = 1.01, top = 2)
	2017/04/28 13:32:24 19784 INFO  [limit_max_cost] Change maxcost from 15000000 to 890000




	relevance match orderid = 11404491
	baseno = 52

	│ 2017-04-24 │           8367.849999999982 │
	│ 2017-04-25 │           7505.499999999963 │
	│ 2017-04-26 │           7173.909999999967 │
	│ 2017-04-27 │           6683.219999999983 │
	│ 2017-04-28 │           3099.269999999997 │
	└────────────┴─────────────────────────────┘


	125 1111101
	625 1001110001

	ВЕЧЕРА

	1) ссылка на задачу http://codeforces.com/contest/793/problem/B
	 код задачи /home/olegts/contest8/2.cpp
	 проблема -- неправильно аллоцированная память
	 дейкстра с priority_queue http://e-maxx.ru/algo/dijkstra_sparse
	 почему нельзя использовать глубину/ширину ? потому что более коротким по весу может оказаться более длинный путь
	 тест с воспроизведением проблемы-- надо зайти сюда http://codeforces.com/problemset/customtest
	ввод
	5 5
	..S..
	****.
	T....
	****.
	.....
	 простые альтернативы
	   : 0-1 поиск в ширину http://e-maxx.ru/algo/bfs
	   : в вершину внести расстояние до нее. -- тогда не будет циклов

	Ошибка с кешом гана
	Ошибка с сортируюшимися нулями
	Ошибка в свн
	Парсер

	https://codesearch.viewer.yandex-team.ru/#!aggregator_name.*Archive,,j,arcadia,yabs-anomalies-analyzer
	https://a.yandex-team.ru/arc/trunk/arcadia/yabs/utils/yabs-alerts/Yabs/Alerts/SeriesMonitoring/PostGeneration/AntiFraud.pm?rev=2901999&blame=true#L46
	https://a.yandex-team.ru/arc/trunk/arcadia/yabs/utils/yabs-alerts/Yabs/Alerts/SeriesMonitoring/PostGeneration/Common/StrategyMonitoring.pm?rev=2901999&blame=true#L36
	https://a.yandex-team.ru/arc/trunk/arcadia/yabs/utils/yabs-alerts/Yabs/Alerts/SeriesMonitoring/PostGeneration/Common/StrategyMonitoring.pm?rev=2901999&blame=true#L36


	strgetbit?

	String::Substring(String::BinText(String::Substring(x, bit / 8, 1)), bit % 8, 1)

	and (YQL::Unwrap(YQL::FromBytes(substring(coalesce(L.widefraudbits, ''),cast(coalesce(84/8, 0) as uint32),1),AsAtom('Byte'))) & (1u << cast(coalesce(84 % 8, 0) as byte))) > 0

	1) antifraud mobile_pagesGi
	2) antifraud event_flags

	Надо будет ресторить Fi


	wildberries 17 апреля (только protected но сняли ее позже)
	filter-log
	performance-log
	dsp-log

	[
	    [
		"contextid",
		"320947328"
	    ],
	    [
		"contexttype",
		"8"
	    ],
	    [
		"producttype",
		"media-smart"
	    ],
	    [
		"bannerid",
		"4052890041"
	    ]
	]


	ВЕЧЕРА

	Кейс с мисаггрегацией
	https://a.yandex-team.ru/arc/trunk/arcadia/yabs/stat/bsint/yabs_sync/Yabs/StrategyMonitoring/DSP.pm?rev=2904395&blame=true#L101

	mysql>  select BannerID,PhraseID,sum(EventCost)/1e6  from order_search_clicks where FraudBits =0 and CounterType =2 group by 1 order by 3 desc limit 10;
	+-----------+------------+--------------------+
	| BannerID  | PhraseID   | sum(EventCost)/1e6 |
	+-----------+------------+--------------------+
	| 440487056 |   29886816 |         428.183489 |
	| 440486963 | 1473882820 |          142.37093 |
	| 440487084 |   29862071 |          83.201798 |
	| 440484955 | 1473834053 |          52.132401 |
	| 440484942 |  440969281 |          43.052107 |
	| 440484987 |   19638532 |             40.651 |
	| 440484948 |    8404258 |          19.442467 |
	| 440487112 |   25128621 |          18.750201 |
	| 440484928 |   58577550 |          17.574133 |
	| 440484994 |  233504220 |          14.216981 |
	+-----------+------------+--------------------+
	10 rows in set (0.00 sec)


	bannerid = 440487056
	phraseid = 29886816
	:q
	Жй




	ВЕЧЕРА

	https://st.yandex-team.ru/SUPBS-9829


	1) есть ли stopwatch
	2) холостые запросы

	    not ok 1 - Ожидаемая ошибка 'Failed to find best covering BidReq for object 11 (perhaps its BidReqID is not in archive yet): не поймана
		not ok 1 - action result common check: Вызываемый код вернул ошибку
	    not ok 3 - action_result
	not ok 3 - missed-object-yabs-dsp
		    not ok 1 - ключ QueueID=1: отсутствует
		not ok 1 - таблица yabsdb.DSPObjectModerationQueue
		    not ok 2 - ключ DataMD5=20: отсутствует
		not ok 2 - таблица yabsdb.DSPObjectModerating
	    not ok 2 - mysql
		    not ok 1 - ключ DataMD5=10: значения отличаются
		    not ok 2 - ключ DataMD5=20: значения отличаются
		not ok 1 - таблица //yabs/DSP/DSPObjectStatQueue
	    not ok 4 - yt_tables
	not ok 10 - yt_get
		    not ok 1 - ключ QueueID=1: отсутствует
		not ok 1 - таблица yabsdb.DSPObjectModerationQueue
		    not ok 1 - ключ DataMD5=18446744073709551605: отсутствует
		    not ok 2 - ключ DataMD5=18446744073709551615: отсутствует
		not ok 2 - таблица yabsdb.DSPObjectModerating
	    not ok 2 - mysql
		    not ok 1 - ключ DataMD5=18446744073709551605: значения отличаются
		    not ok 2 - ключ DataMD5=18446744073709551615: значения отличаются
		not ok 1 - таблица //yabs/DSP/DSPObjectStatQueue
	    not ok 4 - yt_tables
	not ok 12 - yt_get_interval


	# 2017/05/12 15:28:01 18254 INFO  [_load_full_bid] Loading 1 BidReqs from time intervals [20141010010101,20141010010101]
	# 2017/05/12 15:28:01 18254 INFO  [_load_full_bid] Load from DspObject (archive): [20141010010101, 20141010010101]
	# 2017/05/12 15:28:01 18254 INFO  [_load_full_bid] Got 2 md5 data hashes from archive
	# 2017/05/12 15:28:01 18254 INFO  [_load_full_bid] Load from Rtb (archive): [20141010010101, 20141010010101]

	/noh



	gemini

	watchlog url + counter_id

	уже есть таблица на сенеке (которая заполнена через gemini)
	counter_id + url -> offer_id

	watchlog
	Нужна таскка mr которая сама ходит в эту таблицу, брать урлы из метрики, нормализует их и подставляет
	Нужна таска, которая переносит таблицу на hahn

	OfferUrlDict

	Egor Khairullin, [12 мая 2017 г., 18:12]:
	OfferUrlDict

	Egor Khairullin, [12 мая 2017 г., 18:12]:
	Можешь по ads/bsyeti/bsyeti грепнуть слово Gemini

	Там есть GeminiOfferExtractor.pm


	 /etc/yabs-spark/apps/apps.conf
	/etc/yabs-spark/app.conf
	 /etc/yabs-spark/scheduler.conf

	https://bs-mg.yandex-team.ru/render/?from=-24hours&height=863&width=1613&_salt=1494846766.988&showTarget=sumSeries(five_min.bsyeti*_yandex_ru.profiler.gemini.normalized.sum)&target=sumSeries(five_min.bsyeti*yandex_ru.profiler.gemini.lost.sum)&target=sumSeries(five_min.bsyeti*_yandex_ru.profiler.gemini.normalized.sum)

	1456897248



	not ok 3 - collect-premoderated-old
	not ok 7 - collect-premoderated-old


	Вт. мая 16 16:55:41 MSK 2017

	Вт. мая 16 16:55:42 MSK 2017
	0
	Вт. мая 16 16:55:44 MSK 2017:q


	1494957153
	Вт. мая 16 20:52:59 MSK 2017 пропатчен коллектор moderation-лога чтобы не сбрасывать строчки на undef
	2017-05-16 22:04:11.674817659 патч против нулевых строк


	for host in bstat02i.yandex.ru bstat109h.yandex.ru bstat47i.yandex.ru bstat61i.yandex.ru bstat76i.yandex.ru bstat80i.yandex.ru bstat84i.yandex.ru; do  for service in hoststate logcount-ng mkdb_check; do jctl add downtime -host $host -service $service -stop +4hours; echo "Done $host $service";done;done


	  Wrong aligned block at 107994947

	sudo mv /home/yabs/stat/bs-log/bsfront0061f/hit.15484053257898723302.MYD.20170517111004   /home/yabs/stat/bs-log/bsfront0061f/bad.hit.15484053257898723302.MYD.20170517111004


	2017/05/17 18:28:17 755243 DEBUG [_process_slice] [YTDSPObjectStat] [slice 029] got write transaction: 16471b04-400000c3-3f80002-0
	2017/05/17 18:28:50 755243 INFO  [apply_to_yt_ta] [YTDSPObjectStat] [slice 029] Done Lookup


	bstat02h.yandex.ru,bstat44h.yandex.ru,bstatx1.yandex.ru,bstat75h.yandex.ru,bstat109h.yandex.ru,bstat119h.yandex.ru,bstat128h.yandex.ru



	:) select min(PartnerStatID),max(PartnerStatID) from DSPStat;

	SELECT
	    min(PartnerStatID),
	    max(PartnerStatID)
	FROM DSPStat

	┌─min(PartnerStatID)─┬─max(PartnerStatID)─┐
	│                  0 │         1075552985 │
	└────────────────────┴────────────────────┘
	:) select count(*) from DSPStat;

	SELECT count(*)
	FROM DSPStat

	┌────count()─┐
	│ 7143584805 │
	└────────────┘


	:w


	https://a.yandex-team.ru/arc/trunk/arcadia/yabs/stat/yabs-autobudget2/Yabs/AutoBudget/LoadData.pm?rev=2913613&blame=true#L3583
	https://a.yandex-team.ru/arc/trunk/arcadia/yabs/stat/yabs-autobudget2/Yabs/AutoBudget/LoadData.pm?rev=2913613&blame=true#L3603

	1) marginal_cost для goal и roi !!!!
	2) adjusted_quality (в выпуклой оболочке не используется)
	3) _get_banner_phrase_contract_actions (только если не
	4)  _get_contract_actions
	5) apply_apc_forecast_array -> gid_hash
	6) apply_ppc_forecast_array -> gid_hash


	use hahn; select dspeventflags, count(*) as event_count  from [//home/logfeller/logs/bs-dsp-log/1h/2017-05-18T12:00:00] where dspid == "1" and adtype == "media-performance" group by dspeventflags order by event_count desc;

	use hahn; select creativeid, count(*) as event_count  from [//home/logfeller/logs/bs-dsp-log/1h/2017-05-18T12:00:00] where dspid == "1" and adtype == "media-performance" and (cast(dspfraudbits as uint64) & (262144ul)) > 0  group by creativeid order by event_count desc;

	Query OK, 1 row affected (0.00 sec)
	Rows matched: 1  Changed: 1  Warnings: 0



	6651

	ВЕЧЕРА
	обход дерева + цикл


	GroupOrderID
	AgencyID
	ClientID
	UserID
	OrderResourceID
	CurrencyDate
	CurrencyID
	OrderType
	PriceType
	CounterType
	BaseNo
	Options
	AutoStop
	Complete
	KeepActive
	Exported
	StrategyMinPrice
	ManagerID
	ProductID
	ExportID
	EngineID
	ContextID
	TimeZoneID
	HolidayRegionID
	TaxID
	DiscountID
	ReservedTime
	State
	BillingState
	TaxesIncluded
	CounterID
	AttributionType
	ContentType






 !!! PRODUCTION !!! root@bstat54h.yandex.ru [yabsdb]> select OrderID,GroupExportID,count(*) from GroupABPrice54_129467_1 inner join Banner54 using(OrderID,GroupExportID) group by OrderID,GroupExportID order by 3 desc limit 10;
+----------+---------------+----------+
| OrderID  | GroupExportID | count(*) |
+----------+---------------+----------+
|  9337945 |    1545309712 | 77573720 |
|  9337945 |    2542348736 | 31927352 |
| 10176587 |    1682638220 |   451185 |
| 10176587 |    2511550627 |   180740 |
| 10176587 |    2511535739 |   180705 |
| 10176587 |    2511561743 |   124250 |
| 10176587 |    2511567947 |   124215 |
| 10176587 |    2511558285 |   124180 |
| 11405025 |    1983823663 |    80881 |
|  9259373 |    1530345096 |    64872 |
+----------+---------------+----------+
10 rows in set (1 min 55.94 sec)


x $banner_phrases->get_params_hash('212662662,352042207,1;2851661')->{"hits"}


ВЕЧЕРА
Условие задачи http://codeforces.com/contest/810/problem/D
Плохое решение /home/olegts/contest10/4_bad.cpp
Хорошее решение /home/olegts/contest10/4.cpp


AnalyzerInitialParamsPatches
AnalyzerInitialParams



order_visits_14106800
order_visits_4640165
order_visits_uniq_3748190521453146285





mysql> select GoalID,sum(Type = 1) - sum(Type= 0) from order_visits_4640165 where AttributionType = 2 and GoalID != 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+----------+------------------------------+
| GoalID   | sum(Type = 1) - sum(Type= 0) |
+----------+------------------------------+
|  8486810 |                           11 |
| 10428688 |                            1 |
| 11606176 |                            1 |
| 12455731 |                            1 |
| 12455756 |                            1 |
| 12455761 |                            1 |
| 18988750 |                            2 |
| 18995130 |                            1 |
| 20298545 |                           18 |
| 20298550 |                           13 |
| 27099579 |                            2 |
| 28501134 |                            1 |
+----------+------------------------------+
12 rows in set (0.01 sec)

mysql> select GoalID,sum(Type = 1) - sum(Type= 0) from order_visits_14106800 where AttributionType = 2 and GoalID != 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+---------+------------------------------+
| GoalID  | sum(Type = 1) - sum(Type= 0) |
+---------+------------------------------+
| 8486810 |                           59 |
| 8486815 |                            2 |
| 8486820 |                            1 |
| 8486825 |                            3 |
| 8486835 |                            1 |
+---------+------------------------------+
5 rows in set (0.00 sec)

mysql> select CounterID,sum(Type = 1) - sum(Type= 0) from order_visits_4640165 where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+-----------+------------------------------+
| CounterID | sum(Type = 1) - sum(Type= 0) |
+-----------+------------------------------+
|  22227335 |                            6 |
|  29122950 |                           11 |
|  36593310 |                           19 |
+-----------+------------------------------+
3 rows in set (0.01 sec)

mysql> select CounterID,sum(Type = 1) - sum(Type= 0) from order_visits_14106800 where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+-----------+------------------------------+
| CounterID | sum(Type = 1) - sum(Type= 0) |
+-----------+------------------------------+
|  29122950 |                           59 |
+-----------+------------------------------+
1 row in set (0.01 sec)

mysql> select Domain,sum(Type = 1) - sum(Type= 0) from order_visits_4640165 where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+------------------+------------------------------+
| Domain           | sum(Type = 1) - sum(Type= 0) |
+------------------+------------------------------+
| gibdd.ru         |                            1 |
| mail.yandex.ru   |                            2 |
| mobile.yandex.ru |                           11 |
| pass.yandex.ru   |                            1 |
| ru.wikipedia.org |                            1 |
| yandex.ru        |                           18 |
| youtube.com      |                            2 |
+------------------+------------------------------+
7 rows in set (0.01 sec)

mysql> select Domain,sum(Type = 1) - sum(Type= 0) from order_visits_14106800 where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+------------------+------------------------------+
| Domain           | sum(Type = 1) - sum(Type= 0) |
+------------------+------------------------------+
| mobile.yandex.ru |                           59 |
+------------------+------------------------------+
1 row in set (0.01 sec)



mysql> select Domain,sum(Type = 1) - sum(Type= 0) from order_visits_4640165 where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+------------------+------------------------------+
| Domain           | sum(Type = 1) - sum(Type= 0) |
+------------------+------------------------------+
| gibdd.ru         |                            1 |
| mail.yandex.ru   |                            2 |
| mobile.yandex.ru |                           11 |
| pass.yandex.ru   |                            1 |
| ru.wikipedia.org |                            1 |
| yandex.ru        |                           18 |
| youtube.com      |                            2 |
+------------------+------------------------------+
7 rows in set (0.01 sec)

mysql> select Domain,sum(Type = 1) - sum(Type= 0) from order_visits_14106800 where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+------------------+------------------------------+
| Domain           | sum(Type = 1) - sum(Type= 0) |
+------------------+------------------------------+
| mobile.yandex.ru |                           59 |
+------------------+------------------------------+
1 row in set (0.01 sec)


mysql> select PageID,Domain,sum(Type = 1) - sum(Type= 0) from order_visits_4640165   where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+--------+------------------+------------------------------+
| PageID | Domain           | sum(Type = 1) - sum(Type= 0) |
+--------+------------------+------------------------------+
|      1 | gibdd.ru         |                           25 |
| 217336 | mobile.yandex.ru |                           11 |
+--------+------------------+------------------------------+
2 rows in set (0.00 sec)

mysql> select PageID,Domain,sum(Type = 1) - sum(Type= 0) from order_visits_14106800    where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+--------+------------------+------------------------------+
| PageID | Domain           | sum(Type = 1) - sum(Type= 0) |
+--------+------------------+------------------------------+
|      1 | mobile.yandex.ru |                           59 |
+--------+------------------+------------------------------+
1 row in set (0.01 sec)

mysql> select UniqID,sum(Type = 1) - sum(Type= 0) from order_visits_4640165    where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+---------------------+------------------------------+
| UniqID              | sum(Type = 1) - sum(Type= 0) |
+---------------------+------------------------------+
|  148122651471966607 |                            9 |
|  341113961396364832 |                            1 |
| 1075678491409337337 |                            1 |
| 1490432791442537722 |                            1 |
| 1728535491454665871 |                            3 |
| 1860788911436167084 |                            1 |
| 2223657361478675813 |                            1 |
| 2256126531448276051 |                            1 |
| 2270013031441782771 |                            1 |
| 2439331741459398571 |                            1 |
| 2904403761453441477 |                            1 |
| 2929166871461436430 |                            1 |
| 3528051581485517683 |                            1 |
| 3748190521453146285 |                           10 |
| 8723588161455380530 |                            1 |
| 9918267341372356318 |                            1 |
| 9921061901480478305 |                            1 |
+---------------------+------------------------------+
17 rows in set (0.01 sec)



mysql> select UniqID,sum(Type = 1) - sum(Type= 0) from order_visits_14106800    where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+---------------------+------------------------------+
| UniqID              | sum(Type = 1) - sum(Type= 0) |
+---------------------+------------------------------+
|   66665371418790669 |                            1 |
|  141300271448683890 |                            1 |
|  158323361443543046 |                            1 |
|  174601741490342751 |                            1 |
|  451434571488551734 |                            1 |
|  644557001416514874 |                            1 |
|  804450351489643784 |                            1 |
|  821103451475411974 |                            1 |
| 1605787771347469866 |                            1 |
| 1672463731408857272 |                            1 |
| 1694027071399277615 |                            1 |
| 1967188481295351837 |                            1 |
| 2124238061486095305 |                            1 |
| 2131149201446030891 |                            1 |
| 2134040791471002643 |                            1 |
| 2219415001485463036 |                            1 |
| 2296912221466006124 |                            1 |
| 2407880621488994850 |                            1 |
| 2481149241424927600 |                            1 |
| 2484940371455805972 |                            1 |
| 2603273451457436543 |                            1 |
| 2654407361460292912 |                            1 |
| 2740911041473159035 |                            1 |
| 2896988131467959073 |                            1 |
| 2960642551481891009 |                            1 |
| 2965567681473268899 |                            1 |
| 3082920531492015882 |                            1 |
| 3336902111461125566 |                            1 |
| 3453024071473250932 |                            1 |
| 3791150661485279674 |                            1 |
| 3791586871460354776 |                            1 |
| 3851301511387188440 |                            1 |
| 3974300221482908196 |                            1 |
| 4200692171486989221 |                            1 |
| 4674539671489415328 |                            1 |
| 4780321531474463594 |                            1 |
| 4810824771483315524 |                            1 |
| 4813875941483589722 |                            1 |
| 5249304691477380331 |                            1 |
| 5740315831494744696 |                            1 |
| 6107143321491827741 |                            1 |
| 6177935041450766925 |                            1 |
| 6273921191450699994 |                            1 |
| 6478177741478852739 |                            1 |
| 6489458691415335934 |                            1 |
| 6572975131486972485 |                            1 |
| 7113270951431541649 |                            1 |
| 7275387871493711692 |                            1 |
| 7488100301445598405 |                            1 |
| 7920550281489143923 |                            1 |
| 8444187781480322506 |                            1 |
| 8635684711494245110 |                            1 |
| 8840324631473251255 |                            1 |
| 9016010541483710662 |                            1 |
| 9329457351454263457 |                            1 |
| 9389203061450344128 |                            1 |
| 9817530051393649890 |                            1 |
| 9930654651494837295 |                            1 |
| 9938233341420974786 |                            1 |
+---------------------+------------------------------+
59 rows in set (0.01 sec)

mysql> select PlaceID,sum(Type = 1) - sum(Type= 0) from order_visits_4640165    where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+---------+------------------------------+
| PlaceID | sum(Type = 1) - sum(Type= 0) |
+---------+------------------------------+
|     721 |                           36 |
+---------+------------------------------+
1 row in set (0.01 sec)

mysql> select PlaceID,sum(Type = 1) - sum(Type= 0) from order_visits_14106800     where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+---------+------------------------------+
| PlaceID | sum(Type = 1) - sum(Type= 0) |
+---------+------------------------------+
|    1186 |                           59 |
+---------+------------------------------+
1 row in set (0.01 sec)



mysql> select BannerID,sum(Type = 1) - sum(Type= 0) from order_visits_4640165      where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+------------+------------------------------+
| BannerID   | sum(Type = 1) - sum(Type= 0) |
+------------+------------------------------+
| 2488190422 |                           19 |
| 3062220421 |                            1 |
| 3088069418 |                            1 |
| 3088069552 |                            3 |
| 3088069556 |                            1 |
| 4080901124 |                            5 |
| 4080908246 |                            3 |
| 4080911062 |                            3 |
+------------+------------------------------+
8 rows in set (0.01 sec)

mysql> select BannerID,sum(Type = 1) - sum(Type= 0) from order_visits_14106800     where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+------------+------------------------------+
| BannerID   | sum(Type = 1) - sum(Type= 0) |
+------------+------------------------------+
| 4087462273 |                            4 |
| 4087462425 |                           15 |
| 4087470805 |                           40 |
+------------+------------------------------+
3 rows in set (0.00 sec)

mysql> select RegionID,sum(Type = 1) - sum(Type= 0) from order_visits_4640165       where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+----------+------------------------------+
| RegionID | sum(Type = 1) - sum(Type= 0) |
+----------+------------------------------+
|        2 |                            1 |
|       22 |                            9 |
|      172 |                           11 |
|      213 |                           14 |
|    10733 |                            1 |
+----------+------------------------------+
5 rows in set (0.01 sec)

mysql> select RegionID,sum(Type = 1) - sum(Type= 0) from order_visits_14106800       where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+----------+------------------------------+
| RegionID | sum(Type = 1) - sum(Type= 0) |
+----------+------------------------------+
|      172 |                           59 |
+----------+------------------------------+
1 row in set (0.00 sec)
mysql> select Options,sum(Type = 1) - sum(Type= 0) from order_visits_4640165       where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+---------------------+------------------------------+
| Options             | sum(Type = 1) - sum(Type= 0) |
+---------------------+------------------------------+
| yclid               |                           27 |
| yclid,storage-order |                            9 |
+---------------------+------------------------------+
2 rows in set (0.00 sec)

mysql> select Options,sum(Type = 1) - sum(Type= 0) from order_visits_14106800       where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+-----------------+------------------------------+
| Options         | sum(Type = 1) - sum(Type= 0) |
+-----------------+------------------------------+
| yclid,flat-page |                           59 |
+-----------------+------------------------------+
1 row in set (0.01 sec)


mysql> select DeviceType,sum(Type = 1) - sum(Type= 0) from order_visits_4640165       where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+------------+------------------------------+
| DeviceType | sum(Type = 1) - sum(Type= 0) |
+------------+------------------------------+
|          4 |                            1 |
|          6 |                            5 |
|          7 |                            7 |
|         10 |                            1 |
|         11 |                           22 |
+------------+------------------------------+
5 rows in set (0.01 sec)

mysql> select DeviceType,sum(Type = 1) - sum(Type= 0) from order_visits_14106800       where AttributionType = 2 and GoalID = 0 and GoalReached > 0  and ClickNum = 1 and TraficSourceID=3 group by 1;
+------------+------------------------------+
| DeviceType | sum(Type = 1) - sum(Type= 0) |
+------------+------------------------------+
|          6 |                           20 |
|          7 |                            1 |
|          8 |                            1 |
|         10 |                           13 |
|         11 |                           24 |
+------------+------------------------------+
5 rows in set (0.00 sec)


Смотрим пользователя 3748190521453146285


+ ya upload package.tar -T BS_RELEASE_YT --ttl 256 -d 'host: olegts-fin, who: olegts, pwd: /home/olegts/arc/trunk/arcadia/yabs/server/cs/package/.build/yabs/server/cs, date: Вт. мая 30 18:17:04 MSK 2017' -A build_mode=release
Uploading via http
Created resource id is 269546373
        TTL          : 256 days
        Resource link: https://sandbox.yandex-team.ru/resource/269546373/view
        Download link: https://proxy.sandbox.yandex-team.ru/269546373
+ cd /home/olegts/arc/trunk/arcadia/yabs/server/cs/package
+ rm -rf /home/olegts/arc/trunk/arcadia/yabs/server/cs/package/.build



20


 !!! PRODUCTION !!! root@bstat111i.yandex.ru [yabsdb]> select BannerID,PhraseID,ContextType from PhrasePrice where OrderID = 11690851 and PhraseID in  (91113, 9682288);
+------------+----------+-------------+
| BannerID   | PhraseID | ContextType |
+------------+----------+-------------+
| 2717829948 |    91113 |           1 |
| 2837641191 |    91113 |           1 |
+------------+----------+-------------+
2 rows in set (0.01 sec)

 !!! PRODUCTION !!! root@bstat111i.yandex.ru [yabsdb]> select GroupExportID,PhraseID,ContextType from PhrasePrice where OrderID = 11690851 and PhraseID in  (91113, 9682288);
+---------------+----------+-------------+
| GroupExportID | PhraseID | ContextType |
+---------------+----------+-------------+
|    2048133032 |    91113 |           1 |
|    2048133032 |    91113 |           1 |
+---------------+----------+-------------+
2 rows in set (0.01 sec)


 !!! PRODUCTION !!! root@bstat111i.yandex.ru [yabsdb]> select * from GroupAutoBudgetForecasterAPC where GroupExportID = 2048133032 and PhraseID = 91113;
+----------+---------------+----------+-------------+---------------------+-------+------+-------+------+----------------+
| OrderID  | GroupExportID | PhraseID | ContextType | UpdateTime          | APC1  | APC2 | PPC1  | PPC2 | ExperimentBits |
+----------+---------------+----------+-------------+---------------------+-------+------+-------+------+----------------+
| 11690851 |    2048133032 |    91113 |           1 | 2017-05-31 14:58:00 | 19326 | 1872 | 98039 |   31 |              0 |
+----------+---------------+----------+-------------+---------------------+-------+------+-------+------+----------------+
1 row in set (0.02 sec)

autobudget-forecaster-multipliers-APC
11690851,2048133032,91113,1:3

Ср. мая 31 15:55:23 MSK 2017

Ср. мая 31 15:55:25 MSK 2017
11690851,2048133032,91113,1:3
Gi

 !!! PRODUCTION !!! root@bstat111i.yandex.ru [yabsdb]> select * from GroupAutoBudgetForecasterAPC where GroupExportID = 2048133032 and PhraseID = 91113;
+----------+---------------+----------+-------------+---------------------+-------+------+-------+------+----------------+
| OrderID  | GroupExportID | PhraseID | ContextType | UpdateTime          | APC1  | APC2 | PPC1  | PPC2 | ExperimentBits |
+----------+---------------+----------+-------------+---------------------+-------+------+-------+------+----------------+
| 11690851 |    2048133032 |    91113 |           1 | 2017-05-31 15:31:00 | 19326 | 1872 | 98039 |   31 |              0 |
+----------+---------------+----------+-------------+---------------------+-------+------+-------+------+----------------+
1 row in set (0.01 sec)


3120


2017-05-31 13-14
dsplog за сегодня с 12 до 13 dspid = 1 и counter_type = 0
в одной выборке сделать без фильтрации
в другой выборке сделать dspeventflags = 1
выровнять чтобы абсолюты за период совпали
взять отрицание полей и посмотреть какое отрицание дает dr= - 100%


replace into AnalyzerAggregatorInitializerParams (AggregatorHash, InitializerParams) values  (17569525562707973063,'{"query_types":{"bs-dsp-log":{"max_group_count":30,"cluster":"hahn","generate_patches":0,"time_column_format":"%s","location":{"time_interval":3600,"path":"//logs/bs-dsp-log/1h/%Y-%m-%dT%H:00:00"},"aggregate_fields":[{"sql":"if(L.countertype == \\"0\\", 1, 0)","name":"Shows","aggregation_type":"sum"}],"begin_section":"","initial_slice_fields":[{"sql":"L.adtype","name":"adtype"},{"sql":"L.blockheight","name":"blockheight"},{"sql":"L.blockwidth","name":"blockwidth"},{"sql":"L.clid","name":"clid"},{"sql":"L.creativeid","name":"creativeid"},{"sql":"L.cryptaid","name":"cryptaid"},{"sql":"L.dealexportid","name":"dealexportid"},{"sql":"L.dealproductid","name":"dealproductid"},{"sql":"cast(L.dspeventflags as uint64)","name":"dspeventflags"},{"sql":"cast(L.dspfraudbits as uint64)","name":"dspfraudbits"},{"sql":"cast(L.experimentbits as uint64)","name":"experimentbits"},{"sql":"Math::Log(cast(L.fakeprice as double)) / Math::Log(10)","name":"fakeepricelog"},{"sql":"L.isenvironmenttype","name":"isenvironmenttype"},{"sql":"Math::Log(cast(L.mincpm as double)) / Math::Log(10)","name":"mincpmlog"},{"sql":"L.options","name":"options"},{"sql":"L.origregionid","name":"origregionid"},{"sql":"L.pageid","name":"pageid"},{"sql":"Math::Log(cast(L.partnerprice as double)) / Math::Log(10)","name":"partnerpricelog"},{"sql":"L.partnerstatid","name":"partnerstatid"},{"sql":"Math::Log(cast(L.price as double)) / Math::Log(10)","name":"pricelog"},{"sql":"L.provider","name":"provider"},{"sql":"Math::Log(cast(L.realprice as double)) / Math::Log(10)","name":"realpricelog"},{"sql":"L.regionid","name":"regionid"},{"sql":"L.source_uri","name":"source_uri"},{"sql":"L.vendorid","name":"vendorid"},{"sql":"Math::Log(cast(L.yandexprice as double)) / Math::Log(10)","name":"yandexpricelog"},{"sql":"L.testtag","name":"testtag"}],"time_column":"cast(L.eventtime as uint64)","dictionaries":[],"alias":"L","condition":"L.dspid == \\"1\\"","split_fields":{"options":"options","dspfraudbits":"bits","dspeventflags":"bits","adtype":"options"}},"hahn.JoinedEFH":{"max_group_count":30,"cluster":"hahn","generate_patches":"0","time_column_format":"%s","location":{"time_interval":3600,"path":"//home/bs/yabs-log/%Y%m/JoinedEFH%Y%m%d%H"},"aggregate_fields":[{"sql":"if(L.CounterType == 2, 1, 0)","aggregation_type":"sum","name":"Clicks"},{"sql":"if(L.CounterType == 1, 1, 0)","aggregation_type":"sum","name":"Shows"},{"sql":"cast(L.EventCost as uint64)","aggregation_type":"sum","name":"Cost"}],"begin_section":"$word_count = Re2::Count(\\"[a-z]+\\");","initial_slice_fields":[{"sql": "if($word_count(L.SearchQuery) > 4, 4, $word_count(L.SearchQuery))", "name": "WordCount"},{"sql":"L.HitOptions","name":"HitLogOptions"},{"sql":"Banner.Options","name":"BannerOptions"},{"sql":"L.Options","name":"EventOptions"},{"sql":"OrderInfo.Options","name":"OrderInfoOptions"},{"sql":"L.PageID","name":"PageID"},{"sql":"L.PlaceID","name":"PlaceID"},{"sql":"L.SlotID","name":"SlotID"},{"sql":"L.TypeID","name":"TypeID"},{"sql":"L.SequenceID","name":"SequenceID"},{"sql":"L.ResourceNo","name":"ResourceNo"},{"sql":"L.Position","name":"Position"},{"sql":"L.PageNO","name":"PageNO"},{"sql":"L.RegionID","name":"RegionID"},{"sql":"L.SelectType","name":"SelectType"},{"sql":"L.DeviceType","name":"DeviceType"},{"sql":"L.ContextType","name":"ContextType"},{"sql":"L.Options","name":"LogOptions"},{"sql":"L.OrderID","name":"OrderID"},{"sql":"L.DomainID","name":"DomainID"},{"sql":"L.TagID","name":"TagID"},{"sql":"OrderInfo.Options","name":"order_options"},{"sql":"L.HostID","name":"HostID"},{"sql":"L.ExperimentBits","name":"ExperimentBits"},{"sql":"L.ClientIP","name":"ClientIP"}],"time_column":"L.EventTime","dictionaries":[{"join_condition":"L.BannerID == Banner.BannerID","name":"Banner","path":"//home/bs/dbrestore/bstat/yabsdb/Banner"},{"join_condition":"L.OrderID == OrderInfo.OrderID","name":"OrderInfo","path":"//home/bs/dbrestore/bsdb/yabsdb/OrderInfo"}],"alias":"L","condition":"true","split_fields":{"HitLogOptions":"options","OrderInfoOptions":"options","EventOptions":"options","BannerOptions":"options"}},"robot-bs-chevent-log-fraud":{"max_group_count":30,"begin_section":"","cluster":"banach","time_column_format":"\\"%s\\"","location":{"time_interval":3600,"path":"//logs/bs-chevent-log/1h/%Y-%m-%dT%H:00:00"},"aggregate_fields":[{"sql":"if(L.countertype == \\"1\\", 1, 0)","aggregation_type":"sum","name":"Shows"},{"sql":"if(L.countertype == \\"2\\", 1, 0)","aggregation_type":"sum","name":"Clicks"},{"sql":"cast(L.initcost as int64)","aggregation_type":"sum","name":"Cost"}],"initial_slice_fields":[],"time_column":"L.eventtime","dictionaries":[],"alias":"L","condition":"true","wait_for_tables_timeout":7200,"split_fields":{"Options":"options"},"generate_patches":"0"},"robot-bs-eventbad-log":{"max_group_count":30,"begin_section":"","cluster":"banach","time_column_format":"\\"%s\\"","location":{"time_interval":86400,"path":"//logs/bs-eventbad-log/1d/%Y-%m-%d"},"aggregate_fields":[{"sql":"if(L.countertype == \\"1\\", 1, 0)","aggregation_type":"sum","name":"Shows"},{"sql":"if(L.countertype == \\"2\\", 1, 0)","aggregation_type":"sum","name":"Clicks"},{"sql":"cast(L.eventcost as int64)","aggregation_type":"sum","name":"Cost"}],"initial_slice_fields":[],"time_column":"L.eventtime","dictionaries":[],"alias":"L","condition":"true","wait_for_tables_timeout":7200,"split_fields":{"Options":"options"},"generate_patches":"0"},"robot-bs-dsp-log":{"max_group_count":30,"begin_section":"","cluster":"banach","time_column_format":"\\"%s\\"","location":{"time_interval":3600,"path":"//home/logfeller/logs/bs-dsp-log/1h/%Y-%m-%dT%H:00:00"},"aggregate_fields":[{"sql":"cast(L.price as int64)","aggregation_type":"sum","name":"Price"},{"sql":"if(L.countertype == \\"1\\",1,0)","aggregation_type":"sum","name":"Shows"},{"sql":"cast(L.partnerprice as int64)","aggregation_type":"sum","name":"PartnerPrice"},{"sql":"cast(L.realprice as int64)","aggregation_type":"sum","name":"RealPrice"}],"initial_slice_fields":[],"time_column":"L.eventtime","dictionaries":[],"alias":"L","condition":"true","wait_for_tables_timeout":7200,"generate_patches":"0","split_fields":{}},"robot-bs-undodsp-log":{"begin_section":"","max_group_count":30,"cluster":"banach","time_column_format":"\\"%s\\"","location":{"time_interval":86400,"path":"//home/logfeller/logs/bs-undodsp-log/1d/%Y-%m-%d"},"aggregate_fields":[{"sql":"cast(L.price as int64)","aggregation_type":"sum","name":"Price"},{"sql":"if(L.countertype == \\"1\\",1,0)","aggregation_type":"sum","name":"Shows"},{"sql":"cast(L.partnerprice as int64) ","aggregation_type":"sum","name":"PartnerPrice"},{"sql":"cast(L.realprice as int64)","aggregation_type":"sum","name":"RealPrice"}],"initial_slice_fields":[],"time_column":"L.eventtime","dictionaries":[],"alias":"L","condition":"true","wait_for_tables_timeout":7200,"generate_patches":"0","split_fields":{},"until_time_shift":172800},"robot-bs-chevent-log":{"max_group_count":30,"begin_section":"","cluster":"banach","time_column_format":"\\"%s\\"","location":{"time_interval":3600,"path":"//logs/bs-chevent-log/1h/%Y-%m-%dT%H:00:00"},"aggregate_fields":[{"sql":"if(L.countertype == \\"1\\", 1, 0)","aggregation_type":"sum","name":"Shows"},{"sql":"if(L.countertype == \\"2\\", 1, 0)","aggregation_type":"sum","name":"Clicks"},{"sql":"cast(L.eventcost as int64)","aggregation_type":"sum","name":"Cost"}],"initial_slice_fields":[],"time_column":"L.eventtime","dictionaries":[],"alias":"L","condition":"true","wait_for_tables_timeout":7200,"split_fields":{"Options":"options"},"generate_patches":"0"},"agency":{"begin_section":"","max_group_count":30,"cluster":"hahn","generate_patches":"0","time_column_format":"%s","location":{"time_interval":3600,"path":"//home/logfeller/logs/bs-chevent-log/1h/%Y-%m-%dT%H:00:00"},"aggregate_fields":[{"sql":"if(L.countertype == \\"2\\", 1, 0)","aggregation_type":"sum","name":"Clicks"},{"sql":"if(L.countertype == \\"1\\", 1, 0)","aggregation_type":"sum","name":"Shows"},{"sql":"cast(L.eventcost as uint64)","aggregation_type":"sum","name":"Cost"}],"initial_slice_fields":[{"sql":"Banner.Options","name":"BannerOptions"},{"sql":"L.options","name":"EventOptions"},{"sql":"Banner.EngineID","name":"BannerEngineID"},{"name":"BannerTemplateID","sql":"Banner.TemplateID"},{"sql":"Banner.DomainID","name":"BannerDomainID"},{"name":"BannerTargetDomainID","sql":"Banner.TargetDomainID"},{"sql":"Banner.BannerType","name":"BannerBannerType"},{"sql":"Banner.CounterType","name":"BannerCounterType"},{"name":"BannerBannerWeight","sql":"Banner.BannerWeight"},{"name":"BannerFlags","sql":"Banner.Flags"},{"name":"BannerLang","sql":"Banner.Lang"},{"sql":"if(Banner.Flags > 0, 1, 0)","name":"BannerPositiveFlags"},{"sql":"if(OrderInfo.AgencyID == 6691, 1, 0)","name":"IsDirect"},{"sql":"OrderInfo.Options","name":"OrderInfoOptions"},{"name":"OrderInfoGroupOrderID","sql":"OrderInfo.GroupOrderID"},{"name":"OrderInfoAgencyID","sql":"OrderInfo.AgencyID"},{"sql":"OrderInfo.ClientID","name":"OrderInfoClientID"},{"sql":"OrderInfo.UserID","name":"OrderInfoUserID"},{"name":"OrderInfoOrderResourceID","sql":"OrderInfo.OrderResourceID"},{"sql":"OrderInfo.CurrencyDate","name":"OrderInfoCurrencyDate"},{"sql":"OrderInfo.CurrencyID","name":"OrderInfoCurrencyID"},{"sql":"OrderInfo.OrderType","name":"OrderInfoOrderType"},{"name":"OrderInfoPriceType","sql":"OrderInfo.PriceType"},{"sql":"OrderInfo.CounterType","name":"OrderInfoCounterType"},{"sql":"OrderInfo.BaseNo","name":"OrderInfoBaseNo"},{"name":"OrderInfoOptions","sql":"OrderInfo.Options"},{"name":"OrderInfoAutoStop","sql":"OrderInfo.AutoStop"},{"name":"OrderInfoComplete","sql":"OrderInfo.Complete"},{"sql":"OrderInfo.KeepActive","name":"OrderInfoKeepActive"},{"sql":"OrderInfo.Exported","name":"OrderInfoExported"},{"name":"OrderInfoStrategyMinPrice","sql":"OrderInfo.StrategyMinPrice"},{"name":"OrderInfoManagerID","sql":"OrderInfo.ManagerID"},{"name":"OrderInfoProductID","sql":"OrderInfo.ProductID"},{"name":"OrderInfoExportID","sql":"OrderInfo.ExportID"},{"sql":"OrderInfo.EngineID","name":"OrderInfoEngineID"},{"sql":"OrderInfo.ContextID","name":"OrderInfoContextID"},{"name":"OrderInfoTimeZoneID","sql":"OrderInfo.TimeZoneID"},{"name":"OrderInfoHolidayRegionID","sql":"OrderInfo.HolidayRegionID"},{"name":"OrderInfoTaxID","sql":"OrderInfo.TaxID"},{"name":"OrderInfoDiscountID","sql":"OrderInfo.DiscountID"},{"name":"OrderInfoReservedTime","sql":"OrderInfo.ReservedTime"},{"sql":"OrderInfo.State","name":"OrderInfoState"},{"name":"OrderInfoBillingState","sql":"OrderInfo.BillingState"},{"sql":"OrderInfo.TaxesIncluded","name":"OrderInfoTaxesIncluded"},{"sql":"OrderInfo.CounterID","name":"OrderInfoCounterID"},{"sql":"OrderInfo.AttributionType","name":"OrderInfoAttributionType"},{"name":"OrderInfoContentType","sql":"OrderInfo.ContentType"}],"time_column":"cast(L.eventtime as uint64)","dictionaries":[{"join_condition":"cast(L.bannerid as uint64) == Banner.BannerID","name":"Banner","path":"//home/bs/dbrestore/bstat/yabsdb/Banner"},{"join_condition":"cast(L.orderid as uint32) == OrderInfo.OrderID","name":"OrderInfo","path":"//home/bs/dbrestore/bsdb/yabsdb/OrderInfo"}],"alias":"L","condition":"L.fraudbits == \\"0\\" and \'flat-page\' in String::SplitToList(L.options, \',\')","split_fields":{"OrderInfoOptions":"options","BannerFlags":"bits","BannerOptions":"options","EventOptions":"options"}}}}');


Offers по EFH.BannerID восстанавливаем OfferId_MD5 через чтение offer_info_table
Ranks = 0
CounterID
Exp = 'default'
EventTime = current_date constant



dataLayer

{"max_group_count":30,"cluster":"hahn","generate_patches":0,"time_column_format":"%s","location":{"time_interval":3600,"path":"//logs/bs-dsp-log/1h/%Y-%m-%dT%H:00:00"},"aggregate_fields":[{"sql":"if(L.countertype == '0', 1, 0)","name":"Shows","aggregation_type":"sum"}],"begin_section":"","initial_slice_fields":[{"sql":"L.adtype","name":"adtype"},{"sql":"L.blockheight","name":"blockheight"},{"sql":"L.blockwidth","name":"blockwidth"},{"sql":"L.clid","name":"clid"},{"sql":"L.creativeid","name":"creativeid"},{"sql":"L.cryptaid","name":"cryptaid"},{"sql":"L.dealexportid","name":"dealexportid"},{"sql":"L.dealproductid","name":"dealproductid"},{"sql":"cast(L.dspeventflags as uint64)","name":"dspeventflags"},{"sql":"cast(L.dspfraudbits as uint64)","name":"dspfraudbits"},{"sql":"cast(L.experimentbits as uint64)","name":"experimentbits"},{"sql":"Math::Log(cast(fakeprice as double)) / Math::Log(10)","name":"fakeepricelog"},{"sql":"L.isenvironmenttype","name":"isenvironmenttype"},{"sql":"Math::Log(cast(mincpm as double)) / Math::Log(10)","name":"mincpmlog"},{"sql":"L.options","name":"options"},{"sql":"L.origregionid","name":"origregionid"},{"sql":"L.pageid","name":"pageid"},{"sql":"Math::Log(cast(L.partnerprice as double)) / Math::Log(10)","name":"partnerpricelog"},{"sql":"L.partnerstatid","name":"partnerstatid"},{"sql":"Math::Log(cast(L.price as double)) / Math::Log(10)","name":"pricelog"},{"sql":"L.provider","name":"provider"},{"sql":"Math::Log(cast(L.realprice as double)) / Math::Log(10)","name":"realpricelog"},{"sql":"L.regionid","name":"regionid"},{"sql":"L.source_uri","name":"source_uri"},{"sql":"L.vendorid","name":"vendorid"},{"sql":"Math::Log(cast(L.yandexprice as double)) / Math::Log(10)","name":"yandexpricelog"},{"sql":"L.testtag","name":"testtag"}],"time_column":"cast(L.eventtime as uint64)","dictionaries":[],"alias":"L","condition":"dspid == '1'","split_fields":{"options":"options","dspfraudbits":"bits","dspeventflags":"bits","adtype":"options"}}


{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"20724445\",\"offer_id_md5\":\"8079387843586174144\",\"action_bits\":\"1\",\"update_time\":\"1496217246\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"20724445\",\"offer_id_md5\":\"7493525855944504218\",\"action_bits\":\"1\",\"update_time\":\"1496217214\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"4652490496938930341\",\"action_bits\":\"1\",\"update_time\":\"1496409249\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"8265426715921799892\",\"action_bits\":\"1\",\"update_time\":\"1496409333\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"20724445\",\"offer_id_md5\":\"16896895274922746045\",\"action_bits\":\"1\",\"update_time\":\"1496217240\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"10880929139588895386\",\"action_bits\":\"1\",\"update_time\":\"1496409310\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"13854059032917376705\",\"action_bits\":\"1\",\"update_time\":\"1496409312\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"596742024763356778\",\"action_bits\":\"1\",\"update_time\":\"1496409333\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"19256383\",\"offer_id_md5\":\"2320333084352744572\",\"action_bits\":\"1\",\"update_time\":\"1496408596\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"14048746325422668785\",\"action_bits\":\"1\",\"update_time\":\"1496409307\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"4900177698706011481\",\"action_bits\":\"1\",\"update_time\":\"1496409900\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"3529816522485140551\",\"action_bits\":\"1\",\"update_time\":\"1496409255\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"13275109714395478683\",\"action_bits\":\"1\",\"update_time\":\"1496409299\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"5113999476324327106\",\"action_bits\":\"1\",\"update_time\":\"1496409255\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"9294720101027745942\",\"action_bits\":\"1\",\"update_time\":\"1496409327\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"15281133243501630664\",\"action_bits\":\"1\",\"update_time\":\"1496409301\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"17747233386839110164\",\"action_bits\":\"1\",\"update_time\":\"1496409304\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"17010872463815410183\",\"action_bits\":\"1\",\"update_time\":\"1496409312\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"16087822886384818844\",\"action_bits\":\"1\",\"update_time\":\"1496409327\",\"select_type\":\"27\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"12498858983254536922\",\"action_bits\":\"1\",\"update_time\":\"1496409330\",\"select_type\":\"27\"}

{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"14485270474710786951\",\"action_bits\":\"16\",\"update_time\":\"1496410889\",\"select_type\":\"67\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"10208989657340070182\",\"action_bits\":\"16\",\"update_time\":\"1496410889\",\"select_type\":\"67\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"10584804815827087418\",\"action_bits\":\"16\",\"update_time\":\"1496410889\",\"select_type\":\"67\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"10255312308815604436\",\"action_bits\":\"16\",\"update_time\":\"1496410889\",\"select_type\":\"67\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"4699606310623511093\",\"action_bits\":\"16\",\"update_time\":\"1496410889\",\"select_type\":\"67\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"6209999651377086983\",\"action_bits\":\"16\",\"update_time\":\"1496410889\",\"select_type\":\"67\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"20724445\",\"offer_id_md5\":\"12702715134002291081\",\"action_bits\":\"16\",\"update_time\":\"1496410889\",\"select_type\":\"67\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"15086458300282357520\",\"action_bits\":\"16\",\"update_time\":\"1496410889\",\"select_type\":\"67\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"7149058137285849845\",\"action_bits\":\"16\",\"update_time\":\"1496410889\",\"select_type\":\"67\"}
{\"id\":\"377\",\"name\":\"offer-profile\",\"counter_id\":\"5503465\",\"offer_id_md5\":\"38544856376439205\",\"action_bits\":\"16\",\"update_time\":\"1496410889\",\"select_type\":\"67\"}

привет. а можно узнать подробнее про большое количество джобов для хождения в джемини?. ты написал resource_limits = { user_slots = 10 } это означает что одновременно будет 10 джобов которые будут процессить часовую таблицу? или это просто написано ради примера и надо подобрать это число?

Егор Хайруллин, [29 мая 2017 г., 17:26]:
надо подобрать, конечно

чтобы нагрузка была норм

но я как пример написал)

Олег Царьков, [29 мая 2017 г., 18:03]:
у нас на каждую строку вотч лога надо дергать джемини?

или там фильтрация у нас есть

Егор Хайруллин, [29 мая 2017 г., 18:04]:
input_types    => {watch => []},
  common_actions => [
   (Grep {!($_->{Params} =~ /__ym.*ecommerce/)} "ecommerce-inside"),
   (Grep {
    $_->{CounterID} && $ecom_counters && $ecom_counters->has($_->{CounterID})
   } "no-ecom-counter-id"),
   (Grep {$_->{URL} =~ /^http/}),

ну  вот как тут

не должно быть ym.*ecommerce в поле Params

подходящий CounterID

и урл начинается с http

тогда идем в gemini

Олег Царьков, [29 мая 2017 г., 18:09]:
а как достать список правильых counter_id?

Егор Хайруллин, [29 мая 2017 г., 18:10]:
"CounterID from [//yabs/Dicts/OrderInfo] where uint64(CounterID) > 0u",

Олег Царьков, [29 мая 2017 г., 18:13]:
а мы пытаемся уникализовать урлы перед передачей?

Егор Хайруллин, [29 мая 2017 г., 18:13]:
это на сенеках табличка

я не пытаюсь

но это можно делать

почему бы и нет

Олег Царьков, [29 мая 2017 г., 18:13]:
я подумаю много ли выигрыша

Егор Хайруллин, [29 мая 2017 г., 18:13]:
угу


select

from [//home/logfeller/logs/bs-watch-log/1h/2017-06-06T15:00:00]


1496289599&from=1495425600&format=raw&noCache=True&alerts_uniq=1496293240308174'


DataSetValues вставить строки из интерфейса
отредактировать плюс


OrderID = 14601980, GroupExportID = 2575735267


Анализ подневной активности
одинаковые интервалы
Разный список host_id
Диапазон

https://an.yandex.ru/meta/93511?target-ref=https%3A%2F%2Fnews.yandex.ru%2F&charset=utf-8&imp-id=54&enable-flat-highlight=1&test-tag=558070870573058&ad-session-id=5447901497438654225&pcode-version=2039&flash-ver=25&available-width=300&reqid=1497438651298732-1663085195291549597494370-man1-0883-NEWS_RUBRIC&grab=dNCv0L3QtNC10LrRgS7QndC-0LLQvtGB0YLQuDog0JPQu9Cw0LLQvdGL0LUg0L3QvtCy0L7RgdGC0Lgg0YHQtdCz0L7QtNC90Y8sINGB0LDQvNGL0LUg0YHQstC10LbQuNC1INC4INC_0L7RgdC70LXQtNC90LjQtSDQvdC-0LLQvtGB0YLQuCDQoNC-0YHRgdC40Lgg0L7QvdC70LDQudC9CjLQn9GD0YLQuNC9INC_0YDQvtC60L7QvNC80LXQvdGC0LjRgNC-0LLQsNC7INGB0LvQvtCy0LAg0JrQu9C40L3RgtC-0L0sINGB0YDQsNCy0L3QuNCy0YjQtdC5INC10LPQviDRgSDQk9C40YLQu9C10YDQvtC8IAoy0KHRg9C0INC-0YLQutCw0LfQsNC7INCe0LvQtdCz0YMg0J3QsNCy0LDQu9GM0L3QvtC80YMg0LIg0YHQvNGP0LPRh9C10L3QuNC4INC90LDQutCw0LfQsNC90LjRjyAKMtCt0LrRgS3Qs9C70LDQstGDINCk0KHQmNCdINCg0LXQudC80LXRgNCwINC_0YDQuNCz0L7QstC-0YDQuNC70Lgg0Log0LLQvtGB0YzQvNC4INCz0L7QtNCw0Lwg0LrQvtC70L7QvdC40LggCjLQn9C-0LvQuNGG0LjRjyDQm9C-0L3QtNC-0L3QsCDQv9C-0LTRgtCy0LXRgNC00LjQu9CwINCz0LjQsdC10LvRjCDRiNC10YHRgtC4INGH0LXQu9C-0LLQtdC6INCyINC_0L7QttCw0YDQtSDQsiDQttC40LvQvtC8INC00L7QvNC1IAoy0J_QtdGB0LrQvtCyOiDQsiDQmtGA0LXQvNC70LUg0L3QtSDRhdC-0YLRj9GCINCy0YXQvtC00LjRgtGMINCyINGB0LDQvdC60YbQuNC-0L3QvdC-0LUg0L_QuNC60LUgCjLQk9C-0YHQtNGD0LzQsCDQv9GA0LjQvdGP0LvQsCDQt9Cw0LrQvtC9INC-INGA0LXQvdC-0LLQsNGG0LjQuCDQttC40LvQuNGJ0L3QvtCz0L4g0YTQvtC90LTQsCDRgdGC0L7Qu9C40YbRiyAKMtCc0LXRgtC10L7RgNC-0LvQvtCz0Lgg0LfQsNGE0LjQutGB0LjRgNC-0LLQsNC70Lgg0YDQtdC60L7RgNC00L3QviDQvdC40LfQutC-0LUg0LTQsNCy0LvQtdC90LjQtSDQsiDQnNC-0YHQutCy0LUgCjLQodC-0LHRj9C90LjQvSDQvtGC0LrRgNGL0Lsg0LIg0JzQvtGB0LrQstC1INC_0YDQvtC00L7QstC-0LvRjNGB0YLQstC10L3QvdGD0Y4g0LrRgNGD0LPQu9C-0LPQvtC00LjRh9C90YPRjiDRj9GA0LzQsNGA0LrRgyAKMtCjINC30LTQsNC90LjRjyDQk9C-0YHQtNGD0LzRiyDQt9Cw0LTQtdGA0LbQuNCy0LDRjtGCINC_0YDQvtGC0LXRgdGC0YPRjtGJ0LjRhSDQv9GA0L7RgtC40LIg0YDQtdC90L7QstCw0YbQuNC4IAoy0JbQtdC70YLRi9C5INGD0YDQvtCy0LXQvdGMINC-0L_QsNGB0L3QvtGB0YLQuCDQvtCx0YrRj9Cy0LvQtdC9INCyINCc0L7RgdC60LLQtSDQuNC3LdC30LAg0LvQuNCy0L3RjyDRgSDQs9GA0L7Qt9C-0LkgCjLQkiDQmtGA0LXQvNC70LUg0L3QsNC30LLQsNC70Lgg0LDQsdGB0YPRgNC00L3Ri9C80Lgg0YHQu9GD0YXQuCDQviDCq9GA0LXQv9C10YLQuNGG0LjQuMK7INC_0YDRj9C80L7QuSDQu9C40L3QuNC4INGBINCf0YPRgtC40L3Ri9C8IAoy0KHQvtCy0LXRgiDRhNC10LTQtdGA0LDRhtC40Lgg0YHQvtC30LTQsNC7INC60L7QvNC40YHRgdC40Y4g0L_QviDQsdC-0YDRjNCx0LUg0YEg0LjQvdC-0YHRgtGA0LDQvdC9&layout-config=%7B%22win_width%22%3A1276%2C%22win_height%22%3A351%2C%22width%22%3A300%2C%22height%22%3A0%2C%22left%22%3A966%2C%22top%22%3A773%2C%22visible%22%3A0%2C%22ad_no%22%3A0%2C%22req_no%22%3A0%7D&callback=Ya[1497438658998]&dump-match=1
yabs-exp-sid=ccc57286a08cacaa

https://an.yandex.ru/meta/93511?target-ref=https%3A%2F%2Fnews.yandex.ru%2F&charset=utf-8&imp-id=54&enable-flat-highlight=1&test-tag=558070870573058&ad-session-id=2720641497440088663&pcode-version=2039&flash-ver=25&available-width=300&reqid=1497440086239203-589451847707568569899729-vla1-4435-NEWS_RUBRIC&grab=dNCv0L3QtNC10LrRgS7QndC-0LLQvtGB0YLQuDog0JPQu9Cw0LLQvdGL0LUg0L3QvtCy0L7RgdGC0Lgg0YHQtdCz0L7QtNC90Y8sINGB0LDQvNGL0LUg0YHQstC10LbQuNC1INC4INC_0L7RgdC70LXQtNC90LjQtSDQvdC-0LLQvtGB0YLQuCDQoNC-0YHRgdC40Lgg0L7QvdC70LDQudC9CjLQn9GD0YLQuNC9INC_0YDQvtC60L7QvNC80LXQvdGC0LjRgNC-0LLQsNC7INGB0LvQvtCy0LAg0JrQu9C40L3RgtC-0L0sINGB0YDQsNCy0L3QuNCy0YjQtdC5INC10LPQviDRgSDQk9C40YLQu9C10YDQvtC8IAoy0K3QutGBLdCz0LvQsNCy0LAg0KTQodCY0J0g0L_QvtC70YPRh9C40LsgOCDQu9C10YIg0LrQvtC70L7QvdC40LggCjLQodGD0LQg0L7RgtC60LDQt9Cw0LvRgdGPINGB0LzRj9Cz0YfQuNGC0Ywg0L3QsNC60LDQt9Cw0L3QuNC1INCe0LvQtdCz0YMg0J3QsNCy0LDQu9GM0L3QvtC80YMsINGB0L7QvtCx0YnQuNC7INCw0LTQstC-0LrQsNGCIAoy0J_QtdGB0LrQvtCyOiDQsiDQmtGA0LXQvNC70LUg0L3QtSDRhdC-0YLRj9GCINCy0YXQvtC00LjRgtGMINCyINGB0LDQvdC60YbQuNC-0L3QvdC-0LUg0L_QuNC60LUgCjLQk9C-0YHQtNGD0LzQsCDQv9GA0LjQvdGP0LvQsCDQt9Cw0LrQvtC9INC-INGA0LXQvdC-0LLQsNGG0LjQuCDQttC40LvQuNGJ0L3QvtCz0L4g0YTQvtC90LTQsCDRgdGC0L7Qu9C40YbRiyAKMtCc0LXRgtC10L7RgNC-0LvQvtCz0Lgg0LfQsNGE0LjQutGB0LjRgNC-0LLQsNC70Lgg0YDQtdC60L7RgNC00L3QviDQvdC40LfQutC-0LUg0LTQsNCy0LvQtdC90LjQtSDQsiDQnNC-0YHQutCy0LUgCjLQkiDRgNCw0LfQstC40YLQuNC1INC90L7QstC-0Lkg0JzQvtGB0LrQstGLINC30LAg0L_Rj9GC0Ywg0LvQtdGCINCy0LvQvtC20LXQvdC-INC-0LrQvtC70L4gODAwINC80LvRgNC0INGA0YPQsdC70LXQuSAKMtCh0L7QsdGP0L3QuNC9INC-0YLQutGA0YvQuyDQsiDQnNC-0YHQutCy0LUg0L_RgNC-0LTQvtCy0L7Qu9GM0YHRgtCy0LXQvdC90YPRjiDQutGA0YPQs9C70L7Qs9C-0LTQuNGH0L3Rg9GOINGP0YDQvNCw0YDQutGDIAoy0JbQtdC70YLRi9C5INGD0YDQvtCy0LXQvdGMINC-0L_QsNGB0L3QvtGB0YLQuCDQvtCx0YrRj9Cy0LvQtdC9INCyINCc0L7RgdC60LLQtSDQuNC3LdC30LAg0LvQuNCy0L3RjyDRgSDQs9GA0L7Qt9C-0LkgCjLQkiDQnNCn0KEg0L_RgNC10LTRg9C_0YDQtdC00LjQu9C4INC-INC00L7QttC00LUg0Lgg0LPRgNC-0LfQsNGFINCyINCc0L7RgdC60LLQtSAKMtCSINCa0YDQtdC80LvQtSDQvdCw0LfQstCw0LvQuCDQsNCx0YHRg9GA0LTQvdGL0LzQuCDRgdC70YPRhdC4INC-IMKr0YDQtdC_0LXRgtC40YbQuNC4wrsg0L_RgNGP0LzQvtC5INC70LjQvdC40Lgg0YEg0J_Rg9GC0LjQvdGL0LwgCjLQltC40YDQuNC90L7QstGB0LrQuNC5INC_0YDQtdC00LvQvtC20LjQuyDQv9GA0L7QstC10YHRgtC4INGA0LXQvdC-0LLQsNGG0LjRjiDQk9C-0YHQtNGD0LzRiyAKMtCh0L7QstC10YIg0YTQtdC00LXRgNCw0YbQuNC4INGB0L7Qt9C00LDQuyDQutC-0LzQuNGB0YHQuNGO&layout-config=%7B%22win_width%22%3A1276%2C%22win_height%22%3A351%2C%22width%22%3A300%2C%22height%22%3A0%2C%22left%22%3A966%2C%22top%22%3A773%2C%22visible%22%3A0%2C%22ad_no%22%3A0%2C%22req_no%22%3A0%7D&callback=Ya[1497440091613]&dump-match=1



https://an.yandex.ru/meta/93511?target-ref=https%3A%2F%2Fnews.yandex.ru%2F&charset=utf-8&imp-id=54&enable-flat-highlight=1&test-tag=559307821154306&ad-session-id=1777821497518328862&pcode-version=2041&flash-ver=25&available-width=300&reqid=1497518324011139-403147342337935903280311-man1-1867-NEWS_RUBRIC&grab=dNCv0L3QtNC10LrRgS7QndC-0LLQvtGB0YLQuDog0JPQu9Cw0LLQvdGL0LUg0L3QvtCy0L7RgdGC0Lgg0YHQtdCz0L7QtNC90Y8sINGB0LDQvNGL0LUg0YHQstC10LbQuNC1INC4INC_0L7RgdC70LXQtNC90LjQtSDQvdC-0LLQvtGB0YLQuCDQoNC-0YHRgdC40Lgg0L7QvdC70LDQudC9CjLQn9GD0YLQuNC9INC30LDRj9Cy0LjQuywg0YfRgtC-INCc0L7RgdC60LLQsCDQvdC1INC00L7Qv9GD0YHRgtC40YIg0L_RgNC10LLRgNCw0YnQtdC90LjRjyDQoNC-0YHRgdC40Lgg0LIg0YXQsNC70LjRhNCw0YIgCjLQn9GA0L7RidCw0L3QuNC1INGBINCR0LDRgtCw0LvQvtCy0YvQvCDRgdC-0YHRgtC-0LjRgtGB0Y8g0LIg0JTQvtC80LUg0LrQuNC90L4gCjLQodCaINC-0L_RgNC-0LLQtdGA0LMg0YHQvtC-0LHRidC10L3QuNGPINC-INC30LDQstC10YDRiNC10L3QuNC4INGA0LDRgdGB0LvQtdC00L7QstCw0L3QuNGPIMKr0LTQtdC70LAg0JLQsNGB0LjQu9GM0LXQstC-0LnCuyAKMtCS0L7QtNC40YLQtdC70Ywg0LPRgNGD0LfQvtCy0LjQutCwINGB0YLQsNC7INC20LXRgNGC0LLQvtC5INC_0L7QttCw0YDQsCDQv9C-0YHQu9C1INC30LDQv9GD0YHQutCwIMKr0KHQvtGO0LfQsMK7IAoy0KHQnNCYINGD0LfQvdCw0LvQuCDQviDQstC-0LfQvNC-0LbQvdC-0Lwg0L_QvtCy0YvRiNC10L3QuNC4INGB0YDQvtC60LAg0LLRi9GB0LvRg9Cz0Lgg0LvQtdGCINC00LvRjyDQv9C10L3RgdC40Lkg0LLQvtC10L3QvdGL0YUgCjLQkiDQnNC-0YHQutCy0LUgMTUg0LjRjtC90Y8g0L_QvtGF0L7Qu9C-0LTQsNC10YIg0LTQviArMTIg0LPRgNCw0LTRg9GB0L7QsiAKMtCT0L7RgdC00YPQvNCwINGA0LDRgdGB0LzQvtGC0YDQuNGCINC30LDQutC-0L0g0L4g0YDQtdC90L7QstCw0YbQuNC4INC20LjQu9GM0Y8g0L_QviDQstGB0LXQuSDQoNC-0YHRgdC40LggCjLQndCwINC80L7RgdC60L7QstGB0LrQuNGFINCy0L7QutC30LDQu9Cw0YUg0L_QvtGP0LLQuNC70LjRgdGMINC-0LHRitGP0LLQu9C10L3QuNGPINC90LAg0LDQvdCz0LvQuNC50YHQutC-0Lwg0Y_Qt9GL0LrQtSAKMsKr0JzQvtGB0LPQvtGA0YLRgNCw0L3RgcK7INC_0L7Qu9GD0YfQuNGCINCx0L7Qu9C10LUgMSDRgtGL0YEg0L3QvtCy0YvRhSDQsNCy0YLQvtCx0YPRgdC-0LIg0LIgMjAxNyDQs9C-0LTRgyAKMtCaIDIwMzUg0LPQvtC00YMg0LIg0J3QvtCy0L7QuSDQnNC-0YHQutCy0LUg0L_QvtGP0LLRj9GC0YHRjyAyOSDQvdC-0LLRi9GFINGB0YLQsNC90YbQuNC5INC80LXRgtGA0L4gCjLQn9GD0YLQuNC9INC00LLQvtC1INGB0YPRgtC-0Log0LLQv9C70L7RgtC90YPRjiDQt9Cw0L3QuNC80LDQu9GB0Y8g0L_QvtC00LPQvtGC0L7QstC60L7QuSDQuiDCq9Cf0YDRj9C80L7QuSDQu9C40L3QuNC4wrsgCjLQl9Cw0YXQsNGA0L7QstCwOiDQodCo0JAg0L3QtSDQv9C10YDQtdC00LDQstCw0LvQuCDQoNCkINC-0YTQuNGG0LjQsNC70YzQvdC-0LPQviDQv9C-0LfQtNGA0LDQstC70LXQvdC40Y8g0YEg0JTQvdC10Lwg0KDQvtGB0YHQuNC4IAoy0KHRg9C0INCV0LLRgNC-&layout-config=%7B%22win_width%22%3A1276%2C%22win_height%22%3A351%2C%22width%22%3A300%2C%22height%22%3A0%2C%22left%22%3A966%2C%22top%22%3A773%2C%22visible%22%3A0%2C%22ad_no%22%3A0%2C%22req_no%22%3A0%7D&callback=Ya[1497518333304]&dump-match=1

yabs-exp-sid=ccc57286a08cacaa


 !!! PRODUCTION !!! root@bstat54i.yandex.ru [yabsdb]> select ResultFlatCost/1e4,count(*)  from (select BannerID,PhraseID,ContextType,ResultFlatCost from PhrasePrice where OrderID = 14889420 and !find_in_set("deleted", Options)) T inner join (select BannerID from Banner54 where OrderID = 14889420 and ContextPriority > 0) T2 using(BannerID) group by 1;
+--------------------+----------+
| ResultFlatCost/1e4 | count(*) |
+--------------------+----------+
|                0.3 |        4 |
|                4.3 |        4 |
|                5.8 |        4 |
|                6.1 |        4 |
|                6.4 |        4 |
|                6.9 |        4 |
|                7.3 |       48 |
+--------------------+----------+
7 rows in set (1 min 19.91 sec)



olegts@sas1-6325-23202:~$ sky upload diff .  +G@MAN_AUTOBUDGET_GUEST:stable-97-r101 +G@VLA_AUTOBUDGET_GUEST:stable-99-r185 +G@MAN_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@SAS_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@VLA_AUTOBUDGET_PRE_GUEST:stable-100-r2 +G@SAS_AUTOBUDGET_GUEST:stable-97-r101
================================================================================
Internal CQueue error on 8 host(s): +man1-5554-23202.vm.search.yandex.net +man1-5568-23202.vm.search.yandex.net +man1-8294-23202.vm.search.yandex.net +man1-8299-23202.vm.search.yandex.net +man1-8318-23202.vm.search.yandex.net +sas1-5776-23202.vm.search.yandex.net +sas1-5779-23202.vm.search.yandex.net +sas1-5783-23202.vm.search.yandex.net
--------------------------------------------------------------------------------
Timeout: Host is silent
================================================================================

================================================================================
Internal CQueue error on 1 host(s): +man1-8310-23202.vm.search.yandex.net
--------------------------------------------------------------------------------
Authorization as `olegts` failed. PAM reported: [Errno 10] PAM error: User not known to the underlying authentication module
================================================================================


olegts@sas1-6325-23202:~$ sky run "cat diff"   +G@MAN_AUTOBUDGET_GUEST:stable-97-r101 +G@VLA_AUTOBUDGET_GUEST:stable-99-r185 +G@MAN_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@SAS_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@VLA_AUTOBUDGET_PRE_GUEST:stable-100-r2 +G@SAS_AUTOBUDGET_GUEST:stable-97-r101
================================================================================
Success on 213 host(s): +man1-0061-23202.vm.search.yandex.net +man1-0150-23202.vm.search.yandex.net +man1-3905-23202.vm.search.yandex.net +man1-4639-23202.vm.search.yandex.net +man1-4642-23202.vm.search.yandex.net +man1-4650-23202.vm.search.yandex.net +man1-4652-23202.vm.search.yandex.net +man1-4663-23202.vm.search.yandex.net +man1-4669-23202.vm.search.yandex.net +man1-4673-23202.vm.search.yandex.net +man1-4680-23202.vm.search.yandex.net +man1-4687-23202.vm.search.yandex.net +man1-4692-23202.vm.search.yandex.net +man1-5445-23202.vm.search.yandex.net +man1-5461-23202.vm.search.yandex.net +man1-5475-23202.vm.search.yandex.net +man1-5477-23202.vm.search.yandex.net +man1-5485-23202.vm.search.yandex.net +man1-5496-23202.vm.search.yandex.net +man1-5498-23202.vm.search.yandex.net +man1-5499-23202.vm.search.yandex.net +man1-5505-23202.vm.search.yandex.net +man1-5508-23202.vm.search.yandex.net +man1-5512-23202.vm.search.yandex.net +man1-5514-23202.vm.search.yandex.net +man1-5551-23202.vm.search.yandex.net +man1-6031-23202.vm.search.yandex.net +man1-6573-23202.vm.search.yandex.net +man1-6846-23202.vm.search.yandex.net +man1-6881-23202.vm.search.yandex.net +man1-6894-23202.vm.search.yandex.net +man1-6901-23202.vm.search.yandex.net +man1-7124-23202.vm.search.yandex.net +man1-7167-23202.vm.search.yandex.net +man1-7173-23202.vm.search.yandex.net +man1-7185-23202.vm.search.yandex.net +man1-7193-23202.vm.search.yandex.net +man1-7194-23202.vm.search.yandex.net +man1-7195-23202.vm.search.yandex.net +man1-7205-23202.vm.search.yandex.net +man1-7217-23202.vm.search.yandex.net +man1-7218-23202.vm.search.yandex.net +man1-7412-23202.vm.search.yandex.net +man1-7488-23202.vm.search.yandex.net +man1-7524-23202.vm.search.yandex.net +man1-7527-23202.vm.search.yandex.net +man1-7546-23202.vm.search.yandex.net +man1-7554-23202.vm.search.yandex.net +man1-7556-23202.vm.search.yandex.net +man1-7644-23202.vm.search.yandex.net +man1-8093-23202.vm.search.yandex.net +man1-8112-23202.vm.search.yandex.net +man1-8120-23202.vm.search.yandex.net +man1-8126-23202.vm.search.yandex.net +man1-8129-23202.vm.search.yandex.net +man1-8145-23202.vm.search.yandex.net +man1-8176-23202.vm.search.yandex.net +man1-8213-23202.vm.search.yandex.net +man1-8216-23202.vm.search.yandex.net +man1-8219-23202.vm.search.yandex.net +man1-8227-23202.vm.search.yandex.net +man1-8246-23202.vm.search.yandex.net +man1-8247-23202.vm.search.yandex.net +man1-8248-23202.vm.search.yandex.net +man1-8252-23202.vm.search.yandex.net +man1-8258-23202.vm.search.yandex.net +man1-8272-23202.vm.search.yandex.net +man1-8273-23202.vm.search.yandex.net +man1-8288-23202.vm.search.yandex.net +sas1-1090-23202.vm.search.yandex.net +sas1-1478-23202.vm.search.yandex.net +sas1-1479-23202.vm.search.yandex.net +sas1-1486-23202.vm.search.yandex.net +sas1-1496-23202.vm.search.yandex.net +sas1-1532-23202.vm.search.yandex.net +sas1-1567-23202.vm.search.yandex.net +sas1-1577-23202.vm.search.yandex.net +sas1-1998-23202.vm.search.yandex.net +sas1-2000-23202.vm.search.yandex.net +sas1-5765-23202.vm.search.yandex.net +sas1-5771-23202.vm.search.yandex.net +sas1-5773-23202.vm.search.yandex.net +sas1-5774-23202.vm.search.yandex.net +sas1-5792-23202.vm.search.yandex.net +sas1-5884-23202.vm.search.yandex.net +sas1-5906-23202.vm.search.yandex.net +sas1-6025-23202.vm.search.yandex.net +sas1-6055-23202.vm.search.yandex.net +sas1-6099-23202.vm.search.yandex.net +sas1-6149-23202.vm.search.yandex.net +sas1-6192-23202.vm.search.yandex.net +sas1-6202-23202.vm.search.yandex.net +sas1-6207-23202.vm.search.yandex.net +sas1-6311-23202.vm.search.yandex.net +sas1-6312-23202.vm.search.yandex.net +sas1-6325-23202.vm.search.yandex.net +sas1-6353-23202.vm.search.yandex.net +sas1-6359-23202.vm.search.yandex.net +sas1-6378-23202.vm.search.yandex.net +sas1-6411-23202.vm.search.yandex.net +sas1-6422-23202.vm.search.yandex.net +sas1-6466-23202.vm.search.yandex.net +sas1-6467-23202.vm.search.yandex.net +sas1-6534-23202.vm.search.yandex.net +sas1-6535-23202.vm.search.yandex.net +sas1-6542-23202.vm.search.yandex.net +sas1-6545-23202.vm.search.yandex.net +sas1-6580-23202.vm.search.yandex.net +sas1-6630-23202.vm.search.yandex.net +sas1-6631-23202.vm.search.yandex.net +sas1-6714-23202.vm.search.yandex.net +sas1-6715-23202.vm.search.yandex.net +sas1-6739-23202.vm.search.yandex.net +sas1-6745-23202.vm.search.yandex.net +sas1-6782-23202.vm.search.yandex.net +sas1-6807-23202.vm.search.yandex.net +sas1-6808-23202.vm.search.yandex.net +sas1-6815-23202.vm.search.yandex.net +sas1-6849-23202.vm.search.yandex.net +sas1-6852-23202.vm.search.yandex.net +sas1-6890-23202.vm.search.yandex.net +sas1-6928-23202.vm.search.yandex.net +sas1-6929-23202.vm.search.yandex.net +sas1-6961-23202.vm.search.yandex.net +sas1-6969-23202.vm.search.yandex.net +sas1-7006-23202.vm.search.yandex.net +sas1-7011-23202.vm.search.yandex.net +sas1-7040-23202.vm.search.yandex.net +sas1-7042-23202.vm.search.yandex.net +sas1-7110-23202.vm.search.yandex.net +sas1-7115-23202.vm.search.yandex.net +sas1-7120-23202.vm.search.yandex.net +sas1-7123-23202.vm.search.yandex.net +sas1-7161-23202.vm.search.yandex.net +sas1-7162-23202.vm.search.yandex.net +sas1-7197-23202.vm.search.yandex.net +sas1-7199-23202.vm.search.yandex.net +sas1-7232-23202.vm.search.yandex.net +vla1-0092-23202.vm.search.yandex.net +vla1-0094-23202.vm.search.yandex.net +vla1-0096-23202.vm.search.yandex.net +vla1-0097-23202.vm.search.yandex.net +vla1-0098-23202.vm.search.yandex.net +vla1-0100-23202.vm.search.yandex.net +vla1-0101-23202.vm.search.yandex.net +vla1-0102-23202.vm.search.yandex.net +vla1-0104-23202.vm.search.yandex.net +vla1-0105-23202.vm.search.yandex.net +vla1-0106-23202.vm.search.yandex.net +vla1-0107-23202.vm.search.yandex.net +vla1-0108-23202.vm.search.yandex.net +vla1-0109-23202.vm.search.yandex.net +vla1-0110-23202.vm.search.yandex.net +vla1-0111-23202.vm.search.yandex.net +vla1-0112-23202.vm.search.yandex.net +vla1-0115-23202.vm.search.yandex.net +vla1-0119-23202.vm.search.yandex.net +vla1-0124-23202.vm.search.yandex.net +vla1-0872-23202.vm.search.yandex.net +vla1-0900-23202.vm.search.yandex.net +vla1-1041-23202.vm.search.yandex.net +vla1-1150-23202.vm.search.yandex.net +vla1-1291-23202.vm.search.yandex.net +vla1-1637-23202.vm.search.yandex.net +vla1-1639-23202.vm.search.yandex.net +vla1-1643-23202.vm.search.yandex.net +vla1-1647-23202.vm.search.yandex.net +vla1-1716-23202.vm.search.yandex.net +vla1-1742-23202.vm.search.yandex.net +vla1-1872-23202.vm.search.yandex.net +vla1-1873-23202.vm.search.yandex.net +vla1-2068-23202.vm.search.yandex.net +vla1-2721-23202.vm.search.yandex.net +vla1-2725-23202.vm.search.yandex.net +vla1-2736-23202.vm.search.yandex.net +vla1-2742-23202.vm.search.yandex.net +vla1-2743-23202.vm.search.yandex.net +vla1-2744-23202.vm.search.yandex.net +vla1-2749-23202.vm.search.yandex.net +vla1-2753-23202.vm.search.yandex.net +vla1-2771-23202.vm.search.yandex.net +vla1-2776-23202.vm.search.yandex.net +vla1-2799-23202.vm.search.yandex.net +vla1-2806-23202.vm.search.yandex.net +vla1-2809-23202.vm.search.yandex.net +vla1-2832-23202.vm.search.yandex.net +vla1-2855-23202.vm.search.yandex.net +vla1-2861-23202.vm.search.yandex.net +vla1-2863-23202.vm.search.yandex.net +vla1-2865-23202.vm.search.yandex.net +vla1-2867-23202.vm.search.yandex.net +vla1-2874-23202.vm.search.yandex.net +vla1-2884-23202.vm.search.yandex.net +vla1-2888-23202.vm.search.yandex.net +vla1-2892-23202.vm.search.yandex.net +vla1-2893-23202.vm.search.yandex.net +vla1-2902-23202.vm.search.yandex.net +vla1-2908-23202.vm.search.yandex.net +vla1-2941-23202.vm.search.yandex.net +vla1-2986-23202.vm.search.yandex.net +vla1-2989-23202.vm.search.yandex.net +vla1-3126-23202.vm.search.yandex.net +vla1-3135-23202.vm.search.yandex.net +vla1-3141-23202.vm.search.yandex.net +vla1-3165-23202.vm.search.yandex.net +vla1-3176-23202.vm.search.yandex.net +vla1-3187-23202.vm.search.yandex.net +vla1-3195-23202.vm.search.yandex.net +vla1-3252-23202.vm.search.yandex.net +vla1-3340-23202.vm.search.yandex.net +vla1-3348-23202.vm.search.yandex.net +vla1-3441-23202.vm.search.yandex.net +vla1-4422-23202.vm.search.yandex.net
--------------------------------------------------------------------------------
Index: Yabs/SandboxResource.pm
===================================================================
--- Yabs/SandboxResource.pm	(revision 2948826)
+++ Yabs/SandboxResource.pm	(working copy)
@@ -23,7 +23,7 @@
 	return $self;
 }

-method get_with_retries(:$url!, :$retries = 10) {
+method get_with_retries(:$url!, :$retries = 1) {
 	my $data = undef;

 	while ($retries-- > 0) {
================================================================================

================================================================================
Internal CQueue error on 1 host(s): +man1-5554-23202.vm.search.yandex.net
--------------------------------------------------------------------------------
Authentication as `olegts` failed: invalid credentials
================================================================================

================================================================================
Internal CQueue error on 8 host(s): +man1-5568-23202.vm.search.yandex.net +man1-8294-23202.vm.search.yandex.net +man1-8299-23202.vm.search.yandex.net +man1-8310-23202.vm.search.yandex.net +man1-8318-23202.vm.search.yandex.net +sas1-5776-23202.vm.search.yandex.net +sas1-5779-23202.vm.search.yandex.net +sas1-5783-23202.vm.search.yandex.net
--------------------------------------------------------------------------------
Timeout: Host is silent
================================================================================



iolegts@sas1-6325-23202:~$ sky run "sudo patch -p0   /usr/share/perl5/Yabs/SandboxResource.pm  < diff"   +G@MAN_AUTOBUDGET_GUEST:stable-97-r101 +G@VLA_AUTOBUDGET_GUEST:stable-99-r185 +G@MAN_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@SAS_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@VLA_AUTOBUDGET_PRE_GUEST:stable-100-r2 +G@SAS_AUTOBUDGET_GUEST:stable-97-r101
================================================================================
Success on 213 host(s): +man1-0061-23202.vm.search.yandex.net +man1-0150-23202.vm.search.yandex.net +man1-3905-23202.vm.search.yandex.net +man1-4639-23202.vm.search.yandex.net +man1-4642-23202.vm.search.yandex.net +man1-4650-23202.vm.search.yandex.net +man1-4652-23202.vm.search.yandex.net +man1-4663-23202.vm.search.yandex.net +man1-4669-23202.vm.search.yandex.net +man1-4673-23202.vm.search.yandex.net +man1-4680-23202.vm.search.yandex.net +man1-4687-23202.vm.search.yandex.net +man1-4692-23202.vm.search.yandex.net +man1-5445-23202.vm.search.yandex.net +man1-5461-23202.vm.search.yandex.net +man1-5475-23202.vm.search.yandex.net +man1-5477-23202.vm.search.yandex.net +man1-5485-23202.vm.search.yandex.net +man1-5496-23202.vm.search.yandex.net +man1-5498-23202.vm.search.yandex.net +man1-5499-23202.vm.search.yandex.net +man1-5505-23202.vm.search.yandex.net +man1-5508-23202.vm.search.yandex.net +man1-5512-23202.vm.search.yandex.net +man1-5514-23202.vm.search.yandex.net +man1-5551-23202.vm.search.yandex.net +man1-6031-23202.vm.search.yandex.net +man1-6573-23202.vm.search.yandex.net +man1-6846-23202.vm.search.yandex.net +man1-6881-23202.vm.search.yandex.net +man1-6894-23202.vm.search.yandex.net +man1-6901-23202.vm.search.yandex.net +man1-7124-23202.vm.search.yandex.net +man1-7167-23202.vm.search.yandex.net +man1-7173-23202.vm.search.yandex.net +man1-7185-23202.vm.search.yandex.net +man1-7193-23202.vm.search.yandex.net +man1-7194-23202.vm.search.yandex.net +man1-7195-23202.vm.search.yandex.net +man1-7205-23202.vm.search.yandex.net +man1-7217-23202.vm.search.yandex.net +man1-7218-23202.vm.search.yandex.net +man1-7412-23202.vm.search.yandex.net +man1-7488-23202.vm.search.yandex.net +man1-7524-23202.vm.search.yandex.net +man1-7527-23202.vm.search.yandex.net +man1-7546-23202.vm.search.yandex.net +man1-7554-23202.vm.search.yandex.net +man1-7556-23202.vm.search.yandex.net +man1-7644-23202.vm.search.yandex.net +man1-8093-23202.vm.search.yandex.net +man1-8112-23202.vm.search.yandex.net +man1-8120-23202.vm.search.yandex.net +man1-8126-23202.vm.search.yandex.net +man1-8129-23202.vm.search.yandex.net +man1-8145-23202.vm.search.yandex.net +man1-8176-23202.vm.search.yandex.net +man1-8213-23202.vm.search.yandex.net +man1-8216-23202.vm.search.yandex.net +man1-8219-23202.vm.search.yandex.net +man1-8227-23202.vm.search.yandex.net +man1-8246-23202.vm.search.yandex.net +man1-8247-23202.vm.search.yandex.net +man1-8248-23202.vm.search.yandex.net +man1-8252-23202.vm.search.yandex.net +man1-8258-23202.vm.search.yandex.net +man1-8272-23202.vm.search.yandex.net +man1-8273-23202.vm.search.yandex.net +man1-8288-23202.vm.search.yandex.net +sas1-1090-23202.vm.search.yandex.net +sas1-1478-23202.vm.search.yandex.net +sas1-1479-23202.vm.search.yandex.net +sas1-1486-23202.vm.search.yandex.net +sas1-1496-23202.vm.search.yandex.net +sas1-1532-23202.vm.search.yandex.net +sas1-1567-23202.vm.search.yandex.net +sas1-1577-23202.vm.search.yandex.net +sas1-1998-23202.vm.search.yandex.net +sas1-2000-23202.vm.search.yandex.net +sas1-5765-23202.vm.search.yandex.net +sas1-5771-23202.vm.search.yandex.net +sas1-5773-23202.vm.search.yandex.net +sas1-5774-23202.vm.search.yandex.net +sas1-5792-23202.vm.search.yandex.net +sas1-5884-23202.vm.search.yandex.net +sas1-5906-23202.vm.search.yandex.net +sas1-6025-23202.vm.search.yandex.net +sas1-6055-23202.vm.search.yandex.net +sas1-6099-23202.vm.search.yandex.net +sas1-6149-23202.vm.search.yandex.net +sas1-6192-23202.vm.search.yandex.net +sas1-6202-23202.vm.search.yandex.net +sas1-6207-23202.vm.search.yandex.net +sas1-6311-23202.vm.search.yandex.net +sas1-6312-23202.vm.search.yandex.net +sas1-6325-23202.vm.search.yandex.net +sas1-6353-23202.vm.search.yandex.net +sas1-6359-23202.vm.search.yandex.net +sas1-6378-23202.vm.search.yandex.net +sas1-6411-23202.vm.search.yandex.net +sas1-6422-23202.vm.search.yandex.net +sas1-6466-23202.vm.search.yandex.net +sas1-6467-23202.vm.search.yandex.net +sas1-6534-23202.vm.search.yandex.net +sas1-6535-23202.vm.search.yandex.net +sas1-6542-23202.vm.search.yandex.net +sas1-6545-23202.vm.search.yandex.net +sas1-6580-23202.vm.search.yandex.net +sas1-6630-23202.vm.search.yandex.net +sas1-6631-23202.vm.search.yandex.net +sas1-6714-23202.vm.search.yandex.net +sas1-6715-23202.vm.search.yandex.net +sas1-6739-23202.vm.search.yandex.net +sas1-6745-23202.vm.search.yandex.net +sas1-6782-23202.vm.search.yandex.net +sas1-6807-23202.vm.search.yandex.net +sas1-6808-23202.vm.search.yandex.net +sas1-6815-23202.vm.search.yandex.net +sas1-6849-23202.vm.search.yandex.net +sas1-6852-23202.vm.search.yandex.net +sas1-6890-23202.vm.search.yandex.net +sas1-6928-23202.vm.search.yandex.net +sas1-6929-23202.vm.search.yandex.net +sas1-6961-23202.vm.search.yandex.net +sas1-6969-23202.vm.search.yandex.net +sas1-7006-23202.vm.search.yandex.net +sas1-7011-23202.vm.search.yandex.net +sas1-7040-23202.vm.search.yandex.net +sas1-7042-23202.vm.search.yandex.net +sas1-7110-23202.vm.search.yandex.net +sas1-7115-23202.vm.search.yandex.net +sas1-7120-23202.vm.search.yandex.net +sas1-7123-23202.vm.search.yandex.net +sas1-7161-23202.vm.search.yandex.net +sas1-7162-23202.vm.search.yandex.net +sas1-7197-23202.vm.search.yandex.net +sas1-7199-23202.vm.search.yandex.net +sas1-7232-23202.vm.search.yandex.net +vla1-0092-23202.vm.search.yandex.net +vla1-0094-23202.vm.search.yandex.net +vla1-0096-23202.vm.search.yandex.net +vla1-0097-23202.vm.search.yandex.net +vla1-0098-23202.vm.search.yandex.net +vla1-0100-23202.vm.search.yandex.net +vla1-0101-23202.vm.search.yandex.net +vla1-0102-23202.vm.search.yandex.net +vla1-0104-23202.vm.search.yandex.net +vla1-0105-23202.vm.search.yandex.net +vla1-0106-23202.vm.search.yandex.net +vla1-0107-23202.vm.search.yandex.net +vla1-0108-23202.vm.search.yandex.net +vla1-0109-23202.vm.search.yandex.net +vla1-0110-23202.vm.search.yandex.net +vla1-0111-23202.vm.search.yandex.net +vla1-0112-23202.vm.search.yandex.net +vla1-0115-23202.vm.search.yandex.net +vla1-0119-23202.vm.search.yandex.net +vla1-0124-23202.vm.search.yandex.net +vla1-0872-23202.vm.search.yandex.net +vla1-0900-23202.vm.search.yandex.net +vla1-1041-23202.vm.search.yandex.net +vla1-1150-23202.vm.search.yandex.net +vla1-1291-23202.vm.search.yandex.net +vla1-1637-23202.vm.search.yandex.net +vla1-1639-23202.vm.search.yandex.net +vla1-1643-23202.vm.search.yandex.net +vla1-1647-23202.vm.search.yandex.net +vla1-1716-23202.vm.search.yandex.net +vla1-1742-23202.vm.search.yandex.net +vla1-1872-23202.vm.search.yandex.net +vla1-1873-23202.vm.search.yandex.net +vla1-2068-23202.vm.search.yandex.net +vla1-2721-23202.vm.search.yandex.net +vla1-2725-23202.vm.search.yandex.net +vla1-2736-23202.vm.search.yandex.net +vla1-2742-23202.vm.search.yandex.net +vla1-2743-23202.vm.search.yandex.net +vla1-2744-23202.vm.search.yandex.net +vla1-2749-23202.vm.search.yandex.net +vla1-2753-23202.vm.search.yandex.net +vla1-2771-23202.vm.search.yandex.net +vla1-2776-23202.vm.search.yandex.net +vla1-2799-23202.vm.search.yandex.net +vla1-2806-23202.vm.search.yandex.net +vla1-2809-23202.vm.search.yandex.net +vla1-2832-23202.vm.search.yandex.net +vla1-2855-23202.vm.search.yandex.net +vla1-2861-23202.vm.search.yandex.net +vla1-2863-23202.vm.search.yandex.net +vla1-2865-23202.vm.search.yandex.net +vla1-2867-23202.vm.search.yandex.net +vla1-2874-23202.vm.search.yandex.net +vla1-2884-23202.vm.search.yandex.net +vla1-2888-23202.vm.search.yandex.net +vla1-2892-23202.vm.search.yandex.net +vla1-2893-23202.vm.search.yandex.net +vla1-2902-23202.vm.search.yandex.net +vla1-2908-23202.vm.search.yandex.net +vla1-2941-23202.vm.search.yandex.net +vla1-2986-23202.vm.search.yandex.net +vla1-2989-23202.vm.search.yandex.net +vla1-3126-23202.vm.search.yandex.net +vla1-3135-23202.vm.search.yandex.net +vla1-3141-23202.vm.search.yandex.net +vla1-3165-23202.vm.search.yandex.net +vla1-3176-23202.vm.search.yandex.net +vla1-3187-23202.vm.search.yandex.net +vla1-3195-23202.vm.search.yandex.net +vla1-3252-23202.vm.search.yandex.net +vla1-3340-23202.vm.search.yandex.net +vla1-3348-23202.vm.search.yandex.net +vla1-3441-23202.vm.search.yandex.net +vla1-4422-23202.vm.search.yandex.net
--------------------------------------------------------------------------------
patching file /usr/share/perl5/Yabs/SandboxResource.pm
================================================================================

================================================================================
Internal CQueue error on 9 host(s): +man1-5554-23202.vm.search.yandex.net +man1-5568-23202.vm.search.yandex.net +man1-8294-23202.vm.search.yandex.net +man1-8299-23202.vm.search.yandex.net +man1-8310-23202.vm.search.yandex.net +man1-8318-23202.vm.search.yandex.net +sas1-5776-23202.vm.search.yandex.net +sas1-5779-23202.vm.search.yandex.net +sas1-5783-23202.vm.search.yandex.net
--------------------------------------------------------------------------------
Timeout: Host is silent
================================================================================




olegts@sas1-6325-23202:~$ sky run "md5sum /usr/share/perl5/Yabs/SandboxResource.pm && grep 'method get_with_retries' /usr/share/perl5/Yabs/SandboxResource.pm "  +G@MAN_AUTOBUDGET_GUEST:stable-97-r101 +G@VLA_AUTOBUDGET_GUEST:stable-99-r185 +G@MAN_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@SAS_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@VLA_AUTOBUDGET_PRE_GUEST:stable-100-r2 +G@SAS_AUTOBUDGET_GUEST:stable-97-r101
================================================================================
Success on 213 host(s): +man1-0061-23202.vm.search.yandex.net +man1-0150-23202.vm.search.yandex.net +man1-3905-23202.vm.search.yandex.net +man1-4639-23202.vm.search.yandex.net +man1-4642-23202.vm.search.yandex.net +man1-4650-23202.vm.search.yandex.net +man1-4652-23202.vm.search.yandex.net +man1-4663-23202.vm.search.yandex.net +man1-4669-23202.vm.search.yandex.net +man1-4673-23202.vm.search.yandex.net +man1-4680-23202.vm.search.yandex.net +man1-4687-23202.vm.search.yandex.net +man1-4692-23202.vm.search.yandex.net +man1-5445-23202.vm.search.yandex.net +man1-5461-23202.vm.search.yandex.net +man1-5475-23202.vm.search.yandex.net +man1-5477-23202.vm.search.yandex.net +man1-5485-23202.vm.search.yandex.net +man1-5496-23202.vm.search.yandex.net +man1-5498-23202.vm.search.yandex.net +man1-5499-23202.vm.search.yandex.net +man1-5505-23202.vm.search.yandex.net +man1-5508-23202.vm.search.yandex.net +man1-5512-23202.vm.search.yandex.net +man1-5514-23202.vm.search.yandex.net +man1-5551-23202.vm.search.yandex.net +man1-6031-23202.vm.search.yandex.net +man1-6573-23202.vm.search.yandex.net +man1-6846-23202.vm.search.yandex.net +man1-6881-23202.vm.search.yandex.net +man1-6894-23202.vm.search.yandex.net +man1-6901-23202.vm.search.yandex.net +man1-7124-23202.vm.search.yandex.net +man1-7167-23202.vm.search.yandex.net +man1-7173-23202.vm.search.yandex.net +man1-7185-23202.vm.search.yandex.net +man1-7193-23202.vm.search.yandex.net +man1-7194-23202.vm.search.yandex.net +man1-7195-23202.vm.search.yandex.net +man1-7205-23202.vm.search.yandex.net +man1-7217-23202.vm.search.yandex.net +man1-7218-23202.vm.search.yandex.net +man1-7412-23202.vm.search.yandex.net +man1-7488-23202.vm.search.yandex.net +man1-7524-23202.vm.search.yandex.net +man1-7527-23202.vm.search.yandex.net +man1-7546-23202.vm.search.yandex.net +man1-7554-23202.vm.search.yandex.net +man1-7556-23202.vm.search.yandex.net +man1-7644-23202.vm.search.yandex.net +man1-8093-23202.vm.search.yandex.net +man1-8112-23202.vm.search.yandex.net +man1-8120-23202.vm.search.yandex.net +man1-8126-23202.vm.search.yandex.net +man1-8129-23202.vm.search.yandex.net +man1-8145-23202.vm.search.yandex.net +man1-8176-23202.vm.search.yandex.net +man1-8213-23202.vm.search.yandex.net +man1-8216-23202.vm.search.yandex.net +man1-8219-23202.vm.search.yandex.net +man1-8227-23202.vm.search.yandex.net +man1-8246-23202.vm.search.yandex.net +man1-8247-23202.vm.search.yandex.net +man1-8248-23202.vm.search.yandex.net +man1-8252-23202.vm.search.yandex.net +man1-8258-23202.vm.search.yandex.net +man1-8272-23202.vm.search.yandex.net +man1-8273-23202.vm.search.yandex.net +man1-8288-23202.vm.search.yandex.net +sas1-1090-23202.vm.search.yandex.net +sas1-1478-23202.vm.search.yandex.net +sas1-1479-23202.vm.search.yandex.net +sas1-1486-23202.vm.search.yandex.net +sas1-1496-23202.vm.search.yandex.net +sas1-1532-23202.vm.search.yandex.net +sas1-1567-23202.vm.search.yandex.net +sas1-1577-23202.vm.search.yandex.net +sas1-1998-23202.vm.search.yandex.net +sas1-2000-23202.vm.search.yandex.net +sas1-5765-23202.vm.search.yandex.net +sas1-5771-23202.vm.search.yandex.net +sas1-5773-23202.vm.search.yandex.net +sas1-5774-23202.vm.search.yandex.net +sas1-5792-23202.vm.search.yandex.net +sas1-5884-23202.vm.search.yandex.net +sas1-5906-23202.vm.search.yandex.net +sas1-6025-23202.vm.search.yandex.net +sas1-6055-23202.vm.search.yandex.net +sas1-6099-23202.vm.search.yandex.net +sas1-6149-23202.vm.search.yandex.net +sas1-6192-23202.vm.search.yandex.net +sas1-6202-23202.vm.search.yandex.net +sas1-6207-23202.vm.search.yandex.net +sas1-6311-23202.vm.search.yandex.net +sas1-6312-23202.vm.search.yandex.net +sas1-6325-23202.vm.search.yandex.net +sas1-6353-23202.vm.search.yandex.net +sas1-6359-23202.vm.search.yandex.net +sas1-6378-23202.vm.search.yandex.net +sas1-6411-23202.vm.search.yandex.net +sas1-6422-23202.vm.search.yandex.net +sas1-6466-23202.vm.search.yandex.net +sas1-6467-23202.vm.search.yandex.net +sas1-6534-23202.vm.search.yandex.net +sas1-6535-23202.vm.search.yandex.net +sas1-6542-23202.vm.search.yandex.net +sas1-6545-23202.vm.search.yandex.net +sas1-6580-23202.vm.search.yandex.net +sas1-6630-23202.vm.search.yandex.net +sas1-6631-23202.vm.search.yandex.net +sas1-6714-23202.vm.search.yandex.net +sas1-6715-23202.vm.search.yandex.net +sas1-6739-23202.vm.search.yandex.net +sas1-6745-23202.vm.search.yandex.net +sas1-6782-23202.vm.search.yandex.net +sas1-6807-23202.vm.search.yandex.net +sas1-6808-23202.vm.search.yandex.net +sas1-6815-23202.vm.search.yandex.net +sas1-6849-23202.vm.search.yandex.net +sas1-6852-23202.vm.search.yandex.net +sas1-6890-23202.vm.search.yandex.net +sas1-6928-23202.vm.search.yandex.net +sas1-6929-23202.vm.search.yandex.net +sas1-6961-23202.vm.search.yandex.net +sas1-6969-23202.vm.search.yandex.net +sas1-7006-23202.vm.search.yandex.net +sas1-7011-23202.vm.search.yandex.net +sas1-7040-23202.vm.search.yandex.net +sas1-7042-23202.vm.search.yandex.net +sas1-7110-23202.vm.search.yandex.net +sas1-7115-23202.vm.search.yandex.net +sas1-7120-23202.vm.search.yandex.net +sas1-7123-23202.vm.search.yandex.net +sas1-7161-23202.vm.search.yandex.net +sas1-7162-23202.vm.search.yandex.net +sas1-7197-23202.vm.search.yandex.net +sas1-7199-23202.vm.search.yandex.net +sas1-7232-23202.vm.search.yandex.net +vla1-0092-23202.vm.search.yandex.net +vla1-0094-23202.vm.search.yandex.net +vla1-0096-23202.vm.search.yandex.net +vla1-0097-23202.vm.search.yandex.net +vla1-0098-23202.vm.search.yandex.net +vla1-0100-23202.vm.search.yandex.net +vla1-0101-23202.vm.search.yandex.net +vla1-0102-23202.vm.search.yandex.net +vla1-0104-23202.vm.search.yandex.net +vla1-0105-23202.vm.search.yandex.net +vla1-0106-23202.vm.search.yandex.net +vla1-0107-23202.vm.search.yandex.net +vla1-0108-23202.vm.search.yandex.net +vla1-0109-23202.vm.search.yandex.net +vla1-0110-23202.vm.search.yandex.net +vla1-0111-23202.vm.search.yandex.net +vla1-0112-23202.vm.search.yandex.net +vla1-0115-23202.vm.search.yandex.net +vla1-0119-23202.vm.search.yandex.net +vla1-0124-23202.vm.search.yandex.net +vla1-0872-23202.vm.search.yandex.net +vla1-0900-23202.vm.search.yandex.net +vla1-1041-23202.vm.search.yandex.net +vla1-1150-23202.vm.search.yandex.net +vla1-1291-23202.vm.search.yandex.net +vla1-1637-23202.vm.search.yandex.net +vla1-1639-23202.vm.search.yandex.net +vla1-1643-23202.vm.search.yandex.net +vla1-1647-23202.vm.search.yandex.net +vla1-1716-23202.vm.search.yandex.net +vla1-1742-23202.vm.search.yandex.net +vla1-1872-23202.vm.search.yandex.net +vla1-1873-23202.vm.search.yandex.net +vla1-2068-23202.vm.search.yandex.net +vla1-2721-23202.vm.search.yandex.net +vla1-2725-23202.vm.search.yandex.net +vla1-2736-23202.vm.search.yandex.net +vla1-2742-23202.vm.search.yandex.net +vla1-2743-23202.vm.search.yandex.net +vla1-2744-23202.vm.search.yandex.net +vla1-2749-23202.vm.search.yandex.net +vla1-2753-23202.vm.search.yandex.net +vla1-2771-23202.vm.search.yandex.net +vla1-2776-23202.vm.search.yandex.net +vla1-2799-23202.vm.search.yandex.net +vla1-2806-23202.vm.search.yandex.net +vla1-2809-23202.vm.search.yandex.net +vla1-2832-23202.vm.search.yandex.net +vla1-2855-23202.vm.search.yandex.net +vla1-2861-23202.vm.search.yandex.net +vla1-2863-23202.vm.search.yandex.net +vla1-2865-23202.vm.search.yandex.net +vla1-2867-23202.vm.search.yandex.net +vla1-2874-23202.vm.search.yandex.net +vla1-2884-23202.vm.search.yandex.net +vla1-2888-23202.vm.search.yandex.net +vla1-2892-23202.vm.search.yandex.net +vla1-2893-23202.vm.search.yandex.net +vla1-2902-23202.vm.search.yandex.net +vla1-2908-23202.vm.search.yandex.net +vla1-2941-23202.vm.search.yandex.net +vla1-2986-23202.vm.search.yandex.net +vla1-2989-23202.vm.search.yandex.net +vla1-3126-23202.vm.search.yandex.net +vla1-3135-23202.vm.search.yandex.net +vla1-3141-23202.vm.search.yandex.net +vla1-3165-23202.vm.search.yandex.net +vla1-3176-23202.vm.search.yandex.net +vla1-3187-23202.vm.search.yandex.net +vla1-3195-23202.vm.search.yandex.net +vla1-3252-23202.vm.search.yandex.net +vla1-3340-23202.vm.search.yandex.net +vla1-3348-23202.vm.search.yandex.net +vla1-3441-23202.vm.search.yandex.net +vla1-4422-23202.vm.search.yandex.net
--------------------------------------------------------------------------------
d4395d6c58b9ec0477d95282aecc2528  /usr/share/perl5/Yabs/SandboxResource.pm
method get_with_retries(:$url!, :$retries = 1) {
================================================================================

================================================================================
Internal CQueue error on 9 host(s): +man1-5554-23202.vm.search.yandex.net +man1-5568-23202.vm.search.yandex.net +man1-8294-23202.vm.search.yandex.net +man1-8299-23202.vm.search.yandex.net +man1-8310-23202.vm.search.yandex.net +man1-8318-23202.vm.search.yandex.net +sas1-5776-23202.vm.search.yandex.net +sas1-5779-23202.vm.search.yandex.net +sas1-5783-23202.vm.search.yandex.net
--------------------------------------------------------------------------------
Timeout: Host is silent
================================================================================


\


sas1-6325-23202.vm.search.yandex.net


olegts@sas1-6325-23202:~$ sky upload host-options-cron-diff . +G@MAN_AUTOBUDGET_GUEST:stable-97-r101 +G@VLA_AUTOBUDGET_GUEST:stable-99-r185 +G@MAN_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@SAS_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@VLA_AUTOBUDGET_PRE_GUEST:stable-100-r2 +G@SAS_AUTOBUDGET_GUEST:stable-97-r101
^[[D================================================================================
Internal CQueue error on 9 host(s): +man1-5554-23202.vm.search.yandex.net +man1-5568-23202.vm.search.yandex.net +man1-8294-23202.vm.search.yandex.net +man1-8299-23202.vm.search.yandex.net +man1-8310-23202.vm.search.yandex.net +man1-8318-23202.vm.search.yandex.net +sas1-5776-23202.vm.search.yandex.net +sas1-5779-23202.vm.search.yandex.net +sas1-5783-23202.vm.search.yandex.net
--------------------------------------------------------------------------------
Timeout: Host is silent
================================================================================

olegts@sas1-6325-23202:~$ sky upload host-options-random-sleep-diff . +G@MAN_AUTOBUDGET_GUEST:stable-97-r101 +G@VLA_AUTOBUDGET_GUEST:stable-99-r185 +G@MAN_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@SAS_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@VLA_AUTOBUDGET_PRE_GUEST:stable-100-r2 +G@SAS_AUTOBUDGET_GUEST:stable-97-r101
================================================================================
Internal CQueue error on 9 host(s): +man1-5554-23202.vm.search.yandex.net +man1-5568-23202.vm.search.yandex.net +man1-8294-23202.vm.search.yandex.net +man1-8299-23202.vm.search.yandex.net +man1-8310-23202.vm.search.yandex.net +man1-8318-23202.vm.search.yandex.net +sas1-5776-23202.vm.search.yandex.net +sas1-5779-23202.vm.search.yandex.net +sas1-5783-23202.vm.search.yandex.net
--------------------------------------------------------------------------------
Timeout: Host is silent
================================================================================

olegts@sas1-6325-23202:~$ sky run "sudo patch -p0 /home/yabs/stat/bring-host-options.pl < host-options-random-sleep-diff" +G@MAN_AUTOBUDGET_GUEST:stable-97-r101 +G@VLA_AUTOBUDGET_GUEST:stable-99-r185 +G@MAN_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@SAS_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@VLA_AUTOBUDGET_PRE_GUEST:stable-100-r2 +G@SAS_AUTOBUDGET_GUEST:stable-97-r101
================================================================================
Success on 213 host(s): +man1-0061-23202.vm.search.yandex.net +man1-0150-23202.vm.search.yandex.net +man1-3905-23202.vm.search.yandex.net +man1-4639-23202.vm.search.yandex.net +man1-4642-23202.vm.search.yandex.net +man1-4650-23202.vm.search.yandex.net +man1-4652-23202.vm.search.yandex.net +man1-4663-23202.vm.search.yandex.net +man1-4669-23202.vm.search.yandex.net +man1-4673-23202.vm.search.yandex.net +man1-4680-23202.vm.search.yandex.net +man1-4687-23202.vm.search.yandex.net +man1-4692-23202.vm.search.yandex.net +man1-5445-23202.vm.search.yandex.net +man1-5461-23202.vm.search.yandex.net +man1-5475-23202.vm.search.yandex.net +man1-5477-23202.vm.search.yandex.net +man1-5485-23202.vm.search.yandex.net +man1-5496-23202.vm.search.yandex.net +man1-5498-23202.vm.search.yandex.net +man1-5499-23202.vm.search.yandex.net +man1-5505-23202.vm.search.yandex.net +man1-5508-23202.vm.search.yandex.net +man1-5512-23202.vm.search.yandex.net +man1-5514-23202.vm.search.yandex.net +man1-5551-23202.vm.search.yandex.net +man1-6031-23202.vm.search.yandex.net +man1-6573-23202.vm.search.yandex.net +man1-6846-23202.vm.search.yandex.net +man1-6881-23202.vm.search.yandex.net +man1-6894-23202.vm.search.yandex.net +man1-6901-23202.vm.search.yandex.net +man1-7124-23202.vm.search.yandex.net +man1-7167-23202.vm.search.yandex.net +man1-7173-23202.vm.search.yandex.net +man1-7185-23202.vm.search.yandex.net +man1-7193-23202.vm.search.yandex.net +man1-7194-23202.vm.search.yandex.net +man1-7195-23202.vm.search.yandex.net +man1-7205-23202.vm.search.yandex.net +man1-7217-23202.vm.search.yandex.net +man1-7218-23202.vm.search.yandex.net +man1-7412-23202.vm.search.yandex.net +man1-7488-23202.vm.search.yandex.net +man1-7524-23202.vm.search.yandex.net +man1-7527-23202.vm.search.yandex.net +man1-7546-23202.vm.search.yandex.net +man1-7554-23202.vm.search.yandex.net +man1-7556-23202.vm.search.yandex.net +man1-7644-23202.vm.search.yandex.net +man1-8093-23202.vm.search.yandex.net +man1-8112-23202.vm.search.yandex.net +man1-8120-23202.vm.search.yandex.net +man1-8126-23202.vm.search.yandex.net +man1-8129-23202.vm.search.yandex.net +man1-8145-23202.vm.search.yandex.net +man1-8176-23202.vm.search.yandex.net +man1-8213-23202.vm.search.yandex.net +man1-8216-23202.vm.search.yandex.net +man1-8219-23202.vm.search.yandex.net +man1-8227-23202.vm.search.yandex.net +man1-8246-23202.vm.search.yandex.net +man1-8247-23202.vm.search.yandex.net +man1-8248-23202.vm.search.yandex.net +man1-8252-23202.vm.search.yandex.net +man1-8258-23202.vm.search.yandex.net +man1-8272-23202.vm.search.yandex.net +man1-8273-23202.vm.search.yandex.net +man1-8288-23202.vm.search.yandex.net +sas1-1090-23202.vm.search.yandex.net +sas1-1478-23202.vm.search.yandex.net +sas1-1479-23202.vm.search.yandex.net +sas1-1486-23202.vm.search.yandex.net +sas1-1496-23202.vm.search.yandex.net +sas1-1532-23202.vm.search.yandex.net +sas1-1567-23202.vm.search.yandex.net +sas1-1577-23202.vm.search.yandex.net +sas1-1998-23202.vm.search.yandex.net +sas1-2000-23202.vm.search.yandex.net +sas1-5765-23202.vm.search.yandex.net +sas1-5771-23202.vm.search.yandex.net +sas1-5773-23202.vm.search.yandex.net +sas1-5774-23202.vm.search.yandex.net +sas1-5792-23202.vm.search.yandex.net +sas1-5884-23202.vm.search.yandex.net +sas1-5906-23202.vm.search.yandex.net +sas1-6025-23202.vm.search.yandex.net +sas1-6055-23202.vm.search.yandex.net +sas1-6099-23202.vm.search.yandex.net +sas1-6149-23202.vm.search.yandex.net +sas1-6192-23202.vm.search.yandex.net +sas1-6202-23202.vm.search.yandex.net +sas1-6207-23202.vm.search.yandex.net +sas1-6311-23202.vm.search.yandex.net +sas1-6312-23202.vm.search.yandex.net +sas1-6325-23202.vm.search.yandex.net +sas1-6353-23202.vm.search.yandex.net +sas1-6359-23202.vm.search.yandex.net +sas1-6378-23202.vm.search.yandex.net +sas1-6411-23202.vm.search.yandex.net +sas1-6422-23202.vm.search.yandex.net +sas1-6466-23202.vm.search.yandex.net +sas1-6467-23202.vm.search.yandex.net +sas1-6534-23202.vm.search.yandex.net +sas1-6535-23202.vm.search.yandex.net +sas1-6542-23202.vm.search.yandex.net +sas1-6545-23202.vm.search.yandex.net +sas1-6580-23202.vm.search.yandex.net +sas1-6630-23202.vm.search.yandex.net +sas1-6631-23202.vm.search.yandex.net +sas1-6714-23202.vm.search.yandex.net +sas1-6715-23202.vm.search.yandex.net +sas1-6739-23202.vm.search.yandex.net +sas1-6745-23202.vm.search.yandex.net +sas1-6782-23202.vm.search.yandex.net +sas1-6807-23202.vm.search.yandex.net +sas1-6808-23202.vm.search.yandex.net +sas1-6815-23202.vm.search.yandex.net +sas1-6849-23202.vm.search.yandex.net +sas1-6852-23202.vm.search.yandex.net +sas1-6890-23202.vm.search.yandex.net +sas1-6928-23202.vm.search.yandex.net +sas1-6929-23202.vm.search.yandex.net +sas1-6961-23202.vm.search.yandex.net +sas1-6969-23202.vm.search.yandex.net +sas1-7006-23202.vm.search.yandex.net +sas1-7011-23202.vm.search.yandex.net +sas1-7040-23202.vm.search.yandex.net +sas1-7042-23202.vm.search.yandex.net +sas1-7110-23202.vm.search.yandex.net +sas1-7115-23202.vm.search.yandex.net +sas1-7120-23202.vm.search.yandex.net +sas1-7123-23202.vm.search.yandex.net +sas1-7161-23202.vm.search.yandex.net +sas1-7162-23202.vm.search.yandex.net +sas1-7197-23202.vm.search.yandex.net +sas1-7199-23202.vm.search.yandex.net +sas1-7232-23202.vm.search.yandex.net +vla1-0092-23202.vm.search.yandex.net +vla1-0094-23202.vm.search.yandex.net +vla1-0096-23202.vm.search.yandex.net +vla1-0097-23202.vm.search.yandex.net +vla1-0098-23202.vm.search.yandex.net +vla1-0100-23202.vm.search.yandex.net +vla1-0101-23202.vm.search.yandex.net +vla1-0102-23202.vm.search.yandex.net +vla1-0104-23202.vm.search.yandex.net +vla1-0105-23202.vm.search.yandex.net +vla1-0106-23202.vm.search.yandex.net +vla1-0107-23202.vm.search.yandex.net +vla1-0108-23202.vm.search.yandex.net +vla1-0109-23202.vm.search.yandex.net +vla1-0110-23202.vm.search.yandex.net +vla1-0111-23202.vm.search.yandex.net +vla1-0112-23202.vm.search.yandex.net +vla1-0115-23202.vm.search.yandex.net +vla1-0119-23202.vm.search.yandex.net +vla1-0124-23202.vm.search.yandex.net +vla1-0872-23202.vm.search.yandex.net +vla1-0900-23202.vm.search.yandex.net +vla1-1041-23202.vm.search.yandex.net +vla1-1150-23202.vm.search.yandex.net +vla1-1291-23202.vm.search.yandex.net +vla1-1637-23202.vm.search.yandex.net +vla1-1639-23202.vm.search.yandex.net +vla1-1643-23202.vm.search.yandex.net +vla1-1647-23202.vm.search.yandex.net +vla1-1716-23202.vm.search.yandex.net +vla1-1742-23202.vm.search.yandex.net +vla1-1872-23202.vm.search.yandex.net +vla1-1873-23202.vm.search.yandex.net +vla1-2068-23202.vm.search.yandex.net +vla1-2721-23202.vm.search.yandex.net +vla1-2725-23202.vm.search.yandex.net +vla1-2736-23202.vm.search.yandex.net +vla1-2742-23202.vm.search.yandex.net +vla1-2743-23202.vm.search.yandex.net +vla1-2744-23202.vm.search.yandex.net +vla1-2749-23202.vm.search.yandex.net +vla1-2753-23202.vm.search.yandex.net +vla1-2771-23202.vm.search.yandex.net +vla1-2776-23202.vm.search.yandex.net +vla1-2799-23202.vm.search.yandex.net +vla1-2806-23202.vm.search.yandex.net +vla1-2809-23202.vm.search.yandex.net +vla1-2832-23202.vm.search.yandex.net +vla1-2855-23202.vm.search.yandex.net +vla1-2861-23202.vm.search.yandex.net +vla1-2863-23202.vm.search.yandex.net +vla1-2865-23202.vm.search.yandex.net +vla1-2867-23202.vm.search.yandex.net +vla1-2874-23202.vm.search.yandex.net +vla1-2884-23202.vm.search.yandex.net +vla1-2888-23202.vm.search.yandex.net +vla1-2892-23202.vm.search.yandex.net +vla1-2893-23202.vm.search.yandex.net +vla1-2902-23202.vm.search.yandex.net +vla1-2908-23202.vm.search.yandex.net +vla1-2941-23202.vm.search.yandex.net +vla1-2986-23202.vm.search.yandex.net +vla1-2989-23202.vm.search.yandex.net +vla1-3126-23202.vm.search.yandex.net +vla1-3135-23202.vm.search.yandex.net +vla1-3141-23202.vm.search.yandex.net +vla1-3165-23202.vm.search.yandex.net +vla1-3176-23202.vm.search.yandex.net +vla1-3187-23202.vm.search.yandex.net +vla1-3195-23202.vm.search.yandex.net +vla1-3252-23202.vm.search.yandex.net +vla1-3340-23202.vm.search.yandex.net +vla1-3348-23202.vm.search.yandex.net +vla1-3441-23202.vm.search.yandex.net +vla1-4422-23202.vm.search.yandex.net
--------------------------------------------------------------------------------
patching file /home/yabs/stat/bring-host-options.pl
================================================================================

================================================================================
Internal CQueue error on 9 host(s): +man1-5554-23202.vm.search.yandex.net +man1-5568-23202.vm.search.yandex.net +man1-8294-23202.vm.search.yandex.net +man1-8299-23202.vm.search.yandex.net +man1-8310-23202.vm.search.yandex.net +man1-8318-23202.vm.search.yandex.net +sas1-5776-23202.vm.search.yandex.net +sas1-5779-23202.vm.search.yandex.net +sas1-5783-23202.vm.search.yandex.net
--------------------------------------------------------------------------------
Timeout: Host is silent
================================================================================

olegts@sas1-6325-23202:~$ sky run "sudo patch -p0 /etc/cron.d/host_options < host-options-cron-diff " +G@MAN_AUTOBUDGET_GUEST:stable-97-r101 +G@VLA_AUTOBUDGET_GUEST:stable-99-r185 +G@MAN_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@SAS_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@VLA_AUTOBUDGET_PRE_GUEST:stable-100-r2 +G@SAS_AUTOBUDGET_GUEST:stable-97-r101
================================================================================
Success on 213 host(s): +man1-0061-23202.vm.search.yandex.net +man1-0150-23202.vm.search.yandex.net +man1-3905-23202.vm.search.yandex.net +man1-4639-23202.vm.search.yandex.net +man1-4642-23202.vm.search.yandex.net +man1-4650-23202.vm.search.yandex.net +man1-4652-23202.vm.search.yandex.net +man1-4663-23202.vm.search.yandex.net +man1-4669-23202.vm.search.yandex.net +man1-4673-23202.vm.search.yandex.net +man1-4680-23202.vm.search.yandex.net +man1-4687-23202.vm.search.yandex.net +man1-4692-23202.vm.search.yandex.net +man1-5445-23202.vm.search.yandex.net +man1-5461-23202.vm.search.yandex.net +man1-5475-23202.vm.search.yandex.net +man1-5477-23202.vm.search.yandex.net +man1-5485-23202.vm.search.yandex.net +man1-5496-23202.vm.search.yandex.net +man1-5498-23202.vm.search.yandex.net +man1-5499-23202.vm.search.yandex.net +man1-5505-23202.vm.search.yandex.net +man1-5508-23202.vm.search.yandex.net +man1-5512-23202.vm.search.yandex.net +man1-5514-23202.vm.search.yandex.net +man1-5551-23202.vm.search.yandex.net +man1-6031-23202.vm.search.yandex.net +man1-6573-23202.vm.search.yandex.net +man1-6846-23202.vm.search.yandex.net +man1-6881-23202.vm.search.yandex.net +man1-6894-23202.vm.search.yandex.net +man1-6901-23202.vm.search.yandex.net +man1-7124-23202.vm.search.yandex.net +man1-7167-23202.vm.search.yandex.net +man1-7173-23202.vm.search.yandex.net +man1-7185-23202.vm.search.yandex.net +man1-7193-23202.vm.search.yandex.net +man1-7194-23202.vm.search.yandex.net +man1-7195-23202.vm.search.yandex.net +man1-7205-23202.vm.search.yandex.net +man1-7217-23202.vm.search.yandex.net +man1-7218-23202.vm.search.yandex.net +man1-7412-23202.vm.search.yandex.net +man1-7488-23202.vm.search.yandex.net +man1-7524-23202.vm.search.yandex.net +man1-7527-23202.vm.search.yandex.net +man1-7546-23202.vm.search.yandex.net +man1-7554-23202.vm.search.yandex.net +man1-7556-23202.vm.search.yandex.net +man1-7644-23202.vm.search.yandex.net +man1-8093-23202.vm.search.yandex.net +man1-8112-23202.vm.search.yandex.net +man1-8120-23202.vm.search.yandex.net +man1-8126-23202.vm.search.yandex.net +man1-8129-23202.vm.search.yandex.net +man1-8145-23202.vm.search.yandex.net +man1-8176-23202.vm.search.yandex.net +man1-8213-23202.vm.search.yandex.net +man1-8216-23202.vm.search.yandex.net +man1-8219-23202.vm.search.yandex.net +man1-8227-23202.vm.search.yandex.net +man1-8246-23202.vm.search.yandex.net +man1-8247-23202.vm.search.yandex.net +man1-8248-23202.vm.search.yandex.net +man1-8252-23202.vm.search.yandex.net +man1-8258-23202.vm.search.yandex.net +man1-8272-23202.vm.search.yandex.net +man1-8273-23202.vm.search.yandex.net +man1-8288-23202.vm.search.yandex.net +sas1-1090-23202.vm.search.yandex.net +sas1-1478-23202.vm.search.yandex.net +sas1-1479-23202.vm.search.yandex.net +sas1-1486-23202.vm.search.yandex.net +sas1-1496-23202.vm.search.yandex.net +sas1-1532-23202.vm.search.yandex.net +sas1-1567-23202.vm.search.yandex.net +sas1-1577-23202.vm.search.yandex.net +sas1-1998-23202.vm.search.yandex.net +sas1-2000-23202.vm.search.yandex.net +sas1-5765-23202.vm.search.yandex.net +sas1-5771-23202.vm.search.yandex.net +sas1-5773-23202.vm.search.yandex.net +sas1-5774-23202.vm.search.yandex.net +sas1-5792-23202.vm.search.yandex.net +sas1-5884-23202.vm.search.yandex.net +sas1-5906-23202.vm.search.yandex.net +sas1-6025-23202.vm.search.yandex.net +sas1-6055-23202.vm.search.yandex.net +sas1-6099-23202.vm.search.yandex.net +sas1-6149-23202.vm.search.yandex.net +sas1-6192-23202.vm.search.yandex.net +sas1-6202-23202.vm.search.yandex.net +sas1-6207-23202.vm.search.yandex.net +sas1-6311-23202.vm.search.yandex.net +sas1-6312-23202.vm.search.yandex.net +sas1-6325-23202.vm.search.yandex.net +sas1-6353-23202.vm.search.yandex.net +sas1-6359-23202.vm.search.yandex.net +sas1-6378-23202.vm.search.yandex.net +sas1-6411-23202.vm.search.yandex.net +sas1-6422-23202.vm.search.yandex.net +sas1-6466-23202.vm.search.yandex.net +sas1-6467-23202.vm.search.yandex.net +sas1-6534-23202.vm.search.yandex.net +sas1-6535-23202.vm.search.yandex.net +sas1-6542-23202.vm.search.yandex.net +sas1-6545-23202.vm.search.yandex.net +sas1-6580-23202.vm.search.yandex.net +sas1-6630-23202.vm.search.yandex.net +sas1-6631-23202.vm.search.yandex.net +sas1-6714-23202.vm.search.yandex.net +sas1-6715-23202.vm.search.yandex.net +sas1-6739-23202.vm.search.yandex.net +sas1-6745-23202.vm.search.yandex.net +sas1-6782-23202.vm.search.yandex.net +sas1-6807-23202.vm.search.yandex.net +sas1-6808-23202.vm.search.yandex.net +sas1-6815-23202.vm.search.yandex.net +sas1-6849-23202.vm.search.yandex.net +sas1-6852-23202.vm.search.yandex.net +sas1-6890-23202.vm.search.yandex.net +sas1-6928-23202.vm.search.yandex.net +sas1-6929-23202.vm.search.yandex.net +sas1-6961-23202.vm.search.yandex.net +sas1-6969-23202.vm.search.yandex.net +sas1-7006-23202.vm.search.yandex.net +sas1-7011-23202.vm.search.yandex.net +sas1-7040-23202.vm.search.yandex.net +sas1-7042-23202.vm.search.yandex.net +sas1-7110-23202.vm.search.yandex.net +sas1-7115-23202.vm.search.yandex.net +sas1-7120-23202.vm.search.yandex.net +sas1-7123-23202.vm.search.yandex.net +sas1-7161-23202.vm.search.yandex.net +sas1-7162-23202.vm.search.yandex.net +sas1-7197-23202.vm.search.yandex.net +sas1-7199-23202.vm.search.yandex.net +sas1-7232-23202.vm.search.yandex.net +vla1-0092-23202.vm.search.yandex.net +vla1-0094-23202.vm.search.yandex.net +vla1-0096-23202.vm.search.yandex.net +vla1-0097-23202.vm.search.yandex.net +vla1-0098-23202.vm.search.yandex.net +vla1-0100-23202.vm.search.yandex.net +vla1-0101-23202.vm.search.yandex.net +vla1-0102-23202.vm.search.yandex.net +vla1-0104-23202.vm.search.yandex.net +vla1-0105-23202.vm.search.yandex.net +vla1-0106-23202.vm.search.yandex.net +vla1-0107-23202.vm.search.yandex.net +vla1-0108-23202.vm.search.yandex.net +vla1-0109-23202.vm.search.yandex.net +vla1-0110-23202.vm.search.yandex.net +vla1-0111-23202.vm.search.yandex.net +vla1-0112-23202.vm.search.yandex.net +vla1-0115-23202.vm.search.yandex.net +vla1-0119-23202.vm.search.yandex.net +vla1-0124-23202.vm.search.yandex.net +vla1-0872-23202.vm.search.yandex.net +vla1-0900-23202.vm.search.yandex.net +vla1-1041-23202.vm.search.yandex.net +vla1-1150-23202.vm.search.yandex.net +vla1-1291-23202.vm.search.yandex.net +vla1-1637-23202.vm.search.yandex.net +vla1-1639-23202.vm.search.yandex.net +vla1-1643-23202.vm.search.yandex.net +vla1-1647-23202.vm.search.yandex.net +vla1-1716-23202.vm.search.yandex.net +vla1-1742-23202.vm.search.yandex.net +vla1-1872-23202.vm.search.yandex.net +vla1-1873-23202.vm.search.yandex.net +vla1-2068-23202.vm.search.yandex.net +vla1-2721-23202.vm.search.yandex.net +vla1-2725-23202.vm.search.yandex.net +vla1-2736-23202.vm.search.yandex.net +vla1-2742-23202.vm.search.yandex.net +vla1-2743-23202.vm.search.yandex.net +vla1-2744-23202.vm.search.yandex.net +vla1-2749-23202.vm.search.yandex.net +vla1-2753-23202.vm.search.yandex.net +vla1-2771-23202.vm.search.yandex.net +vla1-2776-23202.vm.search.yandex.net +vla1-2799-23202.vm.search.yandex.net +vla1-2806-23202.vm.search.yandex.net +vla1-2809-23202.vm.search.yandex.net +vla1-2832-23202.vm.search.yandex.net +vla1-2855-23202.vm.search.yandex.net +vla1-2861-23202.vm.search.yandex.net +vla1-2863-23202.vm.search.yandex.net +vla1-2865-23202.vm.search.yandex.net +vla1-2867-23202.vm.search.yandex.net +vla1-2874-23202.vm.search.yandex.net +vla1-2884-23202.vm.search.yandex.net +vla1-2888-23202.vm.search.yandex.net +vla1-2892-23202.vm.search.yandex.net +vla1-2893-23202.vm.search.yandex.net +vla1-2902-23202.vm.search.yandex.net +vla1-2908-23202.vm.search.yandex.net +vla1-2941-23202.vm.search.yandex.net +vla1-2986-23202.vm.search.yandex.net +vla1-2989-23202.vm.search.yandex.net +vla1-3126-23202.vm.search.yandex.net +vla1-3135-23202.vm.search.yandex.net +vla1-3141-23202.vm.search.yandex.net +vla1-3165-23202.vm.search.yandex.net +vla1-3176-23202.vm.search.yandex.net +vla1-3187-23202.vm.search.yandex.net +vla1-3195-23202.vm.search.yandex.net +vla1-3252-23202.vm.search.yandex.net +vla1-3340-23202.vm.search.yandex.net +vla1-3348-23202.vm.search.yandex.net +vla1-3441-23202.vm.search.yandex.net +vla1-4422-23202.vm.search.yandex.net
--------------------------------------------------------------------------------
patching file /etc/cron.d/host_options
================================================================================

================================================================================
Internal CQueue error on 9 host(s): +man1-5554-23202.vm.search.yandex.net +man1-5568-23202.vm.search.yandex.net +man1-8294-23202.vm.search.yandex.net +man1-8299-23202.vm.search.yandex.net +man1-8310-23202.vm.search.yandex.net +man1-8318-23202.vm.search.yandex.net +sas1-5776-23202.vm.search.yandex.net +sas1-5779-23202.vm.search.yandex.net +sas1-5783-23202.vm.search.yandex.net
--------------------------------------------------------------------------------
Timeout: Host is silent
================================================================================

olegts@sas1-6325-23202:~$ sky run "sudo /etc/init.d/cron reload " +G@MAN_AUTOBUDGET_GUEST:stable-97-r101 +G@VLA_AUTOBUDGET_GUEST:stable-99-r185 +G@MAN_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@SAS_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@VLA_AUTOBUDGET_PRE_GUEST:stable-100-r2 +G@SAS_AUTOBUDGET_GUEST:stable-97-r101
================================================================================
Success on 213 host(s): +man1-0061-23202.vm.search.yandex.net +man1-0150-23202.vm.search.yandex.net +man1-3905-23202.vm.search.yandex.net +man1-4639-23202.vm.search.yandex.net +man1-4642-23202.vm.search.yandex.net +man1-4650-23202.vm.search.yandex.net +man1-4652-23202.vm.search.yandex.net +man1-4663-23202.vm.search.yandex.net +man1-4669-23202.vm.search.yandex.net +man1-4673-23202.vm.search.yandex.net +man1-4680-23202.vm.search.yandex.net +man1-4687-23202.vm.search.yandex.net +man1-4692-23202.vm.search.yandex.net +man1-5445-23202.vm.search.yandex.net +man1-5461-23202.vm.search.yandex.net +man1-5475-23202.vm.search.yandex.net +man1-5477-23202.vm.search.yandex.net +man1-5485-23202.vm.search.yandex.net +man1-5496-23202.vm.search.yandex.net +man1-5498-23202.vm.search.yandex.net +man1-5499-23202.vm.search.yandex.net +man1-5505-23202.vm.search.yandex.net +man1-5508-23202.vm.search.yandex.net +man1-5512-23202.vm.search.yandex.net +man1-5514-23202.vm.search.yandex.net +man1-5551-23202.vm.search.yandex.net +man1-6031-23202.vm.search.yandex.net +man1-6573-23202.vm.search.yandex.net +man1-6846-23202.vm.search.yandex.net +man1-6881-23202.vm.search.yandex.net +man1-6894-23202.vm.search.yandex.net +man1-6901-23202.vm.search.yandex.net +man1-7124-23202.vm.search.yandex.net +man1-7167-23202.vm.search.yandex.net +man1-7173-23202.vm.search.yandex.net +man1-7185-23202.vm.search.yandex.net +man1-7193-23202.vm.search.yandex.net +man1-7194-23202.vm.search.yandex.net +man1-7195-23202.vm.search.yandex.net +man1-7205-23202.vm.search.yandex.net +man1-7217-23202.vm.search.yandex.net +man1-7218-23202.vm.search.yandex.net +man1-7412-23202.vm.search.yandex.net +man1-7488-23202.vm.search.yandex.net +man1-7524-23202.vm.search.yandex.net +man1-7527-23202.vm.search.yandex.net +man1-7546-23202.vm.search.yandex.net +man1-7554-23202.vm.search.yandex.net +man1-7556-23202.vm.search.yandex.net +man1-7644-23202.vm.search.yandex.net +man1-8093-23202.vm.search.yandex.net +man1-8112-23202.vm.search.yandex.net +man1-8120-23202.vm.search.yandex.net +man1-8126-23202.vm.search.yandex.net +man1-8129-23202.vm.search.yandex.net +man1-8145-23202.vm.search.yandex.net +man1-8176-23202.vm.search.yandex.net +man1-8213-23202.vm.search.yandex.net +man1-8216-23202.vm.search.yandex.net +man1-8219-23202.vm.search.yandex.net +man1-8227-23202.vm.search.yandex.net +man1-8246-23202.vm.search.yandex.net +man1-8247-23202.vm.search.yandex.net +man1-8248-23202.vm.search.yandex.net +man1-8252-23202.vm.search.yandex.net +man1-8258-23202.vm.search.yandex.net +man1-8272-23202.vm.search.yandex.net +man1-8273-23202.vm.search.yandex.net +man1-8288-23202.vm.search.yandex.net +sas1-1090-23202.vm.search.yandex.net +sas1-1478-23202.vm.search.yandex.net +sas1-1479-23202.vm.search.yandex.net +sas1-1486-23202.vm.search.yandex.net +sas1-1496-23202.vm.search.yandex.net +sas1-1532-23202.vm.search.yandex.net +sas1-1567-23202.vm.search.yandex.net +sas1-1577-23202.vm.search.yandex.net +sas1-1998-23202.vm.search.yandex.net +sas1-2000-23202.vm.search.yandex.net +sas1-5765-23202.vm.search.yandex.net +sas1-5771-23202.vm.search.yandex.net +sas1-5773-23202.vm.search.yandex.net +sas1-5774-23202.vm.search.yandex.net +sas1-5792-23202.vm.search.yandex.net +sas1-5884-23202.vm.search.yandex.net +sas1-5906-23202.vm.search.yandex.net +sas1-6025-23202.vm.search.yandex.net +sas1-6055-23202.vm.search.yandex.net +sas1-6099-23202.vm.search.yandex.net +sas1-6149-23202.vm.search.yandex.net +sas1-6192-23202.vm.search.yandex.net +sas1-6202-23202.vm.search.yandex.net +sas1-6207-23202.vm.search.yandex.net +sas1-6311-23202.vm.search.yandex.net +sas1-6312-23202.vm.search.yandex.net +sas1-6325-23202.vm.search.yandex.net +sas1-6353-23202.vm.search.yandex.net +sas1-6359-23202.vm.search.yandex.net +sas1-6378-23202.vm.search.yandex.net +sas1-6411-23202.vm.search.yandex.net +sas1-6422-23202.vm.search.yandex.net +sas1-6466-23202.vm.search.yandex.net +sas1-6467-23202.vm.search.yandex.net +sas1-6534-23202.vm.search.yandex.net +sas1-6535-23202.vm.search.yandex.net +sas1-6542-23202.vm.search.yandex.net +sas1-6545-23202.vm.search.yandex.net +sas1-6580-23202.vm.search.yandex.net +sas1-6630-23202.vm.search.yandex.net +sas1-6631-23202.vm.search.yandex.net +sas1-6714-23202.vm.search.yandex.net +sas1-6715-23202.vm.search.yandex.net +sas1-6739-23202.vm.search.yandex.net +sas1-6745-23202.vm.search.yandex.net +sas1-6782-23202.vm.search.yandex.net +sas1-6807-23202.vm.search.yandex.net +sas1-6808-23202.vm.search.yandex.net +sas1-6815-23202.vm.search.yandex.net +sas1-6849-23202.vm.search.yandex.net +sas1-6852-23202.vm.search.yandex.net +sas1-6890-23202.vm.search.yandex.net +sas1-6928-23202.vm.search.yandex.net +sas1-6929-23202.vm.search.yandex.net +sas1-6961-23202.vm.search.yandex.net +sas1-6969-23202.vm.search.yandex.net +sas1-7006-23202.vm.search.yandex.net +sas1-7011-23202.vm.search.yandex.net +sas1-7040-23202.vm.search.yandex.net +sas1-7042-23202.vm.search.yandex.net +sas1-7110-23202.vm.search.yandex.net +sas1-7115-23202.vm.search.yandex.net +sas1-7120-23202.vm.search.yandex.net +sas1-7123-23202.vm.search.yandex.net +sas1-7161-23202.vm.search.yandex.net +sas1-7162-23202.vm.search.yandex.net +sas1-7197-23202.vm.search.yandex.net +sas1-7199-23202.vm.search.yandex.net +sas1-7232-23202.vm.search.yandex.net +vla1-0092-23202.vm.search.yandex.net +vla1-0094-23202.vm.search.yandex.net +vla1-0096-23202.vm.search.yandex.net +vla1-0097-23202.vm.search.yandex.net +vla1-0098-23202.vm.search.yandex.net +vla1-0100-23202.vm.search.yandex.net +vla1-0101-23202.vm.search.yandex.net +vla1-0102-23202.vm.search.yandex.net +vla1-0104-23202.vm.search.yandex.net +vla1-0105-23202.vm.search.yandex.net +vla1-0106-23202.vm.search.yandex.net +vla1-0107-23202.vm.search.yandex.net +vla1-0108-23202.vm.search.yandex.net +vla1-0109-23202.vm.search.yandex.net +vla1-0110-23202.vm.search.yandex.net +vla1-0111-23202.vm.search.yandex.net +vla1-0112-23202.vm.search.yandex.net +vla1-0115-23202.vm.search.yandex.net +vla1-0119-23202.vm.search.yandex.net +vla1-0124-23202.vm.search.yandex.net +vla1-0872-23202.vm.search.yandex.net +vla1-0900-23202.vm.search.yandex.net +vla1-1041-23202.vm.search.yandex.net +vla1-1150-23202.vm.search.yandex.net +vla1-1291-23202.vm.search.yandex.net +vla1-1637-23202.vm.search.yandex.net +vla1-1639-23202.vm.search.yandex.net +vla1-1643-23202.vm.search.yandex.net +vla1-1647-23202.vm.search.yandex.net +vla1-1716-23202.vm.search.yandex.net +vla1-1742-23202.vm.search.yandex.net +vla1-1872-23202.vm.search.yandex.net +vla1-1873-23202.vm.search.yandex.net +vla1-2068-23202.vm.search.yandex.net +vla1-2721-23202.vm.search.yandex.net +vla1-2725-23202.vm.search.yandex.net +vla1-2736-23202.vm.search.yandex.net +vla1-2742-23202.vm.search.yandex.net +vla1-2743-23202.vm.search.yandex.net +vla1-2744-23202.vm.search.yandex.net +vla1-2749-23202.vm.search.yandex.net +vla1-2753-23202.vm.search.yandex.net +vla1-2771-23202.vm.search.yandex.net +vla1-2776-23202.vm.search.yandex.net +vla1-2799-23202.vm.search.yandex.net +vla1-2806-23202.vm.search.yandex.net +vla1-2809-23202.vm.search.yandex.net +vla1-2832-23202.vm.search.yandex.net +vla1-2855-23202.vm.search.yandex.net +vla1-2861-23202.vm.search.yandex.net +vla1-2863-23202.vm.search.yandex.net +vla1-2865-23202.vm.search.yandex.net +vla1-2867-23202.vm.search.yandex.net +vla1-2874-23202.vm.search.yandex.net +vla1-2884-23202.vm.search.yandex.net +vla1-2888-23202.vm.search.yandex.net +vla1-2892-23202.vm.search.yandex.net +vla1-2893-23202.vm.search.yandex.net +vla1-2902-23202.vm.search.yandex.net +vla1-2908-23202.vm.search.yandex.net +vla1-2941-23202.vm.search.yandex.net +vla1-2986-23202.vm.search.yandex.net +vla1-2989-23202.vm.search.yandex.net +vla1-3126-23202.vm.search.yandex.net +vla1-3135-23202.vm.search.yandex.net +vla1-3141-23202.vm.search.yandex.net +vla1-3165-23202.vm.search.yandex.net +vla1-3176-23202.vm.search.yandex.net +vla1-3187-23202.vm.search.yandex.net +vla1-3195-23202.vm.search.yandex.net +vla1-3252-23202.vm.search.yandex.net +vla1-3340-23202.vm.search.yandex.net +vla1-3348-23202.vm.search.yandex.net +vla1-3441-23202.vm.search.yandex.net +vla1-4422-23202.vm.search.yandex.net
--------------------------------------------------------------------------------
Rather than invoking init scripts through /etc/init.d, use the service(8)
utility, e.g. service cron reload

Since the script you are attempting to invoke has been converted to an
Upstart job, you may also use the reload(8) utility, e.g. reload cron
================================================================================

================================================================================
	Internal CQueue error on 9 host(s): +man1-5554-23202.vm.search.yandex.net +man1-5568-23202.vm.search.yandex.net +man1-8294-23202.vm.search.yandex.net +man1-8299-23202.vm.search.yandex.net +man1-8310-23202.vm.search.yandex.net +man1-8318-23202.vm.search.yandex.net +sas1-5776-23202.vm.search.yandex.net +sas1-5779-23202.vm.search.yandex.net +sas1-5783-23202.vm.search.yandex.net
	--------------------------------------------------------------------------------
	Timeout: Host is silent
	================================================================================

	MySQLClusterVisitHistoryRequest6_MySQLClusterTask_463563_1:q


	4205593083 Казахстан
	3254118790 Белорусь
	3211435188 Белорусь
	3661068692 Белорусь
	3212478350 Белорусь
	3455042932 Белорусь
	3640680687 Белорусь
	3455843598 Белорусь
	4202400908 Казахстан
	4203007195 Казахстан
	2688968410 Белорусь
	4200577919 Казахстан
	3781499006 Белорусь
	3965699279 Белорусь
	3639323101 Украина
	3456314421 Белорусь
	3650598026 Белорусь



	taking 1 with discount
	taking 3 with discount
	taking 8 with discount
	taking 4 with discount
	taking 6 with discount

	1
	1
	1

	{"query_types":{"hahn.JoinedEFH":{"max_group_count":30,"cluster":"hahn","generate_patches":"0","time_column_format":"%s","location":{"time_interval":3600,"path":"//home/bs/yabs-log/%Y%m/JoinedEFH%Y%m%d%H"},"aggregate_fields":[{"sql":"if(L.CounterType == 2, 1, 0)","aggregation_type":"sum","name":"Clicks"},{"sql":"if(L.CounterType == 1, 1, 0)","aggregation_type":"sum","name":"Shows"},{"sql":"cast(L.EventCost as uint64)","aggregation_type":"sum","name":"Cost"}],"begin_section":"$word_count = Re2::Count(\"[a-z]+\");","initial_slice_fields":[{"sql": "if($word_count(L.SearchQuery) > 4, 4, $word_count(L.SearchQuery))", "name": "WordCount"},{"sql":"L.HitOptions","name":"HitLogOptions"},{"sql":"Banner.Options","name":"BannerOptions"},{"sql":"L.Options","name":"EventOptions"},{"sql":"OrderInfo.Options","name":"OrderInfoOptions"},{"sql":"L.PageID","name":"PageID"},{"sql":"L.PlaceID","name":"PlaceID"},{"sql":"L.SlotID","name":"SlotID"},{"sql":"L.TypeID","name":"TypeID"},{"sql":"L.SequenceID","name":"SequenceID"},{"sql":"L.ResourceNo","name":"ResourceNo"},{"sql":"L.Position","name":"Position"},{"sql":"L.PageNO","name":"PageNO"},{"sql":"L.RegionID","name":"RegionID"},{"sql":"L.SelectType","name":"SelectType"},{"sql":"L.DeviceType","name":"DeviceType"},{"sql":"L.ContextType","name":"ContextType"},{"sql":"L.Options","name":"LogOptions"},{"sql":"L.OrderID","name":"OrderID"},{"sql":"L.DomainID","name":"DomainID"},{"sql":"L.TagID","name":"TagID"},{"sql":"OrderInfo.Options","name":"order_options"},{"sql":"L.HostID","name":"HostID"},{"sql":"L.ExperimentBits","name":"ExperimentBits"},{"sql":"L.ClientIP","name":"ClientIP"}],"time_column":"L.EventTime","dictionaries":[{"join_condition":"L.BannerID == Banner.BannerID","name":"Banner","path":"//home/bs/dbrestore/bstat/yabsdb/Banner"},{"join_condition":"L.OrderID == OrderInfo.OrderID","name":"OrderInfo","path":"//home/bs/dbrestore/bsdb/yabsdb/OrderInfo"}],"alias":"L","condition":"true","split_fields":{"HitLogOptions":"options","OrderInfoOptions":"options","EventOptions":"options","BannerOptions":"options"}},"robot-bs-chevent-log-fraud":{"max_group_count":30,"begin_section":"","cluster":"banach","time_column_format":"\"%s\"","location":{"time_interval":3600,"path":"//logs/bs-chevent-log/1h/%Y-%m-%dT%H:00:00"},"aggregate_fields":[{"sql":"if(L.countertype == \"1\", 1, 0)","aggregation_type":"sum","name":"Shows"},{"sql":"if(L.countertype == \"2\", 1, 0)","aggregation_type":"sum","name":"Clicks"},{"sql":"cast(L.initcost as int64)","aggregation_type":"sum","name":"Cost"}],"initial_slice_fields":[],"time_column":"L.eventtime","dictionaries":[],"alias":"L","condition":"true","wait_for_tables_timeout":7200,"split_fields":{"Options":"options"},"generate_patches":"0"},"robot-bs-eventbad-log":{"max_group_count":30,"begin_section":"","cluster":"banach","time_column_format":"\"%s\"","location":{"time_interval":86400,"path":"//logs/bs-eventbad-log/1d/%Y-%m-%d"},"aggregate_fields":[{"sql":"if(L.countertype == \"1\", 1, 0)","aggregation_type":"sum","name":"Shows"},{"sql":"if(L.countertype == \"2\", 1, 0)","aggregation_type":"sum","name":"Clicks"},{"sql":"cast(L.eventcost as int64)","aggregation_type":"sum","name":"Cost"}],"initial_slice_fields":[],"time_column":"L.eventtime","dictionaries":[],"alias":"L","condition":"true","wait_for_tables_timeout":7200,"split_fields":{"Options":"options"},"generate_patches":"0"},"robot-bs-dsp-log":{"max_group_count":30,"begin_section":"","cluster":"banach","time_column_format":"\"%s\"","location":{"time_interval":3600,"path":"//home/logfeller/logs/bs-dsp-log/1h/%Y-%m-%dT%H:00:00"},"aggregate_fields":[{"sql":"cast(L.price as int64)","aggregation_type":"sum","name":"Price"},{"sql":"if(L.countertype == \"1\",[4~1,0)","aggregation_type":"sum","name":"Shows"},{"sql":"cast(L.partnerprice as int64)","aggregation_type":"sum","name":"PartnerPrice"},{"sql":"cast(L.realprice as int64)","aggregation_type":"sum","name":"RealPrice"}],"initial_slice_fields":[],"time_column":"L.eventtime","dictionaries":[],"alias":"L","condition":"true","wait_for_tables_timeout":7200,"generate_patches":"0","split_fields":{}},"robot-bs-undodsp-log":{"begin_section":"","max_group_count":30,"cluster":"banach","time_column_format":"\"%s\"","location":{"time_interval":86400,"path":"//home/logfeller/logs/bs-undodsp-log/1d/%Y-%m-%d"},"aggregate_fields":[{"sql":"cast(L.price as int64)","aggregation_type":"sum","name":"Price"},{"sql":"if(L.countertype == \"1\",1,0)","aggregation_type":"sum","name":"Shows"},{"sql":"cast(L.partnerprice as int64) ","aggregation_type":"sum","name":"PartnerPrice"},{"sql":"cast(L.realprice as int64)","aggregation_type":"sum","name":"RealPrice"}],"initial_slice_fields":[],"time_column":"L.eventtime","dictionaries":[],"alias":"L","condition":"true","wait_for_tables_timeout":7200,"generate_patches":"0","split_fields":{},"until_time_shift":172800},"robot-bs-chevent-log":{"max_group_count":30,"begin_section":"","cluster":"banach","time_column_format":"\"%s\"","location":{"time_interval":3600,"path":"//logs/bs-chevent-log/1h/%Y-%m-%dT%H:00:00"},"aggregate_fields":[{"sql":"if(L.countertype == \"1\", 1, 0)","aggregation_type":"sum","name":"Shows"},{"sql":"if(L.countertype == \"2\", 1, 0)","aggregation_type":"sum","name":"Clicks"},{"sql":"cast(L.eventcost as int64)","aggregation_type":"sum","name":"Cost"}],"initial_slice_fields":[],"time_column":"L.eventtime","dictionaries":[],"alias":"L","condition":"true","wait_for_tables_timeout":7200,"split_fields":{"Options":"options"},"generate_patches":"0"},"agency":{"begin_section":"","max_group_count":30,"cluster":"hahn","generate_patches":"0","time_column_format":"%s","location":{"time_interval":3600,"path":"//home/logfeller/logs/bs-chevent-log/1h/%Y-%m-%dT%H:00:00"},"aggregate_fields":[{"sql":"if(L.countertype == \"2\", 1, 0)","aggregation_type":"sum","name":"Clicks"},{"sql":"if(L.countertype == \"1\", 1, 0)","aggregation_type":"sum","name":"Shows"},{"sql":"cast(L.eventcost as uint64)","aggregation_type":"sum","name":"Cost"}],"initial_slice_fields":[{"sql":"Banner.Options","name":"BannerOptions"},{"sql":"L.options","name":"EventOptions"},{"sql":"Banner.EngineID","name":"BannerEngineID"},{"name":"BannerTemplateID","sql":"Banner.TemplateID"},{"sql":"Banner.DomainID","name":"BannerDomainID"},{"name":"BannerTargetDomainID","sql":"Banner.TargetDomainID"},{"sql":"Banner.BannerType","name":"BannerBannerType"},{"sql":"Banner.CounterType","name":"BannerCounterType"},{"name":"BannerBannerWeight","sql":"Banner.BannerWeight"},{"name":"BannerFlags","sql":"Banner.Flags"},{"name":"BannerLang","sql":"Banner.Lang"},{"sql":"if(Banner.Flags > 0, 1, 0)","name":"BannerPositiveFlags"},{"sql":"if(OrderInfo.AgencyID == 6691, 1, 0)","name":"IsDirect"},{"sql":"OrderInfo.Options","name":"OrderInfoOptions"},{"name":"OrderInfoGroupOrderID","sql":"OrderInfo.GroupOrderID"},{"name":"OrderInfoAgencyID","sql":"OrderInfo.AgencyID"},{"sql":"OrderInfo.ClientID","name":"OrderInfoClientID"},{"sql":"OrderInfo.UserID","name":"OrderInfoUserID"},{"name":"OrderInfoOrderResourceID","sql":"OrderInfo.OrderResourceID"},{"sql":"OrderInfo.CurrencyDate","name":"OrderInfoCurrencyDate"},{"sql":"OrderInfo.CurrencyID","name":"OrderInfoCurrencyID"},{"sql":"OrderInfo.OrderType","name":"OrderInfoOrderType"},{"name":"OrderInfoPriceType","sql":"OrderInfo.PriceType"},{"sql":"OrderInfo.CounterType","name":"OrderInfoCounterType"},{"sql":"OrderInfo.BaseNo","name":"OrderInfoBaseNo"},{"name":"OrderInfoOptions","sql":"OrderInfo.Options"},{"name":"OrderInfoAutoStop","sql":"OrderInfo.AutoStop"},{"name":"OrderInfoComplete","sql":"OrderInfo.Complete"},{"sql":"OrderInfo.KeepActive","name":"OrderInfoKeepActive"},{"sql":"OrderInfo.Exported","name":"OrderInfoExported"},{"name":"OrderInfoStrategyMinPrice","sql":"OrderInfo.StrategyMinPrice"},{"name":"OrderInfoManagerID","sql":"OrderInfo.ManagerID"},{"name":"OrderInfoProductID","sql":"OrderInfo.ProductID"},{"name":"OrderInfoExportID","sql":"OrderInfo.ExportID"},{"sql":"OrderInfo.EngineID","name":"OrderInfoEngineID"},{"sql":"OrderInfo.ContextID","name":"OrderInfoContextID"},{"name":"OrderInfoTimeZoneID","sql":"OrderInfo.TimeZoneID"},{"name":"OrderInfoHolidayRegionID","sql":"OrderInfo.HolidayRegionID"},{"name":"OrderInfoTaxID","sql":"OrderInfo.TaxID"},{"name":"OrderInfoDiscountID","sql":"OrderInfo.DiscountID"},{"name":"OrderInfoReservedTime","sql":"OrderInfo.ReservedTime"},{"sql":"OrderInfo.State","name":"OrderInfoState"},{"name":"OrderInfoBillingState","sql":"OrderInfo.BillingState"},{"sql":"OrderInfo.TaxesIncluded","name":"OrderInfoTaxesIncluded"},{"sql":"OrderInfo.CounterID","name":"OrderInfoCounterID"},{"sql":"OrderInfo.AttributionType","name":"OrderInfoAttributionType"},{"name":"OrderInfoContentType","sql":"OrderInfo.ContentType"}],"time_column":"cast(L.eventtime as uint64)","dictionaries":[{"join_condition":"cast(L.bannerid as uint64) == Banner.BannerID","name":"Banner","path":"//home/bs/dbrestore/bstat/yabsdb/Banner"},{"join_condition":"cast(L.orderid as uint32) == OrderInfo.OrderID","name":"OrderInfo","path":"//home/bs/dbrestore/bsdb/yabsdb/OrderInfo"}],"alias":"L","condition":"L.fraudbits == \"0\" and 'flat-page' in String::SplitToList(L.options, ',')","split_fields":{"OrderInfoOptions":"options","BannerFlags":"bits","BannerOptions":"options","EventOptions":"options"}},"distribution_installs":{"split_fields":{},"condition":"true","alias":"L","dictionaries":[],"time_column":"cast(L.unixtime as uint64)","begin_section":"$is_yandex=Pcre::Grep('yandex');","max_group_count":30,"cluster":"hahn","generate_patches":0,"time_column_format":"%s","location":{"path":"//home/personalization/v4_daily/%Y-%m-%d/atom_banners","time_interval":86400},"aggregate_fields":[{"name":"Installs","aggregation_type":"sum","sql":"if(L.eventtype == 'trueinstall', 1, 0)"},{"name":"Shows","aggregation_type":"sum","sql":"if(L.eventtype == 'show', 1, 0)"}],"initial_slice_fields":[{"name":"browser","sql":"L.browser"},{"name":"country","sql":"L.country"},{"name":"device","sql":"L.device"},{"name":"distr_obj","sql":"L.distr_obj"},{"name":"os","sql":"L.os"},{"name":"product","sql":"L.product"},{"name":"referer","sql":"if($is_yandex(referer), referer, 'non yandex referer')"}]}}}
58


zoo-lock-config
yabs-autobudget2
yabs-autobudget-base

using form_flags_hash_t = yhash_set<form_flags_t, form_flags_t::hasher>;
struct _packed form_flags_t {
    ui64 word_hd;
    double df;
    double df2;
    i8 flags;

    inline bool operator==(form_flags_t const& o) const {
	return this->word_hd == o.word_hd;
    }

    struct hasher {
	ui64 operator()(form_flags_t const& val) const {
	    return val.word_hd;
	}
    };
};



2093     stat_index->norm_broad_word_net = env->builder->Allocate<yabs_word_net>();
2119     yabs_parse_word_sets(env, stat_index->norm_broad_word_net,
2120                          broad_phrase_buffer.phrases.size(),
2121                          /* phrase_index */ nullptr, /* check_flat */ false,
2122                          ENormType::Norm, /* performance */ false,
2123                          phrase_buffer.norm_forms, /* add_region */ true);
2988
2989         list.clear();
2990         parse_phrase_reserve(env, stat_index->perf_broad_word_net, phrase_minusword_buffer.text, phrase_minusword_buffer.text_len, list);
2991         for (i32* pid : list) {
2992             stat_index->broad_phrase[*pid].minusword_idx = env->index;
2993         }

 145     yabs_phrase_expr* get_phrase(ui64 index,
 146                                  yabs_phrase_expr* default_value = nullptr) {
 147         if (index < phrases.size()) {
 148             return phrases[index];
 149         }
 150         return default_value;
 151     }

yvector<yabs_phrase_expr*> phrases;

  77 struct yabs_phrase_expr {
  78     ui64 region_hash; /хеш идентификатора региона фразы, которая получена при парсинге условий показа баннера
  79     ui64 lemmas_flags;
  80     ui8 blocks; //счетчик -- вместе эти счетчики в сумме означают все кроме минус слов
  81     ui8 plus; //счетчик
  82     bool used_flat; //отсутствует disable_flat в PhrasePrice.Options
  83     ENormType norm_type; //наверно, это тип нормализации
  84     bool performance;
  85     ui16 expr_size;
  86     ui64 word[0]; содержит блок размера plus + blocks, затем блок размера minus, содержит word_hd -- хеши от слов
  87 };
enum class ENormType : ui8 {
    None,
    Norm,
    SNorm,
    Offer,
    GoalContext
};
1733     const TPhraseToRegionKey phrase_to_region_key = {
1734         broad_phrase_id,
1735         (is_perf ? TPhraseToRegionKey::EType::Smart
1736                  : TPhraseToRegionKey::EType::Broad),
1737         norm_type};
phrase_buffer.phrase_to_region.AddRegions(*env, {phrase_id, TPhraseToRegionKey::EType::Normal, ENormType::None}, regions);
phrase_region = phrase_buffer.phrase_to_region.FindRegion(*phrase_to_region_key);

const ui64 region_hash = get_region_hash(*phrase_region);
phrase_expr->region_hash = region_hash;

static inline ui64 get_region_hash(i32 id) {
    if (id == 0) {
	return 0;
    }
    char buffer[32];
    int len = sprintf(buffer, "@%u", id);
    return yabs_bobhash(buffer, len);
}
struct TPhraseToRegionKey {
    ui64 ID;

    enum class EType : ui8 { Normal,
			     Broad,
			     Smart };
    EType Type;
    ENormType NormType;

yabs_parse_word_sets

forms
using forms_hash_t = yhash<ui64, i32, hasher_empty<ui64>>;
forms -- количества форм для каждого word_hd

-sexpr какая-то пересортировка по количеству форм

278
279 struct word_node {
280     yabs_ws_link w;
281     yabs::list_t<i32> phrases;
282     yabs::tree_t<word_node, ui64> links;
283 };
struct _packed yabs_ws_link {
    ui64 word_hd;
    i32 ws_id;
};
parse_phrase_reserve(env, stat_index->perf_broad_word_net, phrase_minusword_buffer.text, phrase_minusword_buffer.text_len, list);


3038 static yabs_load_field phrase_minusword_load_bind[] = {
3039     BindField("PhraseData", phrase_minusword_buffer.text, phrase_minusword_buffer.text_len), -- одна фраза
3040     BindField("Data", phrase_minusword_buffer.data, phrase_minusword_buffer.data_len), -- много минус-слов
3041 };

2989         list.clear();
2990         parse_phrase_reserve(env, stat_index->perf_broad_word_net, phrase_minusword_buffer.text, phrase_minusword_buffer.text_len, list);
2991         for (i32* pid : list) {
2992             stat_index->broad_phrase[*pid].minusword_idx = env->index;
2993         }

-> 2687         yabs_load_tree_insert(phrase_buffer.alloc_1, &root, &k, sizeof(k), uint64_cmp);

-> 2710         load_reserve_traverse(word_net, root, len, words, list);

run_parse_phrase_words -> parse_phrase_words -> forms_hash_t& forms = phrase_buffer.get_forms(norm_type, performance);
2137     yabs_parse_word_sets(env, stat_index->perf_norm_broad_word_net,
2138                          broad_phrase_buffer.phrases.size(),
2139                          /* phrase_index */ nullptr, /* check_flat */ false,
2140                          ENormType::Norm, /* performance */ true,
2141                          phrase_buffer.perf_norm_forms, /* add_region */ true);
parse_phrase_words -> phrase_buffer <- используется внутри yabs_parse_word_sets


140

153
473
yabs_parse_word_sets

 556
 557     phrase_expr->blocks = blocks;
 558     phrase_expr->plus = plus;
 559     phrase_expr->lemmas_flags = lemmas_flags;
 560     phrase_expr->expr_size = plus + minus + (plemm_count ? lemm_count : 0);
 561
 562     phrase_expr->used_flat = phrase_table && phrase_buffer.flat_phrases.has(phrase_buffer.phrase_id);
 563     phrase_expr->region_hash = 0;
 564     phrase_expr->performance = performance;
 565     phrase_expr->norm_type = norm_type;

1564     // point of join with broad match data stored in env, store index
1565     // instead of pointer because it is not obvious that broad_match
1566     // points to the same location on every function call
1567     i32 processed_bm_index;
n

2107     store_broad_match_offer(env, broad_match_offers,
2108                             broad_phrase_buffer.offer_count);
2109

94
2095     store_perf_broad_match(env, broad_match_offers,
2096                            broad_phrase_buffer.perf_count);

broad_match_fini_callback
1479     auto not_offers = stat_index->broad_match;
1480     for (const auto& b : cleared_data.Rows) {
1481         if (b.source_context_type == EContextType::Offer) {
1482             broad_match_offers.emplace_back(b);
1483         } else {
1484             *not_offers = b;
1485             ++not_offers;
1486         }
1487     }


1416 static TClearedBroadMatchData
1417 yabs_broad_match_merge_with_parents(const yabs_stat_index& stat_index,
1418                                     yvector<yabs_broad_match>& rows) {

TClearedBroadMatchData
	 yvector<yabs_broad_match> Rows;

struct _packed yabs_broad_match: public ::yabs::zero_init_t<yabs_broad_match> {
    ui64 broad_phrase_id;
    i64 banner_id;
    i32 phrase_id;
    ui32 apc_ratio;
    ui32 sim_distance;
    ui32 score;

    using options_t = yabs::pod_flags_t<yabs_broad_match_option_t, ui32>;
    options_t options;

    ui32 ctr;
    ui32 pctr;
    EContextType source_context_type;
};
1462     auto cleared_data =
1463         yabs_broad_match_merge_with_parents(*stat_index, broad_match_rows);


1328     EContextType const source_context_type = broad_match_buffer.source_context_type;
1329     i64 const banner_id = broad_match_buffer.banner_id;


stat_index->broad_match_offer
stat_index->offer_index[offer_index_count]

1) Взять логику соответствия template
static void add_performance_template_banners
2) store_perf_broad_match -- не набирать туда only-offer-retargeting, а набирать где-то в друге место

18

b^2*m^2*y - 2*b*m^2*y  + 2*b*m*y - m*y+ y
- 2*b*m^2*y^2 + b*m*y^2 + m^2*y^2  - 2*m*y^2 + y^2
+ m^2*y^3 - m*y^3


шшшшшш
84959819819
88007004070
шшшшшш
84959819819
88007004070
шшшшшш
84959819819
88007004070
шшшшшш
84959819819
88007004070
шшшшшш
84959819819
88007004070
шшшшшш
84959819819
88007004070
шшшшшш
84959819819
88007004070
шшшшшш
84959819819
88007004070


TRawGroupPhraseRow


alexpv,bahbka,behemot,dkulikovsky,italiano,keyd,saint,say,zahacker,yottatsa,slepovss,kiwi,nyaapa,olegts

поменять perf_count
3) в context.cpp сделать использование perf_norm_snorm_broad_match


broad_phrase_load_each
	run_parse_phrase_words
		parse_phrase_words

1) использование perf_norm_broad_word_net perf_snorm_broad_word_net
	через функцию GetBroadMatchWordNet
		yabs_phrase_match
			yabs_context_find
				yabs_phrase_pick_lookup
					yabs_handler_fpick_st
				yabs_prepare_pmatch
					yabs_handler_pmatch
2) использование perf_broad_match
	GetBroadMatchIndex
		yabs_phrase_match -- обход ворднетов. Тут надо учесть, чтобы не всегда обходился новый ворднет
3) performance_groups_with_templates
	bool banner_matcher_t::match -- функция матчинга

server-diff
2963743

yabs_context_match* ctm = (yabs_context_match*)yabs_tree_data(ctx);

alexpv,bahbka,behemot,dkulikovsky,italiano,keyd,saint,say,zahacker,yottatsa,slepovss,kiwi,nyaapa,olegts


_restoreConfig ok
_switchAggregator ok
_fillLastTaskParams ok
_fillAggregatorParams ok

_fillSliceFields <- _loadSliceFields -- при правке и при джойне

2966443

268
171


./Yabs/AutoBudget/GroupBannerProcessorInstance.pm
./Yabs/AutoBudget/GroupBannerProcessor.pm
./Yabs/AutoBudget/GroupBannerProcessor/Banner.pm
./Yabs/AutoBudget/GroupBannerProcessor/Group.pm

./Yabs/AutoBudget/Structures/Phrase/Group.pm
./Yabs/AutoBudget/Structures/Banner/Group.pm

./Yabs/AutoBudget/Structures/SQLCondition/Phrase/Group.pm
./Yabs/AutoBudget/Structures/SQLCondition/BannerOrder/Group.pm

./Yabs/AutoBudget/GroupBannerMixin/Banner.pm
./Yabs/AutoBudget/GroupBannerMixin/Group.pm

ban_or_grid


Yabs::AutoBudget::Structures::Banner::Banner

281
189

287 hazard pointers
290
293
301
303
160:

323
Revision: 2978280
326
Revision: 2978398

355

vim:
  Установлен: 2:7.3.429-2ubuntu2.1
  Кандидат:   2:7.4.005-1ppa2~precise+yandex0
  Таблица версий:
     2:7.4.005-1ppa2~precise+yandex0 0
	500 http://yandex-precise.dist.yandex.ru/yt-precise/ unstable/amd64/ Packages
     2:7.3.429-2ubuntu2.2 0
	500 http://mirror.yandex.ru/ubuntu/ precise-updates/main amd64 Packages
	500 http://mirror.yandex.ru/ubuntu/ precise-security/main amd64 Packages
 *** 2:7.3.429-2ubuntu2.1 0
	100 /var/lib/dpkg/status
     2:7.3.429-2ubuntu2 0


--->  Scanning binaries for linking errors
--->  Found 1 broken file, matching files to ports
--->  Found 1 broken port, determining rebuild order
You can always run 'port rev-upgrade' again to fix errors.
The following ports will be rebuilt: gdbm @1.13
Continue? [Y/n]: y


Yabs::YT::_yt_connect_anthill(/usr/share/perl5/Yabs/YT.pm:780):
780:            YT::ConfigureSingletons($singletons);
  DB<2>
Yabs::YT::_yt_connect_anthill(/usr/share/perl5/Yabs/YT.pm:782):
782:            my $connection = new YT::Connection($config);
  DB<2> x $singletons
0  HASH(0x3e5fc68)
   'logging' => HASH(0x3e26c20)
      'rules' => ARRAY(0x3dc5e18)
	   empty array
      'writers' => HASH(0x3de11b8)
	   empty hash
  DB<3>

new YT::Connection({"table_mount_cache":{"success_expiration_time":1,"success_probation_time":1,"failure_expiration_time":1},"secondary_masters":[],"networks":["default"],"enable_read_from_followers":"true","timestamp_provider":{"addresses":["localhost:9014","localhost:9016","localhost:9018"]},"abi_version":"19_1","network_name":"default","udf_registry_path":"//yabs/udfs","primary_master":{"addresses":["localhost:9010"],"cell_id":"ffffffff-ffffffff-00259-ffffffff"},"master_cache":{"addresses":["localhost:9014","localhost:9016","localhost:9018"],"cell_id":"ffffffff-ffffffff-00259-ffffffff","cell_tag":0},"enable_udf":"true"});
install yandex-yt=18.4.20514-prestable~dfd8a22 yandex-yt-http-proxy=18.4.19881-prestable~97a8029 yandex-yt-local=0.0.42-0 yandex-yt-perl=18.5.20952-prestable~7269a2b yandex-yt-perl-18.4=18.4.19881-prestable~97a8029 yandex-yt-perl-18.5=18.5.20952-prestable~7269a2b yandex-yt-perl-19.1=19.1.22635-prestable~85ef5fc yandex-yt-python=0.7.34-0 yandex-yt-python-yson=0.3.1-0  yabs-yt-api=000.127 yabs-yt-standalone-conf=000.21 yabs-yt-standalone-conf-18.4=000.21

620160520
620160524 rtcloud13103k/rtb.9633602275391798857.MYD.20170706172503

382

385

1336587552
1336587548
rtcloud14107k/dsp_object.15899801358588122388.MYD.20170707093401
1336587552


15:28:35
15:28:36
2017/07/07 15:26:39 385293 INFO  [_task_collect_] Stopped task_collect for RankRequest
2017/07/07 15:27:21 396060 INFO  [_task_collect_] Stopped task_collect for MobileBannerPhraseStatRankRequest

Пт. июля  7 15:28:35 MSK 2017
1531441 rplcat  localhost       yabsdb  Query   99      Sending data    insert into BannerPhraseStatControl (BannerID,PhraseID,PShows,PClicks,DShows,DClicks,
Пт. июля  7 15:28:36 MSK 2017

collect-undoevent.log
i2017/07/07 15:26:12 292176 INFO  [yabs_file_unlo] unlocked
2017/07/07 15:26:13 375792 INFO  [        main::] Main loop duration: 300, log wait time: 60
2017/07/07 15:26:13 375792 INFO  [         BEGIN] MYSQL_NOW = now(), mysql_generation_start_time = '20170707152500', mysql_generation_start_unixtime = 1499430300
2017/07/07 15:26:14 375792 INFO  [          load] Host-option bstat-collectros-qtail-metric set in ll_metric
2017/07/07 15:26:14 375792 INFO  [         BEGIN] autobudget-group-banner: 1
2017/07/07 15:26:14 375792 INFO  [yabs_file_lock] locked
2017/07/07 15:26:14 375792 INFO  [           new] Script is already run with timeout 604800 (by runit?)
2017/07/07 15:26:15 375792 INFO  [        main::] Started collect-undoevent (/home/yabs/stat/collect-log.pl UndoEvent --loop-duration=300 --log-wait-time=60)
2017/07/07 15:26:15 375792 INFO  [get_nextdatalo] Time stamp border for log sorting: 20170707102614
2017/07/07 15:27:15 375792 INFO  [get_nextdatalo] Time stamp border for log sorting: 20170707102715
2017/07/07 15:30:16 375792 INFO  [get_nextdatalo] Time stamp border for log sorting: 20170707103015
2017/07/07 15:31:15 375792 INFO  [      main_log] 20170707152600 timing: Setup=1.123,Minutely=299.512,Total=300.635
2017/07/07 15:31:15 375792 INFO  [yabs_file_unlo] unlocked

collect-chevent.log
2017/07/07 15:26:56 386779 INFO  [_task_collect_] Stopped task_collect for AutoBudgetShowsCorrBuffer
2017/07/07 15:27:21 395836 INFO  [_task_collect_] Started task_collect for MobileBannerPhraseStat
2017/07/07 15:27:21 395836 INFO  [_task_collect_] Stopped task_collect for MobileBannerPhraseStat
2017/07/07 15:28:36 419137 INFO  [_task_collect_] Started task_collect for RankStat
2017/07/07 15:29:26 419137 INFO  [_task_collect_] Stopped task_collect for RankStat


collect-rankrequest.log
2017/07/07 15:27:21 396060 INFO  [_task_collect_] Started task_collect for MobileBannerPhraseStatRankRequest
2017/07/07 15:27:21 396060 INFO  [_task_collect_] Stopped task_collect for MobileBannerPhraseStatRankRequest
2017/07/07 15:27:22 364970 INFO  [      main_log] 20170707152500 timing: Setup=1.088,LogWait=60.441,Collect=43.059,Minutely=0.009,Total=104.597 (Speed=593 rps, DataID=2017070712251368678)
2017/07/07 15:27:22 364970 INFO  [get_nextdatalo] Time stamp border for log sorting: 20170707102721
2017/07/07 15:30:22 364970 INFO  [get_nextdatalo] Time stamp border for log sorting: 20170707103021
2017/07/07 15:30:38 364970 INFO  [yabs_file_unlo] unlocked
2017/07/07 15:30:39 449317 INFO  [        main::] Main loop duration: 300, log wait time: 60
2017/07/07 15:30:40 449317 INFO  [         BEGIN] MYSQL_NOW = now(), mysql_generation_start_time = '20170707153000', mysql_generation_start_unixtime = 1499430600
2017/07/07 15:30:41 449317 INFO  [          load] Host-option bstat-collectros-qtail-metric set in ll_metric
2017/07/07 15:30:41 449317 INFO  [         BEGIN] autobudget-group-banner: 1
2017/07/07 15:30:41 449317 INFO  [yabs_file_lock] locked
2017/07/07 15:30:41 449317 INFO  [           new] Script is already run with timeout 604800 (by run

==============================================

1557346 rplcat  localhost       yabsdb  Query   88      Sending data    insert into BannerPhraseStatControl (BannerID,PhraseID,PShows,PClicks,DShows,DClicks,
1560661 rplcat  localhost       yabsdb  Query   0       Sending data    insert into AuctionBannerPhraseStat (\n\t\t\t\tBannerID,\n\t\t\t\tPhraseID,\n\t\t\t\t
Пт. июля  7 15:42:57 MSK 2017
1559160 rplcat  localhost       yabsdb  Query   1       Copying to tmp table    select\n\t\t\t\tBannerID,\n\t\t\t\tPhraseID,\n\t\t\t\tmin(UpdateTime+0)\n\t\t
Пт. июля  7 15:42:58 MSK 2017

collect-chevent.log
2017/07/07 15:41:33 622226 INFO  [ _task_collect] 622226        0.049   AutoBudgetShowsCorrBuffergroup_23
2017/07/07 15:41:33 622226 INFO  [_task_collect_] Stopped task_collect for AutoBudgetShowsCorrBuffer
2017/07/07 15:41:48 629102 INFO  [_task_collect_] Started task_collect for MobileBannerPhraseStat
2017/07/07 15:41:48 629102 INFO  [_task_collect_] Stopped task_collect for MobileBannerPhraseStat
2017/07/07 15:43:02 652705 INFO  [_task_collect_] Started task_collect for RankStat
2017/07/07 15:43:03 652705 INFO  [_task_collect_] Stopped task_collect for RankStat

====================================================



Пт. июля  7 15:52:38 MSK 2017
1574950 rplcat  localhost       yabsdb  Query   95      Sending data    insert into BannerPhraseStatControl (BannerID,PhraseID,PShows,PClicks,DShows,DClicks,
1577794 rplcat  localhost       yabsdb  Query   49      Waiting for table level lock    select\n\t\t\t\tBannerID,\n\t\t\t\tPhraseID,\n\t\t\t\tPShows,\n\t\t\t
1577931 rplcat  localhost       yabsdb  Query   44      Waiting for table level lock    select\n\t\t\t\tBannerID,\n\t\t\t\tPhraseID,\n\t\t\t\tPShows,\n\t\t\t
1577956 rplcat  localhost       yabsdb  Query   44      Waiting for table level lock    select\n\t\t\t\tBannerID,\n\t\t\t\tPhraseID,\n\t\t\t\tPShows,\n\t\t\t
1578941 rplcat  localhost       yabsdb  Query   0       Sending data    insert into AuctionGroupBannerPhraseStat (\n\t\t\t\tGroupBannerID,\n\t\t\t\tPhraseID,
Пт. июля  7 15:52:39 MSK 2017
1577794 rplcat  localhost       yabsdb  Query   0       Copying to tmp table    select\n\t\t\tPhraseID,\n\t\t\tsum(PShows + DShows),\n\t\t\tsum(PClicks + DCl
1577931 rplcat  localhost       yabsdb  Query   0       Copying to tmp table    select\n\t\t\tPhraseID,\n\t\t\tsum(PShows + DShows),\n\t\t\tsum(PClicks + DCl
1577956 rplcat  localhost       yabsdb  Query   0       Copying to tmp table    select\n\t\t\tPhraseID,\n\t\t\tsum(PShows + DShows),\n\t\t\tsum(PClicks + DCl
Пт. июля  7 15:52:41 MSK 2017


2017/07/07 15:51:03 784645 INFO  [_task_collect_] Stopped task_collect for ResourceRankRequest
2017/07/07 15:51:03 784647 INFO  [_task_collect_] Started task_collect for AutoBudgetCopyPhrase
2017/07/07 15:51:03 784647 INFO  [_task_collect_] Stopped task_collect for AutoBudgetCopyPhrase
2017/07/07 15:51:03 784652 INFO  [_task_collect_] Started task_collect for AuctionCurveRankRequest
2017/07/07 15:51:03 784652 INFO  [_task_collect_] Stopped task_collect for AuctionCurveRankRequest
2017/07/07 15:52:39 815636 INFO  [_task_collect_] Started task_collect for BannerChangePhraseRankRequest
2017/07/07 15:52:39 815636 INFO  [_task_collect_] Stopped task_collect for BannerChangePhraseRankRequest
2017/07/07 15:52:39 815667 INFO  [_task_collect_] Started task_collect for MobileBannerPhraseStatRankRequest
2017/07/07 15:52:39 815667 INFO  [_task_collect_] Stopped task_collect for MobileBannerPhraseStatRankRequest
2017/07/07 15:52:39 815672 INFO  [_task_collect_] Started task_collect for RankRequest
2017/07/07 15:52:39 815672 INFO  [_task_collect_] Stopped task_collect for RankRequest
2017/07/07 15:52:40 783135 INFO  [cleanupProcess] /var/lib/mysql.yabs/yabsdb/RotateRankReq


1800
2017/07/07 15:51:36 794007 INFO  [          load] Host-option bstat-collectros-qtail-metric set in ll_metric
2017/07/07 15:51:37 794007 INFO  [         BEGIN] autobudget-group-banner: 1
2017/07/07 15:51:37 794007 INFO  [yabs_file_lock] locked
2017/07/07 15:51:37 794007 INFO  [           new] Script is already run with timeout 604800 (by runit?)
2017/07/07 15:51:38 794007 INFO  [        main::] Started collect-undoevent (/home/yabs/stat/collect-log.pl UndoEvent --loop-duration=300 --log-wait-time=60)
2017/07/07 15:51:38 794007 INFO  [get_nextdatalo] Time stamp border for log sorting: 20170707105115
2017/07/07 15:52:38 794007 INFO  [get_nextdatalo] Time stamp border for log sorting: 20170707105238


check-intersection-episodes <- эпизоды
episodes-covering-black-windows <- черные окна


check-intersection-kd-episodes <- новые эпизоды и новые черные окна одновременно
kd-conditional-eposides-covering-windows <- является черным окном тогда, когда blacked = 1

эпизоды из фида <- check-intersection-kd-episodes,kd-conditional-eposides-covering-windows и имеют ресурс blacked = 0
черные окна из фида <- check-intersection-kd-episodes,kd-conditional-eposides-covering-windows и имеют ресурс blacked = 1

416

Остающие тачки

Тачки колонируютсs

Обслуживающиеся тачки :
bstat106e ждем ресинка https://st.yandex-team.ru/ITDC-35533 ждем тут интела
bsyt06f https://st.yandex-team.ru/ITDC-35540
bstat53i https://st.yandex-team.ru/ITDC-35691

Выкладки:
7)  Пытаемся оптимизировать bsdb-to-yt.pl https://bsint.yandex-team.ru/scriptControl#groupping=&query=bsdb-to-yt&host_query=bstat133&filter=all&sort=ScriptID-ASC ждем ревью
8) ABBannerPhraseCurWeek + OrderInfo выложитьhttps://st.yandex-team.ru/BSDEV-64629
5-7-8 bstat133i и bstat133f
7 bstat133e
9) правка ваншотницы  https://st.yandex-team.ru/BSDEV-64672
---
10) кеширование нормализации https://st.yandex-team.ru/BSDEV-64686

Написание кода:


288 shared_ptr lock_free list implementation
alexpv,bahbka,behemot,dkulikovsky,italiano,keyd,saint,say,zahacker,yottatsa,slepovss,kiwi,nyaapa,olegts
Ср. июля 12 14:35:18 MSK 2017
0
Ср. июля 12 14:35:19 MSK 2017
1
Ср. июля 12 14:35:20 MSK 2017

6e02-65dd0-3ee0001-effb774f



Илья Антипин, [12 июля 2017 г., 18:54]:
yabsinfo.Locks
Находишь записи без существующих mysql-коннектов к мастер-базе и удаляешь их
antilost@bssoap03e:/mnt/raid/home/antilost$ mysql yabsdb -A -urplcat -hbsdb -pslvrkng -e "select L.LockID from yabsinfo.Locks L left join INFORMATION_SCHEMA.processlist P on L.ConnectionID = P.Id where Name like 'YaBSSOAPExportUpdateData2_7%' and P.Id is null and L.State = 'acquired'" | tail -n +2 | tr "\n" "," > ids

Далее delete from yabsinfo.Hosts where LockID in (<..список LockID из ids..>)

Еще есть скрипт clean-locks.pl, удаляющий записи по ExpireTime
https://a.yandex-team.ru/arc/trunk/arcadia/yabs/stat/bsdb/clean-locks.pl?rev=2987924&blame=true#L93

Просто уменьшить ExpireTime нельзя, т.к. запрос транспорт может выполнять долго, но в пределах текущего ExpireTime, но отслеживать и удалять локи, для которых коннектов уже нет — можно, задача для второго дежурного (то, что я делал вручную).


yabsdb.OrderLock
От зависших локов в этой таблице на bssoap есть скрипт order-locks-killer.pl, запускающийся на bssoap и удаляющий из OrderLock записи для данного хоста, если указанный в имени лока pid процесса apache2, обрабатывающего запрос, уже не существует в системе.
https://a.yandex-team.ru/arc/trunk/arcadia/yabs/interface/yabs-transport-scripts/order-locks-killer.pl?rev=2987924&blame=true#L29

Можно наверное сюда же добавить удаление локов, взятых с недоступных по сети хостов.

soap_check отвиснет, когда балансер "увидит" bssoap; если горит на bssoap0_h — ok

Олег Царьков, [12 июля 2017 г., 18:56]:
olegts@bssoap01g:/mnt/raid/home/olegts$ sudo monrun -r soap_check
soap_check = YaBSSOAPExport: updatetime=5988

не на h

Илья Антипин, [12 июля 2017 г., 19:00]:
а когда клонирование запускал bssoap02f -> bssoap03f.yabs, что ты делал для остановки скриптов?

на bssoap02f

Олег Царьков, [12 июля 2017 г., 19:02]:
колонирование само не останавливает?!

Илья Антипин, [12 июля 2017 г., 19:03]:
останавливает, но процесс может длиться долго из-за, например, тяжелых ручек экспорта статистики

Олег Царьков, [12 июля 2017 г., 19:03]:
вроде там уже стадия копирования во всю идет

за логом я смотрю да как ты советовал

фух я на секунду подумал что и с колонированием что-то не так

Илья Антипин, [12 июля 2017 г., 19:06]:
https://paste.yandex-team.ru/265077

короче там тоже OrderLock зависли, и т.к. скрипты остановлены, удаляющий локи скрипт не запустится, пришлось руками почистить. Такое бывает, если сделать apach2-restart, но не apache2-reload

в общем надо подумать, как отслеживать записи в OrderLock, yabsinfo.Locks, вне зависимости от доступности хостов, с которых лок был взят, и удалять их при необходимости


https://bs-mg.yandex-team.ru/render/?target=one_min.bsistat03f_yabs_yandex_ru.logcount_RotateBannerAvailabilityLog*.count&noCache=True&from=-10h




2017/07/12 23:39:27 298697 INFO  [ _task_collect] Processing requests with UpdateInfo = 0 (collecting)


Ср. июля 12 23:39:39 MSK 2017
Id      User    Host    db      Command Time    State   Info
272     system user             NULL    Connect 182697  Waiting for master to send event        NULL
502     system user             NULL    Connect 0       Slave has read all relay log; waiting for the slave I/O thread to update it     NULL
5627114 mkdb_5  2a02:6b8:b040:1a1c:e61d:2dff:fe13:4d20:37316    yabsdb  Execute 157     Sending data    select EngineID, GroupExportID, PhraseID, ContextType,
5629936 rplcat  localhost       yabsdb  Query   1       Sending data    select\n\t\t\t\t\t\t\tABPrice.OrderID,\n\t\t\t\t\t\t\tB.BannerID,\n\t\t\t\t\t\t\tABPri
5632298 root    localhost       yabsdb  Query   -1      NULL    show full processlist
Ср. июля 12 23:39:41 MSK 2017


2017/07/12 23:39:27 298697 INFO  [ _task_collect] Processing requests with UpdateInfo = 0 (collecting)
23:41:56
2017/07/12 23:42:03 298697 INFO  [ _task_collect] Processing requests with UpdateInfo = 2 (cleanup)


Отличия с логфеллером исследуются отдельно https://st.yandex-team.ru/BSMON-9158
AntiFraudStat
OrderStatDayVsArchive
SummaryTagVsArchive
SummaryPartnerVsArchive
ClickHouseDSPStatVsArchive

http://api.gencfg.yandex-team.ru/tags/stable-101-r256/groups/MSK_AUTOBUDGET_GUEST


-r2986009:r2986065

alexpv,bahbka,behemot,dkulikovsky,italiano,keyd,saint,say,zahacker,yottatsa,slepovss,kiwi,nyaapa,legts


 !!! PRODUCTION !!! root@bsint01i.yandex.ru [yabsinfo]> select * from DirectTestLog201707 where TestLogID= 5084762;
+-----------+--------+---------------------+---------------------+---------------------+--------------+---------------+--------+----------+
| TestLogID | TestID | StartTime           | FinishTime          | BsdbTime            | StartStateID | FinishStateID | Status | ErrorStr |
+-----------+--------+---------------------+---------------------+---------------------+--------------+---------------+--------+----------+
|   5084762 |     37 | 2017-07-11 11:02:53 | 2017-07-11 13:08:34 | 0000-00-00 00:00:00 |            9 |            10 | done   | NULL     |
+-----------+--------+---------------------+---------------------+---------------------+--------------+---------------+--------+----------+
1 row in set (0.00 sec)

 !!! PRODUCTION !!! root@bsint01i.yandex.ru [yabsinfo]> select * from DirectTests where TestLogID=5084762;
ERROR 1054 (42S22): Unknown column 'TestLogID' in 'where clause'
 !!! PRODUCTION !!! root@bsint01i.yandex.ru [yabsinfo]> select * from DirectTests where DirectTestID=5084762;
ERROR 1054 (42S22): Unknown column 'DirectTestID' in 'where clause'
 !!! PRODUCTION !!! root@bsint01i.yandex.ru [yabsinfo]> select * from DirectTests where TestID=5084762;
Empty set (0.00 sec)

 !!! PRODUCTION !!! root@bsint01i.yandex.ru [yabsinfo]> select * from DirectTests where TestID=37;
+--------+------------+-----------+------------+----------------------------------+-------------+----------------+--------------+----------------+------------+------------+
| TestID | CampaignID | BannerID  | PhraseID   | PhraseData                       | PhrasePrice | CampaignActive | BannerActive | CurrentStateID | TestTypeID | TestActive |
+--------+------------+-----------+------------+----------------------------------+-------------+----------------+--------------+----------------+------------+------------+
|     37 |   11802890 | 747603100 | 2147483647 | 790f441822f80d493a0d776199f018bb |        15.3 |              1 |            1 |             10 |          4 |          1 |
+--------+------------+-----------+------------+----------------------------------+-------------+----------------+--------------+----------------+------------+------------+
1 row in set (0.00 sec)

 !!! PRODUCTION !!! root@bsint01i.yandex.ru [yabsinfo]> select * from DirectTestTypes where TestTypeID=4;
+------------+---------------------------+
| TestTypeID | Description               |
+------------+---------------------------+
|          4 | Change banner description |
+------------+---------------------------+
1 row in set (0.00 sec)

next: 0x7f4654000ba0
tail 0x7f4654000b50

Каждый тред 10 миллионов операций
1) lock-free очередь 4 треда
real    0m10.082s
user    0m37.448s
sys     0m0.949s

RPS
>>> 4e7/10.0/1e6
4.0 миллиона

2) lock-free очередь 2 треда
real    0m6.079s
user    0m11.314s
sys     0m0.077s

RPS
>>> 2e7/6/1e6
3.3333333333333335 миллиона

3) очередь с мьютексом 4 треда
real    0m17.316s
user    0m23.260s
sys     0m25.856s

RPS
>>> 4e7/17.3/1e6
2.3121387283236996 миллиона

4) очередь с мьютексом 2 треда
real    0m5.500s
user    0m6.980s
sys     0m3.146s

RPS
>>> 2e7/5.5/1e6
3.6363636363636362 миллиона


ABExperimentCurWeek
ABGroupExportPhraseStatDay
ABOrderActions
ABExperimentCurWeek
ABSpentPlan
ABBannerPhraseCurWeek
AutoBudgetConvStat
ABGroupExportPhraseStatDay

$broad = int( $ostat->[$O_BROADMATCH_CAPACITY] * $ab_coeff * 100 / $spent_plan_money );
spent_plan_money -- сколько мы собираемся потратить на поиске
ab_coeff коэффициент 5-минутки

sky upload timestats4.json .  +G@MAN_AUTOBUDGET_GUEST:stable-97-r101 +G@VLA_AUTOBUDGET_GUEST:stable-99-r185 +G@MAN_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@SAS_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@VLA_AUTOBUDGET_PRE_GUEST:stable-100-r2 +G@SAS_AUTOBUDGET_GUEST:stable-97-r101 вот такой командой можно разложить везде файлик

sky run "sudo scp timestats4.json /var/lib/global-info/timestats/timestats4.json"  +G@MAN_AUTOBUDGET_GUEST:stable-97-r101 +G@VLA_AUTOBUDGET_GUEST:stable-99-r185 +G@MAN_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@SAS_AUTOBUDGET_PRE_GUEST:stable-98-r12 +G@VLA_AUTOBUDGET_PRE_GUEST:stable-100-r2 +G@SAS_AUTOBUDGET_GUEST:stable-97-r101


olegts@bs-dev07 [ 13242.server.code ] :~/arc/trunk/arcadia/yabs/server$ svn diff > super-diff-4
olegts@bs-dev07 [ 13242.server.code ] :~/arc/trunk/arcadia/yabs/server$ svn info
Path: .
Working Copy Root Path: /place/home/olegts/arc
URL: svn+ssh://arcadia.yandex.ru/arc/trunk/arcadia/yabs/server
Repository Root: svn+ssh://arcadia.yandex.ru/arc
Repository UUID: 41d65440-b5be-11dd-afe3-b2e846d9b4f8
Revision: 2978398
Node Kind: directory
Schedule: normal
Last Changed Author: aprudaev
Last Changed Rev: 2978353
Last Changed Date: 2017-07-05 15:58:03 +0300 (Ср., 05 июля 2017)
G

olegts@bs-dev07 [ 13242.server.code ] :~/arc/trunk/arcadia/yabs/server$ svn diff > super-diff-5
olegts@bs-dev07 [ 13242.server.code ] :~/arc/trunk/arcadia/yabs/server$ svn info
Path: .
Working Copy Root Path: /place/home/olegts/arc
URL: svn+ssh://arcadia.yandex.ru/arc/trunk/arcadia/yabs/server
Repository Root: svn+ssh://arcadia.yandex.ru/arc
Repository UUID: 41d65440-b5be-11dd-afe3-b2e846d9b4f8
Revision: 2994630
Node Kind: directory
Schedule: normal
Last Changed Author: dzap
Last Changed Rev: 2994622
Last Changed Date: 2017-07-18 13:34:06 +0300 (Вт., 18 июля 2017)



> [fail] test_media_banner.py::TestDSP::test_performance_banner_with_place_select_27[4-expected_result2]  шумный тест то падает то нет
23a25
> [fail] test_chkdb.py::test_chkdb[st] <- это правильное расхождение добавления perf_norm_only_retargeting_broad_word_net
109a112,113

Изучить тесты:
> [fail] test_ad_type.py::TestDSP::test_mediaperf_and_direct[4-100000.0-10000000000.0-smart-MinCPM] мигающий тест
> [fail] test_ad_type.py::TestDSP::test_two_perfs_and_direct[4-1000000.0-100000000.0-10000.0-media_smart-direct] тоже мигающий тест


//home/logfeller/logs/bs-dspobject-log/1d/%Y-%m-%d поле totalhitobjects
 606                         $bid_reqs_info->{$bid_req_id}->[$BR_COUNTERS]->{'real'}++;
 608                         $bid_reqs_info->{$bid_req_id}->[$BR_COUNTERS]->{'total'} =
 609                                 $row->{TotalHitObjects}
 610                                 // $bid_reqs_info->{$bid_req_id}->[$BR_COUNTERS]->{'real'};

$bid_reqs_info->{$bid_req_id}->[$BR_COUNTERS]->{total};
 $bid_reqs_info->{$bid_req_id}->[$BR_COUNTERS]->{real};
objects_count != real_objects_count



ibid_req_id $objects_bid_reqs_covering->{$data_md5}
my $covered_objects_count = $bid_reqs_covered_objects_count->{$bid_req_id};

objects_bid_reqs_covering нет по data_md5 ничего

md5 нету в $bid_reqs_info->{$bid_req_id}->[$BR_OBJECTS] или в $objects_info->{$data_md5}->[$O_TO_MODERATE]

сортировка ключей objects_info по убыванию hits:q


https://metrika.yandex.ru/stat/direct_summary?goal=13023704&metric=ym%3As%3Agoal<goal_id>visits&sort=-ym%3As%3Agoal<goal_id>visits&group=day&selected_rows=f06d0m&period=month&filter=(ym%3As%3AlastDirectClickOrder%3D%3D%252710198249%2527)&attribution=LastSign&currency=643&accuracy=1&metrics=ym%3As%3Agoal<goal_id>conversionRate%2Cym%3As%3Agoal<goal_id>reaches%2Cym%3As%3Agoal<goal_id>visits%2Cym%3As%3Agoal<goal_id>users%2Cym%3As%3Agoal<goal_id>bounceRate%2Cym%3As%3Agoal<goal_id>pageDepth%2Cym%3As%3Agoal<goal_id>avgVisitDurationSeconds%2Cym%3As%3Agoal<goal_id>revenue%2Cym%3As%3Agoal<goal_id>ecommerce<currency>Revenue&id=160530


O_REAL_SPENT_CLICKS <- AutoBudgetStatCurWeek,ABSpentPlan
O_REAL_SPENT_ACTIONS <- ABExperimentCurWeek,ABSpentPlan
week_clicks <- ABBannerPhraseCurWeek
week_actions <- ABBannerPhraseCurWeek

I have done most of the implementation job of a certain basic flum jib, which aim is to find out-of-sync cookies by means of a simple mismatch detection rule.


Антон Полднев, [19 июля 2017 г., 16:45]:
unsorted/test_acceptance.py
TestSmart → test_offer

Искать можно по 'NormType': 'offer'


:q
MAN_BK_ZOOKEEPER_NEW  -  stable-101-r84  1  1  noiseless,olegts
MAN_VH_BACKEND  trunk-2981860  stable-101-r206  2  1  w495,olegts,architect,snusmumrik
MAN_YABSCS_OLEGTS  -  stable-100-r64  1  1  olegts

https://superuser.com/questions/1168901/dnf-copr-plugin-not-present-in-dnf-plugins-core

enum class yabs_arg_tag_type : ui8 {
    query = 0,
    referer = 1,
    rereferer = 2,
    yacofast_exact = 3,
    yacofast_shutter = 4,
    yacofast_direct_banners = 5,
    turl_group = 6,
    turl_shutter = 7,
    bigb_user = 8,
    bigb_common = 9,
    offer = 10,
    ubf = 11,
    user_direct_banner = 12,
    udb = 13, // query from yabs-udb cookie
    adaptive = 14,
    adaptive_banner = 15,
    additional = 16,
    goal = 17,
    count
};

 621     i32 tag_bound[static_cast<int>(yabs_arg_tag_type::count) + 1];

 256 int yabs_args::tag_count() const {
 257     return tag_bound[static_cast<int>(yabs_arg_tag_type::count)];
 258 }

 331 void yabs_args::start_tag_type(yabs_arg_tag_type arg_tag_type) {
 332     tag_bound[static_cast<int>(arg_tag_type)] = tag_count();
 333 }


 344     for (
 345         int arg_tag_type_int = static_cast<int>(arg_tag_type) + 1;
 346         arg_tag_type_int < static_cast<int>(yabs_arg_tag_type::count);
 347         ++arg_tag_type_int) {
 348         tag_bound[arg_tag_type_int] = tag_count();
 349     }
 350 }


for (yabs_tree* ctx = yabs_tree_first(data->context); ctx; ctx = yabs_tree_next(ctx)) {
yabs_context_match* ctm = (yabs_context_match*)yabs_tree_data(ctx)
cur_tag = ctm->phrase[i.pos].arg_tag;

1) есть оба сегмента -- тогда отбирается только офферный
2) нет сегментов -- ничего не отбирается
3) есть только фразовый сегмент -- отбирается только фраза
4) есть только офферный сегмент -- отбирается только офферный

test_partial_disable_only_offer_retargeting_filter.py::TestDisableFilterOptions::test_disable_filter_options[False-False-False]

olegts@bs-dev07 [ 13242.server.code ] :~/arc/trunk/arcadia/yabs/server$ svn diff > server-diff-6
olegts@bs-dev07 [ 13242.server.code ] :~/arc/trunk/arcadia/yabs/server$ svn info
Path: .
Working Copy Root Path: /place/home/olegts/arc
URL: svn+ssh://arcadia.yandex.ru/arc/trunk/arcadia/yabs/server
Repository Root: svn+ssh://arcadia.yandex.ru/arc
Repository UUID: 41d65440-b5be-11dd-afe3-b2e846d9b4f8
Revision: 2994630
Node Kind: directory
Schedule: normal
Last Changed Author: dzap
Last Changed Rev: 2994622
Last Changed Date: 2017-07-18 13:34:06 +0300 (Вт., 18 июля 2017)


olegts@bs-dev07 [ 13242.server.code ] :~/arc/trunk/arcadia/yabs/server$ svn diff > server-diff-7
olegts@bs-dev07 [ 13242.server.code ] :~/arc/trunk/arcadia/yabs/server$ svn info
Path: .
Working Copy Root Path: /place/home/olegts/arc
URL: svn+ssh://arcadia.yandex.ru/arc/trunk/arcadia/yabs/server
Repository Root: svn+ssh://arcadia.yandex.ru/arc
Repository UUID: 41d65440-b5be-11dd-afe3-b2e846d9b4f8
Revision: 3001552
Node Kind: directory
Schedule: normal
Last Changed Author: borman
Last Changed Rev: 3001537
Last Changed Date: 2017-07-24 01:40:35 +0300 (Пн., 24 июля 2017)


заказ клавиатуры https://www.re-store.ru/order/complete.php?id=1258498

/Users/olegts/ubuntu.iso
olegts@bs-dev07 [ 13242.server.code ] :~/arc/trunk/arcadia/yabs/server$ svn diff > super-diff-8
olegts@bs-dev07 [ 13242.server.code ] :~/arc/trunk/arcadia/yabs/server$ svn info
Path: .
Working Copy Root Path: /place/home/olegts/arc
URL: svn+ssh://arcadia.yandex.ru/arc/trunk/arcadia/yabs/server
Repository Root: svn+ssh://arcadia.yandex.ru/arc
Repository UUID: 41d65440-b5be-11dd-afe3-b2e846d9b4f8
Revision: 3001552
Node Kind: directory
Schedule: normal
Last Changed Author: borman
Last Changed Rev: 3001537
Last Changed Date: 2017-07-24 01:40:35 +0300 (Пн., 24 июля 2017)


Причины
1) P19 паттерн -- не показывается в РСЯ. Тогда ставки не апдейтятся АБ
2)



update GoalBanner61 inner join PhrasePrice on GoalBanner61.BannerID = PhrasePrice.BannerID and GoalBanner61.GoalContextID = PhrasePrice.PhraseID and PhrasePrice.ContextType =2 inner join Banner61 on GoalBanner61.BannerID = Banner61.BannerID inner join OrderInfo on Banner61.OrderID = OrderInfo.OrderID set GoalBanner61.Cost = PhrasePrice.ResultFlatCost where Banner61.ContextPriority > 0 and !find_in_set("deleted", GoalBanner61.Options) and !find_in_set("deleted", PhrasePrice.Options) and OrderInfo.Complete = 0 and GoalBanner61.Cost != PhrasePrice.ResultFlatCost ;


Код авторизации:
43UO7N

Виталий Кочуров, [26 июля 2017 г., 11:10]:
про собеседование на аналитика:
обычно нужно пройти секцию АА с кодом,

секцию с матстатом

и как правило ещё 1-2 секции аналитика+код

обязательно требуется как минимум понимание матстата + использовать его в базовых навыках, я обычно даю какую-нибудь супер простую задачу на Байеса, чтобы убедиться, что человек вообще в теме, после этого немного посложней - про проведение АБ теста, как его правильно провести, сколько нужно испытаний, как можно хотя бы оценить с помощью разных упрощений

по коду на секции аналитика+код тоже спрашиваю что-то несложное типа как вычислить, что из данного набора символов можно сделать палиндром

для bs-chevent-log я накодил пока примитивный шаблончик - 11956

YabsDownloadTimestats4
from projects.common.yabs.yabs_timestats4 import YabsTimestats4



olegts@bs-dev07 [ 13242.server.code ] :~/arc/trunk/arcadia/yabs/server$ svn diff > super-diff-9
olegts@bs-dev07 [ 13242.server.code ] :~/arc/trunk/arcadia/yabs/server$ svn info
Path: .
Working Copy Root Path: /place/home/olegts/arc
URL: svn+ssh://arcadia.yandex.ru/arc/trunk/arcadia/yabs/server
Repository Root: svn+ssh://arcadia.yandex.ru/arc
Repository UUID: 41d65440-b5be-11dd-afe3-b2e846d9b4f8
Revision: 3003653
Node Kind: directory
Schedule: normal
Last Changed Author: borman
Last Changed Rev: 3003061
Last Changed Date: 2017-07-25 00:04:11 +0300 (Вт., 25 июля 2017)

лампа http://www.220-volt.ru/catalog-94504/


!!! PRODUCTION !!! root@bstat39i.yandex.ru [yabsdb]> select * from ABVWForecasterAPC where BannerID in (2718531710, 3742357604);
+----------+------------+-----------+-------------+------+------+
| OrderID  | BannerID   | PhraseID  | ContextType | APC1 | APC2 |
+----------+------------+-----------+-------------+------+------+
| 11692956 | 2718531710 | 112937393 |           1 | 3786 | 2896 |
| 11692956 | 2718531710 | 312475733 |           1 | 3823 | 2925 |
| 11692956 | 2718531710 | 456295492 |           1 | 3810 | 2915 |
| 11692956 | 2718531710 | 456296343 |           1 | 4580 | 3504 |
| 11692956 | 3742357604 | 112937393 |           1 | 3666 | 2805 |
| 11692956 | 3742357604 | 312475733 |           1 | 3703 | 2833 |
| 11692956 | 3742357604 | 456295492 |           1 | 3690 | 2823 |
| 11692956 | 3742357604 | 456296343 |           1 | 4436 | 3394 |
+----------+------------+-----------+-------------+------+------+


GoalID где участвует
1) подставляется в fill_dynamic_linear_model_atom
2) в функции find_ab_goal_id
	1) find_ab_goal_id(i) >= 0;
3) в функции check_cpi_strategy_on сравнивается с нулем

bases.stat.stat_index.perf_broad_match = {
bases.stat.stat_index.perf_broad_match_count = {disaev_st001 = [163 152]}
bases.stat.stat_index.perf_norm_broad_word_net.word_hash.key = {disaev_st001 = {Hash = [0x2C443E21488BE932 0x5D332027ABCDF2F9]}}
bases.stat.stat_index.perf_norm_broad_word_net.word_set = {
bases.stat.stat_index.perf_norm_broad_word_net.ws_link_pool = {disaev_st001 = {Hash = [0xA5A680E6BAD40448 0xCFE7CC128A9686C6]}}
bases.stat.stat_index.perf_norm_broad_word_net.ws_phrase_pool = {
bases.stat.stat_index.perf_norm_only_retargeting_broad_word_net.word_hash.key = {
bases.stat.stat_index.perf_norm_only_retargeting_broad_word_net.word_hash.mask = {
bases.stat.stat_index.perf_norm_only_retargeting_broad_word_net.word_set = {
bases.stat.stat_index.perf_norm_only_retargeting_broad_word_net.ws_link_pool = {
bases.stat.stat_index.perf_norm_only_retargeting_broad_word_net.ws_phrase_pool = {
bases.stat.stat_index.perf_only_retargeting_broad_word_net.word_hash.key = {
bases.stat.stat_index.perf_only_retargeting_broad_word_net.word_hash.mask = {
bases.stat.stat_index.perf_only_retargeting_broad_word_net.word_set = {
bases.stat.stat_index.perf_only_retargeting_broad_word_net.ws_link_pool = {
bases.stat.stat_index.perf_only_retargeting_broad_word_net.ws_phrase_pool = {
bases.stat.stat_index.perf_snorm_broad_word_net.word_hash.key = {
bases.stat.stat_index.perf_snorm_broad_word_net.word_hash.mask = {disaev_st001 = [7 3]}
bases.stat.stat_index.perf_snorm_broad_word_net.word_set = {
bases.stat.stat_index.perf_snorm_broad_word_net.ws_phrase_pool = {
bases.stat.stat_index.perf_snorm_only_retargeting_broad_word_net.word_hash.key = {
bases.stat.stat_index.perf_snorm_only_retargeting_broad_word_net.word_hash.mask = {
bases.stat.stat_index.perf_snorm_only_retargeting_broad_word_net.word_set = {
bases.stat.stat_index.perf_snorm_only_retargeting_broad_word_net.ws_link_pool = {
bases.stat.stat_index.perf_snorm_only_retargeting_broad_word_net.ws_phrase_pool = {
bases.stat.stat_index.perf_with_only_offer_broad_match = {
bases.stat.stat_index.perf_with_only_offer_broad_match_count = {

perf_snorm_broad_word_net возвращается GetBroadMatchWordNet



mysql> select * from GroupAutoBudgetForecasterAPC where OrderID = 11692956 and GroupExportiD = 2048169607;
+----------+---------------+-----------+-------------+---------------------+------+------+--------+------+----------------+
| OrderID  | GroupExportID | PhraseID  | ContextType | UpdateTime          | APC1 | APC2 | PPC1   | PPC2 | ExperimentBits |
+----------+---------------+-----------+-------------+---------------------+------+------+--------+------+----------------+
| 11692956 |    2048169607 | 112937393 |           1 | 2017-07-27 04:31:00 |   45 |   18 | 122605 | 2083 |              0 |
| 11692956 |    2048169607 | 312475733 |           1 | 2017-07-27 04:31:00 |   45 |   18 | 165829 | 2092 |              0 |
| 11692956 |    2048169607 | 456295492 |           1 | 2017-07-27 04:31:00 |   45 |   18 | 140915 | 2088 |              0 |
| 11692956 |    2048169607 | 456296343 |           1 | 2017-07-27 04:31:00 |   45 |   18 | 109418 | 2079 |              0 |
+----------+---------------+-----------+-------------+---------------------+------+------+--------+------+----------------+
4 rows in set (0.00 sec)



olegts@bs-dev07 [ 13242.server.code ] :~/arc/trunk/arcadia/yabs/server$ svn diff > super-diff-10
olegts@bs-dev07 [ 13242.server.code ] :~/arc/trunk/arcadia/yabs/server$ ымт вша^C
olegts@bs-dev07 [ 13242.server.code ] :~/arc/trunk/arcadia/yabs/server$ svn info
Path: .
Working Copy Root Path: /place/home/olegts/arc
URL: svn+ssh://arcadia.yandex.ru/arc/trunk/arcadia/yabs/server
Repository Root: svn+ssh://arcadia.yandex.ru/arc
Repository UUID: 41d65440-b5be-11dd-afe3-b2e846d9b4f8
Revision: 3006146
Node Kind: directory
Schedule: normal
Last Changed Author: skalsin
Last Changed Rev: 3005973
Last Changed Date: 2017-07-26 17:41:00 +0300 (Ср., 26 июля 2017)


olegts@bs-dev07 [ 13242.server.code ] :~/arc/trunk/arcadia/yabs/server$ svn diff > server-diff-11
olegts@bs-dev07 [ 13242.server.code ] :~/arc/trunk/arcadia/yabs/server$ svn info
Path: .
Working Copy Root Path: /place/home/olegts/arc
URL: svn+ssh://arcadia.yandex.ru/arc/trunk/arcadia/yabs/server
Repository Root: svn+ssh://arcadia.yandex.ru/arc
Repository UUID: 41d65440-b5be-11dd-afe3-b2e846d9b4f8
Revision: 3007092
Node Kind: directory
Schedule: normal
Last Changed Author: borman
Last Changed Rev: 3007024
Last Changed Date: 2017-07-27 13:28:41 +0300 (Чт., 27 июля 2017)


  DB<20> x $key, $key_nbr, $slot_id, $slot_nbr_id, $apc_pr0, 1, $clicks_srch, $actions_srch
0  '11692956,1,2,2048169607,112937393'
1  '11692956,1,1,2048169607,112937393'
2  2
3  1
4  0.00224250760094071
5  1
6  0
7  0
  DB<17> x apc_nbr_smooth($stat, $key, $key_nbr, $slot_id, $slot_nbr_id, $apc_pr0, 1, $clicks_srch, $actions_srch) * $forecast_mult;
0  0.00213177983894144

  DB<<25>> x $apc0, $data->[ $CLICKS ] + $slot_nbr_sm_clicks + $srch_clicks, $data->[ $ACTIONS ] + $slot_nbr_sm_actions + $srch_actions
0  0.00224250760094071
1  23.1622234921054
2  0

mysql> select PhraseID,sum(pow(0.997, (1501155485 - unix_timestamp(UpdateTime)) div 3600) * Clicks)/1e6 from AutoBudgetForecasterStat where BannerID in (2718531710,3742357604) group by 1;
+-----------+----------------------------------------------------------------------------------+
| PhraseID  | sum(pow(0.997, (1501155485 - unix_timestamp(UpdateTime)) div 3600) * Clicks)/1e6 |
+-----------+----------------------------------------------------------------------------------+
| 112937393 |                                                               22.664167330583364 |
| 312475733 |                                                               16.973138954206252 |
| 456295492 |                                                               20.076920968483005 |
| 456296343 |                                                                26.02366665301882 |
+-----------+----------------------------------------------------------------------------------+
4 rows in set (0.00 sec)



  DB<5> x $stat->{'11692956,1,2,2048169607,112937393'}
0  ARRAY(0x60c7f98)
   0  23.1622234921054
   1  0
   2  0

  DB<<26>> x $data->[ $CLICKS ]
0  23.1622234921054
  DB<<27>> x $slot_nbr_sm_clicks
0  0
  DB<<28>> x $data->[ $ACTIONS ]
0  0
  DB<<29>> x $slot_nbr_sm_actions
0  0
  DB<<30>> x $srch_actions
0  0
  DB<<31>> x $srch_clicks
0  0

  DB<<24>> x _calc_apc($apc0, $data->[ $CLICKS ] + $slot_nbr_sm_clicks + $srch_clicks, $data->[ $ACTIONS ] + $slot_nbr_sm_actions + $srch_actions);
0  0.00213177983894144

  DB<<49>> x 1. / (23.  + 1. / 0.00224250760094071)
0  0.00213251731625158


  DB<11> x $key, $key_nbr, $slot_id, $slot_nbr_id, $apc0, 0
0  '11692956,1,2,2048169607,112937393'
1  '11692956,1,1,2048169607,112937393'
2  2
3  1
4  0.00278014712322144
5  0

  DB<<22>> x 1. /0.0639
0  15.6494522691706

  DB<<21>> x 1. / (23. + 1. /0.0639)
0  0.0258735878851682





service_56_1501503542.91.log
service_56_1501498742.95.log
service_56_1501493946.17.log
service_56_1501489142.09.log
:q

---

Network:

Client:

memset(&host_info, 0, sizeof host_info);
host_info.ai_family = AF_UNSPEC;
host_info.ai_socktype = SOCK_STREAM;
int status = getaddrinfo(ip.c_str(), port.c_str(), &host_info, &host_info_list); // заполняет host_info_list // Это можно вызывать много раз
int socketfd = socket(host_info_list->ai_family, host_info_list->ai_socktype, host_info_list->ai_protocol);
int status = connect(socketfd, host_info_list->ai_addr, host_info_list->ai_addrlen);
send(socketfd, send_message.c_str(), send_message.size(), 0);
shutdown(socketfd, 1);

fd_set fds;
FD_ZERO(&fds);
FD_SET(socketfd, &fds);
memset(incoming_data_buffer, 0, RECV_PART + 1);
int select_result = select(socketfd + 1, &fds, NULL, NULL, &tv);
if (!select_result) {
	break;
}
ssize_t bytes_recieved = recv(socketfd, incoming_data_buffer, RECV_PART, 0); // не ждет ничего
if (bytes_recieved == 0) {
	break;
}
got_message += std::string(incoming_data_buffer);
freeaddrinfo(host_info_list);
close(socketfd);

Server:
memset(&host_info, 0, sizeof host_info);
host_info.ai_family = AF_UNSPEC;
host_info.ai_socktype = SOCK_STREAM;
int status = getaddrinfo(ip.c_str(), port.c_str(), &host_info, &host_info_list); // заполняет host_info_list
int socketfd = socket(host_info_list->ai_family, host_info_list->ai_socktype, host_info_list->ai_protocol);
int status = bind(socketfd, host_info_list->ai_addr, host_info_list->ai_addrlen);
listen(socketfd, 10); // 10 -- максимальное количество соединений
struct sockaddr_in cli_addr;
socklen_t clilen = sizeof(cli_addr);
int client_socketfd = accept(socketfd, (struct sockaddr *) &cli_addr, &clilen); // Это можно вызывать много раз

fd_set fds;
FD_ZERO(&fds);
FD_SET(client_socketfd, &fds);
memset(incoming_data_buffer, 0, RECV_PART + 1);
int select_result = select(client_socketfd + 1, &fds, NULL, NULL, &tv);
if (!select_result) {
	break;
}
ssize_t bytes_recieved = recv(client_socketfd, incoming_data_buffer, RECV_PART, 0);
if (bytes_recieved == 0) {
	break;
}
got_message += std::string(incoming_data_buffer);
shutdown(client_socketfd, 0);

send(client_socketfd, send_message.c_str(), send_message.size(), 0);

close(client_socketfd);


freeaddrinfo(host_info_list);

---

WAL-structures

class ConcreteUpdateClass
	ConcreteProtoDef Dump()
		dumps to protobuf

	Restore(ConcreteProtoDef proto)
		restores from protobuf
private:
	some variables


template <typename BaseStateClass, typename UpdateClass>
class UpdatesApplier
	UpdatesApplier()


tempalte <typename UpdateClass>
class State
	RegisterUpdate
		push to update_queue vector

	Fix
		drop update_queue

	RollbackUpdates
		calls Rollback for all elements from update_queue

	GetUpdates
		return update_queue

	IsUpToDate()
		return true if update_queue is empty

	GetFrontUpdate() noexcept
		returns first update from update_queue

	PopFrontUpdates() noexcept
		pops_front from update_queue

	ApplyUpdates(own_queue) //strong exception safety
		assert(IsUpToDate())
		vector applied_updates
		while not empty own_queue:
			front_update = front of own_queue
			try {
				Apply(front_update)
				applied_updates.push_back(front_update)
			} catch {
				Rollback(front_update)
				call Rollback for all applied_updates
			}
			pop_front from own_queue
private:
	std::list<UpdateClass> update_queue;


class ConcreteState : State<ConcreteUpdateClass>
	Apply(ConcreteUpdateClass one_update) //strong exception safety

	Rollback(ConcreteUpdateClass one_update) noexcept

	ConcreteUpdateClass Dump()
		assert(IsUpToDate())
		dumps to protobuf

	Restore(ConcreteUpdateClass proto)
		restores from proto

	...any modification...
		call ApplyUpdates with some updates list
private:
	variables

---

Double-page structures:

template <typename StateClass>
class DoublePageState : public StateClass
	...inheritec all from parent class, current istance is future state ...
		modifies self (future_state), pushes to future_state.update_queue

	redefine Fix() //strong exception safety
		while !IsUpToDate():
			front_update = call GetFrontUpdate() <- does not throw
			read_state.Apply(front_update)
			call PopFrontUpdates() <- does not throw

	redefine ApplyUpdates(updates) //strong exception safety
		vector applied_updates
		while not empty updates:
			front_update = front from updates
			try {
				Apply(front_update)
			} catch {
				Rollback(front_update)
				call Rollback and read_state.Rollback foo each of applied_updates
				throw;
			}
			try {
				read_state.Apply(front_update)
				applied_updates.push_back(front_update)
			} catch {
				Rollback(front_update)
				read_state.Rollback(front_update)
				call Rollback and read_state.Rollback foo each of applied_updates
				throw
			}
			updates.pop_front(front_update)


	StateClass& GetReadState()
		return read_state
private:
	StateClass read_state;

---




 !!! PRODUCTION !!! root@bsistat01i.yandex.ru [yabsdb]> select TargetType, sum(Cost) from AutoBudgetMonitoringStat201707 where UpdateTime between '2017-07-31' and '2017-08-06' and NetCPC = 0 and LimitDayMoney = 0 group by 1;
+------------+--------------+
| TargetType | sum(Cost)    |
+------------+--------------+
|          0 | 729783163000 |
|          1 | 690792520044 |
+------------+--------------+
2 rows in set (0.43 sec)

 !!! PRODUCTION !!! root@bsistat01i.yandex.ru [yabsdb]> select TargetType, sum(Cost) from AutoBudgetMonitoringStat201708 where UpdateTime between '2017-07-31' and '2017-08-06' and NetCPC = 0 and LimitDayMoney = 0 group by 1;
+------------+---------------+
| TargetType | sum(Cost)     |
+------------+---------------+
|          0 | 2914952738803 |
|          1 | 2349546879808 |
+------------+---------------+
2 rows in set (0.96 sec)

 !!! PRODUCTION !!! root@bsistat01i.yandex.ru [yabsdb]> select TargetType, sum(Cost) from AutoBudgetMonitoringStat201707 where UpdateTime between '2017-07-03' and '2017-07-09' and NetCPC = 0 and LimitDayMoney = 0 group by 1;
+------------+---------------+
| TargetType | sum(Cost)     |
+------------+---------------+
|          0 | 3752942578449 |
|          1 | 3264501666556 |
+------------+---------------+
2 rows in set (3.04 sec)

>>> 3752942578449+3264501666556./2
5385193411727.0
>>> (729783163000+2914952738803) + (690792520044+2349546879808)/2
5164905601729

>>> 5164905601729./5385193411727.0
0.9590937979092278

Общий заработок понизится на 4.1%


 !!! PRODUCTION !!! root@bsistat01i.yandex.ru [yabsdb]> select TargetType, sum(Cost) from AutoBudgetMonitoringStat201707 where UpdateTime between '2017-07-31' and '2017-08-06' and NetCPC = 0 and LimitDayMoney = 0 and BaseNo between 20 and 29  group by 1;
+------------+-------------+
| TargetType | sum(Cost)   |
+------------+-------------+
|          0 | 57019030554 |
|          1 | 64020962075 |
+------------+-------------+
2 rows in set (0.36 sec)

 !!! PRODUCTION !!! root@bsistat01i.yandex.ru [yabsdb]> select TargetType, sum(Cost) from AutoBudgetMonitoringStat201708 where UpdateTime between '2017-07-31' and '2017-08-06' and NetCPC = 0 and LimitDayMoney = 0 and BaseNo between 20 and 29  group by 1;
+------------+--------------+
| TargetType | sum(Cost)    |
+------------+--------------+
|          0 | 218325978157 |
|          1 | 228998847072 |
+------------+--------------+
2 rows in set (0.30 sec)

 !!! PRODUCTION !!! root@bsistat01i.yandex.ru [yabsdb]> select TargetType, sum(Cost) from AutoBudgetMonitoringStat201707 where UpdateTime between '2017-07-03' and '2017-07-09' and NetCPC = 0 and LimitDayMoney = 0 and BaseNo between 20 and 29 group by 1;
+------------+--------------+
| TargetType | sum(Cost)    |
+------------+--------------+
|          0 | 306187329674 |
|          1 | 272069955274 |
+------------+--------------+
2 rows in set (1.69 sec)

>>> 306187329674+272069955274./2
442222307311.0
>>> (57019030554+218325978157) + (64020962075+228998847072)/2
421854913284

>>> 421854913284/442222307311.0
0.9539430876953109

>>> 1-0.9539430876953109
0.04605691230468911

4.5 процента

7) Описать объект транзакции
	- transaction_id
	- список апдейтов
5) Описываем класс стейтов, хранящий
	- список всех апдейтов
	- итератор, на котором находится future state
	- максимальный добавленный transaction_id
	- максимальный примененный transaction_id
	- список итераторов и номеров транзакций смены транзакций


http://www.kursydipacademy.com/

1770139


class Numerator<Update1, Update2>

Numerator<Update1, Update2> numerator;

using AnyUpdate=Update<Update1, Update2>



class State:
	ApplyUpdate(Update1* update) {}
private:
	list<AnyUpdate> updates;



Update<Update1, Update2>
	Proxy:
		CallUpdate(BaseState* state) {
			state->ApplyUpdate((UpdateClass *)this);
		}
	private:
		Update reference

	template <typename State>
	ApplyTo(const State& state)
		proxies->[typeid]->CallUpdate(state)
private:
	type_id


autobudget-forecast-zero-actions-client-const

olegts@bs-dev07 [ 13242.server.code ] :~/arc/trunk/arcadia/yabs/server$ svn info
Path: .
Working Copy Root Path: /place/home/olegts/arc
URL: svn+ssh://arcadia.yandex.ru/arc/trunk/arcadia/yabs/server
Repository Root: svn+ssh://arcadia.yandex.ru/arc
Repository UUID: 41d65440-b5be-11dd-afe3-b2e846d9b4f8
Revision: 3007105
Node Kind: directory
Schedule: normal
Last Changed Author: borman
Last Changed Rev: 3007024
Last Changed Date: 2017-07-27 13:28:41 +0300 (Чт., 27 июля 2017)


 !!! PRODUCTION !!! root@bsdb02f.yandex.ru [yabsdb]> select distinct ExportID from AutoBudgetOrder  inner join (select OrderID,ExportID from OrderInfo where ExportID in (22248213,22248247,22248341,22248460,22248639,22248668,22249243,22249553,22249582,22249676,22250060,22250279,22250578,22250900,22250919,22250971,22251007,22251070,22251121,22251162,22251173,22251212,22251252,22251300,22251313,22251338,22251365,22251403,22251409,22251462,22251484,22251518,22251523,22251536,22251547,22251574,22251657,22251684,22251706,22251708,22251720,22251726,22251740)) T1 using(OrderID) where GoalID = 23128920;
+----------+
| ExportID |
+----------+
| 22251684 |
| 22248341 |
| 22250919 |
| 22251547 |
| 22249676 |
+----------+
5 rows in set (2.74 sec)


exportid = 22251684
baseno = 52
orderid = 11700877
groupexportid = 2049011790
select GroupExportID,sum(Clicks) as Clicks ,sum(arraySum(id, attr_type, num -> if(id = 23128920 and attr_type = 1, num, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num)) as Actions from OrderCounter where OrderID = 11700877 and EventDate = '2017-07-31' group by GroupExportID order by Clicks;
│    2049011790 │     27 │       0 │
│    2049011606 │     28 │       0 │
│    2049011562 │     29 │       0 │
│    2049011785 │     33 │       0 │
│    2049011524 │     34 │       0 │
│    2049011677 │     39 │       1 │
│    2049011521 │     42 │       0 │
│    2049011739 │     42 │       0 │
│    2049011717 │     52 │       0 │
│    2049011586 │     63 │       0 │
│    2049011700 │     66 │       0 │
│    2049011572 │     93 │       0 │
│    2049011513 │    100 │       0 │
│    2049011719 │    108 │       0 │
│    2049011732 │    130 │       0 │
│    2049011589 │    135 │       0 │
│    2049011523 │    184 │       1 │
│    2049011671 │    221 │       0 │
└───────────────┴────────┴─────────┘

Hotel - Russian Federation - 12

search_order_id = 15915906
baseno = 50
group_export_id = 2770423015


 !!! PRODUCTION !!! root@bstat52i.yandex.ru [yabsdb]> select * from PhraseDict where PhraseID in (1007479743,1007479771,1007479776,1007479846,1007479907,1007479743,1007479771,1007479776,1007479846,1007479907);
+----------------------+------------+------+-----------+------------------------------+----------------------+
| DataMD5              | PhraseID   | Type | WordCount | Data                         | NormalizedMD5        |
+----------------------+------------+------+-----------+------------------------------+----------------------+
|  9860616312500490123 | 1007479743 |    0 |         4 | tarkho hotel отель махачкала | 11298037617294994757 |
|  8358729974793870148 | 1007479771 |    0 |         2 | tarkho hotel                 | 10013682540090874846 |
| 12744703135588999692 | 1007479776 |    0 |         3 | tarkho hotel отель           | 15098009542550809207 |
|  8120935972849907370 | 1007479846 |    0 |         3 | тархо отель махачкала        |  3694668188174644598 |
|  2460882326710087529 | 1007479907 |    0 |         2 | тархо отель                  | 17278687847696783299 |
+----------------------+------------+------+-----------+------------------------------+----------------------+
5 rows in set (0.00 sec)



======

orderid = 11701238
exportid = 22248341
baseno = 90
groupexportid = 2048420602
phrases = 597843101,597843219,597843362,597843584,597843658,597843965,818707555,850865474,850865557,850865607,850865719,850865808,850865828,850865842,850865925,597843101,597843219,597843362,597843584,597843658,597843965,818707555,850865474,850865557,850865607,850865719,850865808,850865828,850865842,850865925

search_order_id = 15917182
baseno = 33
groupexportid = 2770486093




---------------------- REPORT _-----
Hotel - Russian Federation - 12

exportid = 22251684
baseno = 52
orderid = 11700877
groupexportid = 2049011790
Статистика группя по дням https://paste.yandex-team.ru/279664
РСЯ 31-ого июля https://paste.yandex-team.ru/279651

search_order_id = 15915906
baseno = 50
group_export_id = 2770423015
Поиск 31 июля  https://paste.yandex-team.ru/279652

====

Hotel - Belarus - 01

orderid = 11701238
exportid = 22248341
baseno = 90
groupexportid = 2048420602
best of search group in here = 2048420692
Статистика по дням этой группо-фразы https://paste.yandex-team.ru/279660
РСЯ 24 июля https://paste.yandex-team.ru/279665

search_order_id = 15917182
baseno = 33
groupexportid = 2770486093
better groupid = 2770486278
Поиск 24 июля https://paste.yandex-team.ru/279666

2048420541 -
2048420424 - 2770485680
2048420357 - 2770485543
2048420684 - 2770486271

===
select EventDate,sum(Clicks) as Clicks ,sum(arraySum(id, attr_type, num -> if(id = 23128920 and attr_type = 1, num, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num)) as Actions from OrderCounter where OrderID = 11700877  and GroupExportID = 2049011790 group by EventDate order by EventDate;

select GroupExportID,sum(Clicks) as Clicks ,sum(arraySum(id, attr_type, num -> if(id = 23128920 and attr_type = 1, num, 0), GoalsMap.ID, GoalsMap.AttributionType, GoalsMap.Num)) as Actions from OrderCounter where OrderID = 11701238   and EventDate = '2017-07-24' group by GroupExportID order by Clicks;

====

exportid  = 22250919
orderid =  11701371
baseno = 30
groupexportid = 2048865410

странный случай

====

Hotel - Italy - 11

exportid = 22251547
orderid = 11703207
baseno = 8
groupexportid = 2048989100


exportid = 28348389
orderid = 15915314
baseno = 129
groupexportid  =2770377930

2048989100 - 2770377930
2048988928 - 2770377640
2048989067 - 2770377841
===
exportid = 22249676
baseno = 132
orderid = 11704187
groupexportid = 2048673239
11703207



================================================



yabs_ext_yabsbt_mkreq <->  yabs_ext_bsbts_mkreq (выбирается по константе  laas_call_bsbts_directly

AddIdsIfPresentToParametersToBts
	yabs_ext_yabsbt_mkreq_keyword_as_number
		yabs_handler_bigb
		yabs_handler_region (laas_call_bsbts_directly off)
	 	get_bsbts_rf_info
	yabs_ext_bsbts_mkreq
		yabs_parse_bigb_answer
		yabs_handler_bigbproxy
		yabs_handler_region (laas_call_bsbts_directly on)
yabs_ext_yabsut_mkreq
	make_external_req
	refinfo_turl_req
yabs_ext_yacofast_mkreq
	make_external_req
	yabs_handler_turl

https://a.yandex-team.ru/arc/trunk/arcadia/ads/bsyeti/eagle/collect/collect.h?rev=3033224#L19
 !!! PRODUCTION !!! root@bsdb02f.yandex.ru [yabsdb]> select * from Constant where Name = 'laas-call-bsbts-directly';
+------------------+--------------------------+-------+---------------------------------------------+---------------------+
| ContentSystemKey | Name                     | Value | Description                                 | UpdateTime          |
+------------------+--------------------------+-------+---------------------------------------------+---------------------+
|                0 | laas-call-bsbts-directly |     1 | BSSERVER-2335 call bsbts directly from laas | 2017-06-09 13:35:59 |
+------------------+--------------------------+-------+---------------------------------------------+---------------------+
1 row in set (0.01 sec)

пробросим регион в этой функции yabs_ext_bsbts_mkreq




 !!! PRODUCTION !!! root@bstat39i.yandex.ru [yabsdb]> select min(ActionID), max(ActionID), count(*) from ExportABStatus;
+---------------+---------------+----------+
| min(ActionID) | max(ActionID) | count(*) |
+---------------+---------------+----------+
|        141859 |        144341 |   257932 |
+---------------+---------------+----------+
1 row in set (0.03 sec)
 !!! PRODUCTION !!! root@bstat143i.yandex.ru [yabsdb]> select min(ActionID), max(ActionID), count(*) from ExportABStatus;
+---------------+---------------+----------+
| min(ActionID) | max(ActionID) | count(*) |
+---------------+---------------+----------+
|         80853 |         83508 |   647722 |
+---------------+---------------+----------+
1 row in set (0.11 sec)
 !!! PRODUCTION !!! root@bstat52i.yandex.ru [yabsdb]> select min(ActionID), max(ActionID), count(*) from ExportABStatus;
+---------------+---------------+----------+
| min(ActionID) | max(ActionID) | count(*) |
+---------------+---------------+----------+
|        135107 |        137508 |   211207 |
+---------------+---------------+----------+
1 row in set (0.03 sec)
 !!! PRODUCTION !!! root@bstat52i.yandex.ru [yabsdb]> select * from ExportABStatus where BannerID = 4441449438;
+------------+------------+----------------+----------+
| PriorityID | BannerID   | BannerPriority | ActionID |
+------------+------------+----------------+----------+
|          0 | 4441449438 |              0 |   137460 |
+------------+------------+----------------+----------+
1 row in set (0.00 sec)


 !!! PRODUCTION !!! root@bsdb02f.yandex.ru [yabsdb]> select BaseNo,OrderID,ExportID from OrderInfo where ExportID in (28544651,28545264 );
+--------+----------+----------+
| BaseNo | OrderID  | ExportID |
+--------+----------+----------+
|     52 | 16258407 | 28544651 |
|     57 | 16258408 | 28545264 |
+--------+----------+----------+
2 rows in set (1 min 23.83 sec)
 !!! PRODUCTION !!! root@bstat57i.yandex.ru [yabsdb]> select BannerID,GroupExportID,ContextPriority,BannerPriority from Banner57 where OrderID = 16258408;
+------------+---------------+-----------------+----------------+
| BannerID   | GroupExportID | ContextPriority | BannerPriority |
+------------+---------------+-----------------+----------------+
| 4441449439 |    2790607711 |              10 |              1 |
+------------+---------------+-----------------+----------------+
1 row in set (0.00 sec)


OrderInfo

Еще что надо описать в RAST:
2) Написать конструирование HashIndentifier из строки
1) Переписать exception top storage на использование Ranked map

yabs_ext_bsbts_mkreq
	yabs_handler_bigb -- не используется
	yabs_handler_region -- тут есть вызов yabs_parse_ip
	get_bsbts_rf_info
		set_freq_cookie
			yabs_handler_count -- не нужно передавать region-id
		set_rtb_freq_cookie
			yabs_process_rtbcount
		yabs_handler_count -- тут вызов легкий, можно не передавать region-id

MATLAB https://rutracker.org/forum/viewtopic.php?t=5399611

+G@MAN_AUTOBUDGET_GUEST:stable-101-r256 +G@VLA_AUTOBUDGET_GUEST:stable-99-r185 +G@MAN_AUTOBUDGET_PRE_GUEST:stable-101-r256 +G@SAS_AUTOBUDGET_PRE_GUEST:stable-102-r21 +G@VLA_AUTOBUDGET_PRE_GUEST:stable-100-r2 +G@SAS_AUTOBUDGET_GUEST:stable-102-r21


booking
ClientID in (32314457,  5234006)


 !!! PRODUCTION !!! root@bsdb02f.yandex.ru [yabsdb]>  select * from KeywordType where KeywordID = 83;
+-----------+--------+---------+---------------+
| KeywordID | Type   | Options | Data          |
+-----------+--------+---------+---------------+
|        83 | system |         | frequency-day |
+-----------+--------+---------+---------------+
1 row in set (0.00 sec)

 !!! PRODUCTION !!! root@bsdb02f.yandex.ru [yabsdb]>  select * from KeywordType where KeywordID = 90;
+-----------+--------+---------+-------------+
| KeywordID | Type   | Options | Data        |
+-----------+--------+---------+-------------+
|        90 | system |         | freq-expire |
+-----------+--------+---------+-------------+
1 row in set (0.00 sec)

 !!! PRODUCTION !!! root@bstat29i.yandex.ru [yabsdb]> select * from Pattern where PatternID = 1416;
+-----------+-----------+-------------+------+--------+
| PatternID | KeywordID | OperationID | Data | Weight |
+-----------+-----------+-------------+------+--------+
|      1416 |        83 |           7 | 3    |      0 |
+-----------+-----------+-------------+------+--------+
1 row in set (0.00 sec)

 !!! PRODUCTION !!! root@bstat29i.yandex.ru [yabsdb]> select * from Pattern where PatternID = 2390;
+-----------+-----------+-------------+------+--------+
| PatternID | KeywordID | OperationID | Data | Weight |
+-----------+-----------+-------------+------+--------+
|      2390 |        90 |           8 | 28   |      0 |
+-----------+-----------+-------------+------+--------+
1 row in set (0.00 sec)


 !!! PRODUCTION !!! root@bsdb02f.yandex.ru [yabsdb]> select * from Operation where OperationID in (7,8);
+-------------+-----------------+------+------------------+------+----------+
| OperationID | OperationPrefix | Data | Description      | Name | MatchAll |
+-------------+-----------------+------+------------------+------+----------+
|           7 | 0+              | <    | less             | lt   |        0 |
|           8 | 0+              | >=   | greater or equal | ge   |        0 |
+-------------+-----------------+------+------------------+------+----------+
2 rows in set (0.00 sec)


шаблоны баннеров, скорее всего, такие же как у ГО и канваса
принимать два специальных пикселя на уровне баннера. нужно и для директовского ГО, и для охватного продукта. в шаблон креатива подставлять TRS'ом
поставить задачу "поправить код креатива для го и конструктора" на Пашу. при необходимости проапдейтить код креатива, кажется для этого нужно апдейтить таблицу, но я не уверен.


это значит что нужно взять два поля из запроса и сказать, что вот эти два поля в итоге два таких-то ресурс-парта такого-то ресурса. набор пикселей то есть вообще массивом можно сделать
т.е. надо:
- поправить TemplateResource для наших медийных шаблонов, вставив туда строчку для пикселей
- поправить шаблон ответа дспшки ртб-хосту, добавив туда пиксели
- научить код креатива эти пиксели дергаться при подтверждении видимости (не тебе, Петрухину)

TemplateID in (921, 953)



== отдельно ==
шаблоны баннеров, скорее всего, такие же как у ГО и канваса
принимать два специальных пикселя на уровне баннера. нужно и для директовского ГО, и для охватного продукта. в шаблон креатива подставлять TRS'ом
поставить задачу "поправить код креатива для го и конструктора" на Пашу. при необходимости проапдейтить код креатива, кажется для этого нужно апдейтить таблицу, но я не уверен.

svn+ssh://arcadia.yandex.ru/arc/branches/yabs/task/yabs-bssoap-www/BSDEV-65102

yabs-bssoap-www=65102.BSDEV.001
qabs-soap-tests-direct=65102.BSDEV.002
qabs-soap-harness=65102.BSDEV.001


0 1 2 3 4 5 6 7 8 9
  0   1   2   3   4


6 -> 4

1 <-
4 <-

2 * 1 + 2 * 4 - 6 = 10 - 6 = 4
abba

i = 6
k = 3

0 1 2 3 4 5 6 7 8 9
  7   8   6   8   8

    0   1 -- первый найденный бит
  ---------
0 |   |   |
  |---|---|
1 |   |   |
  ---------

4
1 2 1 2

3 1 2 -- input
2 1 2

01 2
10 1
11 2
=== DEBUG OUTPUT ===
? 2 1 3
Waiting for response
Got response 0
? 2 2 3
Waiting for response
Got response 3
? 2 1 3
Waiting for response
Got response 0
! 0 0


4 2 1
x = 2
y = 1
1 2 1 2


? 2 1 3
Waiting for response
Got response 0
? 2 2 3
Waiting for response
Got response 3
? 1 4
Waiting for response
Got response 2
one of bits  = 1
one_bit_results =  false true false false false false false false false false false
? 1 3
Waiting for response
Got response 1
? 0
Waiting for response
Got response 0
new_results =  true true false false false false false false false false false
! 1 3
Test OK
All tests OK



== Дежурство
commit transaction failed
Participant cell down

мастербаза отстает каждые 27 минут

bstat128f -- идет колонирование
bstat132e -- прибито колониорование

cdn-resources
====

Позвонить по поводу столов

892496716
893717324
893717320
892496716

sudo mv bsfront0563k/hit.7087177232269132143.MYD.20170905183201 bsfront0563k/bad.hit.7087177232269132143.MYD.20170905183201

893717320
3705702792

sudo -u hw-watcher hw_watcher disk fail sdd
https://femida.yandex-team.ru/problems (page 21)

Вт. сент. 12 17:45:36 MSK 2017

Вт. сент. 12 17:45:37 MSK 2017
1

D = RFMinCPM (миллионные доли) ?
C = RFCPMThreashold (миллионные доли) 0
A = RFDecay (миллионные доли) 0.85
F = MaxRF (миллионные доли)
RFDays



O_STARTTIME
	- коэффициент временно таргетинга
	- фильтрация статистики
	- вызов correct_hits_by_time для баннеро-фраз в adjusted_quality


root@sas1-7120-23202:~# cat /etc/resolv.conf
# generated by saltstack (system/resolv_conf state)
search search.yandex.net
nameserver 127.0.0.1
nameserver 2a02:6b8:0:3400::1
nameserver 2a02:6b8::1:1
options timeout:1 attempts:1r

MaxRF
RFDays
RFMinCPM
RFCPMThreshold
RFDecay
Context->{Type} cpm_banner
change PlaceID 1542

kassa@rambler-co.ru

д-пантенол
АУРОБИН



======

Anastasia Balakina, [18 сент. 2017 г., 14:05]:
Олег, привет! А у тебя по плану когда сойдутся стратегии для медийного продукта?

когда сможем потестить?


OK O_MAX_CPM (O_MAX_CLICK_COST)
OK	Constants.pm -- определение
OK	Limitations.pm -- использование в limit_max_cost, попытка ограничить максимальную цену
OK	Optimization.pm
OK		- calc_flat_bids_using_hulls ограничитель max_click_cost * 2, ограничитель для ставки
OK		- calc_marginal_cost для оптимизации ROI использует max_click_cost
OK		- calc_bids_by_convex_hull -- просто выводится
OK	LoadData.pm
OK		- загрузка O_MAX_CLICK_COST из таблицы
OK	Phrase.pm
OK		- пробрасывание до max_click_cost баннеро-фразы

O_AVG_CPM (O_AVG_CLICK_COST)
OK	Constants.pm -- определение параметра
OK	Limitations.pm
OK		- limit_max_cost -- использование для определения максимальной цены клика по средней стратегии
OK		- определение того, надо ли вызвать calc_eir
OK		- определение avg_val в функции calc_eir
OK		- участие в limit_by_eir
OK		- get_min_limits возвращается разный eir (!!!) -- тут непонятная ошибка
OK			- calc_flat_bids_native
OK			- calc_flat_bids_using_hulls
OK			- calc_flat_probability
OK	LoadData.pm
OK		- switch_order_avg_strategy переключение стратегий
OK		- choose_avg_strategy_for_orders переключение стратегий
OK		- формирование O_UNLIMITED
OK		- apply_group_strategy_to_orders для определнения настроек
OK		- пропускание заказа при чтении PhrasePrice
OK		- is_avg_strategy_only -- заполнение O_AVG_STRATEGY_ONLY
OK			- get_min_limits check_flat_capasity
OK			- split_spent_on_other -- принимаем решение об использовании ручных лимитов
OK			- calc_slopes сразу выставляется ставка если у нас только среднее ограничение в выпуклой оболочке поиска
OK	Optimization.pm
OK		- calc_flat_bids_using_hulls -- используется для ограничения оболочки
OK		- Используется в autobudget-set-average-bid (эксперимент для оболочки поиска)
OK		- отрицание используется в VCG (оболочка поиска)
OK		- calc_flat_bids_native (легаси)
OK		- calc_flat_probability -- используется странным образом, кажется, что должен быть учет других резервов
OK	autobudget.pl
OK		- сохранение в OrderHistory

min_cpm (min_bid)
OK	Constants.pm -- чтение Currency
OK	LoadData.pm -- дефолт
OK	Optimization.pm
OK		- выключение баннера -- проставление минимальной ставки (надо выпилить)
OK		- correct_bid -- не дает опуститься ниже минимальной ставки
OK	autobudget.pl
OK		- определение ленивости заказа

OPTIMIZE_ESHOWS (OPTIMIZE_ROI)
OK	Constants.pm -- определение константы
OK	Limitations.pm
OK		- limit_max_cost разный bottom_coef
OK		- calc_eir contract actions
OK		- учет ReserveReturn
OK	LoadData.pm
OK		- переопределение O_REAL_SPENT_ACTIONS
OK		- загрузка конверсий из ABExperimentCurWeek
OK		- загрузка правильного прогноза apc
OK		- фильтрация APC заказов
OK		- переопределение O_AVG_APC
OK		- фильтрация баннеров в load_actual_actions
OK	Optimization:
OK		- выпуклая оболочка в РСЯ - определение одного из ограничений
OK		- calc_marginal_cost -- пересчет (используется только в оболочке поиска)

(O_AVG_APC)
OK	Constants.pm -- определение
OK	Limitations.pm
OK		- _get_contract_actions
OK		- limit_max_cost -- нахождение максимальной ставки стредней цены клика
OK	LoadData.pm
OK		- choose_avg_strategy_for_orders
OK		- AutoBudgetForecasterAvgAPC -- загрузка
OK	Optimization.pm
OK		- calc_flat_bids_using_hulls
OK		- calc_marginal_cost (только поиск)

(O_REAL_SPENT_ACTIONS)
OK	Constants.pm -- определение
OK	Limitations.pm
OK		- limit_max_cost -- количество потраченных actions
OK		- calc_eir
OK	LoadData.pm
OK		- ABExperimentCurWeek загрузка
OK		- ABSpentPlan загрузка
OK		- ABExperimentCurWeek второй раз загрузка

INTERNAL_MIN_CPM (INTERNAL_MIN_BID)
OK	Constants.pm -- определение
OK	Limitations.pm
OK		- get_avg_strategy_max_cost округление до шага минимальной ставки
OK		- limit_max_cost ограничение максимальной ставки
OK		- limit_banner_phrase_max_cost
OK		- get_overdraft округление
OK	LoadData.pm
OK		- инициализация O_CURRENCY
OK		- сравнение с maxcost для обрезания
OK		- инициализация cost и cpc
OK		- upper_rot_bid вычисление
OK		- инициализация других параметров при чтении load_costs_forecast_auction
	Optimization.pm
OK		- turn_banner_off выключение баннера и проставление минимальной ставки
OK		- использовуется в оболочке поиска в случае, когда первое ребро больше чем maxcost
OK		- mix_adjusted_stat используется тут как шаг (только внутри оптимизации поиска)
OK		- calc_flat_bids_using_hulls огрничитель для всяких максимальных цен, дефолтное значение ставки
OK		- optimize_for_net_cpc -- lower_net_bid_restiction ограничитель
OK		- optimize_for_lazy используется в рассчетах
OK		- calc_flat_bids_native (легаси)
OK		- calc_flat_probability используется как дефолтное значение и при применении амнистии
OK		- set_to_rotation используется в вычислениях (только поиск)
OK	autobudget.pl
OK		- дефолтное значение default_net_bid
OK		- округление fake_spent_money

(max_click_cost)
OK	Hull.pm
OK		- append_max_cost_point
OK	Limitations.pm
OK		- limit_banner_phrase_max_cost
OK		- reset_banner_phrase_max_click_cost
OK	LoadData.pm
OK		- заполнение  max_click_cost_cur
OK		- сравнения при чтении AuctionFullGroupBannerPhrase
	Optimization.pm
OK		- correct_bid
		- calc_flat_bids_using_hulls используется в рассчетах
OK		- build_convex_hull используется для отрезания (только в поиске)
OK		- mix_adjusted_stat обрезание по max_click_cost (используется внутри optimize_with_convex_hull)
OK		- calc_flat_bids_native активно используется в рассчетах (легаси)
OK		- adjusted_quality -- используется в рассчетах (только в поиске)
OK		- calc_marginal_cost используется в рассчетах (только в поиске)
OK	Phrase.pm
OK		- прокидывание от заказа

(max_click_cost_cur)
OK	Limitations.pm
OK		- reset_banner_phrase_max_click_cost меняется параметр
OK	LoadData.pm
OK		- инициализация
OK	Optimization.pm
OK		- correct_bid ограничитель для ставки

(O_MAX_CLICK_COST_CUR)
OK	Limitations.pm
OK		- limit_max_cost исправление значения
OK	LoadData.pm
OK		- инициализация
OK		- приобрасывание до max_click_cost_cur
OK	autobudget.pl
OK		- определение условия lazy, reason: max_cost

(min_bid)
OK	Constants.pm
OK		- инициализация
OK	LoadData.pm
OK		- инициализация для несущствующей валюты
OK	Optimization.pm
OK		- turn_banner_off установка минимальной ставки (надо выпилить)
OK		- correct_bid обрезание снизу по минимальной ставке
OK	autobudget.pl
OK		- определение lazy, reason: max_cost

DEF_MAX_CPM (DEF_MAX_COST)
OK	Constants.pm -- определение
OK	LoadData.pm -- ограничение загруженного из базы значения
OK	Phrase.pm -- проброс ограничения на уровень баннеро-фразы (max_click_cost)

INTERNAL_MIN_CPM_COEFF (INTERNAL_MIN_BID_COEFF) OK	Constants.pm
OK		- определяет INTERNAL_MIN_BID
OK		- определяет min_bid

O_REAL_SPENT_SHOWS( O_REAL_SPENT_CLICKS)
OK	Constants.pm -- определение
OK	Limitations.pm -- использование
OK	LoadData.pm
OK		- выгрузка из ABSpentPlan
OK		- выгрузка из ABExperimentCurWeek
OK		- выгрузка из AutoBudgetStatCurWeek
OK	autobudget.pl
OK		- заполнение истории avgcost

spent_plan_shows (spent_plan_clicks)
OK	Limitations.pm
OK		- входит в get_min_limits
OK	Optimization.pm
OK		- инициализация нулем
OK	autobudget.pl
OK		- попадание из autobudget_function в ostat
OK			- optimize_for_net_cpc -- или нули, или optimize_for_daily
OK			- optimize_for_daily -- тут легко считается shows
OK			- optimize_for_lazy -- тут легко считается shows
OK			- optimize_for_flat_only -- возвращает нули
OK			- optimize_with_convex_hull -- это вариант с поиском, его нет

Изменить функции интерфейса abmonitoring.cgi

svn+ssh://arcadia.yandex.ru/arc/branches/yabs/task/yabs-autobudget2/BSDEV-64256
yabs-autobudget2=64256.BSDEV.001

sudo apt-get install  yabs-yt-api=000.145 yabs-yt-standalone-conf=000.22 yabs-yt-standalone-conf-19.1=000.22 yandex-yt=19.1.22177-prestable~6fc59f4 yandex-yt-http-proxy=19.1.22177-prestable~6fc59f4 yandex-yt-local=0.0.52-2 yandex-yt-perl=19.1.22177-prestable~6fc59f4 yandex-yt-perl-19.1=19.1.22177-prestable~6fc59f4 yandex-yt-python=0.8.11-0 yandex-yt-python-driver=19.1.22177-prestable~6fc59f4 yandex-yt-python-tools=0.2.118-0 yandex-yt-python-yson=0.3.7-0


Максимальная цена
	- кликов
	- показов

Оптимизация по
	- кликам
	- показам
	- доходу
	- показа

https://pnevmat24.ru/pnevmaticheskiy-revolver-gletcher-sw-b8/


RotateVisitLog2017092418500332

TemplateResource
https://dashboard-yabscs5.n.yandex-team.ru/settings -- препрод
https://dashboard-yabscs1.n.yandex-team.ru/settings -- прод

https://st.yandex-team.ru/DIRECT-69250

sas1-8336-23202.vm.search.yandex.net

Исправление легаси:
	- FIX_LEGACY_AVG_COST_RESERVE

64256.BSDEV.003


